<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List
href="oltp_emul_test_for_firebird_25_and_30_-_description.files/filelist.xml">
<title>Тест, имитирующий  OLTP-работу пользователей</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="metricconverter"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="place"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="country-region"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="City"/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Kuntsevo</o:Author>
  <o:LastAuthor>Zotov</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>5602</o:TotalTime>
  <o:Created>2014-12-30T18:09:00Z</o:Created>
  <o:LastSaved>2014-12-30T18:09:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>35373</o:Words>
  <o:Characters>201627</o:Characters>
  <o:Company>TC_Kuntsevo</o:Company>
  <o:Lines>1680</o:Lines>
  <o:Paragraphs>473</o:Paragraphs>
  <o:CharactersWithSpaces>236527</o:CharactersWithSpaces>
  <o:Version>11.9999</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:PunctuationKerning/>
  <w:DrawingGridHorizontalSpacing>6 пт</w:DrawingGridHorizontalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>2</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>2</w:DisplayVerticalDrawingGridEvery>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Helvetica;
	panose-1:2 11 6 4 2 2 2 2 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:Courier;
	panose-1:2 7 4 9 2 2 5 2 4 4;
	mso-font-charset:0;
	mso-generic-font-family:modern;
	mso-font-format:other;
	mso-font-pitch:fixed;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:"Tms Rmn";
	panose-1:2 2 6 3 4 5 5 2 3 4;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:Helv;
	panose-1:2 11 6 4 2 2 2 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:"New York";
	panose-1:2 4 5 3 6 5 6 2 3 4;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:System;
	panose-1:0 0 0 0 0 0 0 0 0 0;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
@font-face
	{font-family:"MS Mincho";
	panose-1:2 2 6 9 4 2 5 8 3 4;
	mso-font-alt:"\FF2D\FF33 \660E\671D";
	mso-font-charset:128;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:fixed;
	mso-font-signature:1 134676480 16 0 131072 0;}
@font-face
	{font-family:Batang;
	panose-1:2 3 6 0 0 1 1 1 1 1;
	mso-font-alt:\BC14\D0D5;
	mso-font-charset:129;
	mso-generic-font-family:auto;
	mso-font-format:other;
	mso-font-pitch:fixed;
	mso-font-signature:1 151388160 16 0 524288 0;}
@font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:\5B8B\4F53;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:1 135135232 16 0 262144 0;}
@font-face
	{font-family:PMingLiU;
	panose-1:2 1 6 1 0 1 1 1 1 1;
	mso-font-alt:\65B0\7D30\660E\9AD4;
	mso-font-charset:136;
	mso-generic-font-family:auto;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:1 134742016 16 0 1048576 0;}
@font-face
	{font-family:"MS Gothic";
	panose-1:2 11 6 9 7 2 5 8 2 4;
	mso-font-alt:"\FF2D\FF33 \30B4\30B7\30C3\30AF";
	mso-font-charset:128;
	mso-generic-font-family:modern;
	mso-font-format:other;
	mso-font-pitch:fixed;
	mso-font-signature:1 134676480 16 0 131072 0;}
@font-face
	{font-family:Dotum;
	panose-1:2 11 6 0 0 1 1 1 1 1;
	mso-font-alt:\B3CB\C6C0;
	mso-font-charset:129;
	mso-generic-font-family:modern;
	mso-font-format:other;
	mso-font-pitch:fixed;
	mso-font-signature:1 151388160 16 0 524288 0;}
@font-face
	{font-family:SimHei;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:\9ED1\4F53;
	mso-font-charset:134;
	mso-generic-font-family:modern;
	mso-font-format:other;
	mso-font-pitch:fixed;
	mso-font-signature:1 135135232 16 0 262144 0;}
@font-face
	{font-family:MingLiU;
	panose-1:2 1 6 9 0 1 1 1 1 1;
	mso-font-alt:\7D30\660E\9AD4;
	mso-font-charset:136;
	mso-generic-font-family:modern;
	mso-font-format:other;
	mso-font-pitch:fixed;
	mso-font-signature:1 134742016 16 0 1048576 0;}
@font-face
	{font-family:Mincho;
	panose-1:2 2 6 9 4 3 5 8 3 5;
	mso-font-alt:\660E\671D;
	mso-font-charset:128;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:fixed;
	mso-font-signature:1 134676480 16 0 131072 0;}
@font-face
	{font-family:Gulim;
	panose-1:2 11 6 0 0 1 1 1 1 1;
	mso-font-alt:\AD74\B9BC;
	mso-font-charset:129;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:fixed;
	mso-font-signature:1 151388160 16 0 524288 0;}
@font-face
	{font-family:Century;
	panose-1:2 4 6 4 5 5 5 2 3 4;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:"Angsana New";
	panose-1:2 2 6 3 5 4 5 2 3 4;
	mso-font-charset:222;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:16777217 0 0 0 65536 0;}
@font-face
	{font-family:"Cordia New";
	panose-1:2 11 3 4 2 2 2 2 2 4;
	mso-font-charset:222;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:16777217 0 0 0 65536 0;}
@font-face
	{font-family:Mangal;
	panose-1:0 0 4 0 0 0 0 0 0 0;
	mso-font-charset:1;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:32768 0 0 0 0 0;}
@font-face
	{font-family:Latha;
	panose-1:2 0 4 0 0 0 0 0 0 0;
	mso-font-charset:1;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:1048576 0 0 0 0 0;}
@font-face
	{font-family:Sylfaen;
	panose-1:1 10 5 2 5 3 6 3 3 3;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:16778883 0 512 0 13 0;}
@font-face
	{font-family:Vrinda;
	panose-1:0 0 4 0 0 0 0 0 0 0;
	mso-font-charset:1;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:0 0 0 0 0 0;}
@font-face
	{font-family:Raavi;
	panose-1:2 0 5 0 0 0 0 0 0 0;
	mso-font-charset:1;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:0 0 0 0 0 0;}
@font-face
	{font-family:Shruti;
	panose-1:2 0 5 0 0 0 0 0 0 0;
	mso-font-charset:1;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:0 0 0 0 0 0;}
@font-face
	{font-family:Sendnya;
	panose-1:0 0 4 0 0 0 0 0 0 0;
	mso-font-charset:1;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:0 0 0 0 0 0;}
@font-face
	{font-family:Gautami;
	panose-1:2 0 5 0 0 0 0 0 0 0;
	mso-font-charset:1;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:0 0 0 0 0 0;}
@font-face
	{font-family:Tunga;
	panose-1:0 0 4 0 0 0 0 0 0 0;
	mso-font-charset:1;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:0 0 0 0 0 0;}
@font-face
	{font-family:"Estrangelo Edessa";
	panose-1:0 0 0 0 0 0 0 0 0 0;
	mso-font-charset:1;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:0 0 0 0 0 0;}
@font-face
	{font-family:Kartika;
	panose-1:1 1 1 0 1 1 1 1 1 1;
	mso-font-charset:1;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:0 0 0 0 0 0;}
@font-face
	{font-family:"Arial Unicode MS";
	panose-1:2 11 6 4 2 2 2 2 2 4;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:204;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:553679495 -2147483648 8 0 66047 0;}
@font-face
	{font-family:"Arial CYR";
	panose-1:2 11 6 4 2 2 2 2 2 4;
	mso-font-charset:204;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:536902279 -2147483648 8 0 511 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h3
	{mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	mso-outline-level:3;
	font-size:13.5pt;
	font-family:"Times New Roman";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
pre
	{margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";}
span.tinylink
	{mso-style-name:tinylink;}
span.msoIns
	{mso-style-type:export-only;
	mso-style-name:"";
	text-decoration:underline;
	text-underline:single;
	color:teal;}
span.msoDel
	{mso-style-type:export-only;
	mso-style-name:"";
	text-decoration:line-through;
	color:red;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:1.0cm 1.0cm 1.0cm 1.0cm;
	mso-header-margin:35.45pt;
	mso-footer-margin:35.45pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:48844343;
	mso-list-type:hybrid;
	mso-list-template-ids:1681700770 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l0:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l1
	{mso-list-id:63917966;
	mso-list-type:hybrid;
	mso-list-template-ids:111177734 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l1:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l2
	{mso-list-id:87508477;
	mso-list-type:hybrid;
	mso-list-template-ids:130596330 68747279 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l2:level1
	{mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l3
	{mso-list-id:167672511;
	mso-list-type:hybrid;
	mso-list-template-ids:417993650 68747279 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l3:level1
	{mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l4
	{mso-list-id:316031979;
	mso-list-type:hybrid;
	mso-list-template-ids:-1301367944 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l4:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l5
	{mso-list-id:353504682;
	mso-list-type:hybrid;
	mso-list-template-ids:1596072818 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l5:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l6
	{mso-list-id:393092830;
	mso-list-type:hybrid;
	mso-list-template-ids:-761362246 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l6:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l7
	{mso-list-id:485636259;
	mso-list-type:hybrid;
	mso-list-template-ids:-1512270868 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l7:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l8
	{mso-list-id:530723567;
	mso-list-type:hybrid;
	mso-list-template-ids:-1890165970 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l8:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l9
	{mso-list-id:642471543;
	mso-list-type:hybrid;
	mso-list-template-ids:1013192866 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l9:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l10
	{mso-list-id:689843915;
	mso-list-type:hybrid;
	mso-list-template-ids:-1689106430 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l10:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l11
	{mso-list-id:846137034;
	mso-list-type:hybrid;
	mso-list-template-ids:-2102242906 -1591291210 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l11:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ascii-font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
@list l12
	{mso-list-id:963462906;
	mso-list-type:hybrid;
	mso-list-template-ids:519052758 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l12:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l13
	{mso-list-id:1012925004;
	mso-list-type:hybrid;
	mso-list-template-ids:2139626798 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l13:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l14
	{mso-list-id:1123424285;
	mso-list-type:hybrid;
	mso-list-template-ids:-87371848 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l14:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l15
	{mso-list-id:1152285349;
	mso-list-type:hybrid;
	mso-list-template-ids:-678249016 -2078014870 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l15:level1
	{mso-level-start-at:4;
	mso-level-text:"%1\)";
	mso-level-tab-stop:27.0pt;
	mso-level-number-position:left;
	margin-left:27.0pt;
	text-indent:-18.0pt;}
@list l16
	{mso-list-id:1401126141;
	mso-list-type:hybrid;
	mso-list-template-ids:-878921838 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l16:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l17
	{mso-list-id:1442990296;
	mso-list-type:hybrid;
	mso-list-template-ids:-88300766 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l17:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l18
	{mso-list-id:1473671970;
	mso-list-type:hybrid;
	mso-list-template-ids:-1294282272 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l18:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l19
	{mso-list-id:1642491619;
	mso-list-type:hybrid;
	mso-list-template-ids:1755709650 -1812065182 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l19:level1
	{mso-level-text:%1;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l20
	{mso-list-id:1748458723;
	mso-list-type:hybrid;
	mso-list-template-ids:1269827270 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l20:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l21
	{mso-list-id:1749380698;
	mso-list-type:hybrid;
	mso-list-template-ids:1144414668 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l21:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l22
	{mso-list-id:1754159683;
	mso-list-type:hybrid;
	mso-list-template-ids:-500411860 -114280174 68747267 68747269 68747265 68747267 68747269 68747265 68747267 68747269;}
@list l22:level1
	{mso-level-start-at:2;
	mso-level-number-format:bullet;
	mso-level-text:-;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
@list l23
	{mso-list-id:1874076529;
	mso-list-type:hybrid;
	mso-list-template-ids:-484688532 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l23:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l24
	{mso-list-id:2015985129;
	mso-list-type:hybrid;
	mso-list-template-ids:2122490910 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l24:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
@list l25
	{mso-list-id:2108234738;
	mso-list-type:hybrid;
	mso-list-template-ids:1584188916 68747281 68747289 68747291 68747279 68747289 68747291 68747279 68747289 68747291;}
@list l25:level1
	{mso-level-text:"%1\)";
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Обычная таблица";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=RU link=blue vlink=purple style='tab-interval:35.4pt'>

<div class=Section1>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'># #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # <o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'># #
#<span
style='mso-spacerun:yes'>                                                                  
</span># # #<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'># #
#<span style='mso-spacerun:yes'>                         </span>O L T P<span
style='mso-spacerun:yes'>   </span>-<span style='mso-spacerun:yes'>   </span>E
M U L<span style='mso-spacerun:yes'>                     </span># # #<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'># #
#<span style='mso-spacerun:yes'>                </span><span
style='mso-spacerun:yes'>                                                   </span>#
# #<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'># #
#<span style='mso-spacerun:yes'>   </span>f o r<span
style='mso-spacerun:yes'>    </span>F i r e b i r d<span
style='mso-spacerun:yes'>   </span>D a t a b a s e<span
style='mso-spacerun:yes'>    </span>2.5<span style='mso-spacerun:yes'>  
</span>&amp;<span style='mso-spacerun:yes'>   </span>3.0<span
style='mso-spacerun:yes'>     </span># # #<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'># #
#<span
style='mso-spacerun:yes'>                                                                  
</span># # #<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'># #
#<span style='mso-spacerun:yes'>                                      </span><span
style='mso-spacerun:yes'>                             </span># # #<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'># #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Copyright: (C)
Pavel Zotov, <st1:place w:st="on"><st1:City w:st="on">Moscow</st1:City>, <st1:country-region
 w:st="on">Russia</st1:country-region></st1:place>. 2014.<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>По всем вопросам, связанным с работой теста, прошу
обращаться по адресу: <span lang=EN-US style='mso-ansi-language:EN-US'>p</span>519446@<span
lang=EN-US style='mso-ansi-language:EN-US'>yandex</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>ru</span></p>

<p class=MsoNormal>Для получения последней версии теста: </p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"Courier New";mso-ansi-language:EN-US'>svn</span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-family:"Courier New"'>
</span></b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"Courier New";mso-ansi-language:EN-US'>checkout</span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-family:"Courier New"'>
</span></b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-family:"Courier New";mso-ansi-language:EN-US'>svn</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-family:"Courier New"'>://</span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-family:"Courier New";
mso-ansi-language:EN-US'>svn</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'>.</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"Courier New";mso-ansi-language:
EN-US'>code</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'>.</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"Courier New";mso-ansi-language:
EN-US'>sf</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'>.</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"Courier New";mso-ansi-language:
EN-US'>net</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'>/</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"Courier New";mso-ansi-language:
EN-US'>p</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'>/</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"Courier New";mso-ansi-language:
EN-US'>firebird</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'>/</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"Courier New";mso-ansi-language:
EN-US'>code</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'>/</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"Courier New";mso-ansi-language:
EN-US'>qa</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'>/</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"Courier New";mso-ansi-language:
EN-US'>oltp</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'>-</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"Courier New";mso-ansi-language:
EN-US'>emul</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'>/ .<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Краткое описание <o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal>Тест создан для имитации нагрузки, возникающей в типичных <span
lang=EN-US style='mso-ansi-language:EN-US'>OLTP</span>-приложениях (большое число
<span style='mso-spacerun:yes'> </span>коротких пишущих транзакций), а также для
сравнения версий СУБД <span lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span><span
lang=EN-US> </span>2.5 и 3.0. </p>

<p class=MsoNormal>Формирование объектов базы и запуск теста производятся через
командные сценарии операционной системы, <span
style='mso-spacerun:yes'> </span>реализованные для <span lang=EN-US
style='mso-ansi-language:EN-US'>Windows</span> и <span lang=EN-US
style='mso-ansi-language:EN-US'>Linux</span>. </p>

<p class=MsoNormal>Файл базы данных может отсутствовать на сервере. В этом
случае она будет автоматически создана, однако её имя в этом случае должно быть
указано вместе с каталогом, т.е. НЕ в виде алиаса.</p>

<p class=MsoNormal>На машине, которая проводит запуск тестовых <span
lang=EN-US style='mso-ansi-language:EN-US'>ISQL</span>-сессий, должны
присутствовать консольные утилиты <span lang=EN-US style='mso-ansi-language:
EN-US'>Firebird</span>: <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>,
<span lang=EN-US style='mso-ansi-language:EN-US'>fbsvcmgr</span>, <span
lang=EN-US style='mso-ansi-language:EN-US'>gfix</span><span lang=EN-US> </span>и
<span lang=EN-US style='mso-ansi-language:EN-US'>gstat</span>, <span
style='mso-spacerun:yes'> </span>а также все необходимые для их запуска
библиотеки. </p>

<p class=MsoNormal>Никаких сторонних продуктов или утилит для работы не
требуется, хотя при работе в <span lang=EN-US style='mso-ansi-language:EN-US'>Windows</span><span
lang=EN-US> </span>полезным будет наличие утилит <span lang=EN-US
style='mso-ansi-language:EN-US'>mtee</span> (для снабжения сообщений об ошибках
<span lang=EN-US style='mso-ansi-language:EN-US'>isql</span> штампами времени
при их логировании) и <span lang=EN-US style='mso-ansi-language:EN-US'>pskill</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>exe</span><span lang=EN-US> </span>(для
быстрого снятия всех запущенных <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>-окон).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Проверяемая версия <span lang=EN-US style='mso-ansi-language:
EN-US'>Firebird</span><span lang=EN-US> </span>(2.5 или 3.0) и число коннектов,
которое необходимо открыть, задаются двумя аргументами к сценарию запуска
теста. Имя сценария - 1run_oltp_emul.bat (или одноимённый с расширением .<span
lang=EN-US style='mso-ansi-language:EN-US'>sh</span><span lang=EN-US> </span>для
работы в <span lang=EN-US style='mso-ansi-language:EN-US'>Linux</span>).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Параметры подключения и выполнения (каталог консольных
утилит <span lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span>, <span
lang=EN-US style='mso-ansi-language:EN-US'>host</span>, <span lang=EN-US
style='mso-ansi-language:EN-US'>port</span>, имя или алиас базы, длительность
работы и др.) хранятся в текстовых файлах – <span lang=EN-US style='mso-ansi-language:
EN-US'>oltp</span>25_<span lang=EN-US style='mso-ansi-language:EN-US'>config</span>
и <span lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>30_<span
lang=EN-US style='mso-ansi-language:EN-US'>config</span> (т.е. отдельно на
каждую версию <span lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span>).
Эти файлы расличаются для работы под <span lang=EN-US style='mso-ansi-language:
EN-US'>Windows</span><span lang=EN-US> </span>и <span lang=EN-US
style='mso-ansi-language:EN-US'>Linux</span>, что отражается расширениями: .<span
lang=EN-US style='mso-ansi-language:EN-US'>win</span><span lang=EN-US> </span>и
.<span lang=EN-US style='mso-ansi-language:EN-US'>nix</span> соответственно.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Средний объем работы, которую должна выполнять каждая из
транзакций, определяется т.н. «нагрузочным пакетом» - набором настроек,
записанных в базе. Эти настройки представлены в одном из скриптов («oltp_main_filling.sql»),
в достаточно наглядной форме, поэтому их легко изменить. Также легко добавить
новый нагрузочный пакет.<span style='mso-spacerun:yes'>  </span>В скрипте oltp_main_filling.sql
представлены нагрузочные пакеты для малого, среднего и большого уровня
нагрузки.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Командный файл, открывающий несколько подключений (<span
lang=EN-US style='mso-ansi-language:EN-US'>isql</span> окон), считывает из <span
lang=EN-US style='mso-ansi-language:EN-US'>config</span>-файла длительность
работы теста и прописывает в базе момент её окончания. Запущенные <span
lang=EN-US style='mso-ansi-language:EN-US'>isql</span>-окна автоматически
завершат свою работу, когда системное время достигнет назначенного предела.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Каждое из <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>-окон
выполняет один и тот же скрипт, вызывая в рамках одной транзакции одну бизнес-операцию.
Выбор операции производится с учетом того, насколько часто она происходит в реальности,
что регулируется настройками в базе. Для <span lang=EN-US style='mso-ansi-language:
EN-US'>Firebird</span> 3.0 существует настройка, позволяющая получить<span
style='mso-spacerun:yes'>  </span>детальный отчет по данным мониторинга о
производительности каждого вида бизнес-операций (как в сводном виде, так и с
расшифровкой по затратам на отдельные таблицы).</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Sql</span>-скрипт
генерируется автоматически и содержит 300 блоков, стартующих транзакции. По его
окончании управление вернётся в .<span lang=EN-US style='mso-ansi-language:
EN-US'>bat</span>-файл и <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>-окно
выполнит переконнект к базе.<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Имя<span style='mso-ansi-language:EN-US'> </span>скрипта<span
lang=EN-US style='mso-ansi-language:EN-US'>: %tmpdir%\sql\tmp_random_run.sql, </span>где<span
style='mso-ansi-language:EN-US'> <span lang=EN-US>%tmpdir% - </span></span>параметр<span
lang=EN-US style='mso-ansi-language:EN-US'>, </span>хранящий<span
style='mso-ansi-language:EN-US'> </span>маршрут<span style='mso-ansi-language:
EN-US'> </span>к<span style='mso-ansi-language:EN-US'> </span>временным<span
style='mso-ansi-language:EN-US'> </span>файлам<span style='mso-ansi-language:
EN-US'> </span>теста<span lang=EN-US style='mso-ansi-language:EN-US'>, </span>указывается<span
style='mso-ansi-language:EN-US'> </span>в<span style='mso-ansi-language:EN-US'>
<span lang=EN-US>config-</span></span>файле<span style='mso-ansi-language:EN-US'>
</span>теста<span lang=EN-US style='mso-ansi-language:EN-US'>.<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'> </span><o:p></o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Фазы работы нагрузочных
сессий (« [заполнение -&gt; ] разогрев -&gt; замеры »)<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Каждый запуск теста проходит либо три (если база пустая или
«недозаполненная»), либо две фазы:<br>
<b style='mso-bidi-font-weight:normal'>а</b>) заполнение базы документами до
необходимого минимального их числа;<br>
<b style='mso-bidi-font-weight:normal'>б</b>) «разогрев» базы в течение
нескольких минут, чтобы значительные её фрагменты загрузились в файловый кеш <span
lang=EN-US style='mso-ansi-language:EN-US'>OS</span>;<br>
<b style='mso-bidi-font-weight:normal'>в</b>) интервал замера
производительности и выдача итогового отчета в виде текста (также допускается
его получение вызовом служебной ХП, см ниже).</p>

<p class=MsoNormal><br>
Фаза «<b style='mso-bidi-font-weight:normal'>а</b>» необходима только в случае,
когда в базе нет документов или недостаточно их количество. Разумеется, в этой
фазе с базой работает только один коннект. Необходимость этой фазы определяется
автоматически командным сценарием (с помощью запроса к базе). Количество
документов, которое требуется создать на этой фазе, настраивается через
текстовый файл конфигурации (см. ниже).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Фаза «<b style='mso-bidi-font-weight:normal'>б</b>»
(разогрев базы) начинается с создания того количества нагрузочных коннектов,
которое будет указано в виде аргумента командному сценарию .<span lang=EN-US
style='mso-ansi-language:EN-US'>bat</span>-файлу. Далее эти коннекты будут
делать те же операции, что и на основном этапе («в»), но их результаты не будут
учитываться в итоговом анализе производительности. </p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Фаза «<b style='mso-bidi-font-weight:normal'>в</b>» является
основной: нагрузочные коннекты продолжают действия, начатые на предыдущей фазе,
но показатели времени их выполнения уже будут учитываться в итоговом отчете. </p>

<p class=MsoNormal>Длительность фаз «б» и «в» задается в минутах<span
style='mso-spacerun:yes'>  </span>в файле конфигурации теста.<span lang=EN-US
style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Замечание-1.<o:p></o:p></b></p>

<p class=MsoNormal>О<b style='mso-bidi-font-weight:normal'> </b>временном
изменении <b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>forced</span><span lang=EN-US> </span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>writes</span></b> на фазе «<b style='mso-bidi-font-weight:normal'>а</b>»
в значение <span lang=EN-US style='mso-ansi-language:EN-US'>OFF</span>.</p>

<p class=MsoNormal>Если командный сценарий определил необходимость этой фазы, и
при этом на выполняющей его клиентской машине имеется утилита <span lang=EN-US
style='mso-ansi-language:EN-US'>gfix</span>, то сценарий:</p>

<p class=MsoNormal>1) запомнит в переменной окружения текущее значение
параметра <span lang=EN-US style='mso-ansi-language:EN-US'>forced</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>writes</span>
</p>

<p class=MsoNormal>2) запишет в базу информацию о том, что <i style='mso-bidi-font-style:
normal'>начинается</i> изменение <span lang=EN-US style='mso-ansi-language:
EN-US'>FW</span><br>
3) выполнит команду изменения <span lang=EN-US style='mso-ansi-language:EN-US'>forced</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>writes</span>:
<span lang=EN-US style='mso-ansi-language:EN-US'>gfix</span> –<span lang=EN-US
style='mso-ansi-language:EN-US'>w</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>async</span> …<br>
4) восстановит по окончании фазы начального заполнения предыдущее значение <span
lang=EN-US style='mso-ansi-language:EN-US'>forced</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>writes</span><span lang=EN-US> </span><span
style='mso-spacerun:yes'> </span>(командой <span lang=EN-US style='mso-ansi-language:
EN-US'>gfix</span>) и </p>

<p class=MsoNormal>5) запишет в базу информацию о том, что изменённое значение <span
lang=EN-US style='mso-ansi-language:EN-US'>FW</span><span lang=EN-US> </span><i
style='mso-bidi-font-style:normal'>возвращено</i> в начальное.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>При повторном вызове теста указанные манипуляции с <span
lang=EN-US style='mso-ansi-language:EN-US'>FW</span><span lang=EN-US> </span>будут
выполнены на фазе «а» только в том случае, когда в базе НЕТ записи, в которой
указан признак начала изменения <span lang=EN-US style='mso-ansi-language:EN-US'>FW</span>,
но нет признака возврата к предыдущему состоянию. Другими<span
style='mso-spacerun:yes'>  </span>словами: если фаза «а» была прервана, то <span
lang=EN-US style='mso-ansi-language:EN-US'>FW</span> может остаться в
состоянии, отличающемся от того, которое было запланировано. В этом случае
сценарий ничего менять в статусе <span lang=EN-US style='mso-ansi-language:
EN-US'>FW</span><span lang=EN-US> </span>не будет и возврат к прежнему значению
(которое <i style='mso-bidi-font-style:normal'>планировалось</i> для теста)
должен сделать тестировщик.<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Замечание-2.<o:p></o:p></b></p>

<p class=MsoNormal>О временном увеличении размера страничного кеша на фазе «<b
style='mso-bidi-font-weight:normal'>а</b>».</p>

<p class=MsoNormal>Командный сценарий всегда будет выполнять начальное
заполнение документов с достаточно большим значением кеша (16384 страницы). Это
значение будет проигнорировано при работе с <span lang=EN-US style='mso-ansi-language:
EN-US'>FB</span> в архитектуре <span lang=EN-US style='mso-ansi-language:EN-US'>SuperServer</span>.
Однако, если в файле <span lang=EN-US style='mso-ansi-language:EN-US'>firebird</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>conf</span><span lang=EN-US> </span>задано
«нетипично» малое значение параметра <span lang=EN-US style='mso-ansi-language:
EN-US'>FileSystemCacheThreshold</span>, меньшее чем 16384, то эффект будет обратным:
вместо увеличения быстродействия при заполнении будет сильное уменьшение. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Требования к версии </b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>Firebird</span>, машине сервера и машинам клиентов<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>При работе на <span lang=EN-US style='mso-ansi-language:
EN-US'>Firebird</span> 3.0 требуется установить последнюю на текущий момент
сборку. В процессе разработки теста было выявлено несколько ошибок уровня ядра <span
lang=EN-US style='mso-ansi-language:EN-US'>FB</span> 3.0, часть из них была
исправлена разработчиками – см. список в конце этого документа.</p>

<pre><span style='font-size:12.0pt;font-family:"Times New Roman"'>При работе на </span><span
lang=EN-US style='font-size:12.0pt;font-family:"Times New Roman";mso-ansi-language:
EN-US'>Firebird</span><span style='font-size:12.0pt;font-family:"Times New Roman"'> 2.5 допускается устанавливать официальный релиз 2.5.3 от 18.07.2014 (сборка 26778). <b
style='mso-bidi-font-weight:normal'>Рекомендуется</b>, тем не менее, устанавливать сборку не ниже 3.3.26790 - <span style='mso-spacerun:yes'> </span>ввиду исправления проблемы с получением стека вызовов в </span><span
lang=EN-US style='font-size:12.0pt;font-family:"Times New Roman";mso-ansi-language:
EN-US'>PSQL</span><span style='font-size:12.0pt;font-family:"Times New Roman"'>-коде, см. </span><span
lang=EN-US style='font-size:12.0pt;font-family:"Times New Roman";mso-ansi-language:
EN-US'>ChangeLog, </span><span style='font-size:12.0pt;font-family:"Times New Roman"'>сообщение</span><span
lang=EN-US style='font-size:12.0pt;font-family:"Times New Roman";mso-ansi-language:
EN-US'> 2014-08-12 10:21<span style='mso-spacerun:yes'>  </span>hvlad: «Avoid info duplication when statements in call stack».</span><span
lang=EN-US style='font-family:"Times New Roman";mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Для нормальной работы требуется сервер с объемом физической
памяти не менее 16 Гб и как минимум 4 ядрами ЦПУ. На результаты теста серьёзное
влияние оказывает производительность дисковой подсистемы.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Работа обеих версий <span lang=EN-US style='mso-ansi-language:
EN-US'>FB</span><span lang=EN-US> </span>(2.5 и 3.<span lang=EN-US
style='mso-ansi-language:EN-US'>x</span>) проверялась на 64-разрядной <span
lang=EN-US style='mso-ansi-language:EN-US'>OS</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>Linux</span><span lang=EN-US> </span>и
на<span style='mso-spacerun:yes'>  </span>32-разрядной <span lang=EN-US
style='mso-ansi-language:EN-US'>Windows</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>XP</span>. </p>

<p class=MsoNormal>Работоспособность скриптов, которые запускают работающие
окна-«клиенты», проверялась на <span lang=EN-US style='mso-ansi-language:EN-US'>OS</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>Windows</span>
2000 и <span lang=EN-US style='mso-ansi-language:EN-US'>Windows</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>XP</span>, для
<span lang=EN-US style='mso-ansi-language:EN-US'>Linux</span><span lang=EN-US> </span>–
на <span lang=EN-US style='mso-ansi-language:EN-US'>Redhat</span> 6.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:14.0pt;mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>«Как мне запустить его ?»<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>0. Скачать актуальную
версию:<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Скачайте <span lang=EN-US style='mso-ansi-language:EN-US'>svn</span>-клиент.
Создайте каталог для хранения файлов теста, перейдите внутрь него.</p>

<p class=MsoNormal>Введите команду:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'>%</span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>path</span><span style='font-size:10.0pt;font-family:"Courier New"'>_</span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>to</span><span style='font-size:10.0pt;font-family:"Courier New"'>_</span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>svn</span><span style='font-size:10.0pt;font-family:"Courier New"'>%\</span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>svn</span><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New"'>
</span><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>checkout</span><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New"'> </span><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";mso-ansi-language:EN-US'>svn</span><span
style='font-size:10.0pt;font-family:"Courier New"'>://</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>svn</span><span
style='font-size:10.0pt;font-family:"Courier New"'>.</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>code</span><span
style='font-size:10.0pt;font-family:"Courier New"'>.</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>sf</span><span
style='font-size:10.0pt;font-family:"Courier New"'>.</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>net</span><span
style='font-size:10.0pt;font-family:"Courier New"'>/</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>p</span><span
style='font-size:10.0pt;font-family:"Courier New"'>/</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>firebird</span><span
style='font-size:10.0pt;font-family:"Courier New"'>/</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>code</span><span
style='font-size:10.0pt;font-family:"Courier New"'>/</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>qa</span><span
style='font-size:10.0pt;font-family:"Courier New"'>/</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>oltp</span><span
style='font-size:10.0pt;font-family:"Courier New"'>-</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>emul</span><span
style='font-size:10.0pt;font-family:"Courier New"'>/ </span><b
style='mso-bidi-font-weight:normal'><span style='font-size:16.0pt;font-family:
"Courier New";color:yellow;background:navy;mso-highlight:navy'>.</span></b><span
style='font-size:10.0pt;font-family:"Courier New";color:yellow'> <o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>(обратите внимание: символ «точка» после ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>oltp</span>-<span lang=EN-US style='mso-ansi-language:
EN-US'>emul</span>/’ – обязателен).</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>1. Правка </b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>firebird</span>.</b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>conf</span><o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal>Умалчиваемые значения следующих параметров потребуется
изменить в б<b style='mso-bidi-font-weight:normal'><i style='mso-bidi-font-style:
normal'>о</i></b>льшую сторону:</p>

<p class=MsoNormal><span lang=EN-US style='font-family:"Courier New";
mso-ansi-language:EN-US'>DefaultDBCachePages</span><span style='font-family:
"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:"Courier New";
mso-ansi-language:EN-US'>TempCacheLimit</span><span style='font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-family:"Courier New";
mso-ansi-language:EN-US'>LockHashSlots</span><span lang=EN-US style='font-family:
"Courier New"'> </span><span style='font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Для небольших уровней нагрузки (до 30-40 подключений) можно
установить следующие значения:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>1. FB 3.0:<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>DefaultDbCachePages = 64K для SuperServer; 512 </span><span
style='font-size:11.0pt;font-family:"Courier New"'>или</span><span
style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:EN-US'> <span
lang=EN-US>1024 - </span></span><span style='font-size:11.0pt;font-family:"Courier New"'>для</span><span
lang=EN-US style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'> SuperClassic<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>TempCacheLimit = 1024M<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>LockHashSlots = 22111<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>2. FB 2.5:<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>DefaultDbCachePages = 65536 - для SuperServer; 512 </span><span
style='font-size:11.0pt;font-family:"Courier New"'>или</span><span
style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:EN-US'> <span
lang=EN-US>1024 - </span></span><span style='font-size:11.0pt;font-family:"Courier New"'>для</span><span
lang=EN-US style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'> SuperClassic<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>TempCacheLimit = 1073741824<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>LockHashSlots = 22111<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Если <span lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span><span
lang=EN-US> </span>установлен на <span lang=EN-US style='mso-ansi-language:
EN-US'>OS</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>Windows</span>, то для установите значения параметров MaxUnflushedWrites
и MaxUnflushedWriteTime равными -1 (т.е. измените дефолтные значения). Это
позволит <span lang=X-NONE style='mso-ansi-language:X-NONE'>СУБД не ожидать
результатов сброса </span>кеша <span lang=X-NONE style='mso-ansi-language:X-NONE'>операционной
системы на диск</span>.<span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:Tahoma'><o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Почти в каждом модуле теста используется проверка наличия
строк в таблице с именем ‘<span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>ext</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>stoptest</span>’. Если в ней есть
хотя бы одна строка, каждый коннект прекращает свою работу, выбрасывая
исключение с именем ‘<span lang=EN-US style='mso-ansi-language:EN-US'>ex</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>test</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>cancellation</span>’. Удобно эту таблицу
сделать как <i style='mso-bidi-font-style:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>external</span></i> и тогда остановить тест
очень просто: нужно добавить всего один символ (+ символ перевода строки) в
соответствующий текстовый файл. В связи с этим, разрешите создание и хранение
данных во внешних (<span lang=EN-US style='mso-ansi-language:EN-US'>external</span>)
таблицах: задайте параметру <span lang=EN-US style='mso-ansi-language:EN-US'>ExternalFileAccess</span>
имя каталога, в котором вы разрешаете тесту делать запись в текстовый файл ‘<span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>ext</span><span style='background:silver;mso-highlight:silver'>_</span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>stoptest</span>’.</p>

<p class=MsoNormal>Например, чтобы разрешить тесту записывать в «стоп-файл», который
расположен в каталоге /<span lang=EN-US style='mso-ansi-language:EN-US'>var</span>/<span
lang=EN-US style='mso-ansi-language:EN-US'>db</span>/<span lang=EN-US
style='mso-ansi-language:EN-US'>fb</span>30, укажите:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>ExternalFileAccess
= Restrict /var/db/fb30<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Рекомендуется назначить создание временных файлов на <span
lang=EN-US style='mso-ansi-language:EN-US'>ram</span>-диске (при работе в<span
style='mso-spacerun:yes'>  </span><span lang=EN-US style='mso-ansi-language:
EN-US'>Linux</span> установите параметр <span lang=EN-US style='mso-ansi-language:
EN-US'>TempDirectories</span> = /<span lang=EN-US style='mso-ansi-language:
EN-US'>dev</span>/<span lang=EN-US style='mso-ansi-language:EN-US'>shm</span>;/<span
lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>)</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>2. Установка
переменных окружения и параметров теста<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l1 level1 lfo13;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>Тест
можно запускать с любого количества компьютеров. При запуске с одного компьютера
вы можете одновременно проверять работу<span style='mso-spacerun:yes'> 
</span>не более двух экземпляров ФБ, причём их версии должны отличаться в
первой же («старшей») цифре,<span style='mso-spacerun:yes'>  </span>т.е. 2.5 и
3.0; но не 3.0 <span lang=EN-US style='mso-ansi-language:EN-US'>SC</span><span
lang=EN-US> </span>и 3.0 <span lang=EN-US style='mso-ansi-language:EN-US'>SS</span>.<br>
Настройки теста для нагрузки инстанса ФБ 2.5 находятся в текстовом файле <b
style='mso-bidi-font-weight:normal'>oltp25_config</b>, аналогичные настройки
для ФБ 3.0 – в файле <b style='mso-bidi-font-weight:normal'>oltp30_config</b>. Файлы
с расширением ‘.<span lang=EN-US style='mso-ansi-language:EN-US'>win</span>’
предназначены для запуска <span lang=EN-US style='mso-ansi-language:EN-US'>ISQL</span>-сессий
на <span lang=EN-US style='mso-ansi-language:EN-US'>Windows</span>-машинах, с
расширением ‘.<span lang=EN-US style='mso-ansi-language:EN-US'>nix</span>’ – на
машинах под управлением <span lang=EN-US style='mso-ansi-language:EN-US'>Linux</span>.<br>
При запуске <span lang=EN-US style='mso-ansi-language:EN-US'>ISQL</span>-сессий
с нескольких компьютеров, указанные файлы должны быть скопированы на каждый из
них. <br>
Файлы <span lang=EN-US style='mso-ansi-language:EN-US'>oltpNN</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>config</span><span lang=EN-US> </span>(<span
lang=EN-US style='mso-ansi-language:EN-US'>NN</span> = 25 или 30) имеют вид,
напоминающий <span lang=EN-US style='mso-ansi-language:EN-US'>firebird</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>conf</span>. </p>

<p class=MsoNormal style='margin-left:18.0pt'><span
style='mso-spacerun:yes'>      </span>Строки, начинающиеся с символа ‘#’,
считаются комментариями. Вот пример:</p>

<p class=MsoNormal style='margin-left:18.0pt'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>#
Folder with Firebird console utilities, with or w/o trailing backslash.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'># If
folder contain spaces, enclose in quotes each part <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'># of
path that contain spaces, i.e.:<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>#
fbc=C:\&quot;Program Files&quot;\&quot;Firebird 2.5.x&quot;\bin<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>#
fbc=C:\&quot;Program Files&quot;\&quot;Firebird 3.0.x&quot;<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>fbc=
C:\MIX\firebird\fb25\bin<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>#
Folder where to store work and error logs, with or w/o trailing backslash.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'># Do
NOT use &quot;%&quot; character for referencing to some windows environment<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>#
variables like TEMP, use &quot;!&quot; instead, or specify absolute path:<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>tmpdir=!temp!\logs.oltp25<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>#
is_embed=1 - if Firebird runs in embedded mode, otherwise 0<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>is_embed=0<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>#
Alias or full path and file name of database.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'># If
you want this database be created by test itself, specify it as<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>#
FULL PATH and file name. No spaces or non-latin characters can be here.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>dbnm=/var/db/fb25/oltp25.fdb<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:18.0pt'><span lang=EN-US
style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l1 level1 lfo13;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>Перейдите
в каталог ‘<b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>src</span></b>’ (созданный ранее клиентом <span
lang=EN-US style='mso-ansi-language:EN-US'>svn</span> при скачивании теста, см.
пункт «0»). Откройте в редакторе файл <b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>oltpNN</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>config</span></b><span lang=EN-US> </span>(<span lang=EN-US
style='mso-ansi-language:EN-US'>NN</span> = 25 или 30) и исправьте значения параметров.
Вероятнее всего, Вам придется исправлять значения переменных <b
style='mso-bidi-font-weight:normal'>fbc </b>и <b style='mso-bidi-font-weight:
normal'>tmpdir</b> (<span lang=EN-US style='mso-ansi-language:EN-US'>fbc</span>
- каталог, где находится утилила <b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>isql</span></b>; <span lang=EN-US
style='mso-ansi-language:EN-US'>tmpdir</span><span lang=EN-US> </span>– каталог,
где будут складываться логи работы и ошибок), а также имя и пароль пользователя
(<span lang=EN-US style='mso-ansi-language:EN-US'>sysdba</span> / <span
lang=EN-US style='mso-ansi-language:EN-US'>masterke</span>). Обратите внимание,
что если одна переменная определяется через какую-то другую, известную в данный
момент (как <span lang=EN-US style='mso-ansi-language:EN-US'>tmpdir</span> –
через <span lang=EN-US style='mso-ansi-language:EN-US'>temp</span>), то
последнюю надо указывать в виде <b style='mso-bidi-font-weight:normal'>!</b><span
lang=EN-US style='mso-ansi-language:EN-US'>varname</span><b style='mso-bidi-font-weight:
normal'>!</b>, а не так: <s>%</s><s><span lang=EN-US style='mso-ansi-language:
EN-US'>varname</span>%</s>.<span lang=EN-US style='mso-ansi-language:EN-US'><br>
</span><b style='mso-bidi-font-weight:normal'><span style='font-size:11.0pt;
font-family:"Courier New"'><br>
</span>Внимание. </b></p>

<p class=MsoNormal style='margin-left:36.0pt'>Если каталог, где находится
утилита <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span> (т.е.
клиент <span lang=EN-US style='mso-ansi-language:EN-US'>FB</span>) содержит в
себе не латинские символы<span style='mso-spacerun:yes'>  </span>или пробелы,
то переменную <span lang=EN-US style='mso-ansi-language:EN-US'>fbc</span> надо
задавать в кавычках, причём охватывать кавычками нужно <b style='mso-bidi-font-weight:
normal'>каждую из папок</b> (это отличается от того, как показывает такие
названия <span lang=EN-US style='mso-ansi-language:EN-US'>Windows</span> в
диалоговых окнах):<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></p>

<p class=MsoNormal style='margin-left:36.0pt'><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>fbc</span><span
style='font-size:10.0pt;font-family:"Courier New"'> = </span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>C</span><span
style='font-size:10.0pt;font-family:"Courier New"'>:\</span><b
style='mso-bidi-font-weight:normal'><span style='font-family:"Courier New";
color:yellow;background:navy;mso-highlight:navy'>&quot;</span></b><span
style='font-size:10.0pt;font-family:"Courier New"'>мои документы</span><b
style='mso-bidi-font-weight:normal'><span style='font-family:"Courier New";
color:yellow;background:navy;mso-highlight:navy'>&quot;</span></b><span
style='font-size:10.0pt;font-family:"Courier New"'>\</span><b style='mso-bidi-font-weight:
normal'><span style='font-family:"Courier New";color:yellow;background:navy;
mso-highlight:navy'>&quot;</span></b><span style='font-size:10.0pt;font-family:
"Courier New"'>олтп'шный тест</span><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New";color:yellow;background:navy;mso-highlight:
navy'>&quot;</span></b><span style='font-size:10.0pt;font-family:"Courier New"'>\</span><b
style='mso-bidi-font-weight:normal'><span style='font-family:"Courier New";
color:yellow;background:navy;mso-highlight:navy'>&quot;</span></b><span
style='font-size:10.0pt;font-family:"Courier New"'>клиент для доступа к базе ФБ</span><b
style='mso-bidi-font-weight:normal'><span style='font-family:"Courier New";
color:yellow;background:navy;mso-highlight:navy'>&quot;</span></b><span
style='font-size:10.0pt;font-family:"Courier New"'>\бин <o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='margin-left:36.0pt'>При задании такого «нестандартного»
значения для переменных в редакторах типа <span lang=EN-US style='mso-ansi-language:
EN-US'>Far</span> убедитесь, что вы переключились в раскладку <span lang=EN-US
style='mso-ansi-language:EN-US'>DOS</span>. Командные сценарии (.<span
lang=EN-US style='mso-ansi-language:EN-US'>bat</span>) будут работать от имени
процесса <span lang=EN-US style='mso-ansi-language:EN-US'>cmd</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>exe</span>, поэтому указание имени в
редакторе в раскладке <span lang=EN-US style='mso-ansi-language:EN-US'>Win</span>125<span
lang=EN-US style='mso-ansi-language:EN-US'>x</span> или <span lang=EN-US
style='mso-ansi-language:EN-US'>unicode</span> приведёт к тому, что .<span
lang=EN-US style='mso-ansi-language:EN-US'>bat</span>-сценарий прочтёт имя в
неверном формате.<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l1 level1 lfo13;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>3)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>Завершающие
символы-разделители каталогов (“\” или “/”) в переменных, относящихся к
каталогам, могут отсутствовать.<br>
При указании имени пользователя, отличного от <span lang=EN-US
style='mso-ansi-language:EN-US'>SYSDBA</span>, убедитесь, что у него есть все права.<br>
Если тестируется <b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>embedded</span></b>-режим, то поменяйте
значение переменной <b style='mso-bidi-font-weight:normal'>is_embed</b> с 0 на
1.<br>
Переменные <span lang=EN-US style='mso-ansi-language:EN-US'>usr</span>, <span
lang=EN-US style='mso-ansi-language:EN-US'>pwd</span>, <span lang=EN-US
style='mso-ansi-language:EN-US'>host</span> и <span lang=EN-US
style='mso-ansi-language:EN-US'>port</span><span lang=EN-US> </span>при
is_embed=1 будут проигнорированы, однако их нельзя удалять из данного файла для
корректного запуска (и они должны иметь какие-то непустые значения).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l1 level1 lfo13;
tab-stops:list 36.0pt'><![if !supportLists]><b style='mso-bidi-font-weight:
normal'><span style='mso-list:Ignore'>4)<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></b><![endif]>Следующие параметры относятся к работе теста:<br>
<b style='mso-bidi-font-weight:normal'>init_docs</b> – минимальное количество
документов, которое должно быть в базе, прежде чем начнётся фаза её «разогрева»
нагрузочными коннектами;<br>
<b style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>no</span>_</b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>auto</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>undo</span></b><span
lang=EN-US> </span>– генерировать ли .<span lang=EN-US style='mso-ansi-language:
EN-US'>sql</span>-скрипт, который будет использоваться для нагрузки, таким
образом, чтобы транзакции стартовали с опцией <span lang=EN-US
style='mso-ansi-language:EN-US'>NO</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>AUTO</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>UNDO</span>. Наличие этой опции
позволяет улучшить производительность;<b style='mso-bidi-font-weight:normal'><br>
</b><b style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>use</span>_</b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>mtee</span><span lang=EN-US> </span></b>– использовать
ли утилиту <span lang=EN-US style='mso-ansi-language:EN-US'>mtee</span><span
lang=EN-US> </span>для записи штампов времени вместе с текстом сообщений об
ошибках, которые выдают <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>-сеансы.
Используется только при старте сессий под управлением <span lang=EN-US
style='mso-ansi-language:EN-US'>Windows</span>. По умолчанию 0 (не
использовать). Если вы установите это значение в 1, то логи <span lang=EN-US
style='mso-ansi-language:EN-US'>isql</span> будут содержать слева от каждого
сообщения еще и штамп времени;<br>
<b style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>detailed</span>_</b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>info</span></b><span lang=EN-US> </span>–
выводить ли в логи <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>
детальные результаты по каждой итерации. По умолчанию установлено в 0, т.к.
такой вывод сильно увеличивает размер логов, создаваемых каждым из <span
lang=EN-US style='mso-ansi-language:EN-US'>isql</span>-окон.Это напрямую влияет
на скорость работы самих <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>
и может сильно загрузить диск клиентской машины, где запущены работающие <span
lang=EN-US style='mso-ansi-language:EN-US'>isql</span>-окна;<br>
<b style='mso-bidi-font-weight:normal'>wait_for_copy</b> – сделать ли паузу в
сценарии после того, как база окажется заполненной минимальным числом
документов (<span lang=EN-US style='mso-ansi-language:EN-US'>init</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>docs</span>). Такую базу удобно
скопировать и далее использовать копию как «эталон» для запуска теста с другими
параметрами, но при условии, что в нём будут те же самые начальные данные. Этот
параметр игнорируется, если в базе уже есть достаточное число документов для
начала фазы разогрева: тест в этом случае сразу переходит к фазе замера
производительности;<br>
<b style='mso-bidi-font-weight:normal'>warm_time</b> – время фазы «разогрева»:
число минут, которое должны проработать нагрузочные окна, прежде чем их
активность начнёт учитываться в итоговом отчете;<br>
<b style='mso-bidi-font-weight:normal'>test_time</b> – время замера
производительности, в минутах. Итоговый отчет - процедура <span lang=EN-US
style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>mon</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>total</span>, запущенная без
параметров, - будет учитывать только те операции, которые выполнились за
последние &lt;test_time&gt; минут.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><b style='mso-bidi-font-weight:normal'><o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>3. Создание базы и
заполнение её начальными данными<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal>1) Тест может самостоятельно создать базу с размером
страницы 8192, при условии, что она указана в <span lang=EN-US
style='mso-ansi-language:EN-US'>config</span>-файле с полным путем (т.е. не в
виде алиаса). Если вас это не устраивает, создайте базу на сервере с нужными
вам параметрами, пропишите её имя в <span lang=EN-US style='mso-ansi-language:
EN-US'>aliases</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>conf</span>
(для ФБ 3.0 - в <span lang=EN-US style='mso-ansi-language:EN-US'>databases</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>conf</span>) и укажите это имя в <span
lang=EN-US style='mso-ansi-language:EN-US'>config</span>-файле теста.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>2) Если на <i style='mso-bidi-font-style:normal'>клиентской</i>
машине (где будут создаваться скрипты и запускаться <span lang=EN-US
style='mso-ansi-language:EN-US'>isql</span>-окна) работает антивирус,
остановите его. Обнаружено, что <span lang=EN-US style='mso-ansi-language:EN-US'>DrWeb</span>-9
практически блокирует вывод в текстовые файлы, проводимый процессом <span
lang=EN-US style='mso-ansi-language:EN-US'>cmd</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>exe</span>. Возможно, это же относится к другим
антивирусам.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>3) Перейдите в каталог ‘<b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>src</span></b>’ (созданный ранее
клиентом <span lang=EN-US style='mso-ansi-language:EN-US'>svn</span> при
скачивании теста, см. пункт «0») и запустите там: <b style='mso-bidi-font-weight:
normal'><span style='font-family:"Courier New"'>1</span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-family:"Courier New";
mso-ansi-language:EN-US'>run</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'>_</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"Courier New";mso-ansi-language:
EN-US'>oltp</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'>_</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"Courier New";mso-ansi-language:
EN-US'>emul</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'>.</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"Courier New";mso-ansi-language:
EN-US'>bat</span></b>(первый символ имени файла – цифра «1») с двумя
параметрами:</p>

<p class=MsoNormal>3.1) 25 или 30 – для <span lang=EN-US style='mso-ansi-language:
EN-US'>Firebird 2.5 </span>или 3.0 соответственно</p>

<p class=MsoNormal>3.2) числом сессий <span lang=EN-US style='mso-ansi-language:
EN-US'>ISQL</span>, которые должны быть автоматически запущены после того, как
будет сформирована тестовая база. Например, для автостарта 10 окон при
тестровании <span lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span>
3.0 запустите тест так: 1<span lang=EN-US style='mso-ansi-language:EN-US'>run</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>emul</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>bat</span> 30 10 (при старте окон с <span lang=EN-US style='mso-ansi-language:
EN-US'>Linux</span>: 1<span lang=EN-US style='mso-ansi-language:EN-US'>run</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>emul</span><b style='mso-bidi-font-weight:normal'>.</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>sh</span></b> 30 10).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Этот скрипт будет считывать настройки из файла <span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>oltpNN</span><span style='background:silver;mso-highlight:silver'>_</span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>config</span><span lang=EN-US> </span>(<span lang=EN-US
style='mso-ansi-language:EN-US'>NN</span> = то, что вы указали: 25 или 30) и
выведет их на экран перед тем, как сформировать объекты БД. Также он попытается
соединиться с базой и показать версию клиента и сервера (командой <span
lang=EN-US style='mso-ansi-language:EN-US'>show</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>version</span>). <span lang=EN-US
style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Если соединение установлено, скрипт выполнит запрос версии <span
lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span> обращением к
функции<span style='mso-spacerun:yes'>  </span><span lang=EN-US
style='mso-ansi-language:EN-US'>rdb</span>$<span lang=EN-US style='mso-ansi-language:
EN-US'>get</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>context</span>(‘<span
lang=EN-US style='mso-ansi-language:EN-US'>SYSTEM</span>’,’<span lang=EN-US
style='mso-ansi-language:EN-US'>ENGINE</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>VERSION</span>’) и сопоставит его результат с
входным аргументом («25» или «30»), исключив разделитель (символ точки). При
несовпадении результатов будет выдано сообщение о том, что вы пытаетесь
запустить тест с параметром, не соответствующим версии сервера.<span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Предупреждение-1.</b>
Если вы решили просмотреть созданные (ранее) объекты в какой-либо среде
разработки (<span lang=EN-US style='mso-ansi-language:EN-US'>IBExpert</span><span
lang=EN-US> </span>или другой), то её коннект будет удерживать эти объекты от
пересоздания их скриптом 1build_oltp_emul. В этом случае скрипт завершится
исключением с выдачей на консоль сообщения «At least one concurrent connection
detected.».</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Предупреждение-2.</b>
Скрипт пересоздания объектов сначала пытается УДАЛИТЬ все существующие объекты
в базе. НЕ создавайте в тестовой базе какие-либо объекты (таблицы, процедуры и
проч.), если далее будете перезапускать тест: они будут удалены. Кроме того,
нельзя создавать таблицы или хранимые запросы, у которых имена столбцов
содержат пробелы или не латинские символы (т.е. заключены в кавычки): скрипт не
сможет их корректно удалить и тест не запустится.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>4. Файлы во временном
каталоге<o:p></o:p></b></p>

<p class=MsoNormal style='margin-left:18.0pt'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В каталоге, заданном переменной <b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>tmpdir</span></b>, при
работе теста появятся файлы трёх типов: </p>

<p class=MsoNormal>а) <span lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>XX</span>_%<span lang=EN-US
style='mso-ansi-language:EN-US'>computername</span>%_<span lang=EN-US
style='mso-ansi-language:EN-US'>NNN</span>.<b style='mso-bidi-font-weight:normal'>log</b>
– лог выполняемых операций (в нём показываются выполняемые бизнес-операции и их
результаты, но НЕ показываются ошибки выполнения);</p>

<p class=MsoNormal>б) <span lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>XX</span>_%<span lang=EN-US
style='mso-ansi-language:EN-US'>computername</span>%_<span lang=EN-US
style='mso-ansi-language:EN-US'>NNN</span>.<b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>err</span></b><span lang=EN-US> </span>–
лог ошибок, которые возникали при выполнении (‘<span lang=EN-US
style='mso-ansi-language:EN-US'>update</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>conflict</span>’ <span lang=EN-US
style='mso-ansi-language:EN-US'>etc</span>);<br>
в) <span lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>XX</span>_%<span lang=EN-US
style='mso-ansi-language:EN-US'>computername</span>%_<span lang=EN-US
style='mso-ansi-language:EN-US'>NNN</span>.log.<b style='mso-bidi-font-weight:
normal'>run_log.txt</b> – это лог состояния работающего окна.</p>

<p class=MsoNormal>Лог типа «в» содержит <span lang=EN-US style='mso-ansi-language:
EN-US'>isql</span>-команду, которая запущена, показывает время начальной задержки
перед коннектом к базе, а также регистрирует удаления логов «а» и «б» при
превышении их размерами пороговых значений. </p>

<p class=MsoNormal>В указанных выше именах файлов ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>XX</span>’ соответствует версии <span
lang=EN-US style='mso-ansi-language:EN-US'>FB</span> (25 или 30), а <span
lang=EN-US style='mso-ansi-language:EN-US'>NNN</span><span lang=EN-US> </span>–
порядковый номер <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>-окна,
которое работает с этим файлом.<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Первое из запущенных <span lang=EN-US style='mso-ansi-language:
EN-US'>isql</span>-окон будет по завершении теста автоматически выполнять
запрос к базе с целью выгрузки итогов выполнения. При этом файл с именем: <span
lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>XX</span>_%<span lang=EN-US style='mso-ansi-language:
EN-US'>computername</span>%_<span lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>_<b
style='mso-bidi-font-weight:normal'><span style='font-size:11.0pt;font-family:
"Courier New"'>1</span></b>.<span lang=EN-US style='mso-ansi-language:EN-US'>log</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>run</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>txt</span> - будет содержать фразу: «<span lang=EN-US style='mso-ansi-language:
EN-US'>Does</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>this</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>window</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>PERFORMANCE</span><span lang=EN-US> </span><span lang=EN-US
style='mso-ansi-language:EN-US'>analysis</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>after</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>finish</span> ? <span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>after</span> = <b style='mso-bidi-font-weight:normal'><span
style='font-size:11.0pt;font-family:"Courier New"'>1</span></b>».</p>

<p class=MsoNormal>Этот же файл будет в итоге содержать и сам отчет в текстовом
виде.<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>5. Как убедиться, что
работающие коннекты действительно что-то делают<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal>Перейдите в каталог, заданный переменной <span lang=EN-US
style='mso-ansi-language:EN-US'>tmpdir</span> и откройте на просмотр любой из
файлов с именем <span lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>XX</span>_%<span lang=EN-US
style='mso-ansi-language:EN-US'>computername</span>%_<span lang=EN-US
style='mso-ansi-language:EN-US'>NNN</span>.<b style='mso-bidi-font-weight:normal'>log</b>.
В этом файле вы увидите сначала сообщения о том, какие переменные были
прочитаны из <span lang=EN-US style='mso-ansi-language:EN-US'>oltpNN</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>config</span> и какие значения им
были присвоены:</p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Read line from oltp30_config and try to execute: set
fbc=C:\MIX\firebird\fb25\bin<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Read line from oltp30_config and try to execute: set
tmpdir=C:\TEMP\logs.oltp30<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Read line from oltp30_config and try to execute: set
is_embed=0<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Read line from oltp30_config and try to execute: set
dbnm=oltp30<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>. .
.<o:p></o:p></span></p>

<p class=MsoNormal>Затем будут выведены уже сообщения о ходе работы данного
коннекта, например:</p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>TEST_ENDS_AT<span style='mso-spacerun:yes'>       
</span>ENGINE <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>=================== ====== <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>2014-10-05 17:55:35 3.0.0<span
style='mso-spacerun:yes'>  </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>DTS<span style='mso-spacerun:yes'>         
</span>TRN<span style='mso-spacerun:yes'>            </span>UNIT<span
style='mso-spacerun:yes'>               </span>MSG<span
style='mso-spacerun:yes'>                   </span>ADD_INFO<span
style='mso-spacerun:yes'>                                 </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>============ ============== ==================
===================== =====================<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>14:55:41.067 tra_23913<span
style='mso-spacerun:yes'>      </span>sp_client_order<span
style='mso-spacerun:yes'>    </span>start<span
style='mso-spacerun:yes'>                 </span>att_115<span
style='mso-spacerun:yes'>                                  </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>DTS<span style='mso-spacerun:yes'>         
</span>TRN<span style='mso-spacerun:yes'>            </span>UNIT<span
style='mso-spacerun:yes'>               </span>ELAPSED_MS MSG<span
style='mso-spacerun:yes'>        </span>ADD_INFO<span
style='mso-spacerun:yes'>                                 </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>============ ============== ==================
========== ========== ===================<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>14:55:41.771 tra_23913<span
style='mso-spacerun:yes'>      </span>sp_client_order<span
style='mso-spacerun:yes'>           </span>500 OK, 1 rows doc=308: created Ok </span><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>. .
.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>В первом сообщении всегда выводится время окончания теста и
версия ФБ.</p>

<p class=MsoNormal>Во втором сообщении выводится состояние коннекта
непосредственно перед началом выполнения бизнес-операции: время, <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span> транзакции, название
выбранной бизнес-операции, сообщение “<span lang=EN-US style='mso-ansi-language:
EN-US'>start</span>” о том, что сейчас она <i style='mso-bidi-font-style:normal'>начнёт</i>
выполняться и <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span> самого
коннекта.</p>

<p class=MsoNormal>В третьем сообщении выводятся аналогичные данные,
дополненные длительностью работы (в <span lang=EN-US style='mso-ansi-language:
EN-US'>ms</span>), а также кратким описание результата выполнения (колонки ‘<span
lang=EN-US style='mso-ansi-language:EN-US'>MSG</span>’ и ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>ADD</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>INFO</span>’).<br>
При работе с <span lang=EN-US style='mso-ansi-language:EN-US'>FB</span> 3.0 в
логе будет также четвёртое сообщение с данными о результатах сбора статистики
мониторинга. Эта информация будет выведена только в случае, когда в файле <span
lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>30_<span lang=EN-US
style='mso-ansi-language:EN-US'>config</span><span lang=EN-US> </span>значение
параметра mon_unit_perf<span style='mso-spacerun:yes'>  </span>равно 1. В
противном случае будет выведено примерно следующее:</p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>TEST_ENDS_AT<span style='mso-spacerun:yes'>       
</span>ENGINE MON_INFO<span
style='mso-spacerun:yes'>                                           </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>=================== ====== =========<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>2014-10-05 17:55:35 3.0.0<span
style='mso-spacerun:yes'>  </span>mon$_dis!<span
style='mso-spacerun:yes'>                                          </span></span><span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Замечание</b>. Когда
размер файла .<span lang=EN-US style='mso-ansi-language:EN-US'>log</span><span
lang=EN-US> </span>(или .<span lang=EN-US style='mso-ansi-language:EN-US'>err</span>)
превышает значение 15000000 байт, его содержимое обнуляется во избежание
переполнения дискового пространства тестирующей машины. Этот порог (15000000)
указан в файле oltp_isql_run_worker.bat в командах:</p>

<p class=MsoNormal>@set maxlog=15000000</p>

<p class=MsoNormal>@set maxerr=15000000</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Измените эти значения, если вам нужны логи другого
максимального размера.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>«Как останавливать работающие </span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:14.0pt;
mso-ansi-language:EN-US'>isql</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>-окна ?»<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Короткий ответ: </b>тест
остановится <i style='mso-bidi-font-style:normal'>сам</i>, в момент времени, который
прописывается в базе при старте и определяется так:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>T</span>0 <span
style='color:#003366'>// момент запуска всех </span><span lang=EN-US
style='color:#003366;mso-ansi-language:EN-US'>isql</span><span
style='color:#003366'>-окон командой </span><span lang=EN-US style='color:#003366;
mso-ansi-language:EN-US'>start</span><span style='color:#003366'> (фиксируется
в базе файлом 1run_oltp_emul.bat )<o:p></o:p></span></p>

<p class=MsoNormal>+ число_минут_на_разогрев_базы <span style='color:#003366'>//
параметр </span><span lang=EN-US style='color:#003366;mso-ansi-language:EN-US'>warm</span><span
style='color:#003366'>_</span><span lang=EN-US style='color:#003366;mso-ansi-language:
EN-US'>time</span><span style='color:#003366'><o:p></o:p></span></p>

<p class=MsoNormal>+ число_минут_в_интервале_замера_производительности <span
style='color:#003366'>// параметр test_time<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>При самоостановке теста, в каталоге, заданном параметром <span
lang=EN-US style='mso-ansi-language:EN-US'>ExternalFileAccess</span><span
lang=EN-US> </span>файла <span lang=EN-US style='mso-ansi-language:EN-US'>firebird</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>conf</span>, будет обновлён файл ‘<span
lang=EN-US style='mso-ansi-language:EN-US'>stoptest</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>txt</span>’: в нём будет одна или несколько
строк, каждая из которых будет состоять из одиночного символа: «2».</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Однако вы также можете «вручную» остановить тест любым из
следующих способов:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>1) Установив непустое содержимое файла ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>stoptest</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>txt</span>’, который должен находиться на
сервере в том каталоге, что был задан параметром <span lang=EN-US
style='mso-ansi-language:EN-US'>ExternalFileAccess</span> в <span lang=EN-US
style='mso-ansi-language:EN-US'>firebird</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>conf</span>:</p>

<p class=MsoNormal>1.1) Если <span lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span><span
lang=EN-US> </span>установлен на <span lang=EN-US style='mso-ansi-language:
EN-US'>Linux</span>: в каталоге, в котором хранится файл ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>stoptest</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>txt</span>’, отражающий <span lang=EN-US
style='mso-ansi-language:EN-US'>external</span>-таблицу базы, откройте в
редаторе этот файл и введите там любой символ (например, «1») с нажатием <span
lang=EN-US style='mso-ansi-language:EN-US'>Enter</span>. Через несколько минут
все работающие окна автоматически закроются с отменой последней выполняемой ими
транзакции. Этот способ – рекомендуемый. </p>

<p class=MsoNormal>1.2) Если <span lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span><span
lang=EN-US> </span>установлен на <span lang=EN-US style='mso-ansi-language:
EN-US'>Windows</span>, то запустите приложение «Блокнот» (от имени
администратора), в нём откройте файл (именно открыть через сочетание клавиш <span
lang=EN-US style='mso-ansi-language:EN-US'>Ctrl</span>-<span lang=EN-US
style='mso-ansi-language:EN-US'>O</span> или из меню «Файл / Открыть…», но <b
style='mso-bidi-font-weight:normal'>не</b> перетаскивая его через <span
lang=EN-US style='mso-ansi-language:EN-US'>drug</span>-<span lang=EN-US
style='mso-ansi-language:EN-US'>n</span>-<span lang=EN-US style='mso-ansi-language:
EN-US'>drop</span>!), введите «1», нажмите <span lang=EN-US style='mso-ansi-language:
EN-US'>Enter</span> и сохраните.</p>

<p class=MsoNormal>Способ остановки через ‘<span lang=EN-US style='mso-ansi-language:
EN-US'>stoptest</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>txt</span>’
– наиболее предпочтительный, т.к. не вызывает форсированных откатов. Это
означает, что валидация базы не приведёт<span style='mso-spacerun:yes'> 
</span>к большому количеству сообщений вида ‘<span lang=EN-US style='mso-ansi-language:
EN-US'>page</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>NNN</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>orphan</span>’, от которых можно будет избавиться только путем <span
lang=EN-US style='mso-ansi-language:EN-US'>backup</span>-<span lang=EN-US
style='mso-ansi-language:EN-US'>restore</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>2) переведите базу в оффлайн: <span lang=EN-US
style='mso-ansi-language:EN-US'>gfix</span> –<span lang=EN-US style='mso-ansi-language:
EN-US'>shut</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>full</span> –<span lang=EN-US style='mso-ansi-language:EN-US'>force</span>
0. Все работающие <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>-окна
достаточно быстро завершатся с исключением, которое будет правильным образом
обработано в сценарии oltp_isql_run_worker.bat, который и запускает <span
lang=EN-US style='mso-ansi-language:EN-US'>isql</span>. Обработка такого
исключения заключается в <span style='mso-spacerun:yes'> </span>проверке
наличия в логе ошибок фразы “<span lang=EN-US style='mso-ansi-language:EN-US'>shutdown</span>”.
Если она будет найдена, то .<span lang=EN-US style='mso-ansi-language:EN-US'>bat</span>-файл
прекратится.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>3) допускается, хотя и НЕ рекомендуется, снятие всех
клиентских процессов (<span lang=EN-US style='mso-ansi-language:EN-US'>cmd</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>exe</span>, <span lang=EN-US
style='mso-ansi-language:EN-US'>isql</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>exe</span><span lang=EN-US> </span>и <span lang=EN-US style='mso-ansi-language:
EN-US'>cscript</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>exe</span>)
утилитой <span lang=EN-US style='mso-ansi-language:EN-US'>psKill</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>exe</span> из пакета <span
lang=EN-US style='mso-ansi-language:EN-US'>SysInternals</span>: <span
lang=EN-US style='mso-ansi-language:EN-US'>pskill</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>isql</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>exe</span> [<span lang=EN-US style='mso-ansi-language:
EN-US'>Enter</span>] и т.п.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>«Как начать новый тест после завершения предыдущего ?»<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>Обнулите содержимое файла ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>stoptest</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>txt</span>’ на сервере, в том каталоге, который
был задан параметром <span lang=EN-US style='mso-ansi-language:EN-US'>ExternalFileAccess</span><span
lang=EN-US> </span>в <span lang=EN-US style='mso-ansi-language:EN-US'>firebird</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>conf</span>. <span
style='mso-spacerun:yes'> </span>Затем вы можете внести исправления либо в
конфигурацию теста (файл <span lang=EN-US style='mso-ansi-language:EN-US'>oltpNN</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>config</span>), либо в таблицу
настроек (<span lang=EN-US style='mso-ansi-language:EN-US'>settings</span>),
хранящуюся в базе. После этого запустите тест командой 1run_oltp_emul.bat &lt;<span
lang=EN-US style='mso-ansi-language:EN-US'>FB</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>version</span>&gt; &lt;<span lang=EN-US
style='mso-ansi-language:EN-US'>number</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>of</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>sessions</span>&gt;, как это было описано выше.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>«Как мне проверить состояние базы после остановки
этого теста ?»<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal>0. Проверьте содержимое файла <span lang=EN-US
style='mso-ansi-language:EN-US'>firebird</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>. На момент написания данного текста
(октябрь 2014), весьма вероятны повреждения при работе <span lang=EN-US
style='mso-ansi-language:EN-US'>Firebird</span> 3.0 в архитектуре <span
lang=EN-US style='mso-ansi-language:EN-US'>SuperClassic</span> в течение первых
трёх часов, а в архитектуре <span lang=EN-US style='mso-ansi-language:EN-US'>SuperServer</span><span
lang=EN-US> </span>– в течение первых шести часов (проверено на нагрузке от 100
окон).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>1. Если к базе нет коннектов, проведите валидацию (<span
lang=EN-US style='mso-ansi-language:EN-US'>gfix</span> –<span lang=EN-US
style='mso-ansi-language:EN-US'>v</span> –<span lang=EN-US style='mso-ansi-language:
EN-US'>full</span> . . .).</p>

<p class=MsoNormal>Если в результате валидации в <span lang=EN-US
style='mso-ansi-language:EN-US'>firebird</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span><span lang=EN-US> </span>появятся
строки, содержащие ‘<span lang=EN-US style='mso-ansi-language:EN-US'>missing</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>entries</span>’,
это может означать возникновение трудно воспроизводимой ошибки в индексах. В
этом случае:</p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l18 level1 lfo15;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>скопируйте
базу в новый файл</p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l18 level1 lfo15;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>проведите
(обязательно) сборку мусора: <span lang=EN-US style='mso-ansi-language:EN-US'>gfix</span>
–<span lang=EN-US style='mso-ansi-language:EN-US'>sweep</span> . . .</p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l18 level1 lfo15;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>3)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>повторите
валидацию: <span lang=EN-US style='mso-ansi-language:EN-US'>gfix</span> –<span
lang=EN-US style='mso-ansi-language:EN-US'>v</span> –<span lang=EN-US
style='mso-ansi-language:EN-US'>full</span> . . .</p>

<p class=MsoNormal>Если в логе ФБ после этих пунктов снова появится сообщение с
текстом ‘<span lang=EN-US style='mso-ansi-language:EN-US'>missing</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>entries</span>’,
то возможно, есть смысл добавить сообщение сюда: <a
href="http://tracker.firebirdsql.org/browse/CORE-3515">http://tracker.firebirdsql.org/browse/CORE-3515</a></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>2. Соединитесь с базой в одиночном коннекте и выполните:<span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>2.1) </span><span
lang=EN-US style='font-size:11.0pt;font-family:"Courier New";background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>SQL&gt; set list on; select *
from srv_diag_fk_uk; commit;</span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Выборка должна быть пустой (иначе будут показаны индексы,
имеющие проблемы: висячие <span lang=EN-US style='mso-ansi-language:EN-US'>FK</span>,
дубли в <span lang=EN-US style='mso-ansi-language:EN-US'>PK</span>,
несовпадающие результаты <span lang=EN-US style='mso-ansi-language:EN-US'>count</span>(*)
по индексу и в <span lang=EN-US style='mso-ansi-language:EN-US'>natural</span>-порядке).<span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>2.2<span
style='background:silver;mso-highlight:silver'>) </span></span><span
lang=EN-US style='font-size:11.0pt;font-family:"Courier New";background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>SQL&gt; set list on; select *
from srv_diag_idx_entries; commit;</span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Выборка должна быть пустой. Иначе будут показаны таблицы и
индексы, подсчет числа строк в которых по двум вариантам: <span lang=EN-US
style='mso-ansi-language:EN-US'>PLAN</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>NATURAL</span> и<span
style='mso-spacerun:yes'>  </span><span lang=EN-US style='mso-ansi-language:
EN-US'>PLAN</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>ORDER</span> &lt;этот_индекс&gt; - дали разные результаты. Это
происходит при наличии ошибки <span lang=EN-US style='mso-ansi-language:EN-US'>missing</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>entries</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Для проверки файла базы без остановки теста вы можете также
использовать утилиту <span lang=EN-US style='mso-ansi-language:EN-US'>nbackup</span>:</p>

<p class=MsoNormal><span lang=EN-US style='font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>nbackup –L
/var/db/fb30/oltp30.fdb<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>cp
/var/db/fb30/oltp30.fdb /var/db/fb30/oltp30_for_validate.fdb<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>nbackup –N
/var/db/fb30/oltp30.fdb<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>nbackup –F
/var/db/oltp30_for_validate.fdb</span><span lang=EN-US style='font-family:"Courier New";
mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>-- и далее провести валидацию полученной физической копии
базы:<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>gfix –v –full
/var/db/oltp30_<b style='mso-bidi-font-weight:normal'>for_validate</b>.fdb</span><span
lang=EN-US style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Замечание. <o:p></o:p></b></p>

<p class=MsoNormal>При большом размере файла команда <span lang=EN-US
style='mso-ansi-language:EN-US'>nbackup</span> –<span lang=EN-US
style='mso-ansi-language:EN-US'>N</span> может выполняться несколько минут.
Кроме того, на текущих версиях ФБ неоднократно было замечено, что эта команда
может приводить к краху сервера.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>«Как получить <i style='mso-bidi-font-style:normal'>сводные</i>
данные о производительности ?»<o:p></o:p></span></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Короткий ответ #1. </b><span
style='mso-spacerun:yes'> </span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Перейдите в каталог, заданный переменной %<span lang=EN-US
style='mso-ansi-language:EN-US'>tmpdir</span>% файла <span lang=EN-US
style='mso-ansi-language:EN-US'>oltpNN</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>config</span>, и откройте в редакторе файл <span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>oltp</span><span style='background:silver;mso-highlight:silver'>_</span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>NN</span><span style='background:silver;mso-highlight:silver'>_%</span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>computer</span><span style='background:silver;mso-highlight:silver'>_</span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>name</span><span style='background:silver;mso-highlight:silver'>%_001_</span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>performance</span><span style='background:silver;mso-highlight:silver'>_</span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>report</span><span style='background:silver;mso-highlight:silver'>.</span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>txt</span>. В этом файле будут приведены результаты двух отчетов по
производительности. </p>

<p class=MsoNormal>Найдите в нём строки, аналогичные приведенным ниже:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>BUSINESS_ACTION<span
style='mso-spacerun:yes'>                      </span>AVG_TIMES_PER_MINUTE<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'>===================================
=====================<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'>***
OVERALL *** for 60 minutes:<span style='mso-spacerun:yes'>                  
</span>2724.33<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>В графе “<span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";mso-ansi-language:EN-US'>AVG</span><span
style='font-size:10.0pt;font-family:"Courier New"'>_</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>TIMES</span><span
style='font-size:10.0pt;font-family:"Courier New"'>_</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>PER</span><span
style='font-size:10.0pt;font-family:"Courier New"'>_</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>MINUTE</span>”
будет показан сводный показатель производительности теста по итогам заданного
времени замеров.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Короткий</b><b
style='mso-bidi-font-weight:normal'><span style='mso-ansi-language:EN-US'> </span>ответ</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'> #2.<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>З</b>апустите<span
lang=EN-US style='mso-ansi-language:EN-US'><span style='mso-spacerun:yes'> 
</span><b style='mso-bidi-font-weight:normal'><span style='background:silver;
mso-highlight:silver'>select * from srv_mon_perf_total;</span><o:p></o:p></b></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Описание.</b> Вы получите
выборку, учитывающую только успешно завершившиеся выполения прикладных
процедур. В этом отчете будут показаны следующие графы:</p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l25 level1 lfo24;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]><span
lang=EN-US style='mso-ansi-language:EN-US'>BUSINESS</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>ACTION</span> – наименование прикладного
действия; в первой строке отчета в этом поле всегда будет содержаться строка
вида: “*** OVERALL *** for last &lt;<span lang=EN-US style='mso-ansi-language:
EN-US'>N</span>&gt; minutes” – её описание см ниже;</p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l25 level1 lfo24;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>AVG_TIMES_PER_MINUTE
- среднее число выполненных действий данного вида за одну минуту, учёт только
УСПЕШНО завершённых;</p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l25 level1 lfo24;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>3)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>AVG_ELAPSED_MS
- средняя длительность одного действия данного вида, миллисекунду, учёт только
УСПЕШНО завершённых;</p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l25 level1 lfo24;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>4)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>SUCCESSFUL_TIMES_DONE
- сколько раз было УСПЕШНО проведено это действие.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Значение в графе AVG_TIMES_PER_MINUTE для строки '*** OVERALL
***'<span style='mso-spacerun:yes'>  </span>есть <span style='background:yellow;
mso-highlight:yellow'>сводный </span>показатель производительности базы.<span
style='mso-tab-count:1'>  </span></p>

<p class=MsoNormal>Он<span style='mso-ansi-language:EN-US'> </span>вычисляется<span
style='mso-ansi-language:EN-US'> </span>как<span lang=EN-US style='mso-ansi-language:
EN-US'>:<span style='mso-spacerun:yes'>   </span><b style='mso-bidi-font-weight:
normal'>sum</b>( <b style='mso-bidi-font-weight:normal'>successful_times_done )
/ last_working_minutes</b>, <o:p></o:p></span></p>

<p class=MsoNormal>где:<span style='mso-tab-count:1'>      </span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>sum</span>(
<span lang=EN-US style='mso-ansi-language:EN-US'>successful</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>times</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>done</span> ) = общее число успешных выполнений
<i style='mso-bidi-font-style:normal'>всех</i> видов действий,</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>last</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>working</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>minutes</span> = количество минут, с момента
самого раннего начала какого-либо из бизнес-действий до момента самого позднего
успешного завершения какого-либо из бизнес-действий, ограниченное сверху
лимитом <span lang=EN-US style='mso-ansi-language:EN-US'>N</span>, определяемым
через один или два входных аргумента к этой процедуре.</p>

<p class=MsoNormal>Лимит <span lang=EN-US style='mso-ansi-language:EN-US'>N</span>
по умолчанию равен 180 минутам, т.е. оценивается активность за последние 3 часа
работы теста.</p>

<p class=MsoNormal>Процедура учитывает выполнение только <i style='mso-bidi-font-style:
normal'>бизнес-</i>операций. Работа вспомогательных модулей, которые вызывались
из процедур <span lang=EN-US style='mso-ansi-language:EN-US'>top</span>-уровня,
в итоговый результат включена, но отдельно не показывается.<span
style='mso-bidi-font-size:14.0pt'><o:p></o:p></span></p>

<p class=MsoNormal>Если вам нужно оценить работу за другое число минут (но
всегда – «завершающих», не «промежуточных»), то укажите один или два аргумента
(далее они обозначены <span lang=EN-US style='mso-ansi-language:EN-US'>H</span><span
lang=EN-US> </span>и <span lang=EN-US style='mso-ansi-language:EN-US'>M</span>),
как показано в следующих примерах:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>select</span>
* <span lang=EN-US style='mso-ansi-language:EN-US'>from</span><span lang=EN-US>
</span><span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>mon</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>total</span>( 0, 45 ) – оценить работу за посление минут</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>select</span>
* <span lang=EN-US style='mso-ansi-language:EN-US'>from</span><span lang=EN-US>
</span><span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>mon</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>total</span>( 1 ) – оценить работу за послений час</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>select</span>
* <span lang=EN-US style='mso-ansi-language:EN-US'>from</span><span lang=EN-US>
</span><span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>mon</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>total</span>( 2, 30 ) – оценить работу за посление 2.5 часа</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Замечание-1. Если за последние <span lang=EN-US
style='mso-ansi-language:EN-US'>N</span> минут для какой-либо бизнес-операции
не было зарегистрировано ни одного успешного завершения, то в отчете для неё
будут проставлены <span lang=EN-US style='mso-ansi-language:EN-US'>NULL</span>
во всех числовых графах.</p>

<p class=MsoNormal>Замечание-2. Если тест работал менее трёх часов (или того
числа минут, которое определится при задании вами входных арументов <span
lang=EN-US style='mso-ansi-language:EN-US'>H</span> и <span lang=EN-US
style='mso-ansi-language:EN-US'>M</span> по формуле <span lang=EN-US
style='mso-ansi-language:EN-US'>H</span>*60 + <span lang=EN-US
style='mso-ansi-language:EN-US'>M</span>), то в строке ‘*** <span lang=EN-US
style='mso-ansi-language:EN-US'>OVERALL</span> ***’ будет указано фактическое
число минут, за которое собрана статистика, и оно будет меньше требуемого.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Вот пример вывода этой ХП при вызове без указания входных
аргументов:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=698
 style='width:523.7pt;margin-left:4.65pt;border-collapse:collapse;mso-padding-alt:
 0cm 5.4pt 0cm 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:12.75pt'>
  <td width=177 nowrap valign=bottom style='width:132.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>BUSINESS_ACTION<o:p></o:p></span></p>
  </td>
  <td width=184 nowrap valign=bottom style='width:138.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>AVG_TIMES_PER_MINUTE<o:p></o:p></span></p>
  </td>
  <td width=139 nowrap valign=bottom style='width:104.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>AVG_ELAPSED_MS<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>SUCCESSFUL_TIMES_DONE<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;height:12.75pt'>
  <td width=177 nowrap valign=bottom style='width:132.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>***
  OVERALL *** for last <b style='mso-bidi-font-weight:normal'><span
  style='background:lime;mso-highlight:lime'>180</span></b> minutes:<o:p></o:p></span></p>
  </td>
  <td width=184 nowrap valign=bottom style='width:138.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";background:yellow;mso-highlight:
  yellow'>575,41</span><span style='font-size:10.0pt;font-family:"Arial CYR"'><o:p></o:p></span></p>
  </td>
  <td width=139 nowrap valign=bottom style='width:104.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>26156<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>103573<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;height:12.75pt'>
  <td width=177 nowrap valign=bottom style='width:132.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>customer
  order: creation<o:p></o:p></span></p>
  </td>
  <td width=184 nowrap valign=bottom style='width:138.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>208,47<o:p></o:p></span></p>
  </td>
  <td width=139 nowrap valign=bottom style='width:104.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>1604<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>37524<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:3;height:12.75pt'>
  <td width=177 nowrap valign=bottom style='width:132.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>customer
  order: refuse<o:p></o:p></span></p>
  </td>
  <td width=184 nowrap valign=bottom style='width:138.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>4,29<o:p></o:p></span></p>
  </td>
  <td width=139 nowrap valign=bottom style='width:104.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>4599<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>773<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:4;height:12.75pt'>
  <td width=177 nowrap valign=bottom style='width:132.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>order
  to supplier: creation<o:p></o:p></span></p>
  </td>
  <td width=184 nowrap valign=bottom style='width:138.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0,94<o:p></o:p></span></p>
  </td>
  <td width=139 nowrap valign=bottom style='width:104.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>104835<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>169<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:5;height:12.75pt'>
  <td width=500 nowrap colspan=3 valign=bottom style='width:375.05pt;
  padding:0cm 5.4pt 0cm 5.4pt;height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>order
  to supplier: removal<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:6;height:12.75pt'>
  <td width=177 nowrap valign=bottom style='width:132.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>invoice
  (draft): creation<o:p></o:p></span></p>
  </td>
  <td width=184 nowrap valign=bottom style='width:138.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0,92<o:p></o:p></span></p>
  </td>
  <td width=139 nowrap valign=bottom style='width:104.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>73021<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>163<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:7;height:12.75pt'>
  <td width=500 nowrap colspan=3 valign=bottom style='width:375.05pt;
  padding:0cm 5.4pt 0cm 5.4pt;height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>invoice
  (draft): removal<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:8;height:12.75pt'>
  <td width=177 nowrap valign=bottom style='width:132.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>invoice
  accept: apply<o:p></o:p></span></p>
  </td>
  <td width=184 nowrap valign=bottom style='width:138.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0,83<o:p></o:p></span></p>
  </td>
  <td width=139 nowrap valign=bottom style='width:104.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>63265<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>148<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:9;height:12.75pt'>
  <td width=177 nowrap valign=bottom style='width:132.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>invoice
  accept: cancel<o:p></o:p></span></p>
  </td>
  <td width=184 nowrap valign=bottom style='width:138.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0,35<o:p></o:p></span></p>
  </td>
  <td width=139 nowrap valign=bottom style='width:104.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>113907<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>62<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:10;height:12.75pt'>
  <td width=177 nowrap valign=bottom style='width:132.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>customer
  reserve: creation<o:p></o:p></span></p>
  </td>
  <td width=184 nowrap valign=bottom style='width:138.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>172,56<o:p></o:p></span></p>
  </td>
  <td width=139 nowrap valign=bottom style='width:104.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>2552<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>31061<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:11;height:12.75pt'>
  <td width=177 nowrap valign=bottom style='width:132.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>customer
  reserve: removal<o:p></o:p></span></p>
  </td>
  <td width=184 nowrap valign=bottom style='width:138.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>36,67<o:p></o:p></span></p>
  </td>
  <td width=139 nowrap valign=bottom style='width:104.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>873<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>6564<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:12;height:12.75pt'>
  <td width=177 nowrap valign=bottom style='width:132.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>realization
  accept: apply<o:p></o:p></span></p>
  </td>
  <td width=184 nowrap valign=bottom style='width:138.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>69,78<o:p></o:p></span></p>
  </td>
  <td width=139 nowrap valign=bottom style='width:104.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>268<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>12490<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:13;height:12.75pt'>
  <td width=177 nowrap valign=bottom style='width:132.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>realization
  accept: cancel<o:p></o:p></span></p>
  </td>
  <td width=184 nowrap valign=bottom style='width:138.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>29,22<o:p></o:p></span></p>
  </td>
  <td width=139 nowrap valign=bottom style='width:104.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>397<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>5201<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:14;height:12.75pt'>
  <td width=177 nowrap valign=bottom style='width:132.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>payment
  from customer: creation<o:p></o:p></span></p>
  </td>
  <td width=184 nowrap valign=bottom style='width:138.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>42,32<o:p></o:p></span></p>
  </td>
  <td width=139 nowrap valign=bottom style='width:104.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>354<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>7576<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:15;height:12.75pt'>
  <td width=177 nowrap valign=bottom style='width:132.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>payment
  from customer: removal<o:p></o:p></span></p>
  </td>
  <td width=184 nowrap valign=bottom style='width:138.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>1,3<o:p></o:p></span></p>
  </td>
  <td width=139 nowrap valign=bottom style='width:104.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>173<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>232<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:16;height:12.75pt'>
  <td width=177 nowrap valign=bottom style='width:132.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>payment
  to supplier: creation<o:p></o:p></span></p>
  </td>
  <td width=184 nowrap valign=bottom style='width:138.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>8,58<o:p></o:p></span></p>
  </td>
  <td width=139 nowrap valign=bottom style='width:104.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>160<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>1536<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:17;mso-yfti-lastrow:yes;height:12.75pt'>
  <td width=177 nowrap valign=bottom style='width:132.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>payment
  to supplier: removal<o:p></o:p></span></p>
  </td>
  <td width=184 nowrap valign=bottom style='width:138.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0,42<o:p></o:p></span></p>
  </td>
  <td width=139 nowrap valign=bottom style='width:104.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>169<o:p></o:p></span></p>
  </td>
  <td width=198 nowrap valign=bottom style='width:148.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>74<o:p></o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Обратите внимание, что </p>

<p class=MsoNormal>1) в строке ‘*** <span lang=EN-US style='mso-ansi-language:
EN-US'>OVERALL</span> ***’ указано число последних минут активности ( ‘<b
style='mso-bidi-font-weight:normal'><span style='background:lime;mso-highlight:
lime'>180</span></b>’ ), совпадающее с тем, что мы неявно указали при вызове
ХП. Однако, если бы тест работал так, что первое успешно\е действие было
зарегистрировано менее трёх часов от момента его окончания, то число минут в
строке ‘***OVERALL ***’ было бы другим (меньшим);</p>

<p class=MsoNormal>2) для операций «order to supplier: removal» и «invoice
(draft): removal» информация об их производительности не выведена. Это
означает, что за последние три часа в базе не было зарегистрировано ни одного <i
style='mso-bidi-font-style:normal'>успешного</i> завершения этих действий. Это
вполне объяснимо, если учесть, что данные два действия наиболее часто
завершаются исключениями вида ‘<span lang=EN-US style='mso-ansi-language:EN-US'>update</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>conflict</span>’.<span lang=EN-US
style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Сводный показатель производительности в данном примере равен
~575. Это число показывает, сколько в среднем бизнес-операций успешно завершается
в базе за одну минуту – т.е. это можно назвать «пропускной способностью» базы
на данном аппаратном и программном обеспечании.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Замечания.<o:p></o:p></b></p>

<p class=MsoNormal>Рекомендуется начинать анализ производительности не ранее,
чем через 1 час с начала работы теста.</p>

<p class=MsoNormal>Не следует запускать эту процедуру слишком часто при
работающих коннектах – это может повлиять на итоговый результат, т.к. данная
процедура обрабатывает большое количество строк, а также вызывает сортировки.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>«Как получить <i style='mso-bidi-font-style:normal'>динамику</i>
изменения производительности ?»<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Короткий ответ #1. </b><span
style='mso-spacerun:yes'> </span></p>

<p class=MsoNormal>Перейдите в каталог, заданный переменной %<span lang=EN-US
style='mso-ansi-language:EN-US'>tmpdir</span>% файла <span lang=EN-US
style='mso-ansi-language:EN-US'>oltpNN</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>config</span>, и откройте в редакторе файл <span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>oltp</span><span style='background:silver;mso-highlight:silver'>_</span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>NN</span><span style='background:silver;mso-highlight:silver'>_%</span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>computer</span><span style='background:silver;mso-highlight:silver'>_</span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>name</span><span style='background:silver;mso-highlight:silver'>%_001_</span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>performance</span><span style='background:silver;mso-highlight:silver'>_</span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>report</span><span style='background:silver;mso-highlight:silver'>.</span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>txt</span>. В этом файле будут приведены результаты двух отчетов по
производительности. </p>

<p class=MsoNormal>Найдите в нём строки, аналогичные приведенным ниже:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>BUSINESS_ACTION<span
style='mso-spacerun:yes'>          </span>INTERVAL_NO<span
style='mso-spacerun:yes'>     </span>CNT_OK_PER_MINUTE<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>======================== ===========
=====================<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>interval #<span style='mso-spacerun:yes'>   </span>1,
overall<span style='mso-spacerun:yes'>            </span>1<span
style='mso-spacerun:yes'>                </span>942.11<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'>. .
.<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'>interval
#<span style='mso-spacerun:yes'>  </span>10, overall<span
style='mso-spacerun:yes'>           </span>10<span
style='mso-spacerun:yes'>                </span>784.56<o:p></o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Короткий ответ #2. </b><span
style='mso-spacerun:yes'> </span></p>

<p class=MsoNormal>Запустите<span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>  </span><b style='mso-bidi-font-weight:normal'><span
style='background:silver;mso-highlight:silver'>select * from srv_mon_perf_dynamic;</span><o:p></o:p></b></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:14.0pt;mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>Предыдущий вариант получения итогов покажет их за <i
style='mso-bidi-font-style:normal'>всё</i> время, которое вы потребовали (по
умолчанию – за последние три часа). Однако, с ростом таблиц и их индексов
производительность будет неизбежно падать. Это означает, что в начале теста она
будет больше, чем перед его завершением.</p>

<p class=MsoNormal>Чтобы оценить, как именно менялась производительность <i
style='mso-bidi-font-style:normal'>за период работы</i> теста, можно разбить
этот период на равные интервалы и вывести данные отдельно по каждому из них.</p>

<p class=MsoNormal>Процедура srv_mon_perf_dynamic выполняет эту задачу,
разбивая весь период, за который вы желаете провести анализ, на такие
интервалы, и суммируя данные по производительности в каждом из них.</p>

<p class=MsoNormal>По умолчанию она делает разбивку последних трёх часов работы
на 10 равных промежутков (т.е. по 18 минут каждый). Если тест работал меньше,
то на интервалы будет разбит период, определяемый первым и последним моментами
времени начала выполнения бизнес-операций.</p>

<p class=MsoNormal>Процедура учитывает выполнение только <i style='mso-bidi-font-style:
normal'>бизнес-</i>операций. Работа вспомогательных модулей, которые вызывались
из процедур <span lang=EN-US style='mso-ansi-language:EN-US'>top</span>-уровня,
в итоговый результат включена, но отдельно не показывается.<span
style='mso-bidi-font-size:14.0pt'><o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Пример результата вызова этой ХП:</p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=653
 style='width:489.65pt;margin-left:4.65pt;border-collapse:collapse;mso-padding-alt:
 0cm 5.4pt 0cm 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:38.95pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:38.95pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>BUSINESS
  <o:p></o:p></span></p>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>ACTION<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:38.95pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>INTER
  VAL NO<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:38.95pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>CNT
  OK PER MINUTE<o:p></o:p></span></p>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:38.95pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>CNT
  ALL<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:38.95pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>CNT
  OK<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:38.95pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>CNT
  ERR<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:38.95pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>ERR
  PRC<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:38.95pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>OK
  AVG MS<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:38.95pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>INTER
  VAL BEG<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:38.95pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>INTER
  VAL END<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
  style='font-size:9.0pt;font-family:"Courier New"'>interval #<span
  style='mso-spacerun:yes'>   </span>1, overall<o:p></o:p></span></b></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>1<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New";background:yellow;
  mso-highlight:yellow'>797,17</span><span style='font-size:9.0pt;font-family:
  "Courier New"'><o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15249<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>14349<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>900<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>5,9<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 14:47<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 15:05<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
  style='font-size:9.0pt;font-family:"Courier New"'>interval #<span
  style='mso-spacerun:yes'>   </span>2, overall<o:p></o:p></span></b></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>2<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New";background:yellow;
  mso-highlight:yellow'>842,01</span><span style='font-size:9.0pt;font-family:
  "Courier New"'><o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15631<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15156<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>475<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>3,04<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 15:05<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 15:23<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:3;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
  style='font-size:9.0pt;font-family:"Courier New"'>interval #<span
  style='mso-spacerun:yes'>   </span>3, overall<o:p></o:p></span></b></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>3<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New";background:yellow;
  mso-highlight:yellow'>989,06</span><span style='font-size:9.0pt;font-family:
  "Courier New"'><o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>18249<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>17803<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>446<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>2,44<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 15:23<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 15:41<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:4;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:5;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
  style='font-size:9.0pt;font-family:"Courier New"'>interval #<span
  style='mso-spacerun:yes'>   </span>9, overall<o:p></o:p></span></b></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>9<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New";background:yellow;
  mso-highlight:yellow'>688,17</span><span style='font-size:9.0pt;font-family:
  "Courier New"'><o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>12528<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>12387<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>141<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>1,13<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 17:12<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 17:30<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:6;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
  style='font-size:9.0pt;font-family:"Courier New"'>interval #<span
  style='mso-spacerun:yes'>  </span>10, overall<o:p></o:p></span></b></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>10<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New";background:yellow;
  mso-highlight:yellow'>497,22</span><span style='font-size:9.0pt;font-family:
  "Courier New"'><o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>9145<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>8950<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>195<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>2,13<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 17:30<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 17:48<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:7;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>invoice
  (draft): creation<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>1<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>48,06<o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>866<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>865<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>1<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>0,12<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>24016<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 14:47<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 15:05<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:8;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>invoice
  (draft): creation<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>2<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>28,89<o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>521<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>520<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>1<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>0,19<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>12501<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 15:05<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 15:23<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:9;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:10;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>invoice
  (draft): creation<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>8<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15,33<o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>279<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>276<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>3<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>1,08<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>11544<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 16:54<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 17:12<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:11;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>invoice
  (draft): creation<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>9<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>17<o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>307<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>306<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>1<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>0,33<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>13074<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 17:12<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 17:30<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:12;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>invoice
  (draft): creation<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>10<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>14,22<o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>259<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>256<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>3<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>1,16<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>12502<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 17:30<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 17:48<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:13;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>invoice
  (draft): removal<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>1<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>1,39<o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>77<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>25<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>52<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>67,53<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>6329<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 14:47<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 15:05<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:14;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>invoice
  (draft): removal<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>2<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>2,5<o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>74<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>45<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>29<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>39,19<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>5120<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 15:05<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 15:23<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:15;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:16;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>invoice
  (draft): removal<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>9<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>3,78<o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>74<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>68<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>6<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>8,11<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>9626<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 17:12<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 17:30<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:17;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>invoice
  (draft): removal<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>10<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>1,72<o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>38<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>31<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>7<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>18,42<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>8811<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 17:30<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt;font-family:"Courier New"'>15.09.2014 17:48<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:18;mso-yfti-lastrow:yes;height:12.75pt'>
  <td width=97 nowrap valign=bottom style='width:72.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=74 nowrap valign=bottom style='width:55.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=67 nowrap valign=bottom style='width:50.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.35pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=48 nowrap valign=bottom style='width:36.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=55 nowrap valign=bottom style='width:41.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
  <td width=81 nowrap valign=bottom style='width:60.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New"'>.
  . .<o:p></o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>«Как получить данные о производительности <i
style='mso-bidi-font-style:normal'>всех</i> модулей ?»<o:p></o:p></span></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Быстрый</b><b
style='mso-bidi-font-weight:normal'><span style='mso-ansi-language:EN-US'> </span>ответ</b><span
lang=EN-US style='mso-ansi-language:EN-US'>: </span>запустите<span lang=EN-US
style='mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span><b
style='mso-bidi-font-weight:normal'><span style='background:silver;mso-highlight:
silver'>select * from srv_mon_perf_detailed;</span><o:p></o:p></b></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>Вы получите сводные результаты по производительности каждой
из вызывавшихся процедур - не только «бизнес-операций», но и вспомогательных
модулей. В том числе – некоторых триггеров, код которых не является тривиальным
типа <span lang=EN-US style='mso-ansi-language:EN-US'>new</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span> = <span lang=EN-US
style='mso-ansi-language:EN-US'>gen</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>id</span>(…).<span style='mso-spacerun:yes'>  </span></p>

<p class=MsoNormal>Результат будет показан в виде числа её вызовов, количества
случившихся при этом исключений, а также «развёртку» по видам исключений (<span
lang=EN-US style='mso-ansi-language:EN-US'>lock</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>conflict</span>, <span lang=EN-US
style='mso-ansi-language:EN-US'>user</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>exc</span> и т.д.).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Описание</b>. <span
style='mso-spacerun:yes'> </span>Каждая вызываемая ХП регистрирует в специальной
<span lang=EN-US style='mso-ansi-language:EN-US'>GTT</span>-таблице момент
своего вызова. При любом варианте завершения этой ХП (нормальном или аварийном)
данные этой <span lang=EN-US style='mso-ansi-language:EN-US'>GTT</span>-таблицы
будут записаны в базу, что позволит оценить длительность её работы и код ошибки
(<span lang=EN-US style='mso-ansi-language:EN-US'>gdscode</span>).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Процедура <span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>srv</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>mon</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>perf</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>detailed</span>,
вызываемая без параметров, выдаст сводную информацию о работе за последние <b
style='mso-bidi-font-weight:normal'>три</b> часа. Если не добавлять условие «<b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>where</span><span lang=EN-US> </span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>dy</span><span
lang=EN-US> </span></b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>is</span><span lang=EN-US> </span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>null</span></b>», то после сводной информации будут выведены записи, сгруппированные
по столбцам ‘<span lang=EN-US style='mso-ansi-language:EN-US'>dy</span>’ (номер
дня) и ‘<span lang=EN-US style='mso-ansi-language:EN-US'>hr</span>’ (номер
часа). Эта информация может быть полезна, если требуется понять, равномерной ли
была производительность в течение каждого часа.</p>

<p class=MsoNormal>При вызове с одним аргументом: <b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>select</span> * </b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>from</span><span lang=EN-US> </span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>mon</span>_</b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>detailed</span>( </b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>H</span> ) [</b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>where</span><span lang=EN-US> </span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>dy</span><span lang=EN-US> </span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>is</span><span
lang=EN-US> </span></b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>null</span> ]</b>; - будет выдана информация по
производительности за последние <span lang=EN-US style='mso-ansi-language:EN-US'>H</span>
часов.</p>

<p class=MsoNormal>При вызове с двумя аргументами: <b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>select</span> * </b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>from</span><span lang=EN-US> </span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>mon</span>_</b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>detailed</span>( </b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>H</span>, </b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>M</span> ) [</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>where</span><span
lang=EN-US> </span></b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>dy</span><span lang=EN-US> </span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>is</span><span lang=EN-US> </span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>null</span> ]</b>; - будет
выдана информация по производительности за последние <span lang=EN-US
style='mso-ansi-language:EN-US'>H</span> часов <span lang=EN-US
style='mso-ansi-language:EN-US'>M</span><span lang=EN-US> </span>минут
(полезно, когда интересуют данные с точностью не до часа, а меньше).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Вот пример вывода этой ХП (показаны не все столбцы):</p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=649
 style='width:486.75pt;margin-left:4.65pt;border-collapse:collapse;mso-padding-alt:
 0cm 5.4pt 0cm 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:19.35pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:19.35pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>UNIT<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:19.35pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>CNT</span><span
  style='font-size:8.0pt;mso-ansi-language:EN-US'> </span><span
  style='font-size:8.0pt'>ALL<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:19.35pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>CNT</span><span
  style='font-size:8.0pt;mso-ansi-language:EN-US'> </span><span
  style='font-size:8.0pt'>OK<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:19.35pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>CNT</span><span
  style='font-size:8.0pt;mso-ansi-language:EN-US'> </span><span
  style='font-size:8.0pt'>ERR<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:19.35pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>ERR</span><span
  style='font-size:8.0pt;mso-ansi-language:EN-US'> </span><span
  style='font-size:8.0pt'>PRC<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:19.35pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>OK</span><span
  style='font-size:8.0pt;mso-ansi-language:EN-US'> </span><span
  style='font-size:8.0pt'>MIN</span><span style='font-size:8.0pt;mso-ansi-language:
  EN-US'> </span><span style='font-size:8.0pt'>MS<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:19.35pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>OK</span><span
  style='font-size:8.0pt;mso-ansi-language:EN-US'> </span><span
  style='font-size:8.0pt'>MAX</span><span style='font-size:8.0pt;mso-ansi-language:
  EN-US'> </span><span style='font-size:8.0pt'>MS<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:19.35pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>CNT</span><span
  style='font-size:8.0pt;mso-ansi-language:EN-US'> </span><span
  style='font-size:8.0pt'>CHK</span><span style='font-size:8.0pt;mso-ansi-language:
  EN-US'> </span><span style='font-size:8.0pt'>VIOL</span><span lang=EN-US
  style='font-size:8.0pt;mso-ansi-language:EN-US'><o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:19.35pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>CNT</span><span
  style='font-size:8.0pt;mso-ansi-language:EN-US'> </span><span
  style='font-size:8.0pt'>UNQ</span><span style='font-size:8.0pt;mso-ansi-language:
  EN-US'> </span><span style='font-size:8.0pt'>VIOL<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:19.35pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>CNT LK</span><span
  style='font-size:8.0pt;mso-ansi-language:EN-US'> </span><span
  style='font-size:8.0pt'>CONFL<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:19.35pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>CNT</span><span
  style='font-size:8.0pt;mso-ansi-language:EN-US'> </span><span
  style='font-size:8.0pt'>USER</span><span style='font-size:8.0pt;mso-ansi-language:
  EN-US'> </span><span style='font-size:8.0pt'>EXC<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:19.35pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>CNT</span><span
  style='font-size:8.0pt;mso-ansi-language:EN-US'> </span><span
  style='font-size:8.0pt'>OTHER</span><span style='font-size:8.0pt;mso-ansi-language:
  EN-US'> </span><span style='font-size:8.0pt'>EXC<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;mso-ansi-language:
  EN-US'>sp_add_invoice_to_stock<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>135<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>101<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>34<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>25,18<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>21<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>67626<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>34<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>sp_cancel_adding_invoice<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>21<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>11<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>10<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>47,61<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>94<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>27854<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>10<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:3;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>sp_cancel_client_order<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>576<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>528<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>48<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>8,33<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>14<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>3989<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>48<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:4;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>sp_cancel_customer_reserve<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>846<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>804<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>42<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>4,96<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>1<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>812<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>42<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:5;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;mso-ansi-language:
  EN-US'>sp_cancel_pay_from_customer<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>10<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>10<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>44<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>1025<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:6;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;mso-ansi-language:
  EN-US'>sp_cancel_pay_to_supplier<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>17<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>17<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>10<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>222<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:7;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>sp_cancel_supplier_invoice<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>4<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>2<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>2<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>50<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>14<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>81<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>2<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:8;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>sp_cancel_supplier_order<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>5<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>5<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>100<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>5<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:9;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>sp_cancel_write_off<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>527<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>524<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>3<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0,56<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>1<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>309<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>3<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:10;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>sp_client_order<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>7283<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>7283<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>15<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>6676<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:11;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>sp_customer_reserve<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>9276<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>8934<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>342<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>3,68<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>2<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>26748<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>342<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:12;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>sp_lock_selected_doc<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>5590<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>5266<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>324<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>5,79<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>106<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>324<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:13;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>sp_make_cost_storno<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>7221<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>7221<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>8806<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:14;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>sp_make_qty_storno<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>9544<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>9213<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>331<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>3,46<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>100273<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>331<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:15;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>sp_pay_from_customer<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>3444<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>3444<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>11<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>5401<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:16;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>sp_pay_to_supplier<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>412<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>412<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>9<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>9060<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:17;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>sp_reserve_write_off<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>3468<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>3271<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>197<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>5,68<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>10<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>4843<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>197<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:18;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>sp_supplier_invoice<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>141<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>141<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>41<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>105658<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:19;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>sp_supplier_order<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>145<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>145<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>38<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>90090<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:20;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>srv_make_invnt_saldo<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>803<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>803<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>6<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>24684<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:21;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>srv_make_money_saldo<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>959<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>959<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>6<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>6042<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:22;mso-yfti-lastrow:yes;height:12.75pt'>
  <td width=131 nowrap valign=bottom style='width:98.3pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:9.0pt'>srv_recalc_idx_stat<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>1036<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>1036<o:p></o:p></span></p>
  </td>
  <td width=33 nowrap valign=bottom style='width:24.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=35 nowrap valign=bottom style='width:26.55pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=47 nowrap valign=bottom style='width:35.5pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>6<o:p></o:p></span></p>
  </td>
  <td width=42 nowrap valign=bottom style='width:31.8pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>1467<o:p></o:p></span></p>
  </td>
  <td width=54 nowrap valign=bottom style='width:40.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=56 nowrap valign=bottom style='width:42.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>0<o:p></o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US style='font-size:7.0pt;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'> </span></span>Процедура<b style='mso-bidi-font-weight:
normal'><span style='mso-ansi-language:EN-US'> <span lang=EN-US>srv_mon_perf_detailed
</span></span></b>выдаёт<span style='mso-ansi-language:EN-US'> </span>следующие<span
style='mso-ansi-language:EN-US'> </span>столбцы<span lang=EN-US
style='mso-ansi-language:EN-US'>:<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>unit</span>
– имя модуля («прикладной» или служебной процедуры), возможно – с уточняющим
действием («<span lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>add</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invoice</span>:<span lang=EN-US
style='mso-ansi-language:EN-US'>apply</span>» и т.д.);</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>all</span> – общее число вызовов
этой процедуры всеми <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>-окнами
(как успешных, так и завершенных с ошибками);</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>ok</span> – число только тех вызовов,
которые завершившились успешно;</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>err</span> – число вызовов,
завершившихся с исключениями (как правило – связанными с лок-конфликтами или
невозможностью выбора случайного <span lang=EN-US style='mso-ansi-language:
EN-US'>ID</span> ввиду отсутствия записей в источнике);</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>err</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>prc</span></b> –
процент числа ошибочных вызовов относительно общего числа (<i style='mso-bidi-font-style:
normal'>важнейший показатель</i>);</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>ok</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>min</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>ms</span> – минимальное время выполнения среди
всех успешно завершившихся вызовов, <span lang=EN-US style='mso-ansi-language:
EN-US'>ms</span>;</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>ok</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>max</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>ms</span> – минимальное время выполнения среди
всех успешно завершившихся вызовов, <span lang=EN-US style='mso-ansi-language:
EN-US'>ms</span>;</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>chk</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>viol</span> – общее число исключений с <span
lang=EN-US style='mso-ansi-language:EN-US'>gdscode</span> = 335544558 ('<span
lang=EN-US style='mso-ansi-language:EN-US'>check</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>constraint</span>') и <span lang=EN-US
style='mso-ansi-language:EN-US'>gdscode</span> = 335544347 ('<span lang=EN-US
style='mso-ansi-language:EN-US'>not</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>valid</span>') (в идеале должно быть ноль; ненулевые значения
свидетельствуют о проблеме, исследованной тут: <span
style='mso-spacerun:yes'> </span><span lang=EN-US style='mso-ansi-language:
EN-US'><a
href="http://www.sql.ru/forum/actualutils.aspx?action=gotomsg&amp;tid=1110158&amp;msg=16428788">sql<span
lang=RU style='mso-ansi-language:RU'>.</span>ru<span lang=RU style='mso-ansi-language:
RU'>/</span>forum<span lang=RU style='mso-ansi-language:RU'>/</span>actualutils<span
lang=RU style='mso-ansi-language:RU'>.</span>aspx<span lang=RU
style='mso-ansi-language:RU'>?</span>action<span lang=RU style='mso-ansi-language:
RU'>=</span>gotomsg<span lang=RU style='mso-ansi-language:RU'>&amp;</span>tid<span
lang=RU style='mso-ansi-language:RU'>=1110158&amp;</span>msg<span lang=RU
style='mso-ansi-language:RU'>=16428788</span></a></span><span lang=EN-US> </span>);</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>unq</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>viol</span> – общее число исключений с <span
lang=EN-US style='mso-ansi-language:EN-US'>gdscode</span> = 335544665 ('<span
lang=EN-US style='mso-ansi-language:EN-US'>unique</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>key</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>violation</span>') и 335544349 <span lang=EN-US style='mso-ansi-language:
EN-US'>no</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>dup</span> (в
идеале должно быть ноль; ненулевые значения говорят о той же проблеме, что и
для графы <span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>chk</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>viol</span>);</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>lk</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>confl</span> – общее число исключений,
связанных с конфликтами блокировок: <span lang=EN-US style='mso-ansi-language:
EN-US'>lock</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>conflict</span>,
<span lang=EN-US style='mso-ansi-language:EN-US'>concurrent</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>transaction</span>, <span
lang=EN-US style='mso-ansi-language:EN-US'>deadlock</span> и <span lang=EN-US
style='mso-ansi-language:EN-US'>update</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>conflict</span> (соответствующие коды <span
lang=EN-US style='mso-ansi-language:EN-US'>gds</span>: 335544345, 335544878,
335544336 и 335544451);</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>stack</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>trc</span> – общее число исключений с кодом 335544842
(‘<span lang=EN-US style='mso-ansi-language:EN-US'>stack</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>trace</span>’), который оказался на
вершине стека и был получен клиентом вместо обычного в таких случаях 335544517 (‘<span
lang=EN-US style='mso-ansi-language:EN-US'>user</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>exc</span>’). Эта проблема была описана тут: <span
lang=EN-US style='mso-ansi-language:EN-US'>sql</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>ru</span>/<span lang=EN-US style='mso-ansi-language:
EN-US'>forum</span>/<span lang=EN-US style='mso-ansi-language:EN-US'>actualutils</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>aspx</span>?<span lang=EN-US
style='mso-ansi-language:EN-US'>action</span>=<span lang=EN-US
style='mso-ansi-language:EN-US'>gotomsg</span>&amp;<span lang=EN-US
style='mso-ansi-language:EN-US'>tid</span>=1112014&amp;<span lang=EN-US
style='mso-ansi-language:EN-US'>msg</span>=16477457 – и её причины решение пока
не найдены. К сожалению, намомент написания этого текста данная ошибка очень
часто происходит на <span lang=EN-US style='mso-ansi-language:EN-US'>FB</span>
3.0 при работе в режиме <span lang=EN-US style='mso-ansi-language:EN-US'>SuperClassic</span>;</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>zero</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>gds</span> – общее число ситуаций, при которых
в секции обработки исключений (‘<span lang=EN-US style='mso-ansi-language:EN-US'>when</span>’)
были переданы нулевые значения <span lang=EN-US style='mso-ansi-language:EN-US'>gdscode</span>;
эта ошибка была обнаружена только в <span lang=EN-US style='mso-ansi-language:
EN-US'>FB</span> 3.0 при работе в режиме <span lang=EN-US style='mso-ansi-language:
EN-US'>SuperClassic</span> – см. <span lang=EN-US style='mso-ansi-language:
EN-US'>CORE-4565<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>user</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>exc</span> - число исключений, определенных в
прикладном коде, т.е. «пользовательских», <span lang=EN-US style='mso-ansi-language:
EN-US'>gdscode</span> = 335544517, '<span lang=EN-US style='mso-ansi-language:
EN-US'>user</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>exc</span>'
(<span lang=EN-US style='mso-ansi-language:EN-US'>aka</span> ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>exception</span> @1’);</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>other</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>exc</span> – число всех остальных исключений</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>«Что с чем сравнивать
в результатах вызова </b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>mon</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>perf</span>_</b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>detailed</span> ?»<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal>Сравнению подлежат количественные и врменн<i
style='mso-bidi-font-style:normal'>ы</i>е показатели, получаемые в результате
работы теста на разных машинах (с одной версией <span lang=EN-US
style='mso-ansi-language:EN-US'>Firebird</span>), либо на разных версиях <span
lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span> (при работе на одной
машине). </p>

<p class=MsoNormal>Прежде всего, нужно сравнивать значения в столбце <b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>ERR</span>_</b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>PRC</span><span lang=EN-US> </span></b>для
одноимённых прикладных режимов (создание клиентских заказов, проведение инвойсов
и т.п.). </p>

<p class=MsoNormal>Для следующих <i style='mso-bidi-font-style:normal'>служебных</i>
модулей (графа ‘<span lang=EN-US style='mso-ansi-language:EN-US'>UNIT</span>’),
выполняющих сбор оборотов и пересчет индексов, факты неуспешного выполнения игнорируются:
</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>srv_make_invnt_saldo;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>srv_make_money_saldo;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>recalc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>idx</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>stat</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Для модулей «sp_cancel_supplier_order» (отмена заказа
поставщику) и «<span lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>cancel</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>adding</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invoice</span>» (отмена проведения инвойса от
поставщика) процент неудачных завершений (<span lang=EN-US style='mso-ansi-language:
EN-US'>ERR</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>PRC</span>) обычно
будет большим в связи с огромным объемом работы, который должна делать
транзакция в этих режимах (особенно в первом из них). </p>

<p class=MsoNormal>В остальных режимах значение <span lang=EN-US
style='mso-ansi-language:EN-US'>ERR</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>PRC</span><span lang=EN-US> </span>не должно превышать 20-25%.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Методика сравнения может быть, например, следующей: </p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l17 level1 lfo23;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>запускаем
тест на 1 час, дождались его завершения, сделали выгрузку результатов <span
lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>mon</span> в <span lang=EN-US style='mso-ansi-language:EN-US'>Excel</span>;</p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l17 level1 lfo23;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>повторяем
то же самое, но на другом сервере или на другой версии <span lang=EN-US
style='mso-ansi-language:EN-US'>Firebird</span>;</p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l17 level1 lfo23;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>3)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>оставляем
во втором отчетё только столбцы с именами: UNIT, CNT_ALL, CNT_OK, CNT_ERR,
ERR_PRC, OK_MIN_MS, OK_MAX_MS – и копируем их в первый отчет, размещая так,
чтобы было удобно сранивать значения для одних и тех же строк в графе <span
lang=EN-US style='mso-ansi-language:EN-US'>“UNIT”.</span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Также можно выполнить сравнение версий <span lang=EN-US
style='mso-ansi-language:EN-US'>Firebird</span> (2.5 <span lang=EN-US
style='mso-ansi-language:EN-US'>vs</span> 3.0), установленных на одном хосте,
запуская одновременно с двух клиентских машин по 10-15 окон, выполняя во всех
коннектах с первой машины соединение с <span lang=EN-US style='mso-ansi-language:
EN-US'>FB</span> 2.5, а со второй машины – соединение с <span lang=EN-US
style='mso-ansi-language:EN-US'>FB</span> 3.0.</p>

<p class=MsoNormal>Запуская два окна с <span lang=EN-US style='mso-ansi-language:
EN-US'>user</span>-трейсом, по одному для каждого инстанса ФБ, можно будет
сразу увидеть в статистике выполнения отличия между этими двумя версиями ФБ.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>«Как (чем) изменить степень нагрузки на СУБД ?»<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Степень нагрузки определяется следующими критериями: </p>

<p class=MsoNormal>1) настройками собственно теста (максимальное количество
строк в одном документе, с учетом его вида: «для клиента» или «от поставщика»;
максимальное значение в графе «Количество» в таблице детализации документа,
также с учетом его вида; максимальное число изделий и контрагентов в
соответствующих справочниках);</p>

<p class=MsoNormal>2) числом открываемых <span lang=EN-US style='mso-ansi-language:
EN-US'>isql</span>-окон;</p>

<p class=MsoNormal>3) частотой вызова той или иной бизнес-операции.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Далее приводятся объяснения по каждому из этих пунктов.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>1. Настройки теста.</b>
Введите запрос: <span lang=EN-US style='font-family:"Courier New";mso-ansi-language:
EN-US'>select</span><span style='font-family:"Courier New"'> * </span><span
lang=EN-US style='font-family:"Courier New";mso-ansi-language:EN-US'>from</span><span
lang=EN-US style='font-family:"Courier New"'> </span><span lang=EN-US
style='font-family:"Courier New";mso-ansi-language:EN-US'>z</span><span
style='font-family:"Courier New"'>_</span><span lang=EN-US style='font-family:
"Courier New";mso-ansi-language:EN-US'>settings</span><span style='font-family:
"Courier New"'>_</span><span lang=EN-US style='font-family:"Courier New";
mso-ansi-language:EN-US'>pivot</span><span style='font-family:"Courier New"'>;<o:p></o:p></span></p>

<p class=MsoNormal>Этот запрос выведет данные обо всех имеющихся нагрузочных
режимах, причём тот из них, который действует сейчас, будет выделен знаком «*»
и выведен в <span lang=EN-US style='mso-ansi-language:EN-US'>uppercase</span>:</p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=494
 style='width:370.4pt;margin-left:4.65pt;border-collapse:collapse;mso-padding-alt:
 0cm 5.4pt 0cm 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:12.75pt'>
  <td width=73 nowrap valign=bottom style='width:54.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>WORKING
  MODE<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>WARES
  MAX ID<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>CUSTOMER
  DOC MAX ROWS<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>SUPPLIER
  DOC MAX ROWS<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>CUSTOMER
  DOC MAX QTY<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>SUPPLIER
  DOC MAX QTY<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>NUMBER
  OF AGENTS<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;height:12.75pt'>
  <td width=73 nowrap valign=bottom style='width:54.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR";
  color:silver'>debug 01<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>1<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>1<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>1<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>2<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>5<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>3<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;height:12.75pt'>
  <td width=73 nowrap valign=bottom style='width:54.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR";
  color:silver'>debug 02<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>2<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>2<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>3<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>5<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>5<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>3<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:3;height:12.75pt'>
  <td width=73 nowrap valign=bottom style='width:54.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR";
  color:silver'>debug 03<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>3<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>3<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>5<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>4<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>8<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>10<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:4;height:12.75pt'>
  <td width=73 nowrap valign=bottom style='width:54.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR";
  color:silver'>debug 04<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>10<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>5<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>30<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>5<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>30<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>15<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:5;height:12.75pt'>
  <td width=73 nowrap valign=bottom style='width:54.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR";
  color:silver'>debug 1a<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>1<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>10<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>50<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>10<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>50<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR";color:silver'>3<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:6;height:12.75pt'>
  <td width=73 nowrap valign=bottom style='width:54.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>small
  01<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>100<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>5<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>20<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>5<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>20<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>30<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:7;height:12.75pt'>
  <td width=73 nowrap valign=bottom style='width:54.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>small
  02<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>300<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>10<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>30<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>10<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>30<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>40<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:8;height:12.75pt'>
  <td width=73 nowrap valign=bottom style='width:54.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>* SMALL 03<o:p></o:p></span></b></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>400<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>10<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>50<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>15<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>50<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>50<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:9;height:12.75pt'>
  <td width=73 nowrap valign=bottom style='width:54.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>medium
  01<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>700<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>20<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>60<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>30<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>100<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>100<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:10;height:12.75pt'>
  <td width=73 nowrap valign=bottom style='width:54.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>medium
  02<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>1500<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>30<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>80<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>50<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>150<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>150<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:11;height:12.75pt'>
  <td width=73 nowrap valign=bottom style='width:54.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>medium
  03<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>3000<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>50<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>100<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>70<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>200<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>200<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:12;height:12.75pt'>
  <td width=73 nowrap valign=bottom style='width:54.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>large
  01<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>5000<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>70<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>200<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>100<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>300<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>500<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:13;height:12.75pt'>
  <td width=73 nowrap valign=bottom style='width:54.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>large
  02<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>7000<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>100<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>300<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>150<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>450<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>700<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:14;mso-yfti-lastrow:yes;height:12.75pt'>
  <td width=73 nowrap valign=bottom style='width:54.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>large
  03<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>9000<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>150<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>400<o:p></o:p></span></p>
  </td>
  <td width=78 nowrap valign=bottom style='width:58.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>200<o:p></o:p></span></p>
  </td>
  <td width=68 nowrap valign=bottom style='width:51.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>600<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>1000<o:p></o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Каждый кортеж определяет то, какими будут значения
контекстных переменных, по которым далее будет сформировано начальное состояние
базы, а также параметры для создаваемых документов (число строк в них и
прочее).</p>

<p class=MsoNormal>В столбцах <span lang=EN-US style='mso-ansi-language:EN-US'>CUSTOMER</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>DOC</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>MAX</span>_*** и <span lang=EN-US
style='mso-ansi-language:EN-US'>SUPPLIER</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>DOC</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>MAX</span>_*** для каждого режима указаны параметры, формирующие <b
style='mso-bidi-font-weight:normal'>объём работы</b>, который в среднем должна
делать каждая транзакция. Это максимальное число строк в таблице детализации по
изделиям для складских документов, а также максимальное значение в графе «Количество»
(оно определяет объем работы при <i style='mso-bidi-font-style:normal'>сторнировании</i>
– см ниже).</p>

<p class=MsoNormal>В столбцах <span lang=EN-US style='mso-ansi-language:EN-US'>WARES</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>MAX</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span><span lang=EN-US> </span>и <span
lang=EN-US style='mso-ansi-language:EN-US'>NUMBER</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>OF</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>AGENTS</span><span lang=EN-US> </span>указаны числа, определяющие число
строк в справочниках «Изделия» и «Контрагенты». Эти справочники формируются до
начала работы теста и далее число строк в них не меняется.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Вы можете легко изменить вышеперечисленные параметры в
каком-либо из режимов, а также создать новый нагрузочный режим. Для этого откройте
в редакторе скрипт <span lang=EN-US style='mso-ansi-language:EN-US'>OLTP</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>MAIN</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>FILLING</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>SQL</span><span lang=EN-US> </span>и найдите там
строку: <span lang=EN-US style='mso-ansi-language:EN-US'>delete</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>from</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>settings</span>;</p>

<p class=MsoNormal>Ниже этой строки находится большой <span lang=EN-US
style='mso-ansi-language:EN-US'>execute</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>block</span>, обрабатывающий <span
lang=EN-US style='mso-ansi-language:EN-US'>CTE</span>-запрос. Внутри<span
style='mso-ansi-language:EN-US'> </span>этого<span style='mso-ansi-language:
EN-US'> </span>СТЕ<span lang=EN-US style='mso-ansi-language:EN-US'>-</span>запроса<span
style='mso-ansi-language:EN-US'> </span>есть<span style='mso-ansi-language:
EN-US'> </span>следующие<span style='mso-ansi-language:EN-US'> </span>строки<span
lang=EN-US style='mso-ansi-language:EN-US'>:</span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- PUT YOUR OWN SETTINGS FOR DIFFERENT WORKLOAD MODES
HERE . . .<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- working | num of | max<span
style='mso-spacerun:yes'>       </span>| max<span
style='mso-spacerun:yes'>       </span>| max<span
style='mso-spacerun:yes'>      </span>| max<span style='mso-spacerun:yes'>     
</span>| num of<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- mode<span style='mso-spacerun:yes'>   
</span>|<span style='mso-spacerun:yes'>  </span>wares | cust_rows | supp_rows |
cust_Qty | supp_Qty | agents<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>'DEBUG_01',<span style='mso-spacerun:yes'>      
</span>1,<span style='mso-spacerun:yes'>       </span>1,<span
style='mso-spacerun:yes'>          </span>1,<span
style='mso-spacerun:yes'>          </span>2,<span
style='mso-spacerun:yes'>         </span>5,<span
style='mso-spacerun:yes'>        </span>3<span style='mso-spacerun:yes'> 
</span>from... union all...<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>'DEBUG_02',<span style='mso-spacerun:yes'>      
</span>2,<span style='mso-spacerun:yes'>       </span>2,<span
style='mso-spacerun:yes'>          </span>3,<span
style='mso-spacerun:yes'>          </span>5,<span
style='mso-spacerun:yes'>         </span>5,<span
style='mso-spacerun:yes'>        </span>3<span style='mso-spacerun:yes'> 
</span>from... union all...<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>'DEBUG_03',<span style='mso-spacerun:yes'>      
</span>3,<span style='mso-spacerun:yes'>       </span>3,<span
style='mso-spacerun:yes'>          </span>5,<span
style='mso-spacerun:yes'>          </span>4,<span
style='mso-spacerun:yes'>         </span>8,<span
style='mso-spacerun:yes'>       </span>10<span style='mso-spacerun:yes'> 
</span>from... union all...<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>'DEBUG_04',<span style='mso-spacerun:yes'>     
</span>10,<span style='mso-spacerun:yes'>       </span>5,<span
style='mso-spacerun:yes'>         </span>30,<span
style='mso-spacerun:yes'>          </span>5,<span
style='mso-spacerun:yes'>        </span>30,<span
style='mso-spacerun:yes'>       </span>15<span style='mso-spacerun:yes'> 
</span>from... union all...<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>'DEBUG_1A',<span style='mso-spacerun:yes'>      
</span>1,<span style='mso-spacerun:yes'>      </span>10,<span
style='mso-spacerun:yes'>         </span>50,<span
style='mso-spacerun:yes'>      </span><span
style='mso-spacerun:yes'>   </span>10,<span style='mso-spacerun:yes'>       
</span>50,<span style='mso-spacerun:yes'>        </span>3<span
style='mso-spacerun:yes'>  </span>from... union all...<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>'SMALL_01',<span style='mso-spacerun:yes'>    
</span>100,<span style='mso-spacerun:yes'>       </span>5,<span
style='mso-spacerun:yes'>         </span>20,<span
style='mso-spacerun:yes'>          </span>5,<span
style='mso-spacerun:yes'>        </span>20,<span
style='mso-spacerun:yes'>       </span>30<span style='mso-spacerun:yes'> 
</span>from... union all...<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>'SMALL_02',<span style='mso-spacerun:yes'>    
</span>300,<span style='mso-spacerun:yes'>      </span>10,<span
style='mso-spacerun:yes'>         </span>30,<span
style='mso-spacerun:yes'>         </span>10,<span
style='mso-spacerun:yes'>        </span>30,<span
style='mso-spacerun:yes'>       </span>40<span style='mso-spacerun:yes'> 
</span>from... union all...<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>'SMALL_03',<span style='mso-spacerun:yes'>    </span><span
style='mso-spacerun:yes'> </span>400,<span style='mso-spacerun:yes'>     
</span>10,<span style='mso-spacerun:yes'>         </span>50,<span
style='mso-spacerun:yes'>         </span>15,<span
style='mso-spacerun:yes'>        </span>50,<span
style='mso-spacerun:yes'>       </span>50<span style='mso-spacerun:yes'> 
</span>from... union all...<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>'MEDIUM_01',<span style='mso-spacerun:yes'>   
</span>700,<span style='mso-spacerun:yes'>      </span>20,<span
style='mso-spacerun:yes'>         </span>60,<span
style='mso-spacerun:yes'>         </span>30,<span
style='mso-spacerun:yes'>       </span>100,<span style='mso-spacerun:yes'>     
</span>100<span style='mso-spacerun:yes'>  </span>from... union all...<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>'MEDIUM_02',<span style='mso-spacerun:yes'>  
</span>1500,<span style='mso-spacerun:yes'>      </span>30,<span
style='mso-spacerun:yes'>         </span>80,<span
style='mso-spacerun:yes'>         </span>50,<span
style='mso-spacerun:yes'>       </span>150,<span style='mso-spacerun:yes'>     
</span>150<span style='mso-spacerun:yes'>  </span>from... union all...<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>'MEDIUM_03',<span style='mso-spacerun:yes'>  
</span>3000,<span style='mso-spacerun:yes'>      </span>50,<span
style='mso-spacerun:yes'>        </span>100,<span
style='mso-spacerun:yes'>         </span>70,<span
style='mso-spacerun:yes'>       </span>200,<span style='mso-spacerun:yes'>     
</span>200<span style='mso-spacerun:yes'>  </span>from... union all...<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>'LARGE_01',<span style='mso-spacerun:yes'>   
</span>5000,<span style='mso-spacerun:yes'>      </span>70,<span
style='mso-spacerun:yes'>        </span>200,<span
style='mso-spacerun:yes'>        </span>100,<span
style='mso-spacerun:yes'>       </span>300,<span style='mso-spacerun:yes'>     
</span>500<span style='mso-spacerun:yes'>  </span>from... union all...<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>'LARGE_02',<span style='mso-spacerun:yes'>   
</span>7000,<span style='mso-spacerun:yes'>     </span>100,<span
style='mso-spacerun:yes'>        </span>300,<span
style='mso-spacerun:yes'>      </span><span
style='mso-spacerun:yes'>  </span>150,<span style='mso-spacerun:yes'>      
</span>450,<span style='mso-spacerun:yes'>      </span>700<span
style='mso-spacerun:yes'>  </span>from... union all...<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>'LARGE_03',<span style='mso-spacerun:yes'>   
</span>9000,<span style='mso-spacerun:yes'>     </span>150,<span
style='mso-spacerun:yes'>        </span>400,<span
style='mso-spacerun:yes'>        </span>200,<span
style='mso-spacerun:yes'>       </span>600,<span style='mso-spacerun:yes'>    
</span>1000<span style='mso-spacerun:yes'>  </span>from rdb$database<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Чтобы исправить значения для какого-то режима, просто
измените одно число на другое.</p>

<p class=MsoNormal>Чтобы добавить новый режим, скопируйте одну из строк и
поменяйте название в первой графе (т.е. задайте уникальное имя этому кортежу).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Чтобы поменять текущий режим на другой, найдите первую команду
вставки в таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>settings</span><span
lang=EN-US> </span>ПОСЛЕ этого <span lang=EN-US style='mso-ansi-language:EN-US'>execute</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>block</span>’<span
lang=EN-US style='mso-ansi-language:EN-US'>a</span>, она имеет такой вид:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>-- ::: NB :::
re-run oltp_data_filling.sql EVERY time you change this var:<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>insert into
settings(working_mode, mcode,<span style='mso-spacerun:yes'>          
</span>svalue)<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>              </span>values('INIT',<span
style='mso-spacerun:yes'>       </span>'WORKING_MODE',<span
style='mso-spacerun:yes'>  </span>'XXXXX’);</span><span lang=EN-US
style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:EN-US'> <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Вместо ‘<span lang=EN-US style='mso-ansi-language:EN-US'>XXXXX</span>’
там будет мнемоническое обозначение режима нагрузки: ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>SMALL</span>_01’, ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>SMALL</span>_02’, ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>MEDIUM</span>_01', <span
style='mso-spacerun:yes'> </span>или какое-то другое.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>ВНИМАНИЕ<b style='mso-bidi-font-weight:normal'>.</b> После
смены мнемокода нагрузки обязательно запустите <span lang=EN-US
style='mso-ansi-language:EN-US'>OLTP</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>DATA</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>FILLING</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>SQL</span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>2. Число открываемых </b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>isql</span>.</b> <span style='mso-spacerun:yes'> </span>Количество
открываемых <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>-окон
задается вторым аргументом к сценарию запуска теста – файлу 1run_oltp_emul.bat.<span
style='font-size:11.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>3.</b> <b
style='mso-bidi-font-weight:normal'>Част<i style='mso-bidi-font-style:normal'>о</i>ты
вызова бизнес-операций</b>. Эти параметры заданы в таблице <b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='background:silver;mso-highlight:silver;
mso-ansi-language:EN-US'>business</span><span style='background:silver;
mso-highlight:silver'>_</span></b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>ops</span></b>, которая заполняется на этапе формирования объектов
тестовой базы, см. скрипт <span lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>main</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>filling</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>sql</span>. Эта таблица содержит (помимо
прочих) поле ‘<span lang=EN-US style='mso-ansi-language:EN-US'>unit</span>’ с
именем хранимой процедуры, реализующей операцию, а также поле ‘<span
lang=EN-US style='mso-ansi-language:EN-US'>random</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>selection</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>weight</span>’, в котором записано число от 0
до 100. </p>

<p class=MsoNormal>Когда какое-то из нагрузочных окон должно выполнить
бизнес-операцию, оно предварительно вызывает служебную ХП srv_random_unit_choice.
Эта ХП генерирует случайное число <span lang=EN-US style='mso-ansi-language:
EN-US'>R</span><span lang=EN-US> </span>от 0 до 100 и затем выполняет выборку
всех записей в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>business</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>ops</span>, у которых значение в
поле <span lang=EN-US style='mso-ansi-language:EN-US'>random</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>selection</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>weight</span> больше или равно <span
lang=EN-US style='mso-ansi-language:EN-US'>R</span>. Далее, выполняется подсчет
числа отобранных записей и уже среди них делается выбор одной случайной строки.
Имя модуля, записанное в поле <span lang=EN-US style='mso-ansi-language:EN-US'>‘unit’</span>
этой строки, и будет далее использовано при вызове соответствующей операции.</p>

<p class=MsoNormal>Числа, записанные в поле <span lang=EN-US style='mso-ansi-language:
EN-US'>random</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>selection</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>weight</span>, были специально
подобраны так, чтобы операции, относящиеся к покупателям (заказчикам)
вызывались чаще остальных. Далее (по убыванию частоты) идут операции,
относящиеся к поставкам, а затем – к оплатам. Реже всех вызываются служебные
процедуры пересчета статистики индексов и создания сальдовых остатков на основе
оборотов.</p>

<p class=MsoNormal>Процедуры, отменяющие какое-либо действие, вызываются реже,
чем процедуры «прямого» действия: такова обычная практика работы предприятий
обслуживания заказов.</p>

<p class=MsoNormal>Любое из <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>-окон
может вызвать любую ХП, т.е. <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>-окна
не делятся на какие-либо «категории». </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Таким образом, для изменения частоты вызовов того или иного
бизнес-действия, необходимо поменять значение в поле <span lang=EN-US
style='mso-ansi-language:EN-US'>business</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>ops</span>. <span lang=EN-US style='mso-ansi-language:
EN-US'>random</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>selection</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>weight</span>: чем оно <i
style='mso-bidi-font-style:normal'>выше</i>, тем <i style='mso-bidi-font-style:
normal'>чаще</i> будет вызываться данная процедура.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>«Как мне убедиться, что статистика по индексам
актуальна, и какая она сейчас <span style='mso-spacerun:yes'> </span>?»<o:p></o:p></span></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Короткий ответ</b>: <span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l9 level1 lfo21;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>запустите<span
style='mso-spacerun:yes'>  </span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>select</span><span
style='background:silver;mso-highlight:silver'> * </span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>from</span><span
lang=EN-US style='background:silver;mso-highlight:silver'> </span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>srv</span><span style='background:silver;mso-highlight:silver'>_</span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>mon</span><span style='background:silver;mso-highlight:silver'>_</span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>idx</span><span style='background:silver;mso-highlight:silver'>;</span>
для получения подробных сведений о результатах пересчета статистики;<br>
<b style='mso-bidi-font-weight:normal'>либо</b></p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l9 level1 lfo21;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>запустите
<span lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>select</span><span style='background:silver;mso-highlight:silver'> * </span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>from</span><span lang=EN-US style='background:silver;mso-highlight:silver'>
</span><span lang=EN-US style='background:silver;mso-highlight:silver;
mso-ansi-language:EN-US'>z</span><span style='background:silver;mso-highlight:
silver'>_</span><span lang=EN-US style='background:silver;mso-highlight:silver;
mso-ansi-language:EN-US'>idx</span><span style='background:silver;mso-highlight:
silver'>_</span><span lang=EN-US style='background:silver;mso-highlight:silver;
mso-ansi-language:EN-US'>stat</span><span style='background:silver;mso-highlight:
silver'>;</span> для получения только данных о текущей статистике,
упорядоченных так, что первыми выводятся самые «проблемные» индексы: с
отсутствующей статистикой либо с плохой селективностью.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Описание.</b> <span
style='mso-spacerun:yes'> </span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Периодический пересчет статистики по индексам необходим при
изменениях таблиц. В некоторых таблицах (<span lang=EN-US style='mso-ansi-language:
EN-US'>DOC_DATA, QDISTR</span>, <span lang=EN-US style='mso-ansi-language:EN-US'>QSTORNED</span>,
<span lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span>, <span
lang=EN-US style='mso-ansi-language:EN-US'>PSTORNED</span>) изменения настолько
интенсивны, что запоздалый пересчет статистики их индексов может привести к
смене планов запросов к ним на совершенно неэффективные, что повлечёт
существенное падение производительности.</p>

<p class=MsoNormal>Скрипты, выполняемые каждым из коннектов, содержат
периодический вызов служебной процедуры srv_recalc_idx_stat, которая выполняет
пересчет статистики по индексам и пишет в протокол их имена и получаемые
результаты (значение из <span lang=EN-US style='mso-ansi-language:EN-US'>rdb</span>$<span
lang=EN-US style='mso-ansi-language:EN-US'>indices</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>rdb</span>$<span lang=EN-US style='mso-ansi-language:
EN-US'>statistics</span> после пересчета, а также величину дельты, т.е.
насколько изменилась статистика с прошлого раза). Процедура srv_mon_idx выполняет
запрос к протоколу и выдаёт результаты в виде, удобном для анализа.<span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Вот пример - фрагмент вывода ХП <span lang=EN-US
style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>mon</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>idx</span>:</p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=705
 style='width:528.8pt;margin-left:4.65pt;border-collapse:collapse;mso-padding-alt:
 0cm 5.4pt 0cm 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:12.75pt'>
  <td width=74 nowrap valign=bottom style='width:55.7pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>TAB_NAME<o:p></o:p></span></p>
  </td>
  <td width=220 nowrap valign=bottom style='width:165.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>IDX_NAME<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>LAST_STAT<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>CURR_STAT<o:p></o:p></span></p>
  </td>
  <td width=91 nowrap valign=bottom style='width:68.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>DIFF_STAT<o:p></o:p></span></p>
  </td>
  <td width=72 nowrap valign=bottom style='width:54.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>LAST_DONE<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;height:12.75pt'>
  <td width=74 nowrap valign=bottom style='width:55.7pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>QDISTR<o:p></o:p></span></p>
  </td>
  <td width=220 nowrap valign=bottom style='width:165.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>PK_QDISTR<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>1,22667779578478E-5<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>1,22167248264304E-5<o:p></o:p></span></p>
  </td>
  <td width=91 nowrap valign=bottom style='width:68.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>5,00531314173713E-8<o:p></o:p></span></p>
  </td>
  <td width=72 nowrap valign=bottom style='width:54.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>18:56:19<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;height:12.75pt'>
  <td width=74 nowrap valign=bottom style='width:55.7pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>QDISTR<o:p></o:p></span></p>
  </td>
  <td width=220 nowrap valign=bottom style='width:165.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>QDISTR_DOC_SND<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>0,000127893596072681<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>0,000126278566312976<o:p></o:p></span></p>
  </td>
  <td width=91 nowrap valign=bottom style='width:68.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>1,61502975970507E-6<o:p></o:p></span></p>
  </td>
  <td width=72 nowrap valign=bottom style='width:54.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>18:56:19<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:3;height:12.75pt'>
  <td width=74 nowrap valign=bottom style='width:55.7pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>QDISTR<o:p></o:p></span></p>
  </td>
  <td width=220 nowrap valign=bottom style='width:165.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:8.0pt;mso-ansi-language:
  EN-US'>QDISTR_SNDOP_RCVOP_SND_ID_DESC<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>7,14540874469094E-5<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>7,12098553776741E-5<o:p></o:p></span></p>
  </td>
  <td width=91 nowrap valign=bottom style='width:68.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>2,44232069235295E-7<o:p></o:p></span></p>
  </td>
  <td width=72 nowrap valign=bottom style='width:54.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>18:56:19<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:4;height:12.75pt'>
  <td width=74 nowrap valign=bottom style='width:55.7pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>QDISTR<o:p></o:p></span></p>
  </td>
  <td width=220 nowrap valign=bottom style='width:165.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>QDISTR_SND_ID<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>0,000127893596072681<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>0,000126278566312976<o:p></o:p></span></p>
  </td>
  <td width=91 nowrap valign=bottom style='width:68.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>1,61502975970507E-6<o:p></o:p></span></p>
  </td>
  <td width=72 nowrap valign=bottom style='width:54.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>18:56:19<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:5;height:12.75pt'>
  <td width=74 nowrap valign=bottom style='width:55.7pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>QDISTR<o:p></o:p></span></p>
  </td>
  <td width=220 nowrap valign=bottom style='width:165.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>QDISTR_WARE_SND_OPTYPE<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>0,00120336946565658<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>0,00120772945228964<o:p></o:p></span></p>
  </td>
  <td width=91 nowrap valign=bottom style='width:68.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>-4,35998663306236E-6<o:p></o:p></span></p>
  </td>
  <td width=72 nowrap valign=bottom style='width:54.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>18:56:19<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:6;height:12.75pt'>
  <td width=74 nowrap valign=bottom style='width:55.7pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>QSTORNED<o:p></o:p></span></p>
  </td>
  <td width=220 nowrap valign=bottom style='width:165.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>PK_QDSTORNED<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>3,62634164048359E-5<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>3,58873148798011E-5<o:p></o:p></span></p>
  </td>
  <td width=91 nowrap valign=bottom style='width:68.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>3,76101525034755E-7<o:p></o:p></span></p>
  </td>
  <td width=72 nowrap valign=bottom style='width:54.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>18:56:19<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:7;height:12.75pt'>
  <td width=74 nowrap valign=bottom style='width:55.7pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>QSTORNED<o:p></o:p></span></p>
  </td>
  <td width=220 nowrap valign=bottom style='width:165.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>QSTORNED_DOC_ID<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>0,000712758395820856<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>0,000696864095516503<o:p></o:p></span></p>
  </td>
  <td width=91 nowrap valign=bottom style='width:68.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>1,58943003043532E-5<o:p></o:p></span></p>
  </td>
  <td width=72 nowrap valign=bottom style='width:54.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>18:56:19<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:8;height:12.75pt'>
  <td width=74 nowrap valign=bottom style='width:55.7pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>QSTORNED<o:p></o:p></span></p>
  </td>
  <td width=220 nowrap valign=bottom style='width:165.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>QSTORNED_RCV_ID<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>0,000560852524358779<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>0,000544959155377001<o:p></o:p></span></p>
  </td>
  <td width=91 nowrap valign=bottom style='width:68.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>1,58933689817786E-5<o:p></o:p></span></p>
  </td>
  <td width=72 nowrap valign=bottom style='width:54.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>18:56:19<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:9;mso-yfti-lastrow:yes;height:12.75pt'>
  <td width=74 nowrap valign=bottom style='width:55.7pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>QSTORNED<o:p></o:p></span></p>
  </td>
  <td width=220 nowrap valign=bottom style='width:165.2pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>QSTORNED_SND_ID<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>0,000267522729700431<o:p></o:p></span></p>
  </td>
  <td width=124 nowrap valign=bottom style='width:92.9pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>0,000263991561951116<o:p></o:p></span></p>
  </td>
  <td width=91 nowrap valign=bottom style='width:68.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:8.0pt'>3,5311677493155E-6<o:p></o:p></span></p>
  </td>
  <td width=72 nowrap valign=bottom style='width:54.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:9.0pt'>18:56:19<o:p></o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span style='mso-spacerun:yes'> </span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Столбцы вывода:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>TAB</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>NAME</span><span lang=EN-US> </span>и
<span lang=EN-US style='mso-ansi-language:EN-US'>IDX</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>NAME</span> – это имя таблицы и индекса,
статистика по кторому была пересчитана;</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>LAST</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>STAT</span> - статистика, которая
хранилась в базе непосредственно <i style='mso-bidi-font-style:normal'>перед</i>
предыдущим пересчетом;</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>CURR</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>STAT</span> – статистика, записанная
сейчас в словаре БД (таблица <span lang=EN-US style='mso-ansi-language:EN-US'>RDB</span>$<span
lang=EN-US style='mso-ansi-language:EN-US'>INDICES</span>);</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>DIFF</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>STAT</span> – насколько поменялаксь
статистика с прошлого раза;</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>LAST</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>DONE</span><span lang=EN-US> </span>–штам
времени, когда произошел последний пересчет статистики</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Процедура <span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>mon</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>idx</span> выдаст информацию по данным <i
style='mso-bidi-font-style:normal'>последнего</i> выполнявшегося пересчета для
сравнения с текущими значениями.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>«Как оценить накопление версий записей ?»<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>Из всех таблиц наиболее подвержены накоплению версий (и
мусора) следующие:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>invnt_turnover_log,
invnt_saldo, money_turnover_log, money_saldo, doc_data, qdistr и pdistr.<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Большое количество версий в таблицах, хранящих обороты и
остатки (<span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_* и <span
lang=EN-US style='mso-ansi-language:EN-US'>money</span>_*) не влияет на
производительность бизнес-операций: в таблицы с оборотами (*_<span lang=EN-US
style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>) идут только вставки, а обращения к
сальдовым таблицам (*_<span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>)
выполняется только в «служебных», но не в прикладных режимах.</p>

<p class=MsoNormal>Накопление версий в таблицах <span lang=EN-US
style='mso-ansi-language:EN-US'>qdistr</span> и <span lang=EN-US
style='mso-ansi-language:EN-US'>pdistr</span> (источники для количественного и
стоимостного <i style='mso-bidi-font-style:normal'>сторнирования</i>)
обусловлено интенсивным удалением записей из них при создании новых документов
и<span style='mso-spacerun:yes'>  </span>движении их по цепочке состояний, т.е.
«проведении» или его отмене, а также при удалении документов. Избежать этого
при наличии транзакций, выполняющих «тяжелые» операции типа проведения инвойса
или отмены заказа поставщику, <span style='mso-spacerun:yes'> </span>невозможно.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В тесте предприняты следующие <b style='mso-bidi-font-weight:
normal'>меры для уменьшения количества версий</b>:</p>

<p class=MsoNormal>1) если требуется внести изменение в таблицу «А», но только
при условии, что сначала будет изменена таблица «Б», то сначала на соотв.
строку в «Б» устанавливается явная блокировка и дальнейшие модификации данных и
только при её успехе;</p>

<p class=MsoNormal>2) агрегатная информация в заголовках документов (поля <span
lang=EN-US style='mso-ansi-language:EN-US'>cost</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>purchase</span><span lang=EN-US> </span>и <span
lang=EN-US style='mso-ansi-language:EN-US'>cost</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>retail</span> – суммы в закупочных и розничных
ценах) НЕ обновляется триггером при модификации дочерней таблицы. Вместо этого,
обновление происходит только один раз, по окончании формирования документа,
когда итоговые суммы подсчитаны в цикле, добавляющем строки в таблицу
детализации;</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>При установке ФБ на машине с <span lang=EN-US
style='mso-ansi-language:EN-US'>OS</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>Linux</span><span lang=EN-US> </span>вы
можете использовать следующие скрипты для анализа счетчиков транзакций и
количества версий в этих таблицах:</p>

<p class=MsoNormal>1. Скрипт для протоколирования значений счетчиков транзакций
(измените переменные окружения на «свои»):</p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>clear<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>fbhome=/opt/fb30trnk/bin<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>dbname=oltp30<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>fbport=3333<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>relax=10<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>log=gstat_h_watch.txt<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>rm -f $log<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>i=0<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>while :<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>do<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>echo<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>echo $(date
+'%Y%m%d_%H%M%S') iter $i<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>echo ......................<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>$fbhome/gstat
-h localhost/$port:$dbname | grep -i &quot;oldest\|next tran&quot;&gt;tmph.tmp<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>supertee -tan
$log cat tmph.tmp<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>rm -f tmph.tmp<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>echo now sleep
$relax seconds. . .<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span></span><span
style='font-size:11.0pt;font-family:"Courier New"'>sleep $relax<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:11.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span>i=$((i+1))<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:11.0pt;font-family:"Courier New"'>done<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>2. Скрипт для протоколирования количеств версий в
вышеупомянутых таблицах:<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>clear<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>fbhome=/opt/fb30trnk/bin<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>dbname=oltp30<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>fbport=3333<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>relax=10<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>log=gstat_watch.txt<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>rm -f $log<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>i=0<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>while :<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>do<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>echo<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>echo $(date
+'%Y%m%d_%H%M%S') iter $i<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>echo
......................<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>$fbhome/gstat
-r localhost/$port:$dbname | grep -A 5 -i &quot;^qdistr
(\|^qstorned\|^doc_data\|^pdistr\|^pstorned&quot;&gt;tmp.tmp<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>supertee -tan
$log cat tmp.tmp<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>rm -f tmp.tmp<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>echo now sleep
$relax seconds. . .<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>sleep $relax<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>i=$((i+1))<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>done<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Оба скрипта используют утилиту <span lang=EN-US
style='mso-ansi-language:EN-US'>supertee</span>, позволяющую проставлять штамп
времени рядом с каждой выводимой строкой, прежде чем она будет продублирована в
лог.</p>

<p class=MsoNormal>Кроме того, оба скрипта будут создавать (перетирать) файлы с
именами ‘<span lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>’ и ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>tmph</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>tmp</span>’ – они используются для временного хранения промежуточных
результатов. </p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'> </span><o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>«Как мне получить сводные данные о возникавших
исключениях ?»<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Вариант</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>-1</span></b><span lang=EN-US style='mso-ansi-language:EN-US'>: </span>запустите<span
lang=EN-US style='mso-ansi-language:EN-US'><span style='mso-spacerun:yes'> 
</span></span><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>select * from
srv_mon_exceptions</span><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>;</span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Пример вывода этой ХП:<span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=559
 style='width:419.45pt;margin-left:4.65pt;border-collapse:collapse;mso-padding-alt:
 0cm 5.4pt 0cm 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:12.75pt'>
  <td width=94 nowrap valign=bottom style='width:70.45pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>FB_GDSCODE<o:p></o:p></span></p>
  </td>
  <td width=96 nowrap valign=bottom style='width:72.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>FB_MNEMONA<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.15pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>UNIT<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>CNT<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>DTS_MIN<o:p></o:p></span></p>
  </td>
  <td width=65 nowrap valign=bottom style='width:48.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>DTS_MAX<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;height:12.75pt'>
  <td width=94 nowrap valign=bottom style='width:70.45pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>335544336<o:p></o:p></span></p>
  </td>
  <td width=96 nowrap valign=bottom style='width:72.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>deadlock<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.15pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_add_invoice:apply<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>25<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>18:52:00<o:p></o:p></span></p>
  </td>
  <td width=65 nowrap valign=bottom style='width:48.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>19:18:38<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;height:12.75pt'>
  <td width=94 nowrap valign=bottom style='width:70.45pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>335544336<o:p></o:p></span></p>
  </td>
  <td width=96 nowrap valign=bottom style='width:72.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>deadlock<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.15pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_add_invoice:cancel<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>1<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>18:57:48<o:p></o:p></span></p>
  </td>
  <td width=65 nowrap valign=bottom style='width:48.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>18:57:48<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:3;height:12.75pt'>
  <td width=94 nowrap valign=bottom style='width:70.45pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>335544336<o:p></o:p></span></p>
  </td>
  <td width=96 nowrap valign=bottom style='width:72.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>deadlock<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.15pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_cancel_client_order<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>1<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>19:17:14<o:p></o:p></span></p>
  </td>
  <td width=65 nowrap valign=bottom style='width:48.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>19:17:14<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:4;height:12.75pt'>
  <td width=94 nowrap valign=bottom style='width:70.45pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>335544336<o:p></o:p></span></p>
  </td>
  <td width=96 nowrap valign=bottom style='width:72.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>deadlock<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.15pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_cancel_customer_reserve<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>1<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>18:57:49<o:p></o:p></span></p>
  </td>
  <td width=65 nowrap valign=bottom style='width:48.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>18:57:49<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:5;height:12.75pt'>
  <td width=94 nowrap valign=bottom style='width:70.45pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>335544336<o:p></o:p></span></p>
  </td>
  <td width=96 nowrap valign=bottom style='width:72.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>deadlock<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.15pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_lock_selected_doc<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>82<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>18:52:00<o:p></o:p></span></p>
  </td>
  <td width=65 nowrap valign=bottom style='width:48.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>19:21:42<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:6;height:12.75pt'>
  <td width=94 nowrap valign=bottom style='width:70.45pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>335544336<o:p></o:p></span></p>
  </td>
  <td width=96 nowrap valign=bottom style='width:72.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>deadlock<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.15pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_reserve_write_off<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>55<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>18:52:08<o:p></o:p></span></p>
  </td>
  <td width=65 nowrap valign=bottom style='width:48.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>19:21:42<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:7;mso-yfti-lastrow:yes;height:12.75pt'>
  <td width=94 nowrap valign=bottom style='width:70.45pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>335544517<o:p></o:p></span></p>
  </td>
  <td width=96 nowrap valign=bottom style='width:72.1pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>user_exc<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.15pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Arial CYR";
  mso-ansi-language:EN-US'>sp_create_doc_using_fifo<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>173<o:p></o:p></span></p>
  </td>
  <td width=64 nowrap valign=bottom style='width:48.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>18:54:14<o:p></o:p></span></p>
  </td>
  <td width=65 nowrap valign=bottom style='width:48.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>19:22:04<o:p></o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Описание</b>.
Запустив эту команду, вы получите таблицу со следующими столбцами:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>FB</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>GDSCODE</span> – числовой код ошибки<span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>FB</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>MNEMONA</span> – мнемоническое имя (‘<span
lang=EN-US style='mso-ansi-language:EN-US'>user</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>exc</span>’ – для пользовательского исключения)</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>UNIT</span>
– имя «модуля», в котором происходила ошибка</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>CNT</span>
– число ошибок</p>

<p class=MsoNormal>DTS_MIN – самый ранний момент, когда случилась ошибка;</p>

<p class=MsoNormal>DTS_MAX – самый поздний момент возникновения ошибки.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Вариант</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>-2</span></b><span lang=EN-US style='mso-ansi-language:EN-US'>: </span>запустите<span
style='mso-ansi-language:EN-US'> </span><span lang=EN-US style='font-size:11.0pt;
font-family:"Courier New";background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>select * from srv_mon_business_perf_with_exc;</span><span lang=EN-US
style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Пример<span style='mso-ansi-language:EN-US'> </span>вывода<span
style='mso-ansi-language:EN-US'> </span>этой<span style='mso-ansi-language:
EN-US'> </span>ХП<span lang=EN-US style='mso-ansi-language:EN-US'>:<o:p></o:p></span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=708
 style='width:530.7pt;margin-left:4.65pt;border-collapse:collapse;mso-padding-alt:
 0cm 5.4pt 0cm 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>INFO<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>UNIT<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>CNT
  ALL<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>CNT
  OK<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>CNT
  ERR<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>ERR PRC<o:p></o:p></span></b></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>CNT
  CHK VIOL<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>CNT
  UNQ VIOL<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>CNT
  LK CNFL<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>CNT
  USR EXC<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Arial CYR";
  mso-ansi-language:EN-US'>CNT OTH EXC<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>customer
  order: creation<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_client_order<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>44685<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>44685<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>customer
  order: refuse<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_cancel_client
  order<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>5771<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>5680<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>91<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>1,57<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>91<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:3;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>order
  to supplier: creation<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_supplier_order<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>584<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>584<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:4;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>order
  to supplier: removal<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_cancel_supplier
  order<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>11<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>4<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>7<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>63,63<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>7<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:5;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>invoice
  (draft): creation<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_supplier_invoice<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>566<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>561<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>5<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0,88<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>5<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:6;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>invoice
  (draft): removal<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_cancel_supplier
  invoice<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>27<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>27<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:7;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>invoice
  accept: apply<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Arial CYR";
  mso-ansi-language:EN-US'>sp_add_invoice_to stock<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>559<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>404<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>155<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>27,72<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>151<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>4<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:8;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>invoice
  accept: cancel<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_cancel_adding
  invoice<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>154<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>109<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>45<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>29,22<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>43<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>2<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:9;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>customer
  reserve: creation<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_customer_reserve<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>50546<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>48721<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>1825<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>3,61<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>1825<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:10;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>customer
  reserve: removal<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_cancel_customer
  reserve<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>14066<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>12660<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>1406<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>9,99<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>1406<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:11;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>realization
  accept: apply<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_reserve_write
  off<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>20489<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>16315<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>4174<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>20,37<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>4173<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>1<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:12;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>realization
  accept: cancel<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_cancel_write
  off<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>3706<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>3702<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>4<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0,1<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>4<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:13;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>payment
  from customer: creation<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_pay_from
  customer<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>14564<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>14564<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:14;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>payment
  from customer: removal<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Arial CYR";
  mso-ansi-language:EN-US'>sp_cancel_pay_from customer<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>212<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>211<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>1<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0,47<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>1<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:15;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>payment
  to supplier: creation<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>sp_pay_to_supplier<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>2943<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>2942<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>1<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0,03<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>1<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:16;mso-yfti-lastrow:yes;height:12.75pt'>
  <td width=121 nowrap valign=bottom style='width:90.75pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span style='font-size:10.0pt;font-family:"Arial CYR"'>payment
  to supplier: removal<o:p></o:p></span></p>
  </td>
  <td width=176 nowrap valign=bottom style='width:132.0pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Arial CYR";
  mso-ansi-language:EN-US'>sp_cancel_pay_to_supplier<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>148<o:p></o:p></span></p>
  </td>
  <td width=52 nowrap valign=bottom style='width:38.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>148<o:p></o:p></span></p>
  </td>
  <td width=44 nowrap valign=bottom style='width:33.05pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=53 nowrap valign=bottom style='width:39.85pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=45 nowrap valign=bottom style='width:33.6pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=49 nowrap valign=bottom style='width:36.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=29 nowrap valign=bottom style='width:21.65pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
  <td width=43 nowrap valign=bottom style='width:31.95pt;padding:0cm 5.4pt 0cm 5.4pt;
  height:12.75pt'>
  <p class=MsoNormal align=right style='text-align:right'><span
  style='font-size:10.0pt;font-family:"Arial CYR"'>0<o:p></o:p></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Описание</b>.
Запустив эту команду, вы получите таблицу со следующими столбцами:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>info</span>
– мнемоническое наименование прикладного действия;</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>unit</span>
– название ХП, которая его выполняет;</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>ok</span> – число только тех вызовов,
которые завершившились успешно;</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>err</span> – число вызовов,
завершившихся с исключениями (как правило – связанными с лок-конфликтами или
невозможностью выбора случайного <span lang=EN-US style='mso-ansi-language:
EN-US'>ID</span> ввиду отсутствия записей в источнике);</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>err</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>prc</span></b> –
процент числа ошибочных вызовов относительно общего числа (<i style='mso-bidi-font-style:
normal'>важнейший показатель</i>);</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>ok</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>min</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>ms</span> – минимальное время выполнения среди
всех успешно завершившихся вызовов, <span lang=EN-US style='mso-ansi-language:
EN-US'>ms</span>;</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>ok</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>max</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>ms</span> – минимальное время выполнения среди
всех успешно завершившихся вызовов, <span lang=EN-US style='mso-ansi-language:
EN-US'>ms</span>;</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>chk</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>viol</span> – общее число исключений с <span
lang=EN-US style='mso-ansi-language:EN-US'>gdscode</span> = 335544558 ('<span
lang=EN-US style='mso-ansi-language:EN-US'>check</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>constraint</span>') и <span lang=EN-US
style='mso-ansi-language:EN-US'>gdscode</span> = 335544347 ('<span lang=EN-US
style='mso-ansi-language:EN-US'>not</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>valid</span>');</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt_unq_viol
– </span>общее<span style='mso-ansi-language:EN-US'> </span>число<span
style='mso-ansi-language:EN-US'> </span>исключений<span style='mso-ansi-language:
EN-US'> </span>с<span style='mso-ansi-language:EN-US'> <span lang=EN-US>gdscode
= 335544665 ('unique_key_violation') </span></span>и<span lang=EN-US
style='mso-ansi-language:EN-US'> 335544349 no_dup;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>lk</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>confl</span> – общее число исключений,
связанных с конфликтами блокировок: <span lang=EN-US style='mso-ansi-language:
EN-US'>lock</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>conflict</span>,
<span lang=EN-US style='mso-ansi-language:EN-US'>concurrent</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>transaction</span>, <span
lang=EN-US style='mso-ansi-language:EN-US'>deadlock</span> и <span lang=EN-US
style='mso-ansi-language:EN-US'>update</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>conflict</span> (соответствующие коды <span
lang=EN-US style='mso-ansi-language:EN-US'>gds</span>: 335544345, 335544878,
335544336 и 335544451);</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>user</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>exc</span> - число исключений, определенных в
прикладном коде, т.е. «пользовательских», <span lang=EN-US style='mso-ansi-language:
EN-US'>gdscode</span> = 335544517, '<span lang=EN-US style='mso-ansi-language:
EN-US'>user</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>exc</span>'
(<span lang=EN-US style='mso-ansi-language:EN-US'>aka</span> ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>exception</span> @1’);</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>cnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>other</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>exc</span> – число всех остальных исключений</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>Вызов этой ХП без параметров приведёт к сбору статистики за
последние три часа работы теста (если она длилась меньше – за всё доступное для
анализа время). Для получения информации за б<i style='mso-bidi-font-style:
normal'>о</i>льшее количество часов и минут запустите ХП так: <span lang=EN-US
style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>select * from
srv_mon_business_perf_with_exc(<b style='mso-bidi-font-weight:normal'> :H [, :M
]</b>);</span><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>(в этом случае будет собрана информация за последние <span
lang=EN-US style='mso-ansi-language:EN-US'>H</span>*60 + <span lang=EN-US
style='mso-ansi-language:EN-US'>M</span> минут до момента последней
запротоколированной операции).</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:14.0pt;mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>Общая</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt;mso-ansi-language:EN-US'> </span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:14.0pt'>информация</span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:14.0pt;
mso-ansi-language:EN-US'><o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Тест создан с целью имитации <span lang=EN-US
style='mso-ansi-language:EN-US'>OLTP</span>-активности пользователей и
предназначен для исследования поведения СУБД <span lang=EN-US style='mso-ansi-language:
EN-US'>Firebird</span><span lang=EN-US> </span>при средней и высокой нагрузке.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Рассматривается деятельность, затрагивающая работу с
клиентскими заказами<span style='mso-spacerun:yes'>  </span>на поставку
запасных частей, заказ поставщику на основе потребностей клиентов, поступление,
резервирование и реализацию товаров, а также их оплат.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Реализованы следующие операции:</p>

<p class=MsoNormal>* прием заказа от клиента и его отмена;</p>

<p class=MsoNormal>* составление заказа поставщику («складского заказа») на
основе имеющихся клиентских заказов, а также его отмена;</p>

<p class=MsoNormal>* ввод инвойса от поставщика на основе складских заказов, а
также его отмена;</p>

<p class=MsoNormal>* «проведение инвойса» - добавление его содержимого к
балансу склада, и его отмена (при условии допустимости этого);</p>

<p class=MsoNormal>* резервирование поступивших изделий, если они относятся к
клиентским заказам;</p>

<p class=MsoNormal>* резервирование изделий из доступного остатка (без связи с
клиентскими заказами);</p>

<p class=MsoNormal>* отмена резервов;</p>

<p class=MsoNormal>* «проведение списания», оно же: «проведение резерва» -<span
style='mso-spacerun:yes'>  </span>списание изделий с баланса склада;</p>

<p class=MsoNormal>* ввод оплаты клиента, относящейся к одному или нескольким
документам-резервам, а также ввод аванса, не связанного с резервами;</p>

<p class=MsoNormal>* ввод оплаты поставщику за полученные изделия (по
инвойсам), а также ввод аванса, не связанного с инвойсами;</p>

<p class=MsoNormal>* отмены всех видов оплат;</p>

<p class=MsoNormal>* сборка <i style='mso-bidi-font-style:normal'>стоимостных</i>
оборотов по операциям контрагентов и формирование сводной таблицы их остатков
(сальдо);</p>

<p class=MsoNormal>* сборка <i style='mso-bidi-font-style:normal'>количественных</i>
оборотов по изделиям и формирование сводной таблицы их остатков;</p>

<p class=MsoNormal>* пересчет статистики индексов (служебная процедура для
поддержания актуальности значений селективности <span
style='mso-spacerun:yes'> </span>индексов).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Кроме того, создание каждого складского документа
сопровождается вызовом специальной процедуры, SRV_FIND_QD_QS_MISM, проверяющей
соответствие данных по трём таблицам: <span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>data</span>,
<span lang=EN-US style='mso-ansi-language:EN-US'>qdistr</span><span lang=EN-US>
</span>и <span lang=EN-US style='mso-ansi-language:EN-US'>qstorned</span> (этого
нельзя сделать декларативными ограничениями). Если данная процедура возбудит
исключение, тест автоматически будет остановлен, т.к. это означает наличие
ошибки в алгоритмах.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Предполагается наличие следующих бизнес-процессов,
выполняемых обычно отдельными должностными лицами:</p>

<p class=MsoNormal>1) менеджер по продажам: создает клиентский заказ; отменяет
ранее созданный клиентский заказ; создает резерв изделий по доступному остатку
или же под заранее выбранный клиентский заказ; отменяет ранее созданный резерв;</p>

<p class=MsoNormal>2) менеджер отдела логистики: выполняет процедуру «сборки»
изделий из клиентских заказов и формирование заказа поставщику; создает
документ – инвойс от поставщика с изделиями, относящимися к ранее созданным
заказам поставщику; вызывает процедуру «проведения инвойса» (добавление к
свободному остатку склада) с немедленным резервированием изделий по клиентским
заказам; отменяет ранее созданный инвойс;</p>

<p class=MsoNormal>3) кассир-операционист: вводит оплаты от клиентов с
«привязкой» их к документам-резервам; выполняет «проведение резервов» (списание
с баланса склада проданных изделий); выполняет отмену проведения резервов;</p>

<p class=MsoNormal>4) бухгалтер: ввод оплат от клиентов (так же, как и у
кассира); ввод оплат поставщикам; отмена оплат; отмена проведения резервов и
проведения инвойсов.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Выполнение
бизнес-операций, регистрация ошибок (исключений)<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Каждый нагрузочный коннект может вызвать любое из
вышеперечисленных действий, но частота вызовов у них не одинаковая и зависит от
вида этой операции.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Помимо этого, каждый коннект периодически вызывает следующие
служебные процедуры:</p>

<p class=MsoNormal>1) пересчет статистики индексов;</p>

<p class=MsoNormal>2) сборка денежных оборотов и формирование сводного регистра
остатков на балансах контрагентов;</p>

<p class=MsoNormal>3) сборка количественных оборотов и формирование регистра
остатков изделий.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Вызовы этих (служебных) процедур выполняются со следующей
логикой: </p>

<p class=MsoNormal>попытаться заблокировать «семафор»; </p>

<p class=MsoNormal>если получилось – начать выполнение и зарегистрировать это; </p>

<p class=MsoNormal>если не получилось – выйти для продолжения другого вида
работ, НЕ регистрируя ошибку (т.к. для этого режима в этом нет необходимости).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='background:silver;mso-highlight:silver'>Основной
целью теста было обеспечение такой работы коннектов, при которой количество исключений
из семейства ‘</span><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>update</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>conflict</span><span
style='background:silver;mso-highlight:silver'>’ было бы минимальным.</span>
При большом проценте конфликтов обновления трудно судить о «пропускной
способности» приложения, т.е. сколько информации могло бы быть в ней записано,
если бы коннекты вообще не имели конфликтов. На откат изменений, которые прошли
в базе до возникновения исключения, требуются существенные затраты. </p>

<p class=MsoNormal>Меры, предпринятые для этого, описаны в разделе «Уменьшение
числа конфликтов блокировок».</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Из сценария, который выполняется утилитой <span lang=EN-US
style='mso-ansi-language:EN-US'>isql</span>, намеренно удалена команда паузы
между транзакциями, что при достаточном числе окон позволяет выполнять
стресс-тестирование СУБД.</p>

<p class=MsoNormal>Минимальной «единицей» работы каждой прикладной операции
является сам документ, т.е. в тесте нет операций с <i style='mso-bidi-font-style:
normal'>отдельными строками</i> документов.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Определения (<span lang=EN-US style='mso-ansi-language:EN-US'>DDL</span>)
основных таблиц содержит ряд декларативных ограничений для исключения<span
style='mso-spacerun:yes'>  </span>записи данных, нарушающих бизнес-логику.
Алгоритмы реализованы так, что исключения вида ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>validation</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>error</span>’,
‘unique_key_violation’ или ‘foreign_key’ при работе теста происходить <i
style='mso-bidi-font-style:normal'>не должны</i>. Если же такие ошибки
случаются, то реакция на них - либо «игнорирование» либо «остановка теста», и
это зависит от настройки ‘<span lang=EN-US style='mso-ansi-language:EN-US'>HALT</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>TEST</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>ON</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>ERROR</span>’ определенной в скрипте <span lang=EN-US style='mso-ansi-language:
EN-US'>oltp</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>main</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>filling</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>sql</span><span lang=EN-US> </span>и хранящейся
в таблице ‘<span lang=EN-US style='mso-ansi-language:EN-US'>settings</span>’ (см
следующий раздел).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Вход и выход из каждого модуля (нормальный или аварийный)
регистрируется в специальной таблице (‘<span lang=EN-US style='mso-ansi-language:
EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>log</span>’)
с записью длительности работы, а также с записью <span lang=EN-US
style='mso-ansi-language:EN-US'>gds</span>-кода исключения, если оно произошло.
</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Таблицы настроек
теста и выполняемых бизнес-операций<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Специальная таблица настроек (‘<b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>settings</span>’</b>)
позволяет задавать стартовые параметры теста, оказывающие влияние на
производительность: лимиты на число строк в документе клиента и заказе
поставщику, на количество<span style='mso-spacerun:yes'>  </span>в отдельной
строке, а также на общее число разных <span lang=EN-US style='mso-ansi-language:
EN-US'>ID</span> изделий в прайс-листе.</p>

<p class=MsoNormal>Все настройки считываются коннектами при старте (триггером
на событие <span lang=EN-US style='mso-ansi-language:EN-US'>CONNECT</span>) и
хранятся в виде контекстных переменных. Запросы к некоторым из этих переменных
оформлены (для <span lang=EN-US style='mso-ansi-language:EN-US'>FB</span><span
lang=EN-US> </span>версии 3.0) в виде <span lang=EN-US style='mso-ansi-language:
EN-US'>deterministic</span>-функций: эмпирически установлено, что это
значительно быстрее, чем каждый раз вызывать <span lang=EN-US style='mso-ansi-language:
EN-US'>rdb</span>$<span lang=EN-US style='mso-ansi-language:EN-US'>get</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>context</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Таблица ‘<b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>business</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>ops</span></b>’, о которой говорилось выше, также служит для настройки
работы теста: в ней записаны частоты вызовов бизнес-операций друг относительно
друга.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Специальная настройка (‘<span lang=EN-US style='mso-ansi-language:
EN-US'>ENABLE</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>MON</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>QUERY</span>’) позволяет включить
запись стека вызовов в случае возникновения ошибок. Однако, при использовании
старых сборок <span lang=EN-US style='mso-ansi-language:EN-US'>FB</span> 3.0, а
также сборок <span lang=EN-US style='mso-ansi-language:EN-US'>FB</span><span
lang=EN-US> </span>2.5, эта возможность сильно ухудшает общую
производительность ввиду обращения к <span lang=EN-US style='mso-ansi-language:
EN-US'>mon</span>$-таблицам. При одновременном обращении к <span lang=EN-US
style='mso-ansi-language:EN-US'>mon</span>$-таблицам из нескольких коннектов
часто фиксировались падения ФБ либо полное <span
style='mso-spacerun:yes'> </span>угасание его активности в виду внутренних дедлоков.
<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Эта проблема была решена только в сборке 6.3.0.31285 от
10-авг-<st1:metricconverter ProductID="2014, см" w:st="on">2014, см</st1:metricconverter>.
замечание в <span lang=EN-US style='mso-ansi-language:EN-US'>ChangeLog</span>:</p>

<pre><span lang=EN-US style='mso-ansi-language:EN-US'>2014-08-10 20:11<span style='mso-spacerun:yes'>  </span>dimitr <o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>   </span>M src/jrd/Attachment.cpp<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>   </span>M src/jrd/Attachment.h<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>   </span>M src/jrd/Monitoring.cpp<o:p></o:p></span></pre>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>В поставляемом скрипте эта настройка выключена, см. скрипт <span
lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>main</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>filling</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>sql</span>:</p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- do we ALLOW to query mon$-tables in ALL cases <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- (not only when some blocking bug encountered) ?<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>insert into settings(working_mode, mcode, svalue)<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>values('COMMON', 'ENABLE_MON_QUERY', '0');</span><span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<pre><span style='font-size:12.0pt;font-family:"Times New Roman"'>Кроме того, для сборок ниже 3.0.31285 Firebird 3.0 и 3.3.26790 Firebird 2.5 включение этой настройки будет приводить к неверному отображению стека вызовов – см. замечание в </span><span
lang=EN-US style='font-size:12.0pt;font-family:"Times New Roman";mso-ansi-language:
EN-US'>ChangeLog</span><span style='font-size:12.0pt;font-family:"Times New Roman"'>:<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>2014-08-12 10:21<span style='mso-spacerun:yes'>  </span>hvlad <o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>   </span>M src/jrd/Monitoring.cpp<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>Avoid info duplication when statements in call stack attached to different transactions (for example: monitoring snapshot is created in autonomous transaction)<o:p></o:p></span></pre>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Из этого следует, что включение настройки регистрации стека
вызовов при ошибках следует делать только на сборках, более поздних, чем указанные.<span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Еще одна важная настройка имеет имя ‘HALT_TEST_ON_ERRORS’ и
определяет реакцию теста на появление исключений, которые не должны происходить
вообще, но <i style='mso-bidi-font-style:normal'>могут</i> случаться при
интенсивной нагрузке на <span lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span>
от десятков коннектов в течение нескольких часов.</p>

<p class=MsoNormal>Речь идёт о следующих видах исключений:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>1) check_constraint
</span>или<span style='mso-ansi-language:EN-US'> <span lang=EN-US>not_valid. </span></span>Возникает
при попытке записи отрицательного остатка по какому-либо изделию в таблицу <span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span>,<span style='mso-spacerun:yes'> 
</span>в процедуре <span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span>.<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>2) <span lang=EN-US style='mso-ansi-language:EN-US'>unique</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>key</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>violation</span>. Возникает при попытке двух
коннектов перенести одну и ту же запись из таблицы <span lang=EN-US
style='mso-ansi-language:EN-US'>QStorned</span><span lang=EN-US> </span>в
таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>QDistr</span> (или
наоборот), причём один из коннектов каким-то образом «игнорирует» исключение
при попытке заблокировать строку в таблице-источнике. Причина проблемы пока не
выяснена, описание и тест см. тут: sql.ru/forum/actualutils.aspx?action=gotomsg&amp;tid=1110158&amp;msg=16433400</p>

<p class=MsoNormal>3) <span lang=EN-US style='mso-ansi-language:EN-US'>foreign</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>key</span>. Возникает при попытке
одного из коннектов добавить запись в таблицу <span lang=EN-US
style='mso-ansi-language:EN-US'>QStorned</span><span lang=EN-US> </span>или
в<span style='mso-spacerun:yes'>  </span><span lang=EN-US style='mso-ansi-language:
EN-US'>QDistr</span> при том, что родительская для неё запись в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>data</span> была удалена другим коннектом. При
этом, «проблемный» коннект каким-то образом игнорирует исключение <span
lang=EN-US style='mso-ansi-language:EN-US'>lock</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>conflict</span>, возникающее в каскадном
триггере при попытке заблокировать строку в родительской таблице. Причина не
выяснена, описание см там же, что и для пункта «2)».<span lang=EN-US
style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Замечание</b>. С
целью увеличения производительности внешние ключи таблиц <span lang=EN-US
style='mso-ansi-language:EN-US'>QDistr</span> и<span lang=EN-US
style='mso-ansi-language:EN-US'>QStorned</span>, ссылавшиеся на <span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>data</span>, были заменены на «простые» индексы
по соответствующим полям. В код теста добавлена проверка наличия «висячих
строк» в этих таблицах, выполняемая в процедуре <span lang=EN-US
style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>find</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>qd</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>qs</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>mism</span>. Если дальнейшее тестирование <span
lang=EN-US style='mso-ansi-language:EN-US'>FB</span> (всех версий и архитектур)
покажет, что «висячие строки» не появляются, то данная проверка будет
отключена.</p>

<p class=MsoNormal>4) <span lang=EN-US style='mso-ansi-language:EN-US'>stack</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>trace</span>. Это исключение при
нормальной работе никогда не должно быть на вершине стека и поэтому клиент его
никогда не должен получать. Однако, на момент написания данного текста, оно
очень часто происходит в <span lang=EN-US style='mso-ansi-language:EN-US'>FB</span>
3.0 <span lang=EN-US style='mso-ansi-language:EN-US'>SuperClassic</span>.
Причина не выяснена, описание см тут: sql.ru/forum/actualutils.aspx?action=gotomsg&amp;tid=1112014&amp;msg=16477457</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Если настройка ‘<span lang=EN-US style='mso-ansi-language:
EN-US'>HALT</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>TEST</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>ON</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>ERRORS</span>’ включает в себя строку ‘<span
lang=EN-US style='mso-ansi-language:EN-US'>CK</span>’, то тест будет
автоматически остановлен при возникновении первого исключения вида <span
lang=EN-US style='mso-ansi-language:EN-US'>check</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>constraint</span>. Если эта же настройка
включает в себя строку '<span lang=EN-US style='mso-ansi-language:EN-US'>PK</span>',
то тест остановится при получении исключения <span lang=EN-US style='mso-ansi-language:
EN-US'>unique</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>key</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>violation</span>. Если настройка
включает в себя строку ‘<span lang=EN-US style='mso-ansi-language:EN-US'>FK</span>’,
то тест остановится при получении исключения <span lang=EN-US style='mso-ansi-language:
EN-US'>foreign</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>key</span>.
И наконец, если тест будет остановлен при получении исключения <span
lang=EN-US style='mso-ansi-language:EN-US'>stack</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>trace</span>, когда настройка включает в себя
строку ‘<span lang=EN-US style='mso-ansi-language:EN-US'>ST</span>’.</p>

<p class=MsoNormal>Подробнее о проблеме попыток нарушения <span lang=EN-US
style='mso-ansi-language:EN-US'>PK</span>/<span lang=EN-US style='mso-ansi-language:
EN-US'>FK</span><span lang=EN-US> </span>в таблицах <span lang=EN-US
style='mso-ansi-language:EN-US'>QDistr</span> &amp; <span lang=EN-US
style='mso-ansi-language:EN-US'>Qstorned</span><span lang=EN-US> </span>см
ниже, раздел «Замечание о попытках нарушений первичного и внешнего ключа»</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>Особенности работы </span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:14.0pt;mso-ansi-language:EN-US'>isql</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:14.0pt'>-коннектов<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal>Процедуры, реализующие бизнес-логику, помимо изменений в
базе также возвращают наборы строк (обычно – новое содержимое документа).
Однако, утилита <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>
имеет неприятную особенность: при выводе данных («фетчах») она сильно тормозит,
причём перенаправление вывода в <span lang=EN-US style='mso-ansi-language:EN-US'>nul</span>
проблему не решает: вместо <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>
процессор начинает загружаться программой <span lang=EN-US style='mso-ansi-language:
EN-US'>csrss</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>exe</span>.
<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Если запустить <span lang=EN-US style='mso-ansi-language:
EN-US'>isql</span><span lang=EN-US> </span>в нескольких десятках окон на одной
машине, это приведёт к ступору данного компьютера. Поэтому было принято решение
вместо показа содержимого документа отображать только результат <span
lang=EN-US style='mso-ansi-language:EN-US'>select</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>count</span>(*) <span lang=EN-US
style='mso-ansi-language:EN-US'>from</span> &lt;прикладная_ХП&gt;.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В процессе разработки теста стало ясным, что все ХП должны
выполняться в режиме изоляции<span style='mso-spacerun:yes'>  </span><span
lang=EN-US style='mso-ansi-language:EN-US'>SNAPSHOT</span>. При работе с <span
lang=EN-US style='mso-ansi-language:EN-US'>TIL</span> = <span lang=EN-US
style='mso-ansi-language:EN-US'>ReadCommitted</span><span lang=EN-US> </span>невозможно
обеспечить согласованность данных на момент старта транзакции, если работа идёт
в режиме сильной конкуренции за одни и те же строки таблиц.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Все коннекты должны стартовать транзакции только с <span
lang=EN-US style='mso-ansi-language:EN-US'>NO</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>WAIT</span>. Старт с <span
lang=EN-US style='mso-ansi-language:EN-US'>LOCK</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>TIMEOUT</span> &gt; 0 не имеет
практического смысла в <span lang=EN-US style='mso-ansi-language:EN-US'>SNAPSHOT</span>,
т.к. команда <span lang=EN-US style='mso-ansi-language:EN-US'>select</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>for</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>update</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>with</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>lock</span><span
lang=EN-US> </span>*выдаст* в этом <span lang=EN-US style='mso-ansi-language:
EN-US'>TIL</span><span lang=EN-US> </span>исключение, в отличие от <span
lang=EN-US style='mso-ansi-language:EN-US'>READ</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>COMMITTED</span>. В результате,
коннект будет ждать несколько секунд только для того, чтобы получить ошибку и
завершить задание.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Каждая транзакция, запускающая «прикладную» ХП, выполняет
большое количество изменений в базе. Поскольку большинство транзакций
завершается успешно, имеет смысл запускать их с опцией NO AUTO UNDO. Это
позволяет не выполнять «слияние» <span lang=EN-US style='mso-ansi-language:
EN-US'>undo</span>-логов после каждого отдельного <span lang=EN-US
style='mso-ansi-language:EN-US'>DML</span>-стейтмента с <span lang=EN-US
style='mso-ansi-language:EN-US'>undo</span>-логом всей транзакции (добавлено 05.06.2014;
анализ результатов показал улучшение производительности примерно на 12-15%).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Запуск <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>-окон
выполняется в сценарии <b style='mso-bidi-font-weight:normal'><span
style='background:silver;mso-highlight:silver'>1</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='background:silver;mso-highlight:silver;
mso-ansi-language:EN-US'>run</span><span style='background:silver;mso-highlight:
silver'>-</span></b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>oltp</span><span
style='background:silver;mso-highlight:silver'>-</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='background:silver;mso-highlight:silver;
mso-ansi-language:EN-US'>emul</span><span style='background:silver;mso-highlight:
silver'>.</span></b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>bat</span></b>:<span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>for /l %%i in
(1, 1, %winq%) do (<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>  </span>. . .<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>  </span>start /min oltp_isql_run_worker.bat %fb%
%sql% %tmpdir%\%logbase%_!k:~1,3!<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>)</span><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>В свою очередь, в файле <b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>oltp</span><span style='background:silver;mso-highlight:silver'>_</span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>isql</span><span
style='background:silver;mso-highlight:silver'>_</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='background:silver;mso-highlight:silver;
mso-ansi-language:EN-US'>run</span><span style='background:silver;mso-highlight:
silver'>_</span></b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>worker</span><span
style='background:silver;mso-highlight:silver'>.</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='background:silver;mso-highlight:silver;
mso-ansi-language:EN-US'>bat</span></b> запуск утилиты <span lang=EN-US
style='mso-ansi-language:EN-US'>isql</span> производится так<span
style='font-size:10.0pt;font-family:"Courier New"'>:</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver'>setlocal <b style='mso-bidi-font-weight:
normal'>enabledelayedexpansion</b> <b style='mso-bidi-font-weight:normal'>enableextensions</b><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>...<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>if
.%use_mtee%.==.1. (<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>  </span>set <b style='mso-bidi-font-weight:normal'>run_isql</b>=%fbc%\isql
%dbconn% -now -q -n -pag 9999 -i %sql% </span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"Courier New";color:aqua;
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>\</span></b><span
lang=EN-US style='font-size:9.0pt;font-family:"Courier New";background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'> <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>               </span>%dbauth% 2^&gt;^&amp;1
1^&gt;^&gt;%log% ^| mtee /t/</span><span lang=DE style='font-size:9.0pt;
font-family:"Courier New";background:silver;mso-highlight:silver;mso-ansi-language:
DE'>+ %err% ^&gt;nul<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>) else (<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>  </span>set <b style='mso-bidi-font-weight:normal'>run_isql</b>=%fbc%\isql
%dbconn% -now -q -n -pag 9999 -i %sql% </span><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-family:"Courier New";color:aqua;
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>\</span></b><span
lang=EN-US style='font-size:9.0pt;font-family:"Courier New";background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver'><span
style='mso-spacerun:yes'>               </span></span><span lang=EN-US
style='font-size:9.0pt;font-family:"Courier New";background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>%dbauth% 1^&gt;^&gt;%log% 2^&gt;^&gt;%err%<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:9.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver'>)<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>...<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>@echo
------------------------------------------<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>@echo Start
isql, packet # %k% at %date% %time%<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>@echo
------------------------------------------<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>@echo on<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:9.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>cmd /c <b
style='mso-bidi-font-weight:normal'>!run_isql!</b></span><span lang=EN-US
style='font-size:9.0pt;font-family:"Courier New";mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>C</span>имвол
‘<span style='background:aqua;mso-highlight:aqua'>\</span>‘ обозначает перенос
команды на следующую строку, в сценарии всё записано в виде одной «длинной»
команды.</p>

<p class=MsoNormal>Обратите внимание, что запуск <span lang=EN-US
style='mso-ansi-language:EN-US'>isql</span><span lang=EN-US> </span><b
style='mso-bidi-font-weight:normal'>не</b> должен содержать ключ ‘-<span
lang=EN-US style='mso-ansi-language:EN-US'>nod</span>’: каждый коннект при
подключении считывает таблицу настроек и сохраняет её в контекстных переменных
до конца сеанса. Это чтение выполняется триггером на событие <span lang=EN-US
style='mso-ansi-language:EN-US'>CONNECT</span> и отключать его действие нельзя.</p>

<p class=MsoNormal><span style='mso-spacerun:yes'> </span></p>

<p class=MsoNormal>Скрипт, выполняемый <span lang=EN-US style='mso-ansi-language:
EN-US'>isql</span>, создаётся файлом 1<span lang=EN-US style='mso-ansi-language:
EN-US'>run</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>emul</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>bat</span>. Этот скрипт сохраняется в
подкаталоге ‘<span lang=EN-US style='mso-ansi-language:EN-US'>sql</span>’ папки
%<span lang=EN-US style='mso-ansi-language:EN-US'>tmpdir</span>% с именем <span
style='background:silver;mso-highlight:silver'>tmp_random_run.sql</span>.</p>

<p class=MsoNormal>Таким обр., если в файле конфигурации теста (<span
lang=EN-US style='mso-ansi-language:EN-US'>oltpNN</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>config</span>) указано:</p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>tmpdir</span><span style='font-size:11.0pt;font-family:
"Courier New"'>=!</span><span lang=EN-US style='font-size:11.0pt;font-family:
"Courier New";mso-ansi-language:EN-US'>temp</span><span style='font-size:11.0pt;
font-family:"Courier New"'>!\</span><span lang=EN-US style='font-size:11.0pt;
font-family:"Courier New";mso-ansi-language:EN-US'>logs</span><span
style='font-size:11.0pt;font-family:"Courier New"'>.</span><span lang=EN-US
style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>oltp</span><span
style='font-size:11.0pt;font-family:"Courier New"'>30</span>, где !<span
lang=EN-US style='mso-ansi-language:EN-US'>temp</span>! соответствует папке ‘<span
lang=EN-US style='mso-ansi-language:EN-US'>C</span>:\<span lang=EN-US
style='mso-ansi-language:EN-US'>TEMP</span>’,</p>

<p class=MsoNormal>- то скрипт, который выполняют все нагрузочные окна, будет
сохранён тут:<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>C:\TEMP\logs.oltp30\sql\tmp_random_run.sql</span><span
lang=EN-US style='font-size:11.0pt;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Этот скрипт имеет достаточно большой размер (около 3 Мб) и
состоит из повторяющихся блоков («итераций»), каждый из которых делает
следующее:<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>1) commit +
</span>старт<span style='mso-ansi-language:EN-US'> <span lang=EN-US>snapshot-</span></span>транзакции<span
style='mso-ansi-language:EN-US'> </span>в<span style='mso-ansi-language:EN-US'>
</span>режиме<span style='mso-ansi-language:EN-US'> <span lang=EN-US>NO wait.<br>
</span></span>2) Вызов вспомогательной процедуры <span lang=EN-US
style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>random</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>unit</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>choice</span><span lang=EN-US> </span>для
определения <i style='mso-bidi-font-style:normal'>в случайном порядке</i> имени
выполняемой далее бизнес-операции. <br>
3) Формирование стейтмента (для передачи механизму <span lang=EN-US
style='mso-ansi-language:EN-US'>execute</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>statement</span>), в котором будет
присутствовать имя модуля, полученное на предыдущем шаге. Стейтмент всегда
имеет только один вид: <span style='background:silver;mso-highlight:silver'>‘</span><span
lang=EN-US style='font-size:11.0pt;font-family:"Courier New";background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>select</span><span lang=EN-US
style='font-size:11.0pt;font-family:"Courier New";background:silver;mso-highlight:
silver'> </span><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>count</span><span
style='font-size:11.0pt;font-family:"Courier New";background:silver;mso-highlight:
silver'>(*) </span><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>from</span><span
lang=EN-US style='font-size:11.0pt;font-family:"Courier New";background:silver;
mso-highlight:silver'> </span><span style='background:silver;mso-highlight:
silver'>‘</span><span style='font-size:11.0pt;font-family:"Courier New";
background:silver;mso-highlight:silver'>||&lt;имя_модуля&gt;</span><span
style='font-size:11.0pt;font-family:"Courier New"'> </span></p>

<p class=MsoNormal>4) Вызов <span lang=EN-US style='mso-ansi-language:EN-US'>execute</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>statement</span>
с передачей ему полученного на предыдущем шаге выражения.</p>

<p class=MsoNormal>5) Если вызов закончился успешно (без выброса исключения),
то формирование контекстной переменной с именем RUN_RESULT, значение которой
будет примерно таким: ‘<span lang=EN-US style='mso-ansi-language:EN-US'>OK</span>,
15 <span lang=EN-US style='mso-ansi-language:EN-US'>rows</span>’. Если же вызов
завершился неудачей (например, ввиду <span lang=EN-US style='mso-ansi-language:
EN-US'>update</span>-конфликта), то перехват исключения в <span lang=EN-US
style='mso-ansi-language:EN-US'>when</span>-блоке и формирование этой же
контекстной переменной (RUN_RESULT) с присваиванием ей значения вида: 'error,
gds='||gdscode.<br>
6) Накопительная выдача в лог итога выполнения: имени модуля и результата его
вызова.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Некоторые дополнительные действия, выполняемые на каждой
итерации этого скрипта, здесь не описаны – они были введены только для отладки.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Когда <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>
завершит выполнение скрипта<span style='mso-spacerun:yes'>  </span><span
lang=EN-US style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>tmp</span><span style='font-size:11.0pt;font-family:"Courier New"'>_</span><span
lang=EN-US style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>random</span><span style='font-size:11.0pt;font-family:"Courier New"'>_</span><span
lang=EN-US style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>run</span><span style='font-size:11.0pt;font-family:"Courier New"'>.</span><span
lang=EN-US style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>sql</span>, произойдёт возврат управления в командный сценарий <b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>oltp</span><span
style='background:silver;mso-highlight:silver'>_</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='background:silver;mso-highlight:silver;
mso-ansi-language:EN-US'>isql</span><span style='background:silver;mso-highlight:
silver'>_</span></b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>run</span><span
style='background:silver;mso-highlight:silver'>_</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='background:silver;mso-highlight:silver;
mso-ansi-language:EN-US'>worker</span><span style='background:silver;
mso-highlight:silver'>.</span></b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>bat</span></b>, в котором будет выполнено несколько проверок содержимого
файла <span lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>XX</span>_%<span lang=EN-US
style='mso-ansi-language:EN-US'>computername</span>%_<span lang=EN-US
style='mso-ansi-language:EN-US'>tmp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>NNN</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>err</span><span
lang=EN-US> </span>– лога ошибок времени выполнения <span lang=EN-US
style='mso-ansi-language:EN-US'>isql</span>.</p>

<p class=MsoNormal>Если этот файл содержит любую из следующих строк: {‘EX_TEST_CANCEL’,
‘<span lang=EN-US style='mso-ansi-language:EN-US'>shutdown</span>’} – то
сценарий прекращает свою работу. В противном случае он переходит к метке “:<span
lang=EN-US style='mso-ansi-language:EN-US'>start</span>”, где производится:</p>

<p class=MsoNormal>1) проверка размера каждого из файлов: <span lang=EN-US
style='mso-ansi-language:EN-US'>oltp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>XX</span>_%<span lang=EN-US style='mso-ansi-language:EN-US'>computername</span>%_<span
lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>NNN</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>log</span> и <span lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>XX</span>_%<span lang=EN-US
style='mso-ansi-language:EN-US'>computername</span>%_<span lang=EN-US
style='mso-ansi-language:EN-US'>tmp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>NNN</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>err</span> –
и «обнуление» их при превышении порога, задаваемого в начале этого сценария (15
<span lang=EN-US style='mso-ansi-language:EN-US'>Mb);</span><br>
2) повторный запуск <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>
(т.е. новый коннект к базе).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Замечание. </b>Причина,
по которой скрипт <span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>tmp</span><span style='font-size:11.0pt;font-family:
"Courier New"'>_</span><span lang=EN-US style='font-size:11.0pt;font-family:
"Courier New";mso-ansi-language:EN-US'>random</span><span style='font-size:
11.0pt;font-family:"Courier New"'>_</span><span lang=EN-US style='font-size:
11.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>run</span><span
style='font-size:11.0pt;font-family:"Courier New"'>.</span><span lang=EN-US
style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>sql</span>
создан из большого числа повторяющихся блоков, заключается в необходимости
уменьшить количество переконнектов, т.к. эти операции в реальных приложениях
вызываются редко. К сожалению, в нынешнем наборе возможностей утилиты <span
lang=EN-US style='mso-ansi-language:EN-US'>isql</span> отсутствует аналог цикла
или оператора перехода на метку (<span lang=EN-US style='mso-ansi-language:
EN-US'>goro</span> :<span lang=EN-US style='mso-ansi-language:EN-US'>m</span>1).
Поэому повторно вызовать один и тот же фрагмент (<span lang=EN-US
style='mso-ansi-language:EN-US'>execute</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>block</span> + <span lang=EN-US
style='mso-ansi-language:EN-US'>commit</span>) без переконнекта возможно только
методом его копирования.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>Особенности реализации<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Меры, предпринятые
для увеличения производительности<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>1. </b>Все прикладные
модули (процедуры, запускаемые непосредственно из <span lang=EN-US
style='mso-ansi-language:EN-US'>isql</span>) реализованы так, чтобы количество
ошибок, вызванных конфликтами блокировок, было минимальным. Алгоритмы теста
реализуют бесконфликтное обновление <i style='mso-bidi-font-style:normal'>остатков</i>
по контрагентам и по изделиям. <i style='mso-bidi-font-style:normal'>Сторнирование</i>
количеств и стоимостей происходит также с минимальным (но не <span lang=EN-US
style='mso-ansi-language:EN-US'>c</span> нулевым) числом лок-конфликтов.<span
style='mso-spacerun:yes'>  </span></p>

<p class=MsoNormal>Возможность выборки записей с пропуском заблокированных (‘<span
lang=EN-US style='mso-ansi-language:EN-US'>skip</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>locked</span>’ в терминологии <span
lang=EN-US style='mso-ansi-language:EN-US'>Oracle</span>) в СУБД <span
lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span> на сегодня
отсутствует. Именно это привело к замене в нескольких местах <span lang=EN-US
style='mso-ansi-language:EN-US'>SQL</span>-кода на <b style='mso-bidi-font-weight:
normal'>курсоры</b>: существуют случаи, когда неудача при попытке установить
блокировку может быть проигнорирована и алгоритм может перейти к «следующей»
строке того же типа. В этом случае исключение лок-конфликта подавляется (но
может быть запротоколировано настройками теста). <span
style='mso-spacerun:yes'> </span></p>

<p class=MsoNormal>К счастью, курсоры в <span lang=EN-US style='mso-ansi-language:
EN-US'>Firebird</span> выполняются примерно с той же скоростью, что и «чистый» <span
lang=EN-US style='mso-ansi-language:EN-US'>SQL.</span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>2. </b>Ситуации, в
которых обработка группы записей должна начинаться только после успешной
блокировки некоторой «родительской» строки, обрабатываются так: <span
lang=EN-US style='mso-ansi-language:EN-US'>select</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>rdb</span>$<span lang=EN-US
style='mso-ansi-language:EN-US'>db</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>key</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>from</span> &lt;<span lang=EN-US style='mso-ansi-language:EN-US'>parent</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>table</span>&gt; <span lang=EN-US
style='mso-ansi-language:EN-US'>where</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>id</span> = :<span lang=EN-US
style='mso-ansi-language:EN-US'>selected</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span><span lang=EN-US> <span
style='mso-spacerun:yes'> </span></span><i style='mso-bidi-font-style:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>for</span><span lang=EN-US> </span></i><i
style='mso-bidi-font-style:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>update</span><span lang=EN-US> </span></i><i style='mso-bidi-font-style:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>with</span><span
lang=EN-US> </span></i><i style='mso-bidi-font-style:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>lock</span></i>. Это позволяет запросить
блокировку записи без вызова <span lang=EN-US style='mso-ansi-language:EN-US'>before</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>update</span>-триггера, который
может пристутствовать на этой таблице.<span lang=EN-US style='mso-ansi-language:
EN-US'><br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>3. </b>В большинстве <span
lang=EN-US style='mso-ansi-language:EN-US'>DML</span>-операторов для
прочитанных записей (в случае необходимости возврата к ним позже и вне текущего
курсора) запоминаются не значения полей <span lang=EN-US style='mso-ansi-language:
EN-US'>ID</span>, а идентификаторы <span lang=EN-US style='mso-ansi-language:
EN-US'>RDB</span>$<span lang=EN-US style='mso-ansi-language:EN-US'>DB</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>KEY</span>. Замеры показали, что
этот метод заметно ускоряет процесс обработки. <br style='mso-special-character:
line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>4. </b>Обработки
записей <i style='mso-bidi-font-style:normal'>курсорным</i> способом используют
синтаски<span lang=EN-US style='mso-ansi-language:EN-US'>c</span>: update <span
lang=EN-US style='mso-ansi-language:EN-US'>T</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>set</span> . . . <span lang=EN-US
style='mso-ansi-language:EN-US'>where</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>current</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>of</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>C</span>. Для <span lang=EN-US
style='mso-ansi-language:EN-US'>Firebird</span> 2.5 применяются явные
объявления курсоров (<span lang=EN-US style='mso-ansi-language:EN-US'>declare</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>c</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>cursor</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>for</span>
(…<span lang=EN-US style='mso-ansi-language:EN-US'>)</span>), для 3.0 –
конструкция ‘<span lang=EN-US style='mso-ansi-language:EN-US'>as</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>cursor</span>
&lt;<span lang=EN-US style='mso-ansi-language:EN-US'>C</span>&gt;.<br>
Замеры показали, что этот способ приводит к максимально возможной
производительности. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>5. </b>При коннекте (триггер
<span lang=EN-US style='mso-ansi-language:EN-US'>TRG</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>CONNECT</span>) производится считывание текущих
настроек из базы, с сохранением их в контекстных переменных, чтобы избежать
многократных обращений к БД в течение сеанса. </p>

<p class=MsoNormal>При определении диапазона для поиска случайного <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span> (в рамках одной
транзакции) в контекстных переменных запоминаются полученные в первый раз
значения минимального и максимального идентификаторов (отдельно для каждого
используемого сейчас <span lang=EN-US style='mso-ansi-language:EN-US'>view</span>-«источника»)
– см. ниже описание модуля <span lang=EN-US style='mso-ansi-language:EN-US'>fn</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>get</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>random</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>. Если затем в <i style='mso-bidi-font-style:
normal'>этой же</i> транзакции будет 20 вызовов для определения случайного <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span>, указанные лимиты уже
будут браться из «кеша» контекстных переменных.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'>6. </b>Режим изоляции <span lang=EN-US
style='mso-ansi-language:EN-US'>SNAPSHOT</span> может привести к большому расходу
памяти сервера: старт каждой такой транзакции требует копирования активной
части <span lang=EN-US style='mso-ansi-language:EN-US'>TIP</span>. При значении
( <span lang=EN-US style='mso-ansi-language:EN-US'>Next</span><span lang=EN-US>
</span>– <span lang=EN-US style='mso-ansi-language:EN-US'>OIT</span><span
lang=EN-US> </span>) * 2 &gt; 65536 каждый старт транзакции потребует выделения
памяти более 64 Кб, что приведёт к<span style='mso-spacerun:yes'>  </span>вызову
функции операционной системы (<span lang=EN-US style='mso-ansi-language:EN-US'>mmap</span>
в <span lang=EN-US style='mso-ansi-language:EN-US'>Linux</span> и <span
lang=X-NONE style='mso-ansi-language:X-NONE'>VirtualAlloc</span> в <span
lang=EN-US style='mso-ansi-language:EN-US'>Windows</span><span
style='font-size:10.0pt;mso-bidi-font-size:12.0pt'>).<span
style='mso-spacerun:yes'>  </span></span>Затем эта память будет отдана обратно
в <span lang=EN-US style='mso-ansi-language:EN-US'>OS</span>, после – опять
затребована оттуда и т.д. Всё может очень сильно замедлить работу в конкуретной
среде: коннекты будут выстраиваться в очередь только лишь для того, чтобы
стартовать транзакцию.</p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'>В
связи с этим, <i style='mso-bidi-font-style:normal'>автономные</i> транзакции
(наследующие от своих «родителей» <span lang=EN-US style='mso-ansi-language:
EN-US'>TIL</span> = <span lang=EN-US style='mso-ansi-language:EN-US'>SNAPSHOT</span>!)
в тесте запускаются только в случае, когда в каком-то модуле происходит
исключение и его нельзя «подавить» в данной ситуации. Все остальные действия
выполняются только в обычных транзакциях.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>7. </b>Запросы с
соединениями таблиц в большинстве используют <b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>inner</span></b><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>join</span>.
Это позволяет оптимизатору самостоятельно выбирать порядок соединения
источников. Однако, оптимизатор может выбрать неверный порядок при отсутствии
или устаревании статистики по индексам. С целью недопущения этого, тест
предусматривает систематический пересчет статистики, что выполняется каждым из
работающих коннектов (разумеется, с «сериализацией» этой операции между
коннектами). В некоторых местах для версии <span lang=EN-US style='mso-ansi-language:
EN-US'>FB</span> 3.0 условия соединения были сознательно изменены (через «+0»)
для вызова <span lang=EN-US style='mso-ansi-language:EN-US'>hash</span>-соединения.
Везде, где это применено, производительность предварительно сравнивалась с
другими вариантами соединения.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>8.</b> В версии <span
lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span> 3.<span lang=EN-US
style='mso-ansi-language:EN-US'>x</span> появились т.н. «хранимые функции»,
которые можно объявить с признаком <i style='mso-bidi-font-style:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>deterministic</span></i>. Замеры
показали, что производительность таких функций существенно выше, чем у вызовов <span
lang=EN-US style='mso-ansi-language:EN-US'>rdb</span>$<span lang=EN-US
style='mso-ansi-language:EN-US'>get</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>context</span> (на самом деле она почти такая же, как у операторов
присваивания констант). </p>

<p class=MsoNormal>Тестирование показало, что при выполнении запроса <span
lang=EN-US style='mso-ansi-language:EN-US'>deterministic</span>-функция делает
«затратную» работу только один раз, когда происходит обработка первой строки.
Для всех последующих строк, обрабатываемых данным запросом, функция возвращает
результат из своего кеша.</p>

<p class=MsoNormal>К сожалению, <span lang=EN-US style='mso-ansi-language:EN-US'>deterministic</span>-функция
будет повторно делать работу при каждом <i style='mso-bidi-font-style:normal'>новом</i>
запуске запроса. Также она не может запомнить состояние своего кеша при
повторном вызове из <span lang=EN-US style='mso-ansi-language:EN-US'>PSQL</span>-объекта
(и тем более – при новом вызове <span lang=EN-US style='mso-ansi-language:EN-US'>PSQL</span>-объекта).</p>

<p class=MsoNormal>В варианте теста для <span lang=EN-US style='mso-ansi-language:
EN-US'>Firebird</span> 3.<span lang=EN-US style='mso-ansi-language:EN-US'>x</span>
такие функции используются, но в основном - для улучшения читабельности кода и
только там, где количество ихповторных вызовов не слишком велико.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>9.</b> Использование
триггеров в дочерних таблицах для обновления агрегатных сведений в
таблицах-«родителях» всегда приводит к лишним обращениям к последним, т.к.
триггер срабатывает для каждой обновляемой дочерней строки. Триггера уровня
оператора (срабатывающего тоько один раз, незасивисимо от числа обработанных
строк) в <span lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span><span
lang=EN-US> </span>не существует. Поэтому было принято решение обновлять
агрегатные «родительские» данные только в процедуре, после завершения
соответсвующего <span lang=EN-US style='mso-ansi-language:EN-US'>DML</span>-оператора.
Затем было решено вообще отказаться от триггеров на таблицах, которые
подвержены интенсивным изменениям.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>10.</b> Если в рамках
одной транзакции<span style='mso-spacerun:yes'>  </span>происходит несколько <span
lang=EN-US style='mso-ansi-language:EN-US'>DML</span>-действий, то завершение
каждого из этих операторов вызывает слияние данных <span lang=EN-US
style='mso-ansi-language:EN-US'>undo</span>-лога этого оператора с <span
lang=EN-US style='mso-ansi-language:EN-US'>undo</span>-логом уровня транзакции.
Старт транзакции возможен с указанием фразы “<span lang=EN-US style='mso-ansi-language:
EN-US'>NO</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>AUTO</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>UNDO</span>”, что позволит сохранять в памяти только <span lang=EN-US
style='mso-ansi-language:EN-US'>undo</span>-логи отдельных <span lang=EN-US
style='mso-ansi-language:EN-US'>DML</span>-операторов, но не делать при
завершении каждого из них слияния с <span lang=EN-US style='mso-ansi-language:
EN-US'>undo</span>-логом уровня транзакции. Тест использует эту возможность:
все <span lang=EN-US style='mso-ansi-language:EN-US'>sql</span>-скрипты,
стартующие транзакции, содержат фразу “<span lang=EN-US style='mso-ansi-language:
EN-US'>no</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>auto</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>undo</span>”.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>11.</b> Прикладные ХП
сделаны селективными, чтобы можно было легко анализировать правильность их
результатов с точки зрения бизнес-логики. Значительная часть этих ХП возвращает
вместе со строками документов также и их остатки, которые должны <i
style='mso-bidi-font-style:normal'>были бы</i> получиться при запуске после
этого служебной ХП srv_make_invnt_saldo. Эта ХП весьма затратна. Чтобы
уменьшить нагрузку на сервер при передаче результатов прикладных ХП в <span
lang=EN-US style='mso-ansi-language:EN-US'>isql</span>-окна, было решено
избавиться от выдачи остатков, заменив их <span lang=EN-US style='mso-ansi-language:
EN-US'>NULL</span>-литералами в соответствующих столбцах. Таким образом, вызов
затратной операции получения прогнозируемых остатков не <span
style='mso-spacerun:yes'> </span>выполняется при работе собственно теста,
возможность эта оставлена только для вызова из среды <span lang=EN-US
style='mso-ansi-language:EN-US'>IB</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>Expert</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>12.</b> <span
style='mso-spacerun:yes'> </span>В ряде мест теста используется вызов функции <span
lang=EN-US style='mso-ansi-language:EN-US'>fn</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>get</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>random</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>id</span>,
которая производит выбор «случайного <span lang=EN-US style='mso-ansi-language:
EN-US'>ID</span>». Затраты на получение этого <span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span> могут быть очень большими, если
запрос должен выполнять поиск с <span lang=EN-US style='mso-ansi-language:EN-US'>PLAN</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>INDEX</span>
по большой таблице. Причина – необходимость многократного построения битовой
карты для ВСЕХ строк источника, и её последующей обработки. Из этой битовой
карты в итоге необходимо получить только первую строку, т.к. выбор случайного <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span> производится по правилу: <span
lang=EN-US style='mso-ansi-language:EN-US'>select</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>id</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>from</span> &lt;<span lang=EN-US
style='mso-ansi-language:EN-US'>some</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>data</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>source</span>&gt;
<span lang=EN-US style='mso-ansi-language:EN-US'>where</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>id</span> &lt;= :<span lang=EN-US
style='mso-ansi-language:EN-US'>r</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>order</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>by</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>id</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>desc</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>rows</span> 1. Замена запросов,
использовавших в &lt;<span lang=EN-US style='mso-ansi-language:EN-US'>some</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>data</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>source</span>&gt; план с построением битовой
карты (<span lang=EN-US style='mso-ansi-language:EN-US'>plan</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>index</span>)
на навигацию по листовому уровню (<span lang=EN-US style='mso-ansi-language:
EN-US'>plan</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>order</span>) привело к увеличению быстродействия<span
style='mso-spacerun:yes'>  </span>более, чем в 1.5 раза. Функция выбора
«случайного <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>»
перестала быть узким местом теста и время её выполнения при сильной нагрузке
редко превышает 500 мс.</p>

<p class=MsoNormal><br>
<b style='mso-bidi-font-weight:normal'>13.</b> Получение нового <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span> через вызов функции <span
lang=EN-US style='mso-ansi-language:EN-US'>gen</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span> сопровождается блокирокой страницы
генераторов. В тех местах, где в таблицы необходимо записать сразу десятки или
сотни строк, вызовы <span lang=EN-US style='mso-ansi-language:EN-US'>gen</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span> от сотен конкурирующих
коннектов будут приводить к лишним ожиданиям каждого из них на установку этой
блокировки. Известен приём, позволяющий уменьшить количество таких ожиданий:
увеличить счетчик не на 1, а сразу на 100 (например), и далее в цикле
присваивать новым записям значения из полученного «пула». Когда число
добавляемых строк заранее известно (например, равно числу строк в «корзине
покупателя»), то для добавления <i style='mso-bidi-font-style:normal'>всех</i>
этих строк можно выполнить только <i style='mso-bidi-font-style:normal'>одно</i>
обращение к <span lang=EN-US style='mso-ansi-language:EN-US'>gen</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>. В коде теста этот метод
используется для всех таких мест, где производится большое число вставок. Это
также позволило избавиться от «примитивных триггеров», выполняющих код
наподобие следующего: <span lang=EN-US style='mso-ansi-language:EN-US'>new</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span> = <span lang=EN-US
style='mso-ansi-language:EN-US'>coalesce</span>( <span lang=EN-US
style='mso-ansi-language:EN-US'>new</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>id</span>, <span lang=EN-US style='mso-ansi-language:EN-US'>gen</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>( &lt;<span lang=EN-US
style='mso-ansi-language:EN-US'>gen</span>&gt;, 1) ). </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>14.</b> Уменьшение
числа индексов до минимума. Затраты на поддержание индексов при модификациях
данных оказывают сильное влияние на производительность. Отказ от некоторых составных
индексов на таблицах, подверженных наиболее частым изменениям, привёл к
увеличению производительности примерно на 70-80%. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>15. </b><span
style='mso-spacerun:yes'> </span>Отказ от ограничений первичного ключа на
таблицах, где он де-факто не играет никакой роли в виду того, что либо у этих
таблиц есть т.н. уникальные «бизнес-ключи» по другим полям, либо эти таблицы
заполняются на непродолжительное время и затем полностью «обнуляются». Речь
идет о следующих таблицах:</p>

<p class=MsoNormal>15.1 ) <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>data</span> – имеет уникальный
бизнес-ключ по полям {<span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>, <span lang=EN-US
style='mso-ansi-language:EN-US'>ware</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>id</span>}. Не участвует в соединениях с условием по полю <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span>, а также в каких-либо
поисках по этому полю.</p>

<p class=MsoNormal>15.2) журналы, в которые идут только вставки, а также возможны
полные очистки их содержимого:</p>

<p class=MsoNormal>15.2.1) <span lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span><span lang=EN-US> </span>–
является журналом выполнения всех операций, в неё идут только вставки;</p>

<p class=MsoNormal>15.2.2) <span lang=EN-US style='mso-ansi-language:EN-US'>money</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span> – журнал стоимостных оборотов,
подвержен только вставкам; обнуляется сервисной ХП при сборке этих оборотов и
обновлении сводных остатков по контрагентам; не участвует в соединениях с
условием по полю <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>;</p>

<p class=MsoNormal>15.2.3) <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span> - журнал количественных оборотов,
подвержен только вставкам; обнуляется сервисной ХП при сборке этих оборотов и
обновлении сводных остатков по изделиям; не участвует в соединениях с условием
по полю <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>;</p>

<p class=MsoNormal>15.3) таблицы, в которых никогда не производится поиск <i
style='mso-bidi-font-style:normal'>отдельной</i> записи, и при этом есть ключи,
определяющие группы «связанных» записей:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>qdistr</span>
– «развёртка» количеств, ожидающих сторнирование, в отдельные записи; не
участвует в соединениях с условием по полю <span lang=EN-US style='mso-ansi-language:
EN-US'>ID</span>. Записи этой таблицы либо добавляются в неё, либо удаляются с
переносом в <span lang=EN-US style='mso-ansi-language:EN-US'>qstorned</span>. Для
одного и того же значения в поле <span lang=EN-US style='mso-ansi-language:
EN-US'>snd</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>id</span>
всегда удаляется <i style='mso-bidi-font-style:normal'>вся группа</i> строк с
этим значением. Первичный ключ из этой таблицы будет удалён только при условии,
что настройка HALT_TEST_ON_ERRORS *не* содержит ‘,<span lang=EN-US
style='mso-ansi-language:EN-US'>PK</span>,’. </p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>qstorned</span>
– «развёртка» количеств, по которым сторнирование уже было проведено, в
отдельные записи; не участвует в соединениях с условием по полю <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span>. Записи этой таблицы
добавляются при одновременном их удалении из <span lang=EN-US style='mso-ansi-language:
EN-US'>qdistr</span>. Удаление записи из этой таблицы также означает, что<span
style='mso-spacerun:yes'>  </span>производится одновременное добавление в
таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>qstorned</span>. Для
одного и того же значения в поле <span lang=EN-US style='mso-ansi-language:
EN-US'>rcv</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>id</span>
всегда удаляется <i style='mso-bidi-font-style:normal'>вся группа</i> строк с
этим значением. Первичный ключ из этой таблицы будет удалён только при условии,
что настройка HALT_TEST_ON_ERRORS *не* содержит ‘,<span lang=EN-US
style='mso-ansi-language:EN-US'>PK</span>,’</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>pdistr</span>
– «развертка» стоимостей, ожидающих сторнирование. Для одного и того же
значения в поле <span lang=EN-US style='mso-ansi-language:EN-US'>snd</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span> всегда удаляется <i
style='mso-bidi-font-style:normal'>вся группа</i> строк с этим значением. Первичный
ключ в этой таблице не нужен в виду отсутствия соединений или поиска по нему.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>pstorned</span>
– «развертка» стоимостей, по которым сторнирование уже было проведено. Для
одного и того же значения в поле <span lang=EN-US style='mso-ansi-language:
EN-US'>rcv</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>id</span>
всегда удаляется <i style='mso-bidi-font-style:normal'>вся группа</i> строк с
этим значением. Первичный ключ по этой таблице также оказался не нужным.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Всё вышесказанное увеличивает объем «полезной работы»,
выполняемой СУБД, - и это была одна из основных целей разработки. Возможно,
некоторые объекты базы и методы работы с ними совершенно не характерны для<span
style='mso-spacerun:yes'>  </span>практических приложений, однако требование
минимизации лок-конфликтов имело приоритет выше, чем следование устоявшимся
правилам проектирования баз для нагруженных систем.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Ловушки в коде для
«самоостановки» теста при ошибках в логике<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Тест должен обеспечивать непротиворечивость данных и
требований бизнес-логики, особенно – неотрицательность остатков изделий.
Декларативные (<span lang=EN-US style='mso-ansi-language:EN-US'>check</span>) ограничения
на неотрицательность некоторых полей хотя и установлены, но при правильной
работе алгоритмов не должны срабатывать <i style='mso-bidi-font-style:normal'>никогда</i>.</p>

<p class=MsoNormal>Для экстренной «самоостановки» теста в коде некоторых
процедур расставлены «ловушки», останавливающие тест, когда возникает отрицательный
остаток по какому-либо изделию или вообще происходит попытка обхода
декларативного <span lang=EN-US style='mso-ansi-language:EN-US'>check</span>-ограничения.
В этом случае в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span> будут записаны сведения о
том, в каком модуле возникло исключение данного вида. </p>

<p class=MsoNormal>Многочисленные запуски теста показали, что <span lang=EN-US
style='mso-ansi-language:EN-US'>check</span>-ограничения не нарушаются, т.е.
тест НЕ должен останавливаться из-за такого рода проблем.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Замечание о попытках
нарушений первичного и внешнего ключа<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal>В двух таблицах: <span lang=EN-US style='mso-ansi-language:
EN-US'>QDistr</span><span lang=EN-US> </span>и <span lang=EN-US
style='mso-ansi-language:EN-US'>Qstorned</span><span lang=EN-US> </span>– для
каждого документа хранятся большие «партии» строк, предназначенные для
сторнирования ресурсов и его отмены. Эти таблицы крайне интенсивно обмениваются
такими «партиями» записей, что приводит к значительному накоплению версий в
них.</p>

<p class=MsoNormal>Обе таблицы имеют стандартный первичный ключ (<span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span>), создаваемый при вставках
через обращение к генератору, а также - внешние ключи на таблицу детализации
изделий (<span lang=EN-US style='mso-ansi-language:EN-US'>DOC</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>DATA</span>), причём таблица <span
lang=EN-US style='mso-ansi-language:EN-US'>QStorned</span> имеет два таких
внешних ключа по разным полям.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Замечание</b> (15.09.2014).
Внешние ключи с таблиц <span lang=EN-US style='mso-ansi-language:EN-US'>QDistr</span><span
lang=EN-US> </span>и <span lang=EN-US style='mso-ansi-language:EN-US'>Qstorned</span>
были удалены, вместо них используются обычные индексы по соответствующим полям.
В код теста добавлена проверка на появление «висячих строк».</p>

<p class=MsoNormal>Алгоритмы обмена записями таковы, что строка с некоторым <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span lang=EN-US> </span>может
присутствовать только в одной из этих таблиц, но не в обеих одновременно. При
переносе строки её <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span
lang=EN-US> </span>не меняется, т.е. она переносится без всяких искажений.</p>

<p class=MsoNormal>Работа теста на средней нагрузке (50 коннектов) в течение
нескольких часов может привести к тому, что будет зарегистрировано исключение:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>335544665
(violation of PRIMARY or UNIQUE KEY constraint)<o:p></o:p></span></p>

<p class=MsoNormal>Это исключение возникает только при средней или высокой
нагрузке и только на <span lang=EN-US style='mso-ansi-language:EN-US'>FB</span>
3.0.</p>

<p class=MsoNormal>Версии теста до 12-авг-2014 реагировали на возникновение <b
style='mso-bidi-font-weight:normal'>всех</b> нарушений декларативных правил
(т.е. <span lang=EN-US style='mso-ansi-language:EN-US'>check</span>, <span
lang=EN-US style='mso-ansi-language:EN-US'>unique</span>, <span lang=EN-US
style='mso-ansi-language:EN-US'>FK</span>), как на логическую ошибку в
алгоритмах. Это приводило к самоостановке всех работающих окон. </p>

<p class=MsoNormal>Затем в тест была добавлена настройка, позволяющая
игнорировать все или часть ошибок, относящихся к декларативным правилам. <span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Эта настрока прописана в скрипте <span lang=EN-US
style='mso-ansi-language:EN-US'>oltp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>main</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>filling</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>sql</span> и выглядит так:</p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- Should test STOP itself if &quot;strange&quot;
exceptions like PK/FK violation occur ?<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- NB: these exceptions can occur in
sp_kill_qty_storno under heavy load: <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- Tx-1 can ignore fact that some record is locked now
by another Tx-2!<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- The reason could not be cleared:<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- sql.ru/forum/actualutils.aspx?action=gotomsg&amp;tid=1110158&amp;msg=16433910<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- 'CK' -- halt if CHECK violation or 'not_valid'
occurs<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- 'PK' -- halt if PK or <st1:country-region w:st="on"><st1:place
 w:st="on">UK</st1:place></st1:country-region> violation occurs<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- 'FK' -- halt if FK violation occurs<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- 'ST' -- halt if exc #335544842 appeared at the top
of stack and logged into perf_log (strange problem only in 3.0 SC)<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- These mnemonics can be combined in list, i.e.:<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- 'CK,PK,FK' - halt if CHECK or PK or FK violation
occurs<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- update settings set svalues='CK' where
working_mode='COMMON' and mcode='HALT_TEST_ON_ERRORS'<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>-- See calls of fn_halt_sign(gdscode):<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>insert into settings(working_mode, mcode,<span
style='mso-spacerun:yes'>                  </span>svalue)<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>             
</span>values('COMMON',<span style='mso-spacerun:yes'>      
</span>'HALT_TEST_ON_ERRORS', 'NONE');<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Таким образом, в поставляемом скрипте настройка такова, что
тест НЕ<span style='mso-spacerun:yes'>  </span>будет самоостанавливаться ни при
каких исключениях, пока не истечёт время его работы, заданное в <span
lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>config</span>-файле.</p>

<p class=MsoNormal><span style='mso-spacerun:yes'> </span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>Краткое описание бизнес-логики<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'> </span>«Цепочки документов» <o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal>Деятельность предприятия, принимающего заказы от клиентов на
поставку изделий и исполняющего их, моделируется несколькими видами документов,
отражающих возникновение <i style='mso-bidi-font-style:normal'>обязательств</i>
между нами и контрагентами (покупателями или поставщиками). Эти обязательства
возникают при создании документов и исчезают при их «проведении», т.е. переводу
в такой статус, который говорит, что дальнейшие действия с документом уже
невозможны (за исключением отмены последней совершенной над ним операции). </p>

<p class=MsoNormal>С момента возникновения обязательств и до их исчезновения
создаются документы нескольких видов, причем их создание идёт строго <i
style='mso-bidi-font-style:normal'>последовательно</i>.<span
style='mso-spacerun:yes'>  </span>Такая последовательность названа в этом
тексте «цепочкой документов».</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В тесте релизована следующая цепочка документов:</p>

<p class=MsoNormal>1) создание заказа клиента на поставку изделий – «стартовая
точка» возникновения наших обязательств перед ним;<br>
2) создание на основе нескольких клиентских заказов нашего заказа поставщику
(«складского заказа»); в этот момент мы передаем поставщику те количества,
которые ранее нам заказали покупатели, т.е. поставщик <i style='mso-bidi-font-style:
normal'>обязан</i> нам поставить этот объем товара;</p>

<p class=MsoNormal>3) поставщик на основе нескольких наших заказов формирует
инвойс – документ для последующего оприходования на нашем складе. Инвойс – это
товары, которые он нам отправляет, следовательно, этим он уменьшает свою
задолженность по поставкам перед нами;</p>

<p class=MsoNormal>4) «Проведение инвойса», т.е. перевод его содержимого в
разряд «Доступно для продаж». Эта операция означает, что все изделия данного
инвойса считаются принятыми на склад, но также это значит, что теперь уже <i
style='mso-bidi-font-style:normal'>мы должны</i> поставщику оплатить данные
товары.</p>

<p class=MsoNormal>5) Создание резерва товара для последующей продажи
(реализации). Эта операция переводит выбранные изделия и их количества из
разряда «Доступно для продаж» в разряд «Зарезервировано». Никаких обязательств
ни перед кем при этом не возникает, однако такая операция нужна в конкурентной
среде: необходимо гарантировать, что выбранный покупателем товар некоторое
время не будет реализован кому-то другому. Создание резерва всегда вызывается
по завершениии операции «Проведение инвойса», т.к. необходимо отложить в резерв
изделия, которые ранее заказывались клиентами. Помимо этого, возможно создание
резерва по данным свободных остатков (т.е. без всякой связи с заказами
клиентов).</p>

<p class=MsoNormal>6) «Проведение резерва» - это перевод его в состояние
«Отгружен». Изделия при этом считаются списанными со склада. Также это означает
возникновение задолженности покупателя перед нами за эти товары.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Помимо этих видов документов, существует еще две операции,
связанные с платежами. Они не относятся к этой «цепочке», т.к. могут
происходить в любой момент времени:</p>

<p class=MsoNormal>1) Ввод оплаты от покупателя (авансовой или за ранее
совершенные отгрузки). Эта операция увеличивает баланс покупателя (или<span
style='mso-spacerun:yes'>  </span>уменьшает его задолженность, если она была).</p>

<p class=MsoNormal>2) Ввод нашей оплаты поставщику (так же, как и в предыдущем
варианте: авансовой или за ранее поставленные товары).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>FIFO</span>-распределения ресурсов при создании
документов<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal>Существенной особенностью теста является применение
алгоритма <span lang=EN-US style='mso-ansi-language:EN-US'>FIFO</span>-распределения
<i style='mso-bidi-font-style:normal'>ресурсов</i> (количественных<span
style='mso-spacerun:yes'>  </span>и стоимостных) при формировании каждого
документа, а также удаление<span style='mso-spacerun:yes'>  </span>выполненного
<span lang=EN-US style='mso-ansi-language:EN-US'>FIFO</span>-распределения при
выполнении операции отмены. </p>

<p class=MsoNormal>Распределение по <span lang=EN-US style='mso-ansi-language:
EN-US'>FIFO</span>-принципу производится в следующих ситуациях:</p>

<p class=MsoNormal>1) при формировании заказа поставщику: по данным
сформированной «корзины» для количества в заказе поставщику ищутся количества в
клиентских заказах, которые мы еще должны покупателям; </p>

<p class=MsoNormal>2) при формировании инвойса от поставщика: для количества из
«корзины» ищутся строки (наших) заказов поставщику, с количествами, которые еще
не полностью были поставлены;<br>
3) при формировании резерва на основании свободного остатка: для количества из
«корзины» ищутся строки из проведенных инвойсов с количествами, которые еще не
были полностью сторнированы другими резервами;</p>

<p class=MsoNormal>4) при «проведении резерва» (списании изделий): поиск
предоплат (авансов) от покупателя, которые он проводил перед этим, либо оплат,
которые сейчас не полностью сторнированы предыдущими проведениями резервов;</p>

<p class=MsoNormal>5) при «проведении инвойса» (добавлении его данных к
доступному остатку склада): поиск наших оплат поставщику, которые еще не
полностью сторнированы другими проведёнными инвойсами от этого поставщика;</p>

<p class=MsoNormal>6) при вводе предоплат (от клиентов нам или от нас
поставщикам) – поиск резервов или инвойсов, которыми можно сторнировать эту
предоплату.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Движение остатков,
сторнирование.<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>Все операции, за исключением платежей, влияют на
количественные остатки соответствующего вида («в заказах поставщикам»,
«доступно», «в резервах» и т.д.). Начальный остаток изделия всегда обусловлен
формированием «корзины покупателя» и созданием на её основе клиентского заказа.
Этот остаток относится к категории «В заказах клиентов». </p>

<p class=MsoNormal>Клиентский заказ – единственный <i style='mso-bidi-font-style:
normal'>складской</i> документ, не имеющий «базового» документа по отношению к
себе, т.к. он создается самым первым. Документы-<i style='mso-bidi-font-style:
normal'>платежи</i> также могут не иметь «базового» по отношению к себе, если
это авансы.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Далее, на основе («на <i style='mso-bidi-font-style:normal'>базе</i>»)
<i style='mso-bidi-font-style:normal'>нескольких</i> клиентских заказов
создается наш заказ поставщику. Это означает, что необходимо:</p>

<p class=MsoNormal>1) перенести объем заказываемого товара из разряда «В
заказах клиентов» в разряд «В заказах поставщикам»;</p>

<p class=MsoNormal>2) отразить <i style='mso-bidi-font-style:normal'>связи</i>
между каждой позицией (строкой) в заказе поставщику и исходными строками
заказов клиентов, по которым была сформирована данная строка. Это позволит в
дальнейшем избежать повторного заказа изделия из какого-то клиентского заказа.
Также это позволит - при <i style='mso-bidi-font-style:normal'>отмене</i>
нашего заказа - отменить такие связи и вновь сделать изделие клиентского заказа
доступным к размещению в новом складском заказе.</p>

<p class=MsoNormal>Уменьшение остатка вида «А» из-за увеличения остатка вида
«Б» называется в данном тексте <i style='mso-bidi-font-style:normal'>сторнированием</i>.
</p>

<p class=MsoNormal>Количество, записываемое в документ «Заказ поставщику»,
ограничено сверху лимитом - контекстной переменной ‘C_SUPPLIER_DOC_MAX_QTY’ (уровня
сеанса). Допустим, было 30 клиентских заказов с одним и тем же изделием, с
разными количествами, а в одном заказе поставщику можно разместить только 20
штук. Как уже было сказано, программный код теста реализует в этом случае
принцип <span lang=EN-US style='mso-ansi-language:EN-US'>FIFO</span>: первыми
размещаются изделия от самых старых клиентских заказов. Остальные количества
будут размещены в последующих заказах.<span style='mso-bidi-font-size:14.0pt'><o:p></o:p></span></p>

<p class=MsoNormal>Все <i style='mso-bidi-font-style:normal'>количества</i>
генерируются как целочисленные значения, без дробей. Это сделано для упрощения
работы алгоритмов сторнирования (они объясняются ниже).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Меры по уменьшению
количества конфликтов обновления</b>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Первые версии теста показали, что очень большое количество
операций отменялись с исключением ‘<span lang=EN-US style='mso-ansi-language:
EN-US'>lock</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>conflict</span>’. Конфликты обновления происходили, когда транзакция
пыталась:</p>

<p class=MsoNormal>1) обновить агрегатную информацию (код состояния, общую
стоимость) в заголовке любого документа, за исключением только что созданного этой
транзакцией;</p>

<p class=MsoNormal>2) обновить агрегатный остаток по изделию (в первых версиях
теста такие остатки обновлялись триггером);</p>

<p class=MsoNormal>3) выполнить сторнирование количеств с «базовых» документов
при определении того, какими строками обеспечивается количество в формируемом
сейчас документе.</p>

<p class=MsoNormal><span style='font-size:14.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Ниже приведены соображения, показывающие возможность
уменьшения числа лок-конфликтов, а также описана их реализация в предлагаемом
тесте.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>1) Анализ показал, что агрегатная информация в заголовке
документа не нужна. Сумма по документу, содержащему от 40 до 400 строк (обычные
цифры для <span lang=EN-US style='mso-ansi-language:EN-US'>OLTP</span>), быстро
вычисляется через таблицу детализации. Состояние же документа определяется
возможностью сторнирования его данных, если более конкретно, то: существуют ли
еще в нём строки, количества которых могут быть сторнированы. Если нет, то на
основе данного документа уже нельзя создавать документ, располагающийся
«следующим» в бизнес-цепочке. Например, если все изделия проведенного <i
style='mso-bidi-font-style:normal'>инвойса</i> уже были «разобраны» по
резервам, то далее нельзя создать ни одного <i style='mso-bidi-font-style:normal'>резерва</i>,
строки которого ссылались бы на любую из строк данного инвойса. </p>

<p class=MsoNormal>В связи с этим, в нынешней версии теста поле «состояние
документа» меняется только при его создании. Сумма по документу в его заголовке
<i style='mso-bidi-font-style:normal'>меняется</i>, однако это делается только
при его формировании (созданиии), так что лок-конфликтов тут нет. В дальнейшем
не исключено, что и этой операции выполняться не будет.</p>

<p class=MsoNormal><span style='font-size:14.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>2) Обновление агрегатных остатков изделий при каждой <span
lang=EN-US style='mso-ansi-language:EN-US'>DML</span>-операции, влияющей на
них, также оказалось излишним. Если алгоритм сторнирования работает правильно,
то нельзя будет разместить в нашем заказе поставщику больше, чем было заказано
у нас клиентами; нельзя сформировать инвойс (на основе нескольких складских
заказов) с количеством, превышающим общую сумму по ним для какого-то иделия, и
т.д.<span style='mso-spacerun:yes'>  </span>Однако, агрегатные остатки по
изделиям обычно нужны логистам и бухгалтерам. Поэтому таблицу с ними всё-таки
вести необходимо. Но такая таблица может регулярно обновляться по принципу
«семафора», а именно: каким-то из коннектов выполняется попытка заблокировать
служебную запись в некоторой таблице. Если получилось, то он начинает обновлять
таблицу агрегатных остатков на основе <i style='mso-bidi-font-style:normal'>журнала</i>
операций. Если нет, то он «тихо» (без выброса исключения) завершает эту ХП и продолжает
другую деятельность. <span style='mso-bidi-font-size:14.0pt'><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:14.0pt'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>3) Сторнирование количеств (а также стоимостей!) оказалось
наиболее серьёзным изменением первоначальной версии теста. Представим, что в
некоторый момент в базе остался только один клиентский заказ, в котором
осталась только одна строка, НЕ размещенная до сих пор в заказах поставщикам.
Если в этот момент времени есть два и более коннекта, создающих одновременно
заказы поставщикам, то они неминуемо попытаются сторнировать количество в
клиентском заказе. Если программный код написан так, что сторнирование делает
уменьшение количества в строке <i style='mso-bidi-font-style:normal'>клиентского
заказа,</i> то получим лок-конфликт. Это особенно часто происходит, если
количество в новом документе (заказе поставщику в данном случае) намного
превышает количество, которое должно быть сторнировано со старых документов
(клиентских заказов). Обратное тоже верно: если количество в «базовом»
документе (инвойсе) велико, и его надо разобрать по многочисленным резервам с
небольшими значениями количеств, то сторнирование количеств инвойса будет
сопровождаться очень частыми лок-конфликтами на уровне отдельных <i
style='mso-bidi-font-style:normal'>строк</i> (не заголовка!) этого инвойса.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Поэтому было принято решение, которое заключается в
следующем: при добавлении каждого нового изделия в строковую часть документа (таблицу
<span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>data</span>) программный код создает в другой
таблице, <span lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span>, такое
число <i style='mso-bidi-font-style:normal'>строк</i>, которое равно
добавляемому сейчас <i style='mso-bidi-font-style:normal'>количеству</i>. Таким
обр., строки таблицы <span lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span>
служат «вертикальной развёрткой» тех количеств, которые далее <i
style='mso-bidi-font-style:normal'>должны быть</i> сторнированы.</p>

<p class=MsoNormal>Например, клиентский заказ, состоящий из одной строки с
количеством, равным 10, будет представлен в таблице <span lang=EN-US
style='mso-ansi-language:EN-US'>QDISTR</span> в виде 10 отдельных строк (с
количествами <i style='mso-bidi-font-style:normal'>для сторнирования</i>,
равными 1, в каждой из них).<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Во многом такое решение напоминает реальную ситуацию, когда
два кладовщика одновременно подходят к полке, на которой лежит 10 штук товара.
Одному кладовщику нужно 3 штуки, второму 5. Очевидно, что никто из них не
станет ждать и они будут брать изделия одновременно – просто в руках у них
окажутся разные экземпляры одного и того же изделия. Строки в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span>, создаваемые при вводе
целочисленного количества в поле <span lang=EN-US style='mso-ansi-language:
EN-US'>DOC</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>DATA</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>QTY</span>, - это и есть <i
style='mso-bidi-font-style:normal'>разные экземпляры</i> одного и того же
изделия, которые мы сохраняем на «полке» склада.</p>

<p class=MsoNormal>Если в процессе работы теста оказывается, что двум и<span
style='mso-spacerun:yes'>  </span>более транзакциям нужно заблокировать
наесколько строк в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>QDistr</span>,
ссылающихся на одну и ту же строку в таблице-детализации документа, то
применяется еще один приём. Транзакция, идентификатор которой является нечётным
числом, будет обрабатывать эту группу строк в порядке возрастания их <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span>, а транзакция с четным
номером – в порядке убывания. Если по одному и тому же количеству транзакции
123 нужно обработать 12 строк, а транзакции 124 – 8, то для группы из 20 строк
обработка этими транзакциями будет бесконфликтной: они будут «забирать» строки
с разных концов доступного множества.</p>

<p class=MsoNormal>Решение проблемы лок-конфликтов при сторнировании стоимостей
выглядит во многом аналогично.</p>

<p class=MsoNormal>В следующих двух параграфах приводится детальное описание
алгоритмов сторнирования количеств и стоимостей. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Сторнирование <span
style='background:silver;mso-highlight:silver'>количеств</span> – описание
алгоритма.<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Алгоритм сторнирования количеств работает следующим образом.</p>

<p class=MsoNormal>Если в строке таблицы детализации <span lang=EN-US
style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>data</span> для <span lang=EN-US style='mso-ansi-language:EN-US'>id</span>
= 12345 записано количество (поле <span lang=EN-US style='mso-ansi-language:
EN-US'>qty</span>) 10 и оно еще не сторнировалось, то в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span><span lang=EN-US> </span>будет
создано для этого количества 10 строк, с <span lang=EN-US style='mso-ansi-language:
EN-US'>id</span> = 1000…1009 (приведены для наглядности дальнейшего изложения).
Во всех строках в поле <span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>
будет записано 1.</p>

<p class=MsoNormal>Когда транзакция с <span lang=EN-US style='mso-ansi-language:
EN-US'>id</span>=123 должна выполнить сторнирование количества, равного 3 (из
общего 10, то <i style='mso-bidi-font-style:normal'>вместо</i> попытки
выполнить апдейт строки в таблице <span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>data</span><span
lang=EN-US> </span>она попытается заблокировать то <i style='mso-bidi-font-style:
normal'>число</i> <i style='mso-bidi-font-style:normal'>строк</i> в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span>, которое сейчас нужно
сторнировать – то есть, 3<span style='mso-spacerun:yes'>  </span>строки. </p>

<p class=MsoNormal>Обработку строк таблицы <span lang=EN-US style='mso-ansi-language:
EN-US'>QDISTR</span> она будет вести в порядке возрастания их <span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span>, поэтому будут заблокированы строки с
<span lang=EN-US style='mso-ansi-language:EN-US'>id</span> = 1000 по 1002.</p>

<p class=MsoNormal>Если в этот же момент времени транзакция с <span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>=124 также должна сторнировать
количество (с этой же строки с <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>data</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>=12345), но уже равное 4, то она будет
действовать так же, как и транзакция-конкурент (123), однако начнёт обработку
строк, начиная с <span lang=EN-US style='mso-ansi-language:EN-US'>id</span> =
1009 в порядке его убывания. Таким образом, она заблокирует строки 1009, 1008,
1007 и 1006. </p>

<p class=MsoNormal>Между транзакциями 123 и 124 конфликт в данном случае если и
возникнет, то только при условии, что хотя бы одной из них требуется больше
половины из доступных строк. </p>

<p class=MsoNormal>Если вместо транзакции 124 конкурентом является транзакция с
нечётным номером (125), то она начнёт обработку строк так же, как и транзакция
с <span lang=EN-US style='mso-ansi-language:EN-US'>id</span>=123 – т.е. в
порядке возрастания их <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>.
Однако, первые три строки сейчас будут заняты. В этом случае транзакция 125 <i
style='mso-bidi-font-style:normal'>подавит исключение</i> <span lang=EN-US
style='mso-ansi-language:EN-US'>lock</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>conflict</span> (на каждой из них) и
дойдёт до первой незанятой строки. Следовательно, она сможет заблокировать
строки с <span lang=EN-US style='mso-ansi-language:EN-US'>id</span> = 1003…1006.</p>

<p class=MsoNormal>Если теперь объявится еще и третья транзакция, которой надо
сторнировать 8 строк, то она сможет заблокировать в <span lang=EN-US
style='mso-ansi-language:EN-US'>QDISTR</span><span lang=EN-US> </span>только
записи с <span lang=EN-US style='mso-ansi-language:EN-US'>id</span> = 1007…1009
– т.е. всего три строки вместо восьми.</p>

<p class=MsoNormal>В реальных приложениях такая ситуация (для третьей
транзакции) обычно приводит к сообщению «Недостаточно для списания». В этом
случае пользователь либо вносит то количество, которое «еще можно списать»,
либо отказывается вообще от его ввода. Данный тест идёт по первому варианту: вместо
«желаемого» количества (8) в документ будет записано то, что оказалось
возможным сторнировать (3).</p>

<p class=MsoNormal>Таким образом, вместо конкурентного обновления одной записи
(в табличной части документа), происходят попытки «набрать» то количество <i
style='mso-bidi-font-style:normal'>строковых блокировок</i> на таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span>, которое необходимо
каждому коннекту-конкуренту, с «тихим» подавлением лок-конфликтов.</p>

<p class=MsoNormal>Разумеется, если транзакция не смогла заблокировать ни одной
из обрабатываемых строк <span lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span>,
то такое изделие вообще не будет помещено в новый документ. Однако, это НЕ
приведёт к выбросу исключения, если в этом документе в итоге всех обработок
окажется хотя бы одна строка с другим изделием. Он просто будет содержать
меньше строк (и, возможно, с меньшими количествами), чем было запланировано при
формировании исходной «корзины».</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Факт успешного получения блокировки нескольких записей в <span
lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span>, относящихся к
количеству какой-то строки исходного документа, означает успешность <i
style='mso-bidi-font-style:normal'>сторнирования</i> этого количества. Чтобы
эти записи далее НЕ участвовали в новых операциях сторнирования, их можно либо
пометить каким-то флагом, либо вообще переместить в другую таблицу (но не
удалять бесследно, иначе нельзя будет отменить проведенное сейчас
сторнирование). В тесте выполняется второй вариант, а именно: есть еще одна
таблица, <span lang=EN-US style='mso-ansi-language:EN-US'>QSTORNED</span>,
предназначенная для «приема» данных из <span lang=EN-US style='mso-ansi-language:
EN-US'>QDISTR</span> и хранения сведений о <i style='mso-bidi-font-style:normal'>проведенных</i>
сторнированиях.</p>

<p class=MsoNormal>Данные в таблице <span lang=EN-US style='mso-ansi-language:
EN-US'>QDISTR</span> – это количества, которые «ждут» сторнирование, данные в <span
lang=EN-US style='mso-ansi-language:EN-US'>QSTORNED</span> – это количества,
над которыми сторнирование уже было проведено. В основном данные «идут» из <span
lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span> в <span lang=EN-US
style='mso-ansi-language:EN-US'>QSTORNED</span>, но при выполнении операции
отмены (например, при отмене складского заказа) этот поток меняет свое
направление. Таким обр., общее количество по изделию в какой-то строке “<span
lang=EN-US style='mso-ansi-language:EN-US'>R</span>” таблицы <span lang=EN-US
style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>data</span> всегда равно сумме операции <span lang=EN-US
style='mso-ansi-language:EN-US'>count</span>(*) тех строк, что относятся к
строке “<span lang=EN-US style='mso-ansi-language:EN-US'>R</span>”, проведенной
на ДВУХ таблицах – <span lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span><span
lang=EN-US> </span>и <span lang=EN-US style='mso-ansi-language:EN-US'>QSTORNED</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Пробные запуски вариантов теста, реализующего этот метод,
показали кардинальное уменьшение числа лок-конфликтов (по ряду операций – почти
до нуля, по некоторым другим – уменьшение на порядок).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Поскольку <i style='mso-bidi-font-style:normal'>количества</i>
в тесте генерируются всегда в виде целых чисел, можно не задумываться о том,
что делать с дробями, которых нет. А ввиду того, что в <span lang=EN-US
style='mso-ansi-language:EN-US'>OLTP</span>-системах документы редко содержат строки
с количествами более 500, можно не опасаться, что такая «вертикальная
развертка» будет иметь сверхбольшое число строк.</p>

<p class=MsoNormal><span lang=EN-US style='font-size:14.0pt;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Сторнирование <span
style='background:silver;mso-highlight:silver'>стоимостей</span> – описание
алгоритма.<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal>В операциях, предусматривающих формирование новых документов
на базе содержимого (строк) существующих, стоимости определяются на основе сторнированных
<i style='mso-bidi-font-style:normal'>количеств</i>. Алгоритм сторнирования <i
style='mso-bidi-font-style:normal'>количеств</i> рассмотрен выше.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Существуют также операции, в которых:</p>

<p class=MsoNormal>1) нет строковой части документа. Это платежи от нас
поставщикам и нам от клиентов.</p>

<p class=MsoNormal>2) не меняется содержимое документа, но меняется его
состояние. Это проведение инвойсов («добавление прихода к балансу склада») и
резервов (т.е. отгрузка товара покупателю).</p>

<p class=MsoNormal>В этом разделе рассматриваются именно эти два вида операций.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Платежи и «проведение» имеют особенность: каждое из этих
действий может сторнировать стоимость своего «противника», полностью или
частично, да еще с чередованием во времени.</p>

<p class=MsoNormal>Например, клиент заплатил нам аванс в размере 20000. Далее
мы ему отгрузили товар на 12000 – это означает, что мы отгрузкой сторнируем
ранее полученный от него аванс. Затем мы отгрузили ему еще товара, уже на
15000. Сторнировать аванс в этом случае мы сможем только 8000 – т.е. то, что от
него осталось в результате предыдущей отгрузки. Сумма 7000 останется несторнированной
– это будет долг клиента. Затем клиент перечисляет нам еще 10000, но у него был
перед этим долг 7000. Следовательно, часть этого платежа будет сразу
сторнирована имевшимся долгом, а оставшаяся часть (3000) будет «ждать», когда
её сторнируют будущие реализации товара клиенту.</p>

<p class=MsoNormal>Возможна и обратная ситуация: сначала мы выполнили
«проведение резерва» на 25000 и у клиента возник такой же по размеру долг.
Затем он перечислил несколько платежей: 8000, 10000 и 7000 – и все они
сторнировали возникшую ранее задолженность.</p>

<p class=MsoNormal>При сторнировании <i style='mso-bidi-font-style:normal'>количеств,</i>
в документе вида «Б» не может оказаться количества, превышающего сумму
сторнирования количеств документа вида «А». Если произошёл лок-конфликт, то в
документе «Б» вместо желаемого количества окажется только возможное «на
сейчас».</p>

<p class=MsoNormal>Но при операциях платежей и «проведения» документов вполне
допускаются ситуации, когда сторнирование хотя и должно было произойти, но не
выполнилось из-за лок-конфликтов. Это просто означает, что оно будет проведено
по тому же принципу <span lang=EN-US style='mso-ansi-language:EN-US'>FIFO</span>
в следующий раз, когда нужная строка будет доступна для блокировки.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Стоимости могут быть дробными, к тому же их значения могут
быть весьма большими. Поэтому прямой перенос того же метода, что применяется
для сторнирования количеств, тут недопустим.<span style='mso-spacerun:yes'> 
</span>Однако, «вертикальную развёртку» всё-таки можно сделать и в этом случае.
При этом, в таблицах, выступающих аналогами к вышеописанным <span lang=EN-US
style='mso-ansi-language:EN-US'>QDISTR</span> &amp; <span lang=EN-US
style='mso-ansi-language:EN-US'>QSTORNED</span>, нужно хранить <i
style='mso-bidi-font-style:normal'>части</i> от исходной величины (т.е.
значения, в сумме равные исходной стоимости). Кроме того, количество таких
частей должно быть ограничено, иначе получим обчень большое число строк в
«развёртке».</p>

<p class=MsoNormal>Для реализации этой идеи было принято решение «дробить»
стоимость на некоторое небольшое число, и это число будет в итоге равно
количеству строк в «развёртке». </p>

<p class=MsoNormal>Правила для всех операций, где стоимость необходимо
сторнировать (и, следовательно, делать её «развёртку»), записаны в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>RULES</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>FOR</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>PDISTR</span>. Целочисленное поле ROWS_TO_MULTIPLY этой таблицы содержит
то число строк, которое должно оказаться в «развёртке» при вводе стоимости в
строку документа. На момент написания этого текста это число во всех случаях
равно 10. <span style='mso-spacerun:yes'> </span></p>

<p class=MsoNormal>Если деление стоимости на 10 есть число, не кратное 100, то
оно округляется с точностью «минус 2» (<span lang=EN-US style='mso-ansi-language:
EN-US'>round</span>(…, -2)) и полученный результат является той «гранулой»,
которая далее будет считаться минимально доступной частью стоимости для
сторнирования. «Развёртка» будет выполняться до тех пор, пока сумма таких
«гранул» не превысит исходную стоимость. Последняя из добавленных строк будет откорректирована
так, чтобы общая сумма стоимостей в «гранулах» в итоге точно сравнялась с
исходной.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Кроме того, если в строковую часть документа вводится
стоимость, меньшая 1000, то никакого её «дробления» не происходит. Этот порог
(1000) можно изменить, если записать в таблицу настроек (<span lang=EN-US
style='mso-ansi-language:EN-US'>settings</span>) новое значение в поле <span
lang=EN-US style='mso-ansi-language:EN-US'>svalue</span> для <span lang=EN-US
style='mso-ansi-language:EN-US'>working</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>mode</span>=’<span lang=EN-US style='mso-ansi-language:
EN-US'>COMMON</span>’ и mcode = ‘C_MIN_COST_TO_BE_SPLITTED’</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Примеры. </p>

<p class=MsoNormal>1) При вводе в строку документа изделия со стоимостью 1000 и
меньше в таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span>
будет добавлена только одна строка, и в ней будет записано то же самое значение
стоимости.</p>

<p class=MsoNormal>2) При вводе в строку документа изделия со стоимостью 1234 в
таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span> будет
добавлено одиннадцать строк: десять со значением 120, последняя – сначала
получит тоже ззначение 120, но затем оно будет заменено на 34. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Таблица, хранящая <i style='mso-bidi-font-style:normal'>части</i>
стоимостей, <i style='mso-bidi-font-style:normal'>ожидающие</i> своего
сторнирования, называется <span lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span>.</p>

<p class=MsoNormal>Таблица, в которую попадают результаты <i style='mso-bidi-font-style:
normal'>проведенного</i> сторнирования стоимостей, называется <span lang=EN-US
style='mso-ansi-language:EN-US'>PSTORNED</span>.</p>

<p class=MsoNormal>Всё остальное выполняется аналогично сторнированию <i
style='mso-bidi-font-style:normal'>количеств</i> (см предыдущий параграф).
Коннекты, которым надо одновременно сторнировать стоимость с одной и той же
позиции документа, будут пытаться «набрать» нужную стоимость, блокируя записи с
«гранулами» в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span>.
Если какие-то «гранулы» оказались заняты конкурентами, то исключение <span
lang=EN-US style='mso-ansi-language:EN-US'>lock</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>conflict</span><span lang=EN-US> </span><i
style='mso-bidi-font-style:normal'>подавляется</i> и делается переход к
следующей «грануле» (внутри группы строк, относящихся к <i style='mso-bidi-font-style:
normal'>этой же</i> стоимости). Если не удалось заблокировать вообще не одной
строки из группы, то сторнирование считается не проведенным, однако это НЕ
вызывает исключения (как было указано выше).</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:14.0pt;mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>Краткое описание реализации<o:p></o:p></span></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Назначения таблиц<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Заголовки документов всех видов хранятся в таблице <b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>_</b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>list</span></b>, а их данные – в таблице <b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>_</b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>data</span></b> (исключение – документы оплат,
где есть только заголовок). </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Виды документов собраны в справочнике <b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>optypes</span></b>
(«типы операций»). Помимо полей, задающих саму операцию (<span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span>, мнемокод и полное название), в этой
же таблице хранятся знаки-множители (+1, 0 или -1), которые показывают, как
данная операция влияет на соответствующий остаток.</p>

<p class=MsoNormal>Поля с этими множителями имеют префикс ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>M</span>_’, за которым следует мнемоническое
обозначение вида остатка, подверженного изменению при выполнении этой операции
(‘<span lang=EN-US style='mso-ansi-language:EN-US'>M</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>QTY</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>CLO</span>’ – знак изменения остатка «В заказах клиентов»; ‘<span
lang=EN-US style='mso-ansi-language:EN-US'>M</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>QTY</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>SUP</span> знак изменения остатка «В заказах поставщику» и т.п.).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Таблица <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>list</span> имеет внешний ключ на таблицу
<span lang=EN-US style='mso-ansi-language:EN-US'>optypes</span> по полю <span
lang=EN-US style='mso-ansi-language:EN-US'>optype</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>.</p>

<p class=MsoNormal>Таблица <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>data</span><span lang=EN-US> </span>имеет
такое же поле (<span lang=EN-US style='mso-ansi-language:EN-US'>optype</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>). Эта денормализация была
необходима для ускорения алгоритма поиска случайного <span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span> документа заданного типа.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Каждый документ проходит три состояния: «открыт» (т.е.
доступен для дальнейших изменений), «зафиксирован» (доступно только
распределение оплат этого документа) и «закрыт». Переход по состояниям «вперёд»
(от открытого к закрытому) происходит при вызове процедур, формирующих
документы этого типа, а также связанные с ними документы. Например, при
«проведении резерва» документ переходит из состотяния «Открыт» в
«Зафиксирован», а когда на этом резерве отразятся его оплаты и сумма их станет
равной сумме розницы – документ станет «Закрытым».</p>

<p class=MsoNormal>Переход по состояниям «назад» возможен только при отмене
ранее проведенных операций.</p>

<p class=MsoNormal>Справочник состояний – таблица <b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>states</span></b>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В каждом документе всегда существует контрагент. Подавляющее
большинство контрагентов – это обычные розничные клиенты (заказчики).
Существует также специальный заказчик, который обозначает «нашу фирму». Его
особенность в том, что когда выполняется проведение инвойса от поставщика, то
изделия, относящиеся к «нашим» заказам, не должны резервироваться. Вместо этого
они должны оставаться в свободном остатке для дальнейших продаж. В тесте «нашей
фирмой» является контрагент с именем “<span lang=EN-US style='mso-ansi-language:
EN-US'>Firebird</span><span lang=EN-US> </span><span lang=EN-US
style='mso-ansi-language:EN-US'>Foundation</span>”.</p>

<p class=MsoNormal>Остальные контрагенты – это «поставщики».</p>

<p class=MsoNormal>Соотношение между числами контрагентов-поставщиков и
контрагентов-покупателей указывается в скрипте загрузки начальных данных <span
lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>data</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>filling</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>sql</span>,
вот фрагмент из него:</p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>insert into
agents(name,is_customer,is_supplier)<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>  </span>values(
:v_name, iif( :r &lt; 0.93, 1, 0), iif( :r &lt; 0.93, 0, 1) );<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Контрагенты хранятся в справочнике ‘<b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>agents</span></b>’.
Помимо <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span
lang=EN-US> </span>и имени, для контрагента задается один из трёх «флагов» (<span
lang=EN-US style='mso-ansi-language:EN-US'>smallint</span>): <span lang=EN-US
style='mso-ansi-language:EN-US'>is</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>customer</span>, <span lang=EN-US style='mso-ansi-language:EN-US'>is</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>supplier</span><span lang=EN-US> </span>и
<span lang=EN-US style='mso-ansi-language:EN-US'>is</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>our</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>firm</span>. Этот справочник (и значения флагов в качестве <span
lang=EN-US style='mso-ansi-language:EN-US'>where</span>-фильтра) используется при
выборе случайного заказчика / поставщика, когда создается новый документ.<span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Таблица <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>list</span><span lang=EN-US> </span>имеет
внешний ключ на таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>agents</span><span
lang=EN-US> </span>по полю <span lang=EN-US style='mso-ansi-language:EN-US'>agent</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Любая операция, приводящая к изменению количественного
остатка (любого вида: «в заказах клиентов», «в заказах поставщику» и проч.),
отражается <span lang=EN-US style='mso-ansi-language:EN-US'>SQL</span>-командой
<span lang=EN-US style='mso-ansi-language:EN-US'>INSERT</span> (и <i
style='mso-bidi-font-style:normal'>только</i> <i style='mso-bidi-font-style:
normal'>этой</i> командой) в накопительный лог – таблицу <b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>turnover</span>_</b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>log</span></b>. </p>

<p class=MsoNormal>Любой из работающих коннектов, который может временно
заблокировать специальную семафорную строку (в таблице ‘<b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>semaphores</span></b>’),
будет проводить сборку оборотов и обновит сводный регистр количественных
остатков – таблицу <b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>.</b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Любая операция, приводящая к изменению стоимостного баланса
контрагента (списание изделий заказчика; оприходование изделий поставщика; все
виды платежей), отражается <span lang=EN-US style='mso-ansi-language:EN-US'>SQL</span>-командой
<span lang=EN-US style='mso-ansi-language:EN-US'>INSERT</span> (и <i
style='mso-bidi-font-style:normal'>только</i> <i style='mso-bidi-font-style:
normal'>этой</i> командой) в накопительный лог – таблицу <b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>money</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>turnover</span>_</b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>log</span></b>.<span
style='mso-spacerun:yes'>  </span><span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>По аналогии с <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span>, любой коннект, который
сможет заблокировать семафорную строку, проведёт сборку этих оборотов и обновит
сводный регистр <i style='mso-bidi-font-style:normal'>стоимостных</i> остатков
на балансах – таблицу <b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>money</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span></b>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Таким обр., таблицы <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span><span
style='mso-spacerun:yes'>  </span><span style='mso-spacerun:yes'> </span>и <span
lang=EN-US style='mso-ansi-language:EN-US'>money</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span> наполняются только через <span
lang=EN-US style='mso-ansi-language:EN-US'>INSERT</span>-команды, а доступ к
таблицам <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span><span lang=EN-US> </span>и
<span lang=EN-US style='mso-ansi-language:EN-US'>money</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span> сериализован, причём <span
lang=EN-US style='mso-ansi-language:EN-US'>lock</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>conflict</span> из-за семафора НЕ
приводит к завершению скрипта, выполняемого коннектом: он «молча» подавляет
исключение и переходит к следующему заданию.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Выбор изделий для клиентского заказа является первой
операцией, с которой начинается документооборот. Этот выбор осуществляется из
таблицы ‘<b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>wares</span></b>’, число строк в которой
фиксировано (НЕ увеличивается с течением времени работы теста). Задание числа
строк в этой таблице производится <i style='mso-bidi-font-style:normal'>перед</i>
стартом теста. В специальном скрипте (<span lang=EN-US style='mso-ansi-language:
EN-US'>oltp</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>main</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>filling</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>sql</span>), формирующем эту таблицу и
справочники, задается строка для таблицы настроек:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>insert into
settings(mcode,<span style='mso-spacerun:yes'>  </span>svalue)
values('C_WARES_MAX_ID',<span style='mso-spacerun:yes'>  </span>'NNNN');<o:p></o:p></span></p>

<p class=MsoNormal>(где <span lang=EN-US style='mso-ansi-language:EN-US'>NNNN</span>
=<span style='mso-spacerun:yes'>  </span>число строк, которые надо
сгенерировать в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>wares</span>).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Создание<span style='mso-spacerun:yes'>  </span>новых
документов, содержащих изделия, осуществляется методом формирования «корзины»,
в которую попадают строки, случайно выбранные либо из таблицы <span lang=EN-US
style='mso-ansi-language:EN-US'>wares</span> (только для клиентских заказов),
либо взятые из доступного остатка для данного вида документа (для заказа
поставщику, инвойса на основе заказов поставщику и резерва по свободному остатку).
</p>

<p class=MsoNormal>«Корзиной» в тесте является таблица <b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>$</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>shopping</span>_</b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>cart</span></b> – это <span
lang=EN-US style='mso-ansi-language:EN-US'>GTT</span> с признаком <span
lang=EN-US style='mso-ansi-language:EN-US'>on</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>commit</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>delete</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>rows</span>. В корзину помещаются
выбранные случайным образом <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>
изделий и затребованные количества.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Затребованное количество вовсе не обязательно должно быть в
наличии. Когда начнётся реальная обработка изделий из корзины, алгоритм будет
исключать из корзины отсутствующие в наличии <span lang=EN-US style='mso-ansi-language:
EN-US'>ID</span>. Для остальных изделий в документ будет помещен результат <span
lang=EN-US style='mso-ansi-language:EN-US'>minvalue</span>() от имеющегося
остатка и затребованного количества.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Серьёзное влияние на производительность оказывают следующие
значения:</p>

<p class=MsoNormal>1) <span lang=EN-US style='mso-ansi-language:EN-US'>max</span><span
lang=EN-US> </span>число строк в корзине при формировании документа для <i
style='mso-bidi-font-style:normal'>розничного</i> клиента (контекстная
переменная «C_CUSTOMER_DOC_MAX_ROWS» в скрипте <span lang=EN-US
style='mso-ansi-language:EN-US'>oltp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>main</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>filling</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>sql</span>);</p>

<p class=MsoNormal>2) <span lang=EN-US style='mso-ansi-language:EN-US'>max</span><span
lang=EN-US> </span>число строк в корзине при формировании документа для <i
style='mso-bidi-font-style:normal'>поставщика </i>(контекстная переменная «C_SUPPLIER_DOC_MAX_ROWS»);<br>
3) <span lang=EN-US style='mso-ansi-language:EN-US'>max</span><span lang=EN-US>
</span>количество по изделию, указываемое в одной строке документа для <i
style='mso-bidi-font-style:normal'>розничного</i> клиента (контекстная
переменная «C_CUSTOMER_DOC_MAX_QTY»);<br>
4) <span lang=EN-US style='mso-ansi-language:EN-US'>max</span><span lang=EN-US>
</span>количество по изделию, указываемое в одной строке документа для <i
style='mso-bidi-font-style:normal'>поставщика</i> (контекстная переменная «C_CUSTOMER_DOC_MAX_QTY»);<br
style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>В сочетании с переменной «C_WARES_MAX_ID», эти 4 переменных
формируют «<b style='mso-bidi-font-weight:normal'><span style='background:silver;
mso-highlight:silver'>пакеты нагрузки</span></b>»:<span
style='mso-spacerun:yes'>  </span>разные наборы настроек, задающие малый,
средний или высокий уровень загруженности СУБД.</p>

<p class=MsoNormal>Строки, относящиеся к одному пакету нагрузки, итмеют в
таблице ‘<span lang=EN-US style='mso-ansi-language:EN-US'>settings</span>’ одно
и то же мнемоническое значение в поле working_mode.<span lang=EN-US
style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>На момент написания этого текста таких пакетов нагрузки
создано несколько: <span lang=EN-US style='mso-ansi-language:EN-US'>SMALL</span>_01,
<span lang=EN-US style='mso-ansi-language:EN-US'>SMALL</span>_02, …, <span
lang=EN-US style='mso-ansi-language:EN-US'>MEDIUM</span>_01, <span lang=EN-US
style='mso-ansi-language:EN-US'>MEDIUM</span>_02, …, <span lang=EN-US
style='mso-ansi-language:EN-US'>LARGE</span>_01, <span lang=EN-US
style='mso-ansi-language:EN-US'>LARGE</span>_02 и т.п.</p>

<p class=MsoNormal><span style='mso-spacerun:yes'> </span></p>

<p class=MsoNormal>Остальные строки в таблице ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>settings</span>’ объединены общим значением в
поле working_mode – ‘<span lang=EN-US style='mso-ansi-language:EN-US'>COMMON</span>’.
Это означает, что они являются общими для всех вариантов нагрузки.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Таблицы <span lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span>,
<span lang=EN-US style='mso-ansi-language:EN-US'>QSTORNED</span>, <span
lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span><span lang=EN-US> </span>и
<span lang=EN-US style='mso-ansi-language:EN-US'>PSTORNED</span> были описаны
выше. Они предназначены для уменьшения числа лок-конфликтов при выполнении <span
lang=EN-US style='mso-ansi-language:EN-US'>FIFO</span>-распределений ресурсов в
момент создания документов и заполнения их строковых частей.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Схема работы процедур<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Все процедуры, выполняющие «бизнес-логику», а также многие
вспомогательные процедуры, <span style='mso-spacerun:yes'> </span>реализованы
по одному шаблону:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>create or alter procedure &lt;current_unit_name&gt; (
. . . ) returns ( . . . )<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>as<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>declare
v_this varchar(31) = ‘&lt;current_unit_name&gt;’<br>
begin<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>     </span>проверить, нет ли команды остановки теста
(пустой ли сейчас файл ‘</span><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";mso-ansi-language:EN-US'>stoptest</span><span
style='font-size:10.0pt;font-family:"Courier New"'>.</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>txt</span><span
style='font-size:10.0pt;font-family:"Courier New"'>’);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>     </span>проверить, что транзакция стартовала с </span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>NO</span><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New"'>
</span><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>wait</span><span style='font-size:10.0pt;font-family:
"Courier New"'> или </span><span lang=EN-US style='font-size:10.0pt;font-family:
"Courier New";mso-ansi-language:EN-US'>LOCK</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New"'> </span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>TIMEOUT</span><span
style='font-size:10.0pt;font-family:"Courier New"'> &gt; 0;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>     </span>зарегистрировать в </span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>perf</span><span style='font-size:10.0pt;font-family:"Courier New"'>_</span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>log</span><span style='font-size:10.0pt;font-family:"Courier New"'>
начало работы :</span><span lang=EN-US style='font-size:10.0pt;font-family:
"Courier New";mso-ansi-language:EN-US'>v</span><span style='font-size:10.0pt;
font-family:"Courier New"'>_</span><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";mso-ansi-language:EN-US'>this</span><span
style='font-size:10.0pt;font-family:"Courier New"'>;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>     </span>&lt; . . </span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>.</span><span
style='font-size:10.0pt;font-family:"Courier New"'>выполнить основную задачу .
. .&gt;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>   </span><span
style='mso-spacerun:yes'>  </span>зарегистрировать в </span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>perf</span><span
style='font-size:10.0pt;font-family:"Courier New"'>_</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>log</span><span
style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><i style='mso-bidi-font-style:normal'>успешное</i>
окончание работы :</span><span lang=EN-US style='font-size:10.0pt;font-family:
"Courier New";mso-ansi-language:EN-US'>v</span><span style='font-size:10.0pt;
font-family:"Courier New"'>_</span><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";mso-ansi-language:EN-US'>this</span><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>     </span>вернуть</span><span style='font-size:10.0pt;
font-family:"Courier New";mso-ansi-language:EN-US'> </span><span
style='font-size:10.0pt;font-family:"Courier New"'>набор</span><span
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'> </span><span
style='font-size:10.0pt;font-family:"Courier New"'>данных</span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'> (for select from … into … do suspend;)<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>when</span><span style='font-size:10.0pt;font-family:
"Courier New"'><span style='mso-spacerun:yes'>  </span></span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>any</span><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>     </span>зарегистрировать в </span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>perf</span><span style='font-size:10.0pt;font-family:"Courier New"'>_</span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>log</span><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New"'>
</span><i style='mso-bidi-font-style:normal'><span style='font-size:10.0pt;
font-family:"Courier New"'>аварийное</span></i><span style='font-size:10.0pt;
font-family:"Courier New"'> завершение работы <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>     </span>модуля :</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>v</span><span
style='font-size:10.0pt;font-family:"Courier New"'>_</span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>this</span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New"'> </span><span
style='font-size:10.0pt;font-family:"Courier New"'>(с указанием </span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>gdscode</span><span style='font-size:10.0pt;font-family:"Courier New"'>);<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>     </span>если исключение отсносится к нарушению </span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>check</span><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New"'>
</span><span style='font-size:10.0pt;font-family:"Courier New"'>или </span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>unique</span><span style='font-size:10.0pt;font-family:"Courier New"'>
органичения, <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>       </span>то вызвать процедуру, останавливающую
тест и сбрасывающую «грязные»<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span>данные во вспомогательные «</span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>Z</span><span style='font-size:10.0pt;font-family:"Courier New"'>»-таблицы
для возможного анализа;<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>     </span></span><span lang=EN-US style='font-size:
10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'>exception;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>end</span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В итоге, по каждому выполнению можно видеть его
длительность, было ли оно завершено успешно или аварийно, и с каким кодом.
Анализ данных таблицы <b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>log</span><span
lang=EN-US> </span></b>позволил выявить большое количество ошибок в алгоритмах,
а также узких мест по производительности.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Вспомогательной для этих логов таблицей является ‘<span
lang=EN-US style='mso-ansi-language:EN-US'>fb</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>errors</span>’ – справочник стандартных ошибок <span
lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Реализация выбора “случайного
</b><b style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>ID</span>”.<o:p></o:p></b></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Деятельность обычных пользователей носит случайный
характер.<span style='mso-spacerun:yes'>  </span>Имитация этой деятельности
коннектами-роботами оказалась нетривиальной задачей. Основная трудность здесь
возникла в обеспечении случайного разброса значений <span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span>, которые надо «взять в обработку», при
неравномерном (перекошенном) распределении данных. Кроме того, непросто
обеспечить приемлемую скорость такой выборки.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В связи с тем, что в одной таблице хранятся документы разных
видов, особого внимания потребовала реализация эффективного алгоритма выбора
случайного <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span
lang=EN-US> </span>из некоторого диапазона для последующей его обработки. Причём,
диапазон этот меняется достаточно быстро: с каждым <span lang=EN-US
style='mso-ansi-language:EN-US'>commit</span>’ом появляются сотни<span
style='mso-spacerun:yes'>  </span>новых строк, «теряют актуальность» такой же
порядок ранее занесенных.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Производительность реализации вида <span lang=EN-US
style='mso-ansi-language:EN-US'>select</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>from</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>T</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>where</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span> &gt;= :<span lang=EN-US
style='mso-ansi-language:EN-US'>random</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>order</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>by</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>rows</span> 1 сводится к быстроте
определения аргумента (:<span lang=EN-US style='mso-ansi-language:EN-US'>random</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>), относящегося к заранее
выбранному типу строк (т.е. только среди строк клиентских заказов; только среди
строк заказов поставщику, и т.п.). </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Аргумент :<span lang=EN-US style='mso-ansi-language:EN-US'>random</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span> должен учитывать лимиты <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span> (<span lang=EN-US
style='mso-ansi-language:EN-US'>min</span> &amp; <span lang=EN-US
style='mso-ansi-language:EN-US'>max</span>) для вышеперечисленных примеров,
иначе поиск такого случайного <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span
lang=EN-US> </span>будет выполняться недопустимо долго, т.к. придется делать
напрасный перебор еще и среди «неподходящих» типов.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Очевидно, что для поиска <span lang=EN-US style='mso-ansi-language:
EN-US'>min</span><span lang=EN-US> </span>и <span lang=EN-US style='mso-ansi-language:
EN-US'>max</span><span lang=EN-US> </span>значений <span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span><span lang=EN-US> </span>нужны <span
lang=EN-US style='mso-ansi-language:EN-US'>ascend</span> и <span lang=EN-US
style='mso-ansi-language:EN-US'>descend</span>-индексы (первый чаще всего уже
есть – это, например, индекс первичного ключа; второй надо создавать специально
для этих целей). </p>

<p class=MsoNormal>В режимах формирования документов таблица-«корзина»
заполняется несколькими десятками строк с разными <span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span>. При работе <span lang=EN-US
style='mso-ansi-language:EN-US'>SNAPSHOT</span>-транзакции нет смысла
определять <span lang=EN-US style='mso-ansi-language:EN-US'>max</span>-значение
диапазона для каждого изделия – достаточно это сделать только для первого из
«корзины». Все изменения с момента старта такой транзакции, сделанные
конкурентами, всё равно ей не видны (даже зафиксированные, ибо мы работаем
только с <span lang=EN-US style='mso-ansi-language:EN-US'>TIL</span> = <span
lang=EN-US style='mso-ansi-language:EN-US'>SNAPSHOT</span>).</p>

<p class=MsoNormal>Это означает, что при формировании «корзины» достаточно
запомнить в контекстной переменной из пространства имен ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>USER</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>TRANSACTION</span>’ оба лимита (<span lang=EN-US style='mso-ansi-language:
EN-US'>min</span> &amp; <span lang=EN-US style='mso-ansi-language:EN-US'>max</span>)
и далее уже использовать эти значения вместо повторного вызова затратных <span
lang=EN-US style='mso-ansi-language:EN-US'>SQL</span>-выражений.<span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Но для разных видов документов требуется проводить поиск по
разным критериям. Чтобы избежать создание нескольких модулей, выполняющих одну
и туже задачу: выборку <span lang=EN-US style='mso-ansi-language:EN-US'>min</span>
&amp; <span lang=EN-US style='mso-ansi-language:EN-US'>max</span><span
lang=EN-US> </span>из разных «источников», а затем генерацию и поиск первого <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span lang=EN-US> </span>&gt;=
:<span lang=EN-US style='mso-ansi-language:EN-US'>random</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>, было решено создать
функцию, которая принимает в качестве аргументов: </p>

<p class=MsoNormal>1) имя хранимого запроса (<span lang=EN-US style='mso-ansi-language:
EN-US'>view</span>), в котором будет проводиться запрос вида:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>    </span>select ID from T where ID &gt;= :random_id order
by ID rows 1;<o:p></o:p></span></p>

<p class=MsoNormal>2) имя <span lang=EN-US style='mso-ansi-language:EN-US'>view</span>,
в котором (при необходимости, только для первого изделия с момента старта
транзакции) будет искаться нижний лимит диапазона, т.е. <span lang=EN-US
style='mso-ansi-language:EN-US'>min</span>;</p>

<p class=MsoNormal>3) имя <span lang=EN-US style='mso-ansi-language:EN-US'>view</span>,
в котором (аналогично предыдущему) будет искаться верхний лимит, т.е. <span
lang=EN-US style='mso-ansi-language:EN-US'>max</span>.</p>

<p class=MsoNormal>4) еще одним аргументом передается признак, играющий роль <span
lang=EN-US style='mso-ansi-language:EN-US'>boolean</span>-флага: поднимать ли
исключение, если <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span> так
и не будет найден;</p>

<p class=MsoNormal>5) возможно ли в генерируемом выражении для поиска <i
style='mso-bidi-font-style:normal'>пропуск</i> фразы ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>ORDER</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>BY</span>’. В промежуточных
вариантах теста рассматривалась возможность пропуска этой фразы в виду того,
что выбранный <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span> в
дальнейшем будет удалён из диапазона, в котором он искался (так построена
логика работы теста). Сейчас этот аргумент оставлен, но он всегда равен 0, т.е.
фраза ‘<span lang=EN-US style='mso-ansi-language:EN-US'>ORDER</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>BY</span>’
добавляется всегда;</p>

<p class=MsoNormal>6) генерировать ли выражение для поиска так, чтобы он
проводился в убывающем индексе (т.е. вместо <span lang=EN-US style='mso-ansi-language:
EN-US'>select</span> … <span lang=EN-US style='mso-ansi-language:EN-US'>from</span>
… <span lang=EN-US style='mso-ansi-language:EN-US'>where</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>id</span><span
lang=EN-US> </span><i style='mso-bidi-font-style:normal'><span
style='font-family:"Courier New"'>&gt;=</span></i> :<span lang=EN-US
style='mso-ansi-language:EN-US'>random</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>order</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>by</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>id</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>rows</span> 1 будет сгенерировано
выражение вида: <span lang=EN-US style='mso-ansi-language:EN-US'>select</span>
… <span lang=EN-US style='mso-ansi-language:EN-US'>from</span> … <span
lang=EN-US style='mso-ansi-language:EN-US'>where</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>id</span><span lang=EN-US> </span><b
style='mso-bidi-font-weight:normal'><i style='mso-bidi-font-style:normal'><span
style='font-family:"Courier New"'>&lt;=</span></i></b><b style='mso-bidi-font-weight:
normal'><span style='font-family:"Courier New"'> </span></b>:<span lang=EN-US
style='mso-ansi-language:EN-US'>random</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>order</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>by</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>id</span><span lang=EN-US> </span><i
style='mso-bidi-font-style:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>desc</span></i><span lang=EN-US> </span><span lang=EN-US
style='mso-ansi-language:EN-US'>rows</span> 1). В этом случае для поиска
случайного <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span> будет
задействован тот же индекс, что и для поиска верхний лимит (<span lang=EN-US
style='mso-ansi-language:EN-US'>max</span>) – см аргумент «3)».</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Эта функция названа ‘<b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>fn</span><span style='background:silver;mso-highlight:silver'>_</span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>get</span><span style='background:
silver;mso-highlight:silver'>_</span></b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>random</span><span style='background:silver;mso-highlight:silver'>_</span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>id</span></b>’ и она используется
повсеместно для поиска “первого случайного <span lang=EN-US style='mso-ansi-language:
EN-US'>ID</span>”. Все хранимые запросы, которые ей передаются в качестве
аргументов, должны иметь поле ‘<span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>’.</p>

<p class=MsoNormal>Детальное описание этой функции см. ниже, в разделе «<b
style='mso-bidi-font-weight:normal'>Вспомогательные функции</b>».</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Кеширование
константных значений<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal>Значения идентификаторов из справочника операций и
справочника состояний документов используются так часто, что имеет смысл
сохранять их в памяти сеанса после первого прочтения.</p>

<p class=MsoNormal>Эксперименты показали, что вызов <span lang=EN-US
style='mso-ansi-language:EN-US'>deterministic</span>-функции выполняется
значительно быстрее, чем вызов <span lang=EN-US style='mso-ansi-language:EN-US'>rdb</span>$<span
lang=EN-US style='mso-ansi-language:EN-US'>get</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>context</span>(). К сожалению, на сегодня <span
lang=EN-US style='mso-ansi-language:EN-US'>deterministic</span>-функции могут
работать как кеш только при отсутствии параметров (<a
href="http://tracker.firebirdsql.org/browse/CORE-4361">http://tracker.firebirdsql.org/browse/CORE-4361</a>).
Поэтому пришлось сделать на каждый вид документа и на каждый вид статуса
отдельную <span lang=EN-US style='background:silver;mso-highlight:silver;
mso-ansi-language:EN-US'>deterministic</span>-функцию.</p>

<p class=MsoNormal>Все такие функции, возвращающие <span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span><span lang=EN-US> </span>вида
документа (т.е. <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span
lang=EN-US> </span>проводимой операции), имеют имя вида: <span lang=EN-US
style='mso-ansi-language:EN-US'>fn</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>oper</span>_*****(). Все функции, возвращающие <span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span><span lang=EN-US> </span>статута,
имеют имя вида: <span lang=EN-US style='mso-ansi-language:EN-US'>fn</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_*****_<span lang=EN-US
style='mso-ansi-language:EN-US'>state</span>().</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Проблемы при
обращении к </b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>MON</span>$-таблицам<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Первые пробные запуски теста показали, что даже при средней
нагрузке (до 25-30 коннектов) через несколько часов после начала работы теста
могут возникнуть ситуации <span lang=EN-US style='mso-ansi-language:EN-US'>deadlock</span>’ов,
приводящие к полной остановке работы коннектов. </p>

<p class=MsoNormal>Избежать таких ситуаций пока что можно только одним
способом: полностью исключить обращения к <span lang=EN-US style='mso-ansi-language:
EN-US'>MON</span>$-таблицам. <span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>В коде теста такое обращение только в одном месте – в
функции <span lang=EN-US style='mso-ansi-language:EN-US'>fn</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>get</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>stack</span>(),<span style='mso-spacerun:yes'> 
</span>возвращающей стек вызовов. Однако, эта функция НЕ будет запрашивать <span
lang=EN-US style='mso-ansi-language:EN-US'>MON</span>$-таблицы, если установлен
запрет на это в виде контекстной переменной, считываемой из таблицы <span
lang=EN-US style='mso-ansi-language:EN-US'>SETTINGS</span>.</p>

<p class=MsoNormal>Настройка, запрещающая опрос <span lang=EN-US
style='mso-ansi-language:EN-US'>MON</span>$-таблиц, задаётся так:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>insert into
settings(working_mode, mcode,<span style='mso-spacerun:yes'>                 
</span>svalue)<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>              </span>values('COMMON',<span
style='mso-spacerun:yes'>       </span>' ENABLE_MON_QUERY ', '<b
style='mso-bidi-font-weight:normal'><span style='background:silver;mso-highlight:
silver'>0</span></b>');<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Замечание-1. </b>При
возникновении исключения, относящегося к нарушению <span lang=EN-US
style='mso-ansi-language:EN-US'>check</span>- <span lang=EN-US
style='mso-ansi-language:EN-US'>unique</span>-ограничений, а также органичений
внешнего ключа, тест выполнит код «самоостанова». При этом в текстовый файл ‘<span
lang=EN-US style='mso-ansi-language:EN-US'>stoptest</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>txt</span>’ будет записано «2» с переводом
строки (&lt;<span lang=EN-US style='mso-ansi-language:EN-US'>LF</span>&gt;), а
затем тот коннект, который получил данное исключение, всё таки произведёт
обращение к <span lang=EN-US style='mso-ansi-language:EN-US'>mon</span>-таблицам
для получения стека вызова. Остальные коннекты при этом сделать такой вызов уже
не смогут ввиду наличия непустого файла ‘<span lang=EN-US style='mso-ansi-language:
EN-US'>stoptext</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>txt</span>’.
</p>

<p class=MsoNormal>Таким образом, настройка запрещения любых вызовов <span
lang=EN-US style='mso-ansi-language:EN-US'>mon</span>$-таблиц всё-таки может
быть проигнорирована, но только в ситуации, когда тест уже подлежит остановку,
и только со стороны одного коннекта.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Замечание-2. </b>Проблема
резкого ухудшения производительности при интенсивном обращении к <span
lang=EN-US style='mso-ansi-language:EN-US'>mon</span>$-таблицам была решена в
сборках <span lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span> 3.0,
датированных после 10-08-2014.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>Детальное описание бизнес-процессов и реализующих их
процедур<o:p></o:p></span></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Описание
бизнес-процессов</b>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В тесте имитируется деятельность предприятия, работающего в
сфере приема заказов на поставку запасных частей,<span
style='mso-spacerun:yes'>  </span>передачи заказов поставщикам, оприходования
товаров, создания резервов и реализации (отгрузки) клиентам. Также реализованы
операции приема платежей от клиентов и наших платежей поставщикам.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Каждое действие, приводящее к изменению обязательств перед
клиентами или поставщиками (далее - контрагентами), отображается на документ
отдельного <b style='mso-bidi-font-weight:normal'><i style='mso-bidi-font-style:
normal'>вида</i></b>.</p>

<p class=MsoNormal>Вид документа однозначно определяет, как должны меняться
остатки изделий и балансы контрагентов.</p>

<p class=MsoNormal>Далее описаны все виды документов и то, как они влияют на
соответствующие виды остатков:</p>

<p class=MsoNormal>1) Создание клиентского заказа увеличивает остаток «В заказах
клиентов». </p>

<p class=MsoNormal>2) Создание нашего <i style='mso-bidi-font-style:normal'>заказа
поставщику</i> (на основе заказов <i style='mso-bidi-font-style:normal'>клиентов
у нас</i>) уменьшает остаток «В заказах клиентов» и на эту же величину
увеличивает остаток «В заказах поставщику».<br>
3) Поставщик присылает <i style='mso-bidi-font-style:normal'>инвойс</i> –
документ, являющийся основанием для оприходования товара. Этот инвойс
формируется поставщиком обычно на основе нескольких <i style='mso-bidi-font-style:
normal'>наших заказов</i>, отправленных ранее поставщику. Это увеличивает
остаток «Инвойсы от поставщика» и уменьшает на этот же объем остаток «В заказах
поставщику».</p>

<p class=MsoNormal>4) Мы выполняем «проведение инвойса», т.е. добавляем его
содержимое к балансу склада. Это означает, что мы увеличиваем остаток «Доступно
для продаж» и уменьшаем остаток «Инвойсы от поставщика». Также это означает,
что увеличивается наша задолженность по оплате этого инвойса перед поставщиком.</p>

<p class=MsoNormal>5) После того, как изделие будет добавлено на склад (см. п.
4)), необходимо проверить, нужно ли его зарезервировать под клиента, который
ранее его заказывал. Создание резерва уменьшает остаток «Доступно» и
увеличивает остаток «В резервах»</p>

<p class=MsoNormal>6) Проведение этого резерва кассиром уменьшает остаток «В
резервах» и увеличивает общий итоге в графе «Реализация», а также увеличивает
задолженность контрагента на сумму реализации. </p>

<p class=MsoNormal>7) Клиент может оплатить либо конкретные счета по созданным ранее
отгрузкам товара, либо сделать предоплату (аванс). В последнем случае этот
аванс будет сторнироваться при отгрузке ему товара, т.е. при создании отгрузок <i
style='mso-bidi-font-style:normal'>после</i> этой оплаты.</p>

<p class=MsoNormal>8) Аналогично пункту 7, мы можем оплатить поставщику товар
либо по фактически полученным и проведенным инвойсам, либо сделать аванс, и
тогода его надо будет сторнировать при последующих поступлениях от поставщика.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Процедуры прямого
действия и отмены<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Различаются процедуры прямого и отменяющего действия.</p>

<p class=MsoNormal>Процедуры прямого действия служат для достижения конечных
целей предприятия – получение прибыли и уменьшение задолженностей контрагентов
перед нами или нас перед контрагентами. Примеры: создание нового заказа
клиента, оприходование инвойса, создание резерва, списание товара, ввод оплаты
(от покупателя или от нас поставщику).</p>

<p class=MsoNormal>Процедуры отменяющего действия вызываются в случае, когда
приходится аннулировать результат «прямых» процедур (обычно - по независящим от
нас обстоятельствам). Примеры: отмена заказа клиента, отмена оприходованного
ранее инвойса, отмена списания, отмена ранее введенной оплаты.</p>

<p class=MsoNormal>На практике, после отмены чаще всего происходит небольшая
корректировка документа, которая ранее (в предыдущем его статусе) была
недоступна и затем снова применяется «прямая» процедура, т.е. документ снова
переводится в прежний статус. Отмены происходят редко. Самые частые из них –
обусловлены отказами клиентов от своих заказов, т.е. обычно это происходит на
самой ранеей стадии «жизненного пути» документа.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Далее приведено описание сначала процедур прямого действия,
затем процедур-отмен.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Процедуры прямого
действия</b>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>1.</b> <b
style='mso-bidi-font-weight:normal'>Заказ клиента</b> на поставку изделий (<span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span lang=EN-US> </span>операции
возвращается функцией с именем <span style='mso-spacerun:yes'> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>fn</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>oper</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>order</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>by</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>customer</span>()).</p>

<p class=MsoNormal>Реализующая<span style='mso-ansi-language:EN-US'> </span>ХП<span
lang=EN-US style='mso-ansi-language:EN-US'>: sp_client_order.<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Из представления <span lang=EN-US style='mso-ansi-language:
EN-US'>v</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>all</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>customers</span><span lang=EN-US> </span>случайным
образом выбирается контрагент-покупатель. Для примерно 20% заказов таким
покупателем назначается «наша фирма», т.е. считается, что заказ создается для
пополнения собственных запасов склада (для ведения розничных продаж без
предварительного заказа на поставку).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Из справочника прайс-листа (представление <span lang=EN-US
style='mso-ansi-language:EN-US'>v</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>all</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>wares</span>)
случайным образом выбираются <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>
изделий, число которых ограничено контекстной переменной <span lang=EN-US
style='mso-ansi-language:EN-US'>C</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>CUSTOMER</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>DOC</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>MAX</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>ROWS</span>. Эти <span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span> и количества добавляются в «корзину»
(<span lang=EN-US style='mso-ansi-language:EN-US'>GTT</span>-таблица <span
lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>$<span lang=EN-US
style='mso-ansi-language:EN-US'>shopping</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>cart</span>), после чего происходит:</p>

<p class=MsoNormal>1. создание заголовка нового документа (добавление записи в
таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>list</span> – см вызов ХП <span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>add</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>list</span>);</p>

<p class=MsoNormal>2. добавление в цикле строк в <span lang=EN-US
style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>data</span> - таблицу-детализацию <span lang=EN-US style='mso-ansi-language:
EN-US'>(</span>см<span style='mso-ansi-language:EN-US'> </span>вызовы<span
style='mso-ansi-language:EN-US'> <span lang=EN-US>sp_add_doc_data);<o:p></o:p></span></span></p>

<p class=MsoNormal>3. срабатывание триггера <span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>data</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>aiud</span>, который добавляет
запись в журнал изменений остатков <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span>.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>В итоге выполнения этой ХП будет сформирован документ –
клиентский заказ, а в журнале оборотов по изделиям появятся новые записи с <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span> изделий и количествами из
этого документа. Служебная ХП <span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span>, вызываемая на регулярной основе, обработает вновь
поступившие записи и пополнит таблицу <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>
результатом суммирования количеств по разряду «Заказы клиентов». Это приведет к
увеличению значений в графе <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>clo</span>, после чего эта же служебная ХП удалит ставшие ненужными (обработанные
только что) записи в <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>2</b>. Наш <b
style='mso-bidi-font-weight:normal'>заказ поставщику</b> на основе нескольких
клиентских заказов (<span lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span
lang=EN-US> </span>операции возвращается функцией с именем <span lang=EN-US
style='mso-ansi-language:EN-US'>fn</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>oper</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>order</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>for</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>supplier</span>()).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Реализующая<span style='mso-ansi-language:EN-US'> </span>ХП<span
lang=EN-US style='mso-ansi-language:EN-US'>: <b style='mso-bidi-font-weight:
normal'>sp_supplier_order</b>.<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Начало процедуры – аналогичное остальным: проверка наличия
стоп-файла, проверка того, что текущая транзакция работает либо в <span
lang=EN-US style='mso-ansi-language:EN-US'>NO</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>wait</span><span lang=EN-US> </span>либо
с <span lang=EN-US style='mso-ansi-language:EN-US'>lock</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>timeout</span> &gt; 0, и регистрация
начала выполнения в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Далее, из представления <span lang=EN-US style='mso-ansi-language:
EN-US'>v</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>all</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>suppliers</span> случайным образом
выбирается контрагент-поставщик.</p>

<p class=MsoNormal>Из представления v_qdistr_clo_ord производится выбор
случайного <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span> изделия,
относящегося к какому-либо клиентскому заказу и еще НЕ заказанного у поставщика
в полном объеме. Этот <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>
добавляется в «корзину» <span lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>$<span
lang=EN-US style='mso-ansi-language:EN-US'>shopping</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>cart</span>. </p>

<p class=MsoNormal>Название представления для выбора случайного <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span>: v_qdistr_clo_ord <span
style='mso-spacerun:yes'> </span>- подсказывает, что в нём есть обращение к
таблице <span lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span>, в
которой хранятся данные о ресурсах, <i style='mso-bidi-font-style:normal'>ожидающих</i>
своего сторнирования. Созданием складского заказа поставщику мы сторнируем
количества в клиентских заказах. Это означает, что из таблицы <span lang=EN-US
style='mso-ansi-language:EN-US'>QDISTR</span> в таблицу <span lang=EN-US
style='mso-ansi-language:EN-US'>QSTORNED</span><span lang=EN-US> </span>будет
перемещено такое число строк, которое равно сумме <i style='mso-bidi-font-style:
normal'>количеств</i>, помещенных в складской заказ.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Количество, которое мы заказываем у поставщика, ограничено
контекстной переменной C_SUPPLIER_DOC_MAX_QTY, а общее число строк заказа поставщику
- переменной <span lang=EN-US style='mso-ansi-language:EN-US'>C</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>SUPPLIER</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>DOC</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>MAX</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>ROWS</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Дополнительные требования к каждому изделию, которое
отбирается в заказ поставщику:</p>

<p class=MsoNormal>1) его клиентский заказ не должен быть отменён из-за отказа
покупателя. Процедура отмены кл заказа (<span lang=EN-US style='mso-ansi-language:
EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>cancel</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>client</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>order</span>) описана ниже.</p>

<p class=MsoNormal>2) сумма количеств наших предыдущих заказов <i
style='mso-bidi-font-style:normal'>поставщикам</i> этого изделия должны быть
строго меньше исходного количества заказа <i style='mso-bidi-font-style:normal'>клиента</i>
(т.е. мы не должны заказывать больше, чем у нас запрашивали сторонние клиенты
плюс то, что было нужно нам самим).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В общем случае, количество по какому-либо изделию в корзине
не будет равно точной сумме количеств из нескольких клиентских заказов.<span
style='mso-spacerun:yes'>  </span>Кроме того, алгоритм <i style='mso-bidi-font-style:
normal'>набора</i> корзины <i style='mso-bidi-font-style:normal'>не</i> должен
«знать», с какого клиентского заказа какое количество вошло в корзину. Например,
нельзя исключать, что <span style='mso-spacerun:yes'> </span>в будущем алгоритм
набора корзины будет опираться не на документы, а на какой-либо сводный регистр
(для ускорения этой операции). Поэтому алгоритм должен знать только имя
представления (<span lang=EN-US style='mso-ansi-language:EN-US'>view</span>)
или другого источника данных (ХП),<span style='mso-spacerun:yes'>  </span>из
которого он вправе делать выборку – и больше ничего.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Поэтому, после того как корзина сформирована, <span
style='mso-spacerun:yes'> </span>проводится поиск клиентских заказов, <span
style='mso-spacerun:yes'> </span>количества которых необходимо сторнировать для
обеспечения количества в складском заказе. Если среди всех строк<span
style='mso-spacerun:yes'>  </span>корзины будет найдена<span
style='mso-spacerun:yes'>  </span>хотя бы одна, количество которой можно
обеспечить полностью или частично клиентским заказами, то будет создан новый
документ – заказ поставщику. В строковую часть этого документа будут помещены
все такие изделия, затребованные количества которых могут быть обеспечены
количествами из заказов клиентов, которые до сих пор еще не были заказаны (при
условии, что сами заказы не аннулированы).</p>

<p class=MsoNormal>Поиск таких сторнируемых документов проводится по принципу <span
lang=EN-US style='mso-ansi-language:EN-US'>FIFO</span> (самый старый будет
сторнирован прежде всех).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Данный набор операций (поиск сторнируемых документов для
обеспечения затребованного количества, создание заголовка документа и
заполнение его строковой части, добавление в журнал оборотов по изделиям –
таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>) - является общим еще для нескольких
операций. Поэтому он выделен в отдельную ХП - sp_<span lang=EN-US
style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>qty</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>storno</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В итоге выполнения этой ХП будет сформирован документ –
заказ-поставщику, а в журнале оборотов по изделиям появятся новые записи с <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span> изделий и количествами из
этого документа. </p>

<p class=MsoNormal>Служебная ХП <span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span>, вызываемые на регулярной основе, обработает вновь
поступившие записи и пополнит таблицу <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>
результатом суммирования количеств по разряду «Заказано у поставщика». </p>

<p class=MsoNormal>Это приведет к увеличению значений в графе <span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>ord</span>, но также – к уменьшению
на те же величины содержимого в поле <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>clo</span> (т.к. наш складской заказ был
сформирован на основе СТОРНО клиентских заказов!)</p>

<p class=MsoNormal>Затем эта же служебная ХП (<span lang=EN-US
style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>make</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>) удалит ставшие
ненужными (обработанные только что) записи в <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В завершении ХП <b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>supplier</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>order</span></b><span lang=EN-US> </span>выполняются еще две операции:</p>

<p class=MsoNormal>1) передача клиенту выборку из этого документа</p>

<p class=MsoNormal>2) регистрация завершения выполнения ХП <span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>supplier</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>order</span>
в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>3. Инвойс от
поставщика </b>на основе нескольких наших заказов (ему).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Реализующая<span style='mso-ansi-language:EN-US'> </span>ХП<span
lang=EN-US style='mso-ansi-language:EN-US'>: <b style='mso-bidi-font-weight:
normal'>sp_supplier_invoice</b>.</span><br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></p>

<p class=MsoNormal>Начало процедуры – аналогичное остальным: проверка наличия
стоп-файла, проверка того, что текущая транзакция работает либо в <span
lang=EN-US style='mso-ansi-language:EN-US'>NO</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>wait</span><span lang=EN-US> </span>либо
с <span lang=EN-US style='mso-ansi-language:EN-US'>lock</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>timeout</span> &gt; 0, и регистрация
начала выполнения в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Инвойс – это документ, являющийся «прообразом» приходной
накладной и содержащий перечень изделий, которые нам были отправлены
поставщиком. В реальной практике все инвойсы подлежат сверке с <i
style='mso-bidi-font-style:normal'>фактически</i> поступившим количеством и
последующим составлением акта разногласий.</p>

<p class=MsoNormal>Только после подтверждения акта разногласий всеми сторонами,
содержимое инвойса «добавляется» к балансу склада и считается оприходованным.</p>

<p class=MsoNormal>В этом тесте процедура акта разногласий не реализована, но
добавление инвойса к балансу склада создано как отдельный алгоритм и
выполняется отдельным вызовом. </p>

<p class=MsoNormal>Таким обр., ХП <span lang=EN-US style='mso-ansi-language:
EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>supplier</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>invoice</span> – это всего лишь
формирование «прообраза» приходной накладной, но НЕ добавление её содержимого к
балансу склада.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Из представления <span lang=EN-US style='mso-ansi-language:
EN-US'>v</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>all</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>suppliers</span> случайным образом
выбирается контрагент-поставщик.</p>

<p class=MsoNormal>Из представления v_<span lang=EN-US style='mso-ansi-language:
EN-US'>qdistr</span>_ord_<span lang=EN-US style='mso-ansi-language:EN-US'>sup</span>
производится выбор случайного <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>
изделия, относящегося к какому-либо складскому заказу, <span
style='mso-spacerun:yes'> </span>при условии, что оно еще не было поставлено по
инвойсам в полном объеме. Этот <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>
добавляется в «корзину» <span lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>$<span
lang=EN-US style='mso-ansi-language:EN-US'>shopping</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>cart</span>. </p>

<p class=MsoNormal>Количество, которое мы получаем по инвойсу поставщика,
ограничено контекстной переменной C_SUPPLIER_DOC_MAX_QTY, а общее число строк в
инвойсе – контекстной переменной <span lang=EN-US style='mso-ansi-language:
EN-US'>C</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>SUPPLIER</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>DOC</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>MAX</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>ROWS</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Далее выполняется тот же набор операций, что в документе «<b
style='mso-bidi-font-weight:normal'>2</b>. Наш <b style='mso-bidi-font-weight:
normal'>заказ поставщику</b>»: поиск для каждой строки корзины документов –
складских заказов, которыми можно обеспечить количество из корзины (<span
lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>$<span lang=EN-US
style='mso-ansi-language:EN-US'>shopping</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>cart</span>), формирование заголовка и строк
документа, добавление в журнал оборотов <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span> количества и ссылки на
вид операции.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Затем служебная ХП <span lang=EN-US style='mso-ansi-language:
EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span> обработает вновь поступившие
записи и пополнит таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span> результатом
суммирования количеств по разряду «Получено по инвойсам». </p>

<p class=MsoNormal>Это приведет к увеличению значений в графе <span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>sup</span>, но также – к уменьшению
на те же величины содержимого в поле <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>ord</span> (т.к. инвойс был сформирован на
основе СТОРНО наших складских заказов!).</p>

<p class=MsoNormal>Далее эта же служебная ХП (<span lang=EN-US
style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>make</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>) удалит ставшие
ненужными (обработанные только что) записи в <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В завершении ХП <b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>supplier</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>invoice</span></b> выполняются еще две операции:</p>

<p class=MsoNormal>1) передача клиенту выборки из этого документа</p>

<p class=MsoNormal>2) регистрация завершения выполнения ХП <span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>supplier</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>invoice</span>
в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>4. <span
style='mso-spacerun:yes'> </span>«Проведение» инвойса </b>(добавление его
содержимого к балансу склада).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Реализующая ХП: <b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>add</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>invoice</span>_</b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>to</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>stock</span></b><br
style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></p>

<p class=MsoNormal>Начало процедуры: проверка наличия стоп-файла, проверка
того, что текущая транзакция работает либо в <span lang=EN-US style='mso-ansi-language:
EN-US'>NO</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>wait</span><span lang=EN-US> </span>либо с <span lang=EN-US
style='mso-ansi-language:EN-US'>lock</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>timeout</span> &gt; 0, и регистрация начала выполнения в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Данная ХП проводит случайный выбор инвойса, который еще НЕ
был добавлен к балансу склада, из <span lang=EN-US style='mso-ansi-language:
EN-US'>view</span> v_add_invoice_to_stock. </p>

<p class=MsoNormal>Затем она выполняет операцию, в итоге которой:</p>

<p class=MsoNormal>1) все изделия инвойса считаются добавленными к свободному
остатку склада (т.е. их далее можно резервировать для последующей продажи
клиентам);</p>

<p class=MsoNormal>2) все изделия инвойса, присутствующие в неотменённых
клиентских заказах, причём в таком количестве, что по ним еще есть потребность
в резервировании, начинают автоматически попадать в новые документы – резервы
под ранее созданные клиентские заказы;</p>

<p class=MsoNormal>3) сам инвойс переходит из состояния «Открыт» в состояние
«Зафиксирован». Это означает, что его табличная часть становится недоступной
для изменений, инвойс нельзя удалить, но допускается установка связи между этим
<i style='mso-bidi-font-style:normal'>инвойсом</i> и одной или несколькими
нашими <i style='mso-bidi-font-style:normal'>оплатами</i> поставщику за
изделия.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Указанная операция называется «проведением инвойса». </p>

<p class=MsoNormal>Обратная ей операция, при которой отменяются созданные
резервы (а если они уже были закрыты и списаны – отменяются и сами списания), затем
отменяется перевод изделий в разряд доступного остатка и инвойс возвращается в
статус «Открыт», называется «ОТМЕНОЙ проведения»,</p>

<p class=MsoNormal>Если процедура <b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>add</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>invoice</span>_</b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>to</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>stock</span></b><span
style='mso-spacerun:yes'>  </span>вызывается с аргументом <span lang=EN-US
style='mso-ansi-language:EN-US'>a</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>cancel</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>mode</span>
= 1, то вместо проведения инвойса будет выполнена ОТМЕНА такого проведения.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Особенностью операции «Проведение инвойса» является то, что
исходный документ ранее уже был сформирован – это некоторый инвойс от
поставщика в статусе «Открыт». </p>

<p class=MsoNormal>Следовательно, уже нет необходимости:</p>

<p class=MsoNormal>1) искать документы - складские заказы, которые должны
сторнироваться для обеспечения количества по данному инвойсу: это было сделано
ранее, на этапе формирования самого инвойса в ХП <span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>supplier</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>invoice</span>;</p>

<p class=MsoNormal>2) добавлять что-либо в строковую часть документа: она была
сформирована также в ХП <span style='mso-spacerun:yes'> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>supplier</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invoice</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Однако, необходимо добавить в журнал <span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>turnover</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>log</span>
данные по <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span> изделий и
количеству, которое добавляется к балансу склада: это нужно сделать по смыслу
данной бизнес-операции (мы считаем, что инвойс проверен и его данные нужно
теперь отразить на доступном остатке склада).</p>

<p class=MsoNormal>Все алгоритмы намеренно сделаны так, чтобы в них не было
никакой коррекции ранее занесённых строк в журнале оборотов по изделиям –
таблице <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>.</p>

<p class=MsoNormal>Пополнение таблицы <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span><span
style='mso-spacerun:yes'>  </span>новыми строками производится только в одном
месте – в процедуре <span lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>add</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>log</span>, вызываемой из триггера <span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>list</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>aiud</span>. Эта ХП выполняет исключительно
операторы <span lang=EN-US style='mso-ansi-language:EN-US'>INSERT</span><span
lang=EN-US> </span>в журнал <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>. </p>

<p class=MsoNormal>В ХП <span lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>add</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>log</span><span lang=EN-US> </span>анализируется как значение
количества, так и вид операции, применямой к документу. </p>

<p class=MsoNormal>Количество по инвойсу остается, конечно, прежним. Поэтому
для отображения новых остатков необходимо применить к этому документу такую
операцию, которая добавит количество инвойса к доступному остатку. Эта операция
хранится в справочнике – таблице <span lang=EN-US style='mso-ansi-language:
EN-US'>optypes</span> – в виде отдельной строки и имеет код 2100, мнемоническое
обозначение <span lang=EN-US style='mso-ansi-language:EN-US'>optypes</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>mcode</span> = ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>INC</span>’. </p>

<p class=MsoNormal>Вместо кода этой операции (2100) везде прописан вызов <span
lang=EN-US style='mso-ansi-language:EN-US'>deterministic</span>-функции fn_oper_invoice_add().<span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В итоге, в результате команды: <span lang=EN-US
style='mso-ansi-language:EN-US'>update</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>data</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>set</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>optype</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span> = <span lang=EN-US style='mso-ansi-language:
EN-US'>fn</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>oper</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>invoice</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>add</span>() <span lang=EN-US style='mso-ansi-language:
EN-US'>where</span> … - будет выполнено добавление в лог <span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>turnover</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>log</span>
новых строк с количеством, записанным в строках инвойса, отражающих применение
к документу этой операции и увеличение остатка.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Служебная ХП <span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span> обработает вновь поступившие записи и пополнит таблицу <span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span> результатом суммирования количеств
по разряду «Добавлено к балансу склада по проведенным инвойсам». </p>

<p class=MsoNormal>Это приведет к увеличению значений в графе <span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>avl</span>, но также – к уменьшению
на те же величины содержимого в поле <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>sup</span>.</p>

<p class=MsoNormal>Затем эта же служебная ХП (<span lang=EN-US
style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>make</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>) удалит ставшие
ненужными (обработанные только что) записи в <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>После того, как данные инвойса отразятся на доступных
остатках изделий, ХП <b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>add</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>invoice</span>_</b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>to</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>stock</span><span
lang=EN-US> </span></b>выполнит поиск таких клиентских заказов, в которых:</p>

<p class=MsoNormal>1) имеется хотя бы одно изделие из списка оприходованных
только что;</p>

<p class=MsoNormal>2) осталась ненулевой потребность в резерве этого изделия
(т.е. еще не всё количество по нему было зарезервировано ранее).</p>

<p class=MsoNormal>Если на некоторое изделие «претендуют» сразу несколько
клиентских заказов, то приходится распределять оприходованное количество между
ними по принципу <span lang=EN-US style='mso-ansi-language:EN-US'>FIFO</span> (кл.
заказ с изделием, созданный раньше всех,<span style='mso-spacerun:yes'> 
</span>получит это изделие в резерв самым первым). Остальные клиентские заказы,
которым данное изделие не достанется, из рассмотрения исключаются.</p>

<p class=MsoNormal>В итоге, будет получен <span lang=EN-US style='mso-ansi-language:
EN-US'>distinct</span>-список документов – клиентских заказов, для которых
необходимо провести резервирование изделий, поступивших только что. </p>

<p class=MsoNormal>Из этого списка исключаются клиентские заказы, в которых
покупателем является «наша фирма», после чего алгоритм создает для каждого из
оставшихся клиентских заказов новый документ резервирования, вызывая ХП <i
style='mso-bidi-font-style:normal'>sp_customer_reserve</i> с передачей ей <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span> клиентского заказа (описание
этой ХП см ниже).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В завершении ХП <b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>add</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>invoice</span>_</b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>to</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>stock</span></b>
выполняются еще две операции:</p>

<p class=MsoNormal>1) передача клиенту выборку из этого документа</p>

<p class=MsoNormal>2) регистрация завершения выполнения ХП <span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>supplier</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>invoice</span>
в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>По окончании работы этой ХП на складе может возникнуть
свободный остаток. При ненулевом свободном остатке могут создаваться документы сразу
для розничной продажи, минуя клиентские заказы.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>5. Резервирование
изделий</b> для последующей их продажи</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Реализующая ХП: <b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>customer</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>reserve</span><o:p></o:p></b></p>

<p class=MsoNormal>Имеет<span style='mso-ansi-language:EN-US'> </span>входной<span
style='mso-ansi-language:EN-US'> </span>аргумент<span style='mso-ansi-language:
EN-US'> <span lang=EN-US>a_client_order_id default null. </span></span></p>

<p class=MsoNormal>Если он передан и не равен -1 («минус один»), то алгоритм
считает, что надо создать резерв для заранее найденного клиентского заказа, в
котором есть незарезервированные до сих пор изделия.</p>

<p class=MsoNormal>Если он НЕ передан, то алгоритм будет делать выбор
случайного <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span> документа
из списка клиентских заказов, в котором можно провести такое резервирование.</p>

<p class=MsoNormal>Если же он передан и равен -1, то алгоритм создаст резерв на
основе доступного остатка, т.е.<span style='mso-spacerun:yes'>  </span>вне
связи с каким-либо клиентским заказом.</p>

<p class=MsoNormal><br>
Эта ХП вызывается:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>1) явно – непосредственным вызовом из .<span lang=EN-US
style='mso-ansi-language:EN-US'>sql</span>-скрипта. Аргумент <span lang=EN-US
style='mso-ansi-language:EN-US'>a</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>client</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>order</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span> будет иметь значение <span
lang=EN-US style='mso-ansi-language:EN-US'>NULL</span>, что означает:
попытаться сформировать резерв прежде всего для клиентского заказа (любого из
тех, в которых есть еще хотя бы одно изделие, нуждающееся в таком резерве);
только если таких заказов нет, сформировать резерв из свободного остатка.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>2) неявно – при вызове ХП добавления инвойса к балансу
склада. В этом случае алгоритм составит список клиентских заказов, по которым
до сих пор сохраняется потребность в резервировании изделий, и вызовет эту ХП в
цикле для каждого такого клиентского заказа, с аргументом<span
style='mso-spacerun:yes'>  </span><span lang=EN-US style='mso-ansi-language:
EN-US'>a</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>client</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>order</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span> = <span lang=EN-US style='mso-ansi-language:
EN-US'>ID</span> такого кл заказа</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Начало процедуры: проверка наличия стоп-файла, проверка
того, что текущая транзакция работает либо в <span lang=EN-US style='mso-ansi-language:
EN-US'>NO</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>wait</span><span lang=EN-US> </span>либо с <span lang=EN-US
style='mso-ansi-language:EN-US'>lock</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>timeout</span> &gt; 0, и регистрация начала выполнения в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>ХП <span lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>customer</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>reserve</span> формирует сначала «корзину» (<span
lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>$<span lang=EN-US
style='mso-ansi-language:EN-US'>shopping</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>cart</span>), в которую добавляются изделия
либо из клиентского заказа (когда известен его <span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span>), <span
style='mso-spacerun:yes'> </span>либо из свободного остатка склада. </p>

<p class=MsoNormal>При резерве из свободного остатка склада число строк в
корзине ограничено контекстной переменной C_CUSTOMER_DOC_MAX_<span lang=EN-US
style='mso-ansi-language:EN-US'>ROWS</span>, а количество – переменной C_CUSTOMER_DOC_MAX_QTY.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>После формирования корзины алгоритм вызывает ХП sp_create_doc_using_fifo,
которая в данном случае ищет <i style='mso-bidi-font-style:normal'>проведенные инвойсы</i>
(т.е. в статусе «Зафиксирован» или «Закрыт»), количества которых будут
обеспечивать (своим <i style='mso-bidi-font-style:normal'>сторнированием</i>)<span
style='mso-spacerun:yes'>  </span>затребованное количество резерва из корзины.</p>

<p class=MsoNormal>Если среди всех строк<span style='mso-spacerun:yes'> 
</span>корзины будет найдена<span style='mso-spacerun:yes'>  </span>хотя бы
одна, количество которой можно обеспечить полностью или частично проведенными
инвойсами, то будет создан новый документ – резерв товара для продажи. В
строковую часть этого документа будут помещены все такие изделия, затребованные
количества которых могут быть обеспечены количествами из проведенных инвойсов.</p>

<p class=MsoNormal>При добавлении в строковую часть (в таблицу <span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>data</span>) срабатывает триггер, вызывающий
добавление строк в журнал <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>. В этих строках будет указан вид
операции и количество по каждой строке.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Служебная ХП <span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span> обработает вновь поступившие записи и пополнит таблицу <span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span> результатом суммирования количеств
по разряду «Зарезервировано для продажи». </p>

<p class=MsoNormal>Это приведет к увеличению значений в графе <span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>res</span> и к уменьшению на те же
величины содержимого в поле <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>avl</span>.</p>

<p class=MsoNormal>Затем эта же служебная ХП (<span lang=EN-US
style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>make</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>) удалит ставшие
ненужными (обработанные только что) записи в <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>6. Розничная продажа:
</b>списание товара и отражение этого на балансе покупателя</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Реализующая<span style='mso-ansi-language:EN-US'> </span>ХП<span
lang=EN-US style='mso-ansi-language:EN-US'>: <b style='mso-bidi-font-weight:
normal'>sp_reserve_write_off<o:p></o:p></b></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Начало процедуры: проверка наличия стоп-файла, проверка
того, что текущая транзакция работает либо в <span lang=EN-US style='mso-ansi-language:
EN-US'>NO</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>wait</span><span lang=EN-US> </span>либо с <span lang=EN-US
style='mso-ansi-language:EN-US'>lock</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>timeout</span> &gt; 0, и регистрация начала выполнения в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Данная ХП проводит случайный выбор документа-резерва,
который еще не был списан с баланса склада, источником для выбора служит <span
lang=EN-US style='mso-ansi-language:EN-US'>view</span> v_reserve_write_off. </p>

<p class=MsoNormal>Затем она выполняет операцию, в итоге которой:</p>

<p class=MsoNormal>1) все изделия резерва считаются списанными с баланса склада
(т.е. проданными);</p>

<p class=MsoNormal>2) сам резерв переходит из состояния «Открыт» в состояние
«Зафиксирован». Это означает, что его табличная часть становится недоступной
для изменений, его нельзя удалить, но допускается установка связи между этим <i
style='mso-bidi-font-style:normal'>резервом</i> и одной или несколькими <i
style='mso-bidi-font-style:normal'>оплатами</i> клиента за проданные изделия;</p>

<p class=MsoNormal>3) общая сумма проданных изделий (в <i style='mso-bidi-font-style:
normal'>розничных</i> ценах) отражается на задолженности покупателя,
уквеличивая её.</p>

<p class=MsoNormal>Указанная операция называется «списанием резерва». </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Особенностью операции «Списание резерва» является то, что
исходный документ ранее уже был сформирован – это некоторый резерв для
покупателя в статусе «Открыт». </p>

<p class=MsoNormal>Следовательно, уже нет необходимости:</p>

<p class=MsoNormal>1) искать документы – инвойсы от поставщика, которые должны
сторнироваться для обеспечения количества по данному резерву: это было сделано
ранее, на этапе формирования самого резерва в ХП <span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>customer</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>reserve</span>;</p>

<p class=MsoNormal>2) добавлять что-либо в строковую часть документа: она была
сформирована также в ХП <span style='mso-spacerun:yes'> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>customer</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>reserve</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Однако, необходимо добавить в журнал <span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>turnover</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>log</span>
данные по <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span> изделий и
количеству, которое списывается с баланса склада: это нужно сделать по смыслу
данной бизнес-операции (мы считаем, что изделия <i style='mso-bidi-font-style:
normal'>проданы</i> и это нужно теперь отразить на балансе склада и
покупателя).</p>

<p class=MsoNormal>Количество по документу резерва остается прежним. Поэтому
для отображения новых остатков необходимо применить к этому документу такую
операцию, которая спишет количество инвойса с баланса склада. Эта операция
хранится в справочнике – таблице <span lang=EN-US style='mso-ansi-language:
EN-US'>optypes</span> – в виде отдельной строки и имеет код 3400, мнемоническое
обозначение <span lang=EN-US style='mso-ansi-language:EN-US'>optypes</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>mcode</span> = ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>SAL</span>’. </p>

<p class=MsoNormal>Вместо кода операции (3400) везде прописан вызов <span
lang=EN-US style='mso-ansi-language:EN-US'>deterministic</span>-функции fn_oper_retail_realization().</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В итоге, в результате команды: <span lang=EN-US
style='mso-ansi-language:EN-US'>update</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>data</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>set</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>optype</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span> = fn_oper_retail_realization() <span
lang=EN-US style='mso-ansi-language:EN-US'>where</span> … будет выполнено
добавление в лог <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span> новых строк с количеством,
записанным в строках продаваемого сейчас резерва, отражающих применение к
документу этой операции и уменьшение<span style='mso-spacerun:yes'> 
</span>остатка на складе.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Служебная ХП <span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span> обработает вновь поступившие записи и пополнит таблицу <span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span> результатом суммирования количеств
по разряду «Добавлено к балансу склада по проведенным инвойсам». </p>

<p class=MsoNormal>Это приведет к уменьшению значений в графе <span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>res</span>, а также – к увеличению
СТОИМОСТНОЙ суммы оборотов- поля <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>cost</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>out</span>.</p>

<p class=MsoNormal>Затем эта же служебная ХП (<span lang=EN-US
style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>make</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>) удалит ставшие
ненужными (обработанные только что) записи в <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В завершении ХП <b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>reserve</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>write</span>_</b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>off</span></b> выполняются еще две
операции:</p>

<p class=MsoNormal>1) передача клиенту выборку из этого документа</p>

<p class=MsoNormal>2) регистрация завершения выполнения ХП <span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>supplier</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>invoice</span>
в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>По окончании работы этой ХП остаток изделия «по данным
бухучета» (поле <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>acn</span>, .<span lang=EN-US style='mso-ansi-language:EN-US'>cost</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>acn</span>) может стать нулевым. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Примечание. </p>

<p class=MsoNormal>В таблице <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span> установлен <span
lang=EN-US style='mso-ansi-language:EN-US'>check</span>: если количественный
остаток (<span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>acn</span> – поле, вычисляемое по
формуле <span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>avl</span> + <span lang=EN-US
style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>res</span>) равен нулю, то стоимостной остаток (<span lang=EN-US
style='mso-ansi-language:EN-US'>cost</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>acn</span> - поле, вычисляемое по формуле <span lang=EN-US
style='mso-ansi-language:EN-US'>cost</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>inc</span><span lang=EN-US> </span>– <span lang=EN-US style='mso-ansi-language:
EN-US'>cost</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>out</span>)
также должен быть <i style='mso-bidi-font-style:normal'>точно</i> равен нулю.
Без каких либо «почти-нулей» ввиду накопления погрешностей при вычислении
стоимости отпуска через цену закупки, умноженной на количество, меньшее чем
объем закупки, и проч. Данное требование легко обеспечивается, когда списание
товаров идёт по правилам <span lang=EN-US style='mso-ansi-language:EN-US'>FIFO</span>
/ <span lang=EN-US style='mso-ansi-language:EN-US'>LIFO</span> (но не по
средневзвешенной цене).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>7. Оплата покупателем
</b>реализованных ему изделий или предоплата </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Реализующая<span style='mso-ansi-language:EN-US'> </span>ХП<span
lang=EN-US style='mso-ansi-language:EN-US'>: <b style='mso-bidi-font-weight:
normal'>sp_pay_from_customer<o:p></o:p></b></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Начало процедуры: проверка наличия стоп-файла, проверка
того, что текущая транзакция работает либо в <span lang=EN-US style='mso-ansi-language:
EN-US'>NO</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>wait</span><span lang=EN-US> </span>либо с <span lang=EN-US
style='mso-ansi-language:EN-US'>lock</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>timeout</span> &gt; 0, и регистрация начала выполнения в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В отличие от остатков <i style='mso-bidi-font-style:normal'>изделий</i>,
остатки на балансах <i style='mso-bidi-font-style:normal'>контрагентов</i>
могут быть любого знака, что отражает их задолженность перед нами, или
наоборот. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Выбор контрагента, вычисление суммы неоплаченных им резервов
(а если их больше нет, то генерация случайного значения суммы аванса) и
создание документа<span style='mso-spacerun:yes'>  </span><i style='mso-bidi-font-style:
normal'>оплаты</i> производится вызовом ХП sp_payment_prepare.<span lang=EN-US
style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Документы оплаты хранятся в таблице <span lang=EN-US
style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>list</span>. У них отсутствует табличная часть, поэтому по ним нет
никаких строк в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>data</span>.</p>

<p class=MsoNormal>Когда вводится оплата от покупателя, то программа должна
сначала определить, не нужно ли сторнировать этой оплатой ранее возникшую задолженность
контрагента. Эта задолженность могла возникнуть при отгрузке ему товара
(процедура <span lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>write</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>off</span>,<span lang=EN-US style='mso-ansi-language:
EN-US'>&nbsp;</span>см выше), при этом в таблицу <span lang=EN-US
style='mso-ansi-language:EN-US'>PDISTR</span> добавляются строки, хранящие
части («гранулы») от общей стоимости документа реализации. При вводе оплаты
выполняется обратная операция: поиск таких строк-«гранул» и попытка их
блокировки. При успешной блокировке строка будет перенесена из таблицы <span
lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span> в таблицу <span
lang=EN-US style='mso-ansi-language:EN-US'>PSTORNED</span>, что означает
проведение сторнирования (части) ранее возникшего долга. Эта операция выполняется
процедурой <span lang=EN-US style='mso-ansi-language:EN-US'>srv_make</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>cost_storno</span>.</p>

<p class=MsoNormal>Таблицы <span lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span><span
lang=EN-US> </span>и <span lang=EN-US style='mso-ansi-language:EN-US'>PSTORNO</span>
играют роль «сообщающихся сосудов»: при проведении сторнирования записи
«переезжают» из <span lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span>
в <span lang=EN-US style='mso-ansi-language:EN-US'>PSTORNO</span>, а при отмене
– обратно.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Ввод оплат влечёт за собой добавление в журнал изменения
стоимостных оборотов по контрагентам (<span lang=EN-US style='mso-ansi-language:
EN-US'>money</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span>). Этот журнал
просматривается служебной процедурой <span lang=EN-US style='mso-ansi-language:
EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>money</span>-<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span>, которая делает «сборку» оборотов
и обновляет таблицу балансов (<span lang=EN-US style='mso-ansi-language:EN-US'>money</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>).</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>8. Наша оплата
поставщику </b>за полученные изделия или предоплата</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Реализующая<span style='mso-ansi-language:EN-US'> </span>ХП<span
lang=EN-US style='mso-ansi-language:EN-US'>: <b style='mso-bidi-font-weight:
normal'>sp_pay_to_supplier<o:p></o:p></b></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Начало процедуры: проверка наличия стоп-файла, проверка
того, что текущая транзакция работает либо в <span lang=EN-US style='mso-ansi-language:
EN-US'>NO</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>wait</span><span lang=EN-US> </span>либо с <span lang=EN-US
style='mso-ansi-language:EN-US'>lock</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>timeout</span> &gt; 0, и регистрация начала выполнения в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Всё остальное в этой ХП аналогично тому, что делается в ХП <span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>pay</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>from</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>customer</span>.
Сумма нашей оплаты распределяется по <i style='mso-bidi-font-style:normal'>закупочным</i>
стоимостям документов-инвойсов, находящихся в любом статусе, кроме «Закрыт». Распределение
выполняется по <span lang=EN-US style='mso-ansi-language:EN-US'>FIFO</span>-принципу,
сторнирование идёт через попытки установить строковые блокировки на таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span> и перенести содержимое
её строк в таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>PSTORNED.<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Процедуры отмены</b>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>1.</b> <b
style='mso-bidi-font-weight:normal'>Отмена</b> <b style='mso-bidi-font-weight:
normal'>клиентского заказа</b></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><br>
</span>Реализующая<span style='mso-ansi-language:EN-US'> </span>ХП<span
lang=EN-US style='mso-ansi-language:EN-US'>: <b style='mso-bidi-font-weight:
normal'>sp_cancel_client_order<o:p></o:p></b></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Когда менеджер отменяет ранее созданный заказ клиента, возможна
ситуация, при которой количество по к-л строке из этого заказа было
сторнировано процедурой составления нашего заказа <i style='mso-bidi-font-style:
normal'>поставщику</i>.</p>

<p class=MsoNormal>То есть, существует как минимум одна строка в нашем заказе <i
style='mso-bidi-font-style:normal'>поставщику</i>, количество в которой было
обеспечено строкой из отменяемого клиентского заказа (и, возможно, еще и
строками из других кл. заказов). </p>

<p class=MsoNormal>Заказ поставщику составляется на основе нескольких
клиентских заказов и его содержимое не меняется после того, как поставщик его
подтвердил. Это значит, что нельзя удалять клиентские заказы, на основе которых
он был составлен, т.к. иначе в строках нашего заказа поставщику потеряется
информация о том, на основе каких строк заказов клиентов они были сформированы.</p>

<p class=MsoNormal>С другой стороны, отменённый клиентский заказ должен
находиться в таком состоянии, при котором исключены любые изменения в нём.
Кроме того, он должен стать невидимым для алгоритма, создающего резерв по
итогам оприходования новых изделий («проведения инвойсов»).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Специальная ХП <span lang=EN-US style='mso-ansi-language:
EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span> при очередном просмотре журнала <span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span> добавит количества в регистр <span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span> и в результате его количество в
графе <span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>cl<b style='mso-bidi-font-weight:
normal'>r</b></span> будет увеличено на значения из отменяемого клиентского
заказа. </p>

<p class=MsoNormal>Графа <span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>clr</span> сводного регистра <span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span> может содержать значения, превышающие
<span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>clo</span>. Это будет происходить, когда часть
клиентских заказов сторнируется заказами поставщику (при этом уменьшаются
значения в <span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>clo</span>), а другая их часть –
отменяется, но без возможности удаления, т.к. ранее они уже были сторнированы
заказами поставщику.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>2.</b> <b
style='mso-bidi-font-weight:normal'>Отмена</b> <b style='mso-bidi-font-weight:
normal'>заказа поставщику</b></p>

<p class=MsoNormal><br>
Реализующая ХП: <b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>cancel</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>supplier</span>_</b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>order</span><o:p></o:p></b></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Заказ поставщику можно отменить только при условии, что нет
ни одного инвойса, в формировании количеств которого была бы задействована
любая из строк данного заказа. Другими словами – если поставщик еще не
подтвердил данный заказ каким-либо своим инвойсом.<span lang=EN-US
style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Если такие инвойсы уже есть (и возможно, что часть из них
уже «проведена»), то сначала необходимо отменять все проведения, а затем
удалять эти инвойсы. Последние две операции, в свою очередь, повлекут поиск и
отмену проведения всех реализаций, которые сторнировали инвойсы, и удаление
после этого резервов клиентов (т.к. именно они сторнируют количества в
инвойсах, а не их состояние «проведён»).</p>

<p class=MsoNormal>Формирование инвойса (ХП <span lang=EN-US style='mso-ansi-language:
EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>supplier</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>invoice</span>, см выше) идёт на
основе наших заказов поставщику, количество в строке инвойса всегда
«собирается» с одного или нескольких наших заказов по <span lang=EN-US
style='mso-ansi-language:EN-US'>FIFO</span>-принципу. Поиск складского заказа,
который можно сейчас удалить, проводится через вызов функции <span lang=EN-US
style='mso-ansi-language:EN-US'>fn</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>get</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>random</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>, которой дается команда
искать <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span
lang=EN-US> </span>в представлении <span lang=EN-US style='mso-ansi-language:
EN-US'>v</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>cancel</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>supplier</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>order</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Если в этом представлении будет найден какой-либо <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span>, то дальнейшие действия
процедуры <b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>cancel</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>supplier</span>_</b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>order</span></b>: </p>

<p class=MsoNormal>1) вызвать вспомогательную ХП <span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>lock</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>dependend</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>docs</span>, которая составит список
инвойсов, зависимых от выбранного складского заказа (её описание см ниже) и
попытается заблокировать каждый из них; при невозможности выполнить блокировку
хотя бы одного из этих документов будет выброшено исключение и алгоритм прекратит
свою работу;</p>

<p class=MsoNormal>2) для каждого найденного инвойса получить его состояние.
Если инвойс «проведён», то:<br>
2.1) найти все резервы, в формировании количеств которых были задействованы
строки данного инвойса; попытаться заблокировать каждый из найденных резервов.
При невозможности установить все блокировки будет выброшено исключение и
алгоритм прекратит свою работу.</p>

<p class=MsoNormal>2.2) отменить (если нужно) проведение этих резервов, затем –
удалить сами резервы;</p>

<p class=MsoNormal>2.3) отменить проведение инвойса (вызов <span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>cancel</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>adding</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>invoice</span>). Затем – удалить сам
инвойс (вызов процедуры <span lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>cancel</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>supplier</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invoice</span> -<span
style='mso-spacerun:yes'>  </span>см ниже);</p>

<p class=MsoNormal>3) заполнить временную таблицу <span lang=EN-US
style='mso-ansi-language:EN-US'>tmp</span>$<span lang=EN-US style='mso-ansi-language:
EN-US'>result</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>set</span><span
lang=EN-US> </span>данными удаляемого сейчас складского заказа (для передачи их
клиенту);</p>

<p class=MsoNormal>4) удалить заголовок складского заказа (<span lang=EN-US
style='mso-ansi-language:EN-US'>FK</span>-каскад вызовет удаление его строк, а
триггер на таблице <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>data</span> – добавление в <span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span> записей с отрицательными
значениями<span style='mso-spacerun:yes'>  </span>количества);<br>
5) зарегистрировать завершение своего выполнния (вызов execute procedure
sp_add_to_perf_log(…))</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Замечание.<o:p></o:p></b></p>

<p class=MsoNormal>Данная ХП является наиболее «ресурсозатратной» и чаще всех
завершается с ошибками вида <span lang=EN-US style='mso-ansi-language:EN-US'>lock</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>conflict</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>3.</b> <b
style='mso-bidi-font-weight:normal'>Отмена</b> <b style='mso-bidi-font-weight:
normal'>непроведённого</b> <b style='mso-bidi-font-weight:normal'>инвойса от
поставщика<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Реализующая ХП: <b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>cancel</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>supplier</span>_</b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>invoice</span><o:p></o:p></b></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Эта процедура отменяет только действие <span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>supplier</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>invoice</span>,
т.е. создание <b style='mso-bidi-font-weight:normal'>не</b>проведенного
инвойса. Она не отменяет действие по проведению инвойса – это делает <span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>cancel</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>adding</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invoice</span>, см ниже.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Когда инвойс создается (в <span lang=EN-US style='mso-ansi-language:
EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>supplier</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>invoice</span>), то он остается в
состоянии «Открыт» вплоть до момента добавления его количеств к свободным
остаткам склада. В этом состоянии строки инвойса не сторнируются для каких-либо
<i style='mso-bidi-font-style:normal'>количественных</i> распределений. Однако,
такой инвойс участвует в <i style='mso-bidi-font-style:normal'>стоимостных</i>
распределениях при вводе наших платежей поставщикам.</p>

<p class=MsoNormal>Поэтому при удалении инвойса нужно сначала удалить данные по
распределению стоимости наших платежей поставщикам. Это выполняется командой <span
lang=EN-US style='mso-ansi-language:EN-US'>delete</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>from</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>plinks</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>p</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>where</span> :<span lang=EN-US
style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>list</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>id</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>in</span> (
<span lang=EN-US style='mso-ansi-language:EN-US'>p</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>rcv</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>id</span>, <span lang=EN-US style='mso-ansi-language:EN-US'>p</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>snd</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>).</p>

<p class=MsoNormal>Выбор инвойса для его удаления проводится через вызов
функции <span lang=EN-US style='mso-ansi-language:EN-US'>fn</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>get</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>random</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>, которой дается команда искать <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span lang=EN-US> </span>в
представлении <span lang=EN-US style='mso-ansi-language:EN-US'>v</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>cancel</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>supplier</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invoice</span>. Если в этом представлении не
будет найдено ни одной записи, то процедура зарегистрирует этот факт, после
чего выбросит исключение <span lang=EN-US style='mso-ansi-language:EN-US'>ex</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>can</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>not</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>select</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>random</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span><span lang=EN-US> </span><span
style='mso-spacerun:yes'> </span>и завершится.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>4.</b> <b
style='mso-bidi-font-weight:normal'>Отмена</b> <b style='mso-bidi-font-weight:
normal'>операции проведения нвойса<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>Реализующая<span style='mso-ansi-language:EN-US'> </span>ХП<span
lang=EN-US style='mso-ansi-language:EN-US'>: <b style='mso-bidi-font-weight:
normal'>sp_cancel_adding_invoice<o:p></o:p></b></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal>Процедура выбирает инвойс из списка тех, что были добавлены
к свободным остаткам склада (используя представление v_cancel_adding_invoice),
после чего передаёт <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>
этого инвойса и признак действия «Отменить» (<span lang=EN-US style='mso-ansi-language:
EN-US'>a</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>cancel</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>mode</span><span
style='mso-spacerun:yes'>  </span>= 1) в ХП sp_add_invoice_to_stock.</p>

<p class=MsoNormal>Процедура <span lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>add</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invoice</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>to</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>stock</span><span lang=EN-US> </span>по признаку <span lang=EN-US
style='mso-ansi-language:EN-US'>a</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>cancel</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>mode</span><span
style='mso-spacerun:yes'>  </span>= 1 выполняет следующие действия:</p>

<p class=MsoNormal>1) составляет список резервов, которые были автоматически
созданы при добавлении этого инвойса к балансу склада (вызывает ХП <span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>lock</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>dependend</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>docs</span>)
и пытается заблокировать каждый из них. По каждому такому резерву далее выполняется:</p>

<p class=MsoNormal>1.1) отмена его списания, если она уже состоялась (вызовом sp_cancel_write_off).
Эта отмена вызовет увеличение остатка «В резерве», записанного в <span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>qty</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>res</span>.</p>

<p class=MsoNormal>1.2) отмена самого резерва (вызовом <span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>cancel</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>customer</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>reserve</span>). Это вызовет
уменьшение остатка «В резерве» и одновременно – увеличение остатка «Доступно»,
записанного в <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>avl</span>.</p>

<p class=MsoNormal>2) применяет к документу операцию «Отмена проведения
инвойса», <span style='mso-spacerun:yes'> </span>что приведет к уменьшению
значения в <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>avl</span> и одновременно – к увеличению остатка <span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>sup</span>.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Применение операции «Отмена проведения инвойса» состоит из
следующих шагов:</p>

<p class=MsoNormal>1) замена в <i style='mso-bidi-font-style:normal'>заголовке</i>
документа - поле <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>list</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>optype</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span><span lang=EN-US> </span>- кода
операции с прежнего значения (2100, мнемокод = ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>INC</span>’: «Проведенный инвойс») на новое: 2000,
мнемокод = ‘<span lang=EN-US style='mso-ansi-language:EN-US'>SUP</span>’, «Инвойс
от поставщика». Также меняется статус документа (поле <span lang=EN-US
style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>list</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>state</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>) с закрытого или зафиксированного
на «Открыт».</p>

<p class=MsoNormal>2) замена в <i style='mso-bidi-font-style:normal'>строках</i>
<span style='mso-spacerun:yes'> </span>документа (таблица <span lang=EN-US
style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>data</span>) такого же поля - <span lang=EN-US style='mso-ansi-language:
EN-US'>optype</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>id</span><span
lang=EN-US> </span>на новый <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span
lang=EN-US> </span>операции. Это вызывает срабатывание триггера <span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>data</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>aiud</span>. Этот триггер будет добавлять в журнал оборотов изделий –
таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span><span lang=EN-US> </span>– записи с ОТРИЦАТЕЛЬНЫМИ
значениями и кодом операции = 2100 (т.е. с мнемокодом = ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>INC</span>’). Данное действие приведёт к тому,
что процедура <span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span> сложит положительные и отрицательные <span lang=EN-US
style='mso-ansi-language:EN-US'>INC</span>-обороты и в итоге в сальдовом
регистре (<span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>) в графе <span
lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>avl</span> произойдёт уменьшение значений,
вплоть до нуля.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Завершается ХП <b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>cancel</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>adding</span>_</b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>invoice</span></b> выборкой из
выбранного документа-инвойса и регистрацией в таблице <span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>log</span> момента окончания работы данной ХП.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>5.</b> <b
style='mso-bidi-font-weight:normal'>Отмена</b> <b style='mso-bidi-font-weight:
normal'>операции</b> <b style='mso-bidi-font-weight:normal'>списания (</b>она
же:<b style='mso-bidi-font-weight:normal'> «отмена проведения реализации»)<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Реализующая<span style='mso-ansi-language:EN-US'> </span>ХП<span
lang=EN-US style='mso-ansi-language:EN-US'>: <b style='mso-bidi-font-weight:
normal'>sp_cancel_write_off<o:p></o:p></b></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Процедура выбирает документ реализации из списка v_cancel_write_off
(это список «проведенных списаний»), применяет к нему операцию «Отмена
проведения списания», делает выборку строк и регистрирует завершение своей
работы.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Применение операции «Отмена проведения списания» состоит из
следующих шагов:</p>

<p class=MsoNormal>1) замена в <i style='mso-bidi-font-style:normal'>заголовке</i>
документа - поле <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>list</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>optype</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span> - кода операции с прежнего значения
(3400, мнемокод = ‘<span lang=EN-US style='mso-ansi-language:EN-US'>SAL</span>’:
«Проведенная реализация») на новое: 3300, мнемокод = ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>RES</span>’, «Резерв для последующей продажи».
Также меняется статус документа (поле <span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>list</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>state</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>) с закрытого или зафиксированного на
«Открыт».</p>

<p class=MsoNormal>2) замена в <i style='mso-bidi-font-style:normal'>строках</i><span
style='mso-spacerun:yes'>  </span>документа (таблица <span lang=EN-US
style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>data</span>) такого же поля - <span lang=EN-US style='mso-ansi-language:
EN-US'>optype</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>id</span><span
lang=EN-US> </span>на новый <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span
lang=EN-US> </span>операции. <span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Замена в <i style='mso-bidi-font-style:normal'>заголовке</i>
документа вызывает срабатывание триггера <span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>list</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>aiud</span>. Этот триггер вызовет ХП
<span lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>add</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>log</span>,
которая добавит в журнал оборотов изделий – таблицу <span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>turnover</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>log</span><span
lang=EN-US> </span>– записи с ОТРИЦАТЕЛЬНЫМИ значениями и кодом операции = 3400
(т.е. с мнемокодом = ‘<span lang=EN-US style='mso-ansi-language:EN-US'>SAL</span>’).
</p>

<p class=MsoNormal>Данное действие приведёт к тому, что процедура <span
lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>
сложит положительные и отрицательные <span lang=EN-US style='mso-ansi-language:
EN-US'>SAL</span>-обороты и в итоге в сальдовом регистре (<span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span>) в графе <span lang=EN-US style='mso-ansi-language:EN-US'>cost</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>out</span> произойдёт уменьшение
значений, вплоть до нуля. Одновременно будут увеличены остатки в графе <span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>qty</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>res</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>5.</b> <b
style='mso-bidi-font-weight:normal'>Отмена</b> операции <b style='mso-bidi-font-weight:
normal'>резерва<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Реализующая<span style='mso-ansi-language:EN-US'> </span>ХП<span
lang=EN-US style='mso-ansi-language:EN-US'>: <b style='mso-bidi-font-weight:
normal'>sp_cancel_customer_reserve<o:p></o:p></b></span></p>

<p class=MsoNormal>Вызывается менеджером по продажам (‘<span lang=EN-US
style='mso-ansi-language:EN-US'>sales</span>’) или логистом (’<span lang=EN-US
style='mso-ansi-language:EN-US'>logist</span>’).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Процедура выбирает документ – резерв из списка v_cancel_<span
lang=EN-US style='mso-ansi-language:EN-US'>customer</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>reserve</span> (это список резервов с стастусе
«Открыт»), удаляет связи между ним и платежами по нему, делает выборку строк
удаляемого документа, после чего удаляет заголовок и его строки. В итоге -
регистрирует завершение своей работы.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Удаление <i style='mso-bidi-font-style:normal'>заголовка</i>
документа вызывает срабатывание триггера <span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>list</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>aiud</span>, который вызовет ХП <span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>add</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>log</span>
(добавление записей в журнал оборотов по изделиям – таблицу <span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>turnover</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>log</span>).
</p>

<p class=MsoNormal>Добавленные в этот журнал записи будут содержать отрицательные
значения количеств, равные количествам в удаляемых строках документа.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Служебная процедура <span lang=EN-US style='mso-ansi-language:
EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span> сложит положительные и
отрицательные обороты, что отразится на графе <span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>res</span> в виде уменьшения этого
поля. Одновременно будет увеличено значение в графе «Остаток доступный» (<span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>qty</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>avl</span>).</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>6 и 7</b>. <b
style='mso-bidi-font-weight:normal'>Отмена оплаты</b> (от нас поставщику или
нам от покупателя).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Реализующие<span style='mso-ansi-language:EN-US'> </span>ХП<span
lang=EN-US style='mso-ansi-language:EN-US'>: <b style='mso-bidi-font-weight:
normal'>sp_cancel_pay_to_supplier, sp_cancel_pay_from_customer<o:p></o:p></b></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Документы-<i style='mso-bidi-font-style:normal'>оплаты</i>
хранятся в виде отдельных строк в таблице <span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>list</span>
и не имеют табличных частей (в отличие от документов склада). Выбор документа
для отмены производится:</p>

<p class=MsoNormal>1) при отмене нашей оплаты поставщику - среди строк
представления v_cancel_payment_to_supplier;</p>

<p class=MsoNormal>2) при отмене оплаты покупателя нам – среди строк
представления v_cancel_customer_prepayment.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Отмена документа-оплаты начинается с удаления строк,
отражающих связи между этой оплатой и теми документами, на которые она была
распределена при своём сторнировании. Для оплаты поставщику это документы-инвойсы,
для оплаты покупателя – документы-резервы. Эти связи хранятся в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>plinks</span>, поэтому их отмена
выполняется командой <span lang=EN-US style='mso-ansi-language:EN-US'>delete</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>from</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>plinks</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>where</span>
… </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Далее удаляется сам документ-оплата (строка в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>list</span>) и проведура регистрирует завершение
своего выполнения.</p>

<p class=MsoNormal>При любом изменении в таблице <span lang=EN-US
style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>list</span> триггер <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>list</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>aiud</span> определит, относится ли операция
этой строки (<span lang=EN-US style='mso-ansi-language:EN-US'>optype</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>) к тем, что воздействуют
на балансы контрагентов. </p>

<p class=MsoNormal>Если в таблице <span lang=EN-US style='mso-ansi-language:
EN-US'>optypes</span> поле <span lang=EN-US style='mso-ansi-language:EN-US'>m</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>cust</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>debt</span> (для операций, относящихся к
реализации) или поле <span lang=EN-US style='mso-ansi-language:EN-US'>m</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>supp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>debt</span> (для операций, относящихся к
поставкам) не равно нулю, то такой вид документа считается <i style='mso-bidi-font-style:
normal'>влияющим</i> на баланс контрагента. В этом случае триггер <span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>list</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>aiud</span><span lang=EN-US> </span>добавит в журнал стоимостных
оборотов – таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>money</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span><span lang=EN-US> </span>– значения
изменений по оборотам.</p>

<p class=MsoNormal>В частности, при отмене оплаты в <span lang=EN-US
style='mso-ansi-language:EN-US'>money</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>turnover</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>log</span>
будет добавлена запись с отрицательным значением стоимости, равным по модулю
сумме оплаты.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Служебная процедура <span lang=EN-US style='mso-ansi-language:
EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>money</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span> выполнит сборку этих оборотов и обновит
сводный регистр балансов контрагентов – таблицу <span lang=EN-US
style='mso-ansi-language:EN-US'>money</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span>, после чего удалит обработанные обороты в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>money</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Вспомогательные
процедуры (в алфавитном порядке).<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Следующие процедуры обеспечивают работу прикладных модулей,
а также требуются для отладки при возникновении проблем.</p>

<p class=MsoNormal><span style='background:silver;mso-highlight:silver'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>add</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>doc</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>data</span> – добавляет одну
строку в таблицу детализации (<span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>data</span>), хранящую изделия
документов; если в документ ранее уже заносилось изделие (проверка – по полям <span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span> и <span lang=EN-US style='mso-ansi-language:
EN-US'>ware</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>id</span>),
то новое количество и стоимости будут сложены с прежними; для уменьшения числа
обращений в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>data</span> алгоритм работает по
принципу: 1) попытаться добавить строку; 2) при получении исключения вида <span
lang=EN-US style='mso-ansi-language:EN-US'>no</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>dup</span> – выполнить <span lang=EN-US
style='mso-ansi-language:EN-US'>update</span> с суммированием количества и
стоимостей. Этот алгоритм более производителен, чем <span lang=EN-US
style='mso-ansi-language:EN-US'>merge</span>.</p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>add</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>doc</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>list</span> – формирует заголовок
документа (т.е. добавляет запись в таблицу <span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>list</span>);
возвращает как <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>
документа, так и идентификатор версии записи <span lang=EN-US style='mso-ansi-language:
EN-US'>RDB</span>$<span lang=EN-US style='mso-ansi-language:EN-US'>DB</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>KEY</span>, что позволяет затем в
вызывающей процедуре обращаться к этой записи с максимальной скоростью;</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>add</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>money</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>log</span>
– добавляет (и <i style='mso-bidi-font-style:normal'>только</i> добавляет)
запись в журнал оборотов денежных средств по операциям, которые затрагивают
балансы контрагентов;</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>add</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>to</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>abend</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>log</span>
-<span style='mso-spacerun:yes'>  </span>добавляет в таблицу <span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>log</span> информацию о модуле и о коде завершения (<span lang=EN-US
style='mso-ansi-language:EN-US'>gdscode</span>), а также некоторые
дополнительные сведения; если настройка ENABLE_MON_QUERY установлена в значение
<b style='mso-bidi-font-weight:normal'><span style='font-family:"Courier New"'>1</span></b>,
то вместо имени модуля будет записан полный стек вызовов до той точки в коде,
где случилось исключение (см. скрипт <span lang=EN-US style='mso-ansi-language:
EN-US'>OLTP</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>MAIN</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>FILLING</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>SQL</span>);</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>add</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>invnt</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>log</span>
– добавляет в таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span><span lang=EN-US> </span>записи о
всех оборотах, которые происходили с изделиями. Вызывается из триггера <span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>list</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>aiud</span> после завершения обновлений в документе, содержащем изделия.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>add</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>to</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>perf</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>log</span>
– добавляет в журнал выполнений сведения о текущем модуле и длительности его
выполнения, а также дополнительную информацию, полезную при отладке;<span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>check</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>ctx</span>
– защита от случайного удаления (установки в <span lang=EN-US style='mso-ansi-language:
EN-US'>NULL</span>) контекстных переменных, которые требуются для работы; если
требуемой контекстной переменной нет, эта ХП выбросит исключение;</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>check</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>nowait</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>or</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>timeout</span>
– проверка на то, что текущая транзакция работает либо в режиме <span
lang=EN-US style='mso-ansi-language:EN-US'>NO</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>WAIT</span>, либо с каким-то
ненулевым таймаутом; если режим <span lang=EN-US style='mso-ansi-language:EN-US'>WAIT</span>,
будет выброшено исключение;<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>check</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>to</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>stop</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>work</span>
– проверка наличия хотя бы одной записи в таблице ext_stoptest; если такая
запись есть, будет выброшено исключение «ex_test_cancellation» с текстом такого
же содержания;</p>

<p class=MsoNormal>Управление при этом вернётся из <span lang=EN-US
style='mso-ansi-language:EN-US'>isql</span><span lang=EN-US> </span>в .<span
lang=EN-US style='mso-ansi-language:EN-US'>bat</span>-файл, запустивший
этот<span style='mso-spacerun:yes'>  </span><span lang=EN-US style='mso-ansi-language:
EN-US'>isql</span> (т.е. в oltp_isql_run_worker.bat). Поскольку <span
lang=EN-US style='mso-ansi-language:EN-US'>isql</span> запускается так, что
ошибки выполнения логируются в файле .<span lang=EN-US style='mso-ansi-language:
EN-US'>err</span>, то в этом .<span lang=EN-US style='mso-ansi-language:EN-US'>bat</span>-файле
будет выполнена проверка: find /c /i &quot;EX_TEST_CANCEL&quot; – и если такая
строка в логе существует, то весь скрипт прекратит свою работу. Этим
обеспечивается корректное «самозавершение» всех<span style='mso-spacerun:yes'> 
</span>тестовых окон (т.е. не форсированный <span lang=EN-US style='mso-ansi-language:
EN-US'>rollback</span>, без применения методов типа <span lang=EN-US
style='mso-ansi-language:EN-US'>pskill</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>exe</span><span lang=EN-US> </span>или <span
lang=EN-US style='mso-ansi-language:EN-US'>gfix</span> -<span lang=EN-US
style='mso-ansi-language:EN-US'>shut</span>).<span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>flush</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>perf</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>log</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>on</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>abend</span>
– запускается только при возникновении исключения в каком-либо из модулей:
слияние всех данных, имеющихся в <span lang=EN-US style='mso-ansi-language:
EN-US'>GTT</span>-таблице <span lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>$<span
lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>, с содержимым <span lang=EN-US
style='mso-ansi-language:EN-US'>fixed</span>-таблицы <span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>log</span>. Чтобы не потерять информацию об ошибке ввиду возникшего
исключения, эта процедура выполняет сканирование всех строк таблицы <span
lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>$<span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>log</span> (т.е. всего, что успела туда записать отменяемая сейчас
транзакция). Далее, для каждой строки она сохраняет содержимое её полей в
контекстных-переменных уровня <b style='mso-bidi-font-weight:normal'>сессии</b>.
После этого она вызывает ХП sp_flush_tmpperf_in_auton_tx, которая выполняет
«фиксацию» данных с помощью автономной транзакции. На каждую «пачку» строк из <span
lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>$<span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>log</span> стартует только одна автономная транзакция, и после
завершения этого переноса контестные переменные «обнуляются».</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>S</span><span style='background:silver;
mso-highlight:silver'>p_flush_tmpperf_in_auton_tx</span> – процедура, вызываемая
из <span lang=EN-US style='mso-ansi-language:EN-US'>Sp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>flush</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>log</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>on</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>abend</span><span lang=EN-US> </span>и
записывающая данные контестных переменных (уровня сессии) в <span lang=EN-US
style='mso-ansi-language:EN-US'>fixed</span>-таблицу <span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>log</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>S</span><span style='background:silver;
mso-highlight:silver'>p_fill_shopping_cart</span> – вспомогательная процедура
для заполнения «корзины покупателя» (таблица <span lang=EN-US style='mso-ansi-language:
EN-US'>tmp</span>$<span lang=EN-US style='mso-ansi-language:EN-US'>shopping</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>cart</span>). Используется при формировании
клиентского заказа, резерва по доступным остаткам, складского заказа поставщику
и инвойса от поставщика.</p>

<p class=MsoNormal>Число строк, которое будет добавлено в корзину, определяется
видом операции: если контрагентом по ней выступает покупатель, то верхний лимит
определяется контекстной переменной с именем 'C_CUSTOMER_DOC_MAX_ROWS', а если
контрагентом выступает поставщик, то переменной с именем 'C_SUPPLIER_DOC_MAX_ROWS'.
Конкретные значения этих переменных задаются в скрипте <span lang=EN-US
style='mso-ansi-language:EN-US'>oltp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>main</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>filling</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>sql</span> и зависят от выбранного
«нагрузочного режима». </p>

<p class=MsoNormal>Отношение <span lang=EN-US style='mso-ansi-language:EN-US'>C</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>SUPPLIER</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>DOC</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>MAX</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>ROWS</span>
/ <span lang=EN-US style='mso-ansi-language:EN-US'>C</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>CUSTOMER</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>DOC</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>MAX</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>ROWS</span>
сильно влияет на производительность: чем оно больше, тем дольше формируются
документы для<span style='mso-spacerun:yes'>  </span><i style='mso-bidi-font-style:
normal'>поставщика</i> по сравнению с формированием документов для <i
style='mso-bidi-font-style:normal'>клиентов</i>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>get</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>clo</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>for</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>invoice</span> – вспомогательная
процедура, вызываемая из режима «проведение инвойса». Возвращает набор <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span> клиентских заказов,
изделия из которых присутствуют в данном инвойсе. По таким заказам необходимо
далее создать <i style='mso-bidi-font-style:normal'>резервы</i>, чтобы эти
изделия не были проданы другим клиентам.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>halt</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>on</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>error</span>
– вспомогательная процедура для САМООСТАНОВКИ теста в случае, когда какой-либо
алгоритм нарушает бизнес-логику и необходимо немедленно всё остановить;</p>

<p class=MsoNormal>Основное правило бизнес-логики – неотрицательность остатков
склада - обеспечивается БЕЗБЛОКИРОВОЧНЫМ методом попыток сторнирования
имеющихся ресурсов, представленных строками-«развёртками» количеств в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span>. Некоторые алгоритмы
содержали в себе трудноуловимые логические ошибки, приводившие к отрицательным
остаткам изделий. Для обнаружения таких ошибок была создана эта ХП, а также
процедура сброса «грязных данных» во вспомогательные таблицы – см ниже описание
<span lang=EN-US style='mso-ansi-language:EN-US'>ZDUMP</span>4<span lang=EN-US
style='mso-ansi-language:EN-US'>DBG</span>. Процедура <span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>halt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>on</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>error</span> вызывается только из
одного места: <span lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>add</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>to</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>abend</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>log</span>,
при условии передачи последней входного аргумента A_HALT_DUE_TO_ERROR = 1;</p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>init</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>ctx</span>
– инициализация по таблице <span lang=EN-US style='mso-ansi-language:EN-US'>settings</span>
контекстных переменных уровня сессии; вызывается при коннекте, из триггера <span
lang=EN-US style='mso-ansi-language:EN-US'>TRG</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>CONNECT</span>;</p>

<p class=MsoNormal><span style='background:silver;mso-highlight:silver'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>kill</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>cost</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>storno</span>
– отмена <i style='mso-bidi-font-style:normal'>стоимостного</i> сторнирования: вызывается
при операциях удаления документов, которые влияют на балансы контрагентов;
возвращает строки, которые были сторнированы при при создании документов, из
таблицы <span lang=EN-US style='mso-ansi-language:EN-US'>PSTORNED</span><span
lang=EN-US> </span>в таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span>;
см также ХП <span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>cost</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>storno</span>;<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>kill</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>qty</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>storno</span>
– отмена количественного сторнирования: вызывается из триггера <span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>data</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>aiud</span> для операций удаления документов, а также отмены их
предыдущего «проведения». Возвращает строки, которые были сторнированы при при
создании документов, из таблицы <span lang=EN-US style='mso-ansi-language:EN-US'>QSTORNED</span><span
lang=EN-US> </span>в таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span>;</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>lock</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>dependend</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>docs</span>
– процедура получения списка документов, <i style='mso-bidi-font-style:normal'>зависимых</i>
от текущего. Для всех<span style='mso-spacerun:yes'>  </span>полученных
документов<span style='mso-spacerun:yes'>  </span>далее проводится попытка
установки явной блокировки и выброс исключения при невозможности этого.</p>

<p class=MsoNormal>Зависимыми от текущего документа «А» будут<span
style='mso-spacerun:yes'>  </span>все (другие) документы, при формировании
которых проводилось сторнирование количеств, занесённых в документ «А». </p>

<p class=MsoNormal>Например, для документа типа «Инвойс» (в состоянии
«Проведён») зависимыми от него будут все документы - резервы клиентов<span
style='mso-spacerun:yes'>  </span>(независимо от того, проведены они или нет),
количества которых были обеспечены содержимым данного инвойса. Для документа
типа «Заказ поставщику» зависимыми от него будут все документы – инвойсы
(независимо от того, проведены они или нет), при формировании которых были
сторнированы количества данного заказа поставщику.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Когда отменяется проведение инвойса,<span
style='mso-spacerun:yes'>  </span>необходимо предварительно составить список
всех резервов клиентов (в том числе отгруженных), которые сторнировали
количества выбранного сейчас инвойса. Далее, необходимо отменить все отгрузки,
а затем – и сами резервы. </p>

<p class=MsoNormal>Когда отменяется заказ поставщику (а у него нет состояния
«проведён», т.е. его отмена равнозначна удалению), то необходимо составить
список всех инвойсов, которые при своем формировании сторнировали количества
данного заказа. После чего сначала вызвать процедуру отмены каждого такого
инвойса (если он проведён – то сначала еще и процедуру отмены проведения!), и
только после – удаление самого заказа.</p>

<p class=MsoNormal>Очевидно, что данное действие может затрагивать большое
количество строк. Поэтому процедуры отмены проведения инвойсов и отмены заказа
поставщику чаще всего подвержены исключениям типа <span lang=EN-US
style='mso-ansi-language:EN-US'>lock</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>conflict</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='background:silver;mso-highlight:silver'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>lock</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>selected</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>doc</span>
– выполняет попытку заблокировать заголовок документа после того, как он будет
выбран случайным образом в <span lang=EN-US style='mso-ansi-language:EN-US'>fn</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>get</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>random</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span> (см ниже); если заблокировать не
удалось, выбросит исключение <span lang=EN-US style='mso-ansi-language:EN-US'>lock</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>conflict</span>; если документ с
переданным <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span> не
найден, выбросит пользовательское исключение «ex_no_doc_found_for_handling» (но
такое возможно только при ошибке алгоритма);</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>make</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>qty</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>storno</span>
– основная процедура <i style='mso-bidi-font-style:normal'>количественного</i>
сторнирования: ищет строки-«ресурсы» в таблице <span lang=EN-US
style='mso-ansi-language:EN-US'>QDISTR</span> и пытается их заблокировать,
выполняя такие блокировки до тех пор, пока их число не сравняется с тем
количеством, которое необходимо обеспечить этим сторнированием; если блокировка
какой-либо строки не удалась (т.е. возник <span lang=EN-US style='mso-ansi-language:
EN-US'>lock</span><span lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:
EN-US'>conflict</span>), «перепрыгивает» на следующую строку из доступных
вместо выброса исключения. Тем самым даже при сильной конкуренции за одно и
тоже изделие можно добиться сторнирования требуемого количества и мнимизировать
откаты из-за лок-конфликтов. Также эта ХП выполняет добавление строки в
заголовок документа и изделий в таблицу детализации.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>make</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>cost</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>storno</span>
– основная процедура <i style='mso-bidi-font-style:normal'>стоимостного</i>
сторнирования: вызывается при операциях создания или «проведения» документов, формирование
которых требует поиска денежных ресурсов, которыми можно обеспечить данную
операцию; например, при проведении резерва (т.е. отгрузке товара покупателю)
нужно найти все его платежи, которые еще не были сторнированы другими такими
отгрузками, и попытаться <i style='mso-bidi-font-style:normal'>сторнировать</i>
стоимость этих платежей общей стоимостью проводимой сейчас отгрузки.
Стоимости-ресурсы, подлежащие сторнированию, представлены в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span>. Исходный платеж
разбивается на несколько частей и каждая из них представлена в <span
lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span> в виде отдельной
строки. Процедура <span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>cost</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>storno</span> будет <i style='mso-bidi-font-style:normal'>пытаться</i>
заблокировать такое число этих строк, которое будет обеспечивать (т.е. станет
больше или равным) стоимость по текущей операции. </p>

<p class=MsoNormal>Если блокировка какой-либо строки не удалась (т.е. возник <span
lang=EN-US style='mso-ansi-language:EN-US'>lock</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>conflict</span>), алгоритм
«перепрыгивает» на следующую строку из доступного набора (вместо выброса
исключения – по аналогии с ХП <span lang=EN-US style='mso-ansi-language:EN-US'>Sp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>lock</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>for</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>distr</span>).</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>multiply</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>rows</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>for</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>pdistr</span>
–делит стоимость вводимого платежа на несколько частей; каждую из них добавляет
в таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>pdistr</span>; таким
образом, эта ХП создает строки-ресурсы для последующего <i style='mso-bidi-font-style:
normal'>стоимостного</i> сторнирования, т.е. переноса их их <span lang=EN-US
style='mso-ansi-language:EN-US'>pdistr</span><span lang=EN-US> </span>в таблицу
<span lang=EN-US style='mso-ansi-language:EN-US'>pstorned</span>;</p>

<p class=MsoNormal>Число строк-ресурсов, на которое в итоге отобразится
вводимый платеж, регулируется настройкой в таблице <span lang=EN-US
style='mso-ansi-language:EN-US'>SETTINGS</span>: <span lang=EN-US
style='mso-ansi-language:EN-US'>mcode</span> = ‘C_ROWS_TO_MULTIPLY’ для <span
lang=EN-US style='mso-ansi-language:EN-US'>working</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>mode</span> = ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>COMMON</span>’ (см скрипт <span lang=EN-US
style='mso-ansi-language:EN-US'>oltp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>main</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>filling</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>sql</span>) и на данный момент
принято равным 10. Платежи состоимостями менее 1000 не разделяются, т.е. для
них в <span lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span> будет
добавлена только одна строка (регулируется настройкой 'C_MIN_COST_TO_BE_SPLITTED');<span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>multiply</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>rows</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>for</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>qdistr</span>
– «размножает» количество, записываемое в <span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>data</span>,
на такое число строк в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>Qdistr</span>,
которое равно этому количеству; таким образом, эта ХП создает строки-ресурсы
для последующего <i style='mso-bidi-font-style:normal'>количественного</i>
сторнирования, т.е. переноса их из <span lang=EN-US style='mso-ansi-language:
EN-US'>qdistr</span><span lang=EN-US> </span><span
style='mso-spacerun:yes'> </span>в таблицу <span lang=EN-US style='mso-ansi-language:
EN-US'>qstorned</span>. В каждой такой строке количество будет равным 1 (тест
предполагает, что в складские документы добавляются только натуральные
количества изделий);<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Sp</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>upd</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>in</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>perf</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>log</span>
– добавляет к ранее занесённой записи в таблице <span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>log</span> некоторую информацию, позволяющую проводить анализ возникшего
исключения.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Srv</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>check</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>neg</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>remainders</span>
– <i style='mso-bidi-font-style:normal'>диагностическая </i>процедура, вызываемая
после обновления таблицы оборотов <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span> в случае, когда настройка
теста требует остановки работы коннектов при таких данных в <span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>log</span>,
запись которых в сальдовую таблицу остатков приведёт к нарушению правила
неотрицательности остатков. Эта процедура носит отладочный характер и в
поставляемом скрипте настройки теста таковы, что она не вызывается.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Srv</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>diag</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>fk</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>uk</span>
– <i style='mso-bidi-font-style:normal'>диагностическая</i> процедура для
проверки внешних ключей и соответствующих им <span lang=EN-US style='mso-ansi-language:
EN-US'>PK</span>/<span lang=EN-US style='mso-ansi-language:EN-US'>UK</span>,<span
style='mso-spacerun:yes'>  </span>а также проверки действительного отсутствия
дублей в уникальных ключах. Выполняет в цикле <span lang=EN-US
style='mso-ansi-language:EN-US'>execute</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>statement</span>’ы, которые
формируются на основе текущих данных словаря БД (т.е. при добавлении нового <span
lang=EN-US style='mso-ansi-language:EN-US'>FK</span><span lang=EN-US> </span>или
<span lang=EN-US style='mso-ansi-language:EN-US'>UNIQUE</span>-ограничения эта
процедура автоматически «увидит» его).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'> </span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>Srv</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>diag</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>idx</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>entries</span>
- <i style='mso-bidi-font-style:normal'>диагностическая</i> процедура для
проверки равенства количества ключей, подсчитанных «по индексу» и числу
записей, подсчитанных полным перебором (т.е. <span lang=EN-US style='mso-ansi-language:
EN-US'>natural</span>).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Srv</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>find</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>qd</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>qs</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>mism</span>
– <i style='mso-bidi-font-style:normal'>диагностическая </i>процедура поиска
таких записей в <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>data</span>, для которых <b
style='mso-bidi-font-weight:normal'>не</b> соблюдается правило: количество,
записанное в поле <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>data</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>qty</span><span lang=EN-US> </span>(всегда -
целое!) должно равняться сумме результатов операции <span lang=EN-US
style='mso-ansi-language:EN-US'>count</span>(*), выполненной над строками
таблиц <span lang=EN-US style='mso-ansi-language:EN-US'>qdistr</span> &amp; <span
lang=EN-US style='mso-ansi-language:EN-US'>qstorned</span>, являющимися
дочерними для этой строки из <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>data</span>. Другими словами:
количество <i style='mso-bidi-font-style:normal'>по строке</i> документа
обязано всегда отражаться на точно такое же <i style='mso-bidi-font-style:normal'>общее</i>
<i style='mso-bidi-font-style:normal'>количество</i> <i style='mso-bidi-font-style:
normal'>строк</i> в таблицах <span lang=EN-US style='mso-ansi-language:EN-US'>qdistr</span>
&amp; <span lang=EN-US style='mso-ansi-language:EN-US'>qstorned</span>. <span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Srv</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>make</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>invnt</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>saldo</span>
– процедура сбора данных из журнала оборотов по <i style='mso-bidi-font-style:
normal'>изделиям</i> (<span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_turnover_log)
и обновления по ним сальдовой таблицы остатков изделий (invnt_saldo). Эта
таблица затем может быть использована в <span lang=EN-US style='mso-ansi-language:
EN-US'>OLAP</span>-отчете «Обороты и остатки по складу». Периодически
вызывается всеми работающими коннектами, однако реализована так, что только
один из них может в данный момент времени выполнить сам код (т.е. реализация по
принципу «семафора»). При невозможности выполнения (запись-семафор занята
другим коннектом) процедура немедленно прекращает свою работу. Конфликты
обновления, возникающие на «семафорной записи» в этой ХП, в базе <i
style='mso-bidi-font-style:normal'>не</i> регистрируются.</p>

<p class=MsoNormal>Ввиду того, что сальдовая таблица может быть обновлена
только одним из коннектов, мы можем после установки блокировки «семафора» делать
запрос остатков в этой таблице – без риска получения значения, отличающегося от
неподтвержённого остатка, изменяемого другой транзакцией. </p>

<p class=MsoNormal>Это означает, что мы можем сначала <i style='mso-bidi-font-style:
normal'>вычислить</i> новый остаток через сложение существующего в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span><span lang=EN-US> </span>и суммы
оборотов по таблице <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>, а затем - проверить его на
неотрицательность, и только после успешного прохождения этой проверки обновлять
остатки (оператором <span lang=EN-US style='mso-ansi-language:EN-US'>update</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>or</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>insert</span>).</p>

<p class=MsoNormal>Если вычисленный остаток окажется меньше нуля, то данная ХП
не будет выбрасывать исключение, но зарегистрирует эту ошибку и перейдёт к
следующему изделию. В противном случае – обновит сальдовый остаток и удалит из
журнала оборотов (таблица <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>) все строки, относящиеся к
обработанному только что изделию.</p>

<p class=MsoNormal><span style='mso-spacerun:yes'> </span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Srv</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>make</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>money</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>saldo</span>
- процедура сбора данных из журнала оборотов по <i style='mso-bidi-font-style:
normal'>стоимостям</i> (таблица money_turnover_log) и обновления по ним
сальдовой таблицы остатков контрагентов (<span lang=EN-US style='mso-ansi-language:
EN-US'>money</span>_saldo). Особенности её работы и вызовов такие же, как у <span
lang=EN-US style='mso-ansi-language:EN-US'>Srv</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>,
за исключением того, что проверка на неотрицательность итогового баланса
контрагента не производится (т.к. он может быть отрицательным).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Srv</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>mon</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>exceptions</span> – вспомогательная
ХП для анализа видов возникавших исключений и их числа.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Srv</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>mon</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>idx</span> - вспомогательная ХП
для проверки текущего состояния статистики индексов и сравнения её с предыдущим
пересчетом;</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Srv</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>mon</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>perf</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>xxx</span>
– вспомогательные процедуры для анализа производительности. Они были описаны в
начале данного документа, см. раздел «Как оценить производительность».</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Srv</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>recalc</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>idx</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>stat</span>
– процедура пересчета статистики индексов таблиц, которые подвержены
интенсивным изменениям. Обновление статистки крайне необходимо для режимов, где
оптимизатор имеет возможность порядок соединения таблиц.</p>

<p class=MsoNormal>Периодически вызывается всеми работающими коннектами.
Особенности её работы и вызовов такие же, как у <span lang=EN-US
style='mso-ansi-language:EN-US'>Srv</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>make</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>, однако для показа
изменённых значений статистики в логе <span lang=EN-US style='mso-ansi-language:
EN-US'>isql</span> она требует вызова в транзакции с режимом <span lang=EN-US
style='mso-ansi-language:EN-US'>READ</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>COMMITTED</span>. Этот режим автоматически устанавливается скриптом,
создающим <span lang=EN-US style='mso-ansi-language:EN-US'>isql-</span>сценарии.</p>

<p class=MsoNormal>В <span lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span>
3.0 данная процедура отрабатывает достаточно быстро даже при большой нагрузке
на базу и больших таблицах.</p>

<p class=MsoNormal><i style='mso-bidi-font-style:normal'>Замечание</i>.
Вспомогательное представление <span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>z</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>idx</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>stat</span> позволяет быстро
определить индексы с плохой селективностью. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Zdump</span><span style='background:silver;
mso-highlight:silver'>4</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>dbg</span> –процедура, вызываемая
при экстренной «самоостановке» теста и выполняющая выгрузку всех «грязных данных»
текущей транзакции во вспомогательные “<b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>z</span>-таблицы</b>”: <span
lang=EN-US style='mso-ansi-language:EN-US'>zdoc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>data</span>, <span lang=EN-US style='mso-ansi-language:
EN-US'>zdoc</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>list</span>,
<span lang=EN-US style='mso-ansi-language:EN-US'>zinvnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>, <span lang=EN-US style='mso-ansi-language:
EN-US'>zqdistr</span>, <span lang=EN-US style='mso-ansi-language:EN-US'>zqstorned</span><span
lang=EN-US> </span>и др. Структуры “<span lang=EN-US style='mso-ansi-language:
EN-US'>z</span>-таблиц” в точности повторяют структуры их прототипов, но не
содежат индексов, триггеров и каких-либо ограничений</p>

<p class=MsoNormal>Эта ХП необходима для поиска трудновоспроизводимых ошибок,
приводящих к нарушению правила неотрицательности остатков изделий на складе.
Выгрузка «грязных данных» производится с помощью курсора, на каждой итерации
которого производится вызов автономной транзакции, записывающей в “<span
lang=EN-US style='mso-ansi-language:EN-US'>z</span>-таблицы” значения курсорных
переменных (которые как раз и будут содержать «грязные данные»). </p>

<p class=MsoNormal>В связи с этим, при большом объёме данных «самоостановка»
теста может длиться заметное время.</p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Zdbg</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>catch</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>neg</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>remainders</span><span
lang=EN-US> </span>и <span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Zdbg</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>catch</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>qdqs</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>mism</span>
– две служебные ХП, из которых вызывается <span lang=EN-US style='mso-ansi-language:
EN-US'>Zdump</span>4<span lang=EN-US style='mso-ansi-language:EN-US'>dbg</span>
при обнаружении данных, приводящих к отрицательным остаткам изделий.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Вспомогательные функции
(в алфавитном порядке).<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>СУБД <span lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span>,
начиная с версии 3, позволяет создавать т.н. «хранимые функции». Их
использование упрощает синтаксис, а также (для <span lang=EN-US
style='mso-ansi-language:EN-US'>deterministic</span>-вариантов) – ускоряет
работу ввиду кеширования ими константных значений.</p>

<p class=MsoNormal>В версии теста, предназначенном для <span lang=EN-US
style='mso-ansi-language:EN-US'>Firebird</span> 2.5, вместо таких функций
используются обычные хранимые процедуры, возвращающие переменную с именем ‘<span
lang=EN-US style='mso-ansi-language:EN-US'>result</span>’. Имена этих процедур
(в том числе префикс ‘<b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>fn</span>_</b>’) оставлены прежними – т.е. как
и в версии для 3.<span lang=EN-US style='mso-ansi-language:EN-US'>x</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Следующие функции обеспечивают работу прикладных модулей
теста (перечислены в алфавитном порядке):</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Fn</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>doc</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>xxxx</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>state</span>
(где ‘<span lang=EN-US style='mso-ansi-language:EN-US'>xxxx</span>’ = { <span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>canc</span><span style='background:silver;mso-highlight:silver'> | </span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>clos</span><span style='background:silver;mso-highlight:silver'> | </span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>open</span><span style='background:silver;mso-highlight:silver'> | </span><span
lang=EN-US style='background:silver;mso-highlight:silver;mso-ansi-language:
EN-US'>fix</span> }) – возвращает идентификатор из справочника состояний
(таблица ‘<span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>states</span>’), соответствующий
отменённому, закрытому, открытому и зафиксированному состоянию. Эти<span
style='mso-ansi-language:EN-US'> </span>функции<span style='mso-ansi-language:
EN-US'> </span>объявлены<span style='mso-ansi-language:EN-US'> </span>как<span
style='mso-ansi-language:EN-US'> <span lang=EN-US>deterministic.<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Fn</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>get</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>random</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>cost</span><span
lang=EN-US> </span>– возвращает случайное значение стоимости (тип <span
lang=EN-US style='mso-ansi-language:EN-US'>numeric</span>(12,2)) из диапазона,
определяемого настройками – контекстными переменными. Используется для
генерации случайного значения суммы платежа (от нас поставщику или нам от
клиента);<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Fn</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>get</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>random</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>customer</span>
– возвращает <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>
случайно выбираемого контрагента-покупателя;</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>Fn</span><span
style='background:silver;mso-highlight:silver'>_</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='background:silver;mso-highlight:silver;
mso-ansi-language:EN-US'>get</span><span style='background:silver;mso-highlight:
silver'>_</span></b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>random</span><span
style='background:silver;mso-highlight:silver'>_</span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='background:silver;mso-highlight:silver;
mso-ansi-language:EN-US'>id</span></b> – возвращает <span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span><span lang=EN-US> </span>случайно
выбираемого документа; принимает следующие аргументы:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>a</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>view</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>for</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>search</span> – имя представления (<span lang=EN-US style='mso-ansi-language:
EN-US'>view</span>), в котором следует проводить поиск документов;</p>

<p class=MsoNormal>a_view_for_bounds – имя представления, которое нужно
задействовать однократно в рамках текущей транзакции для определения
минимального и максимального <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>
(план выполнения в таком представлении может быть гораздо более эффективным,
чем в <span lang=EN-US style='mso-ansi-language:EN-US'>a</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>view</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>for</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>search</span>);</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>a</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>raise</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>exc</span> – следует ли выбросить исключение (ex_can_not_select_random_id)
при невозможности выбора <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>
(т.е. когда в представлении <span lang=EN-US style='mso-ansi-language:EN-US'>a</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>view</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>for</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>search</span><span style='mso-spacerun:yes'>  </span>ничего не было
найдено);</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>a</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>can</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>skip</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>order</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>clause</span>
- <span style='mso-spacerun:yes'> </span>допускается ли выбор случайного <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span> без учета физического
размещения записей на страницах, т.е. без применения <span lang=EN-US
style='mso-ansi-language:EN-US'>ORDER</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>BY</span> в <span lang=EN-US
style='mso-ansi-language:EN-US'>select</span>-выражении. Этот метод в общем
случае будет работать не верно: если «большие» значения <span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span> находятся на страницах с меньшими
номерами, то выражение <span lang=EN-US style='mso-ansi-language:EN-US'>select</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>from</span>
&lt;<span lang=EN-US style='mso-ansi-language:EN-US'>view</span>&gt; <span
lang=EN-US style='mso-ansi-language:EN-US'>where</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span> &gt;= :<span lang=EN-US
style='mso-ansi-language:EN-US'>random</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>rows</span> 1 – будет гораздо чаще
выдавать именно эти, «большие», значения. Однако, ряд бизнес-операций (создание
заказа поставщику, инвойса и клиентского резерва) таков, что сразу после
заполнения «корзины» случайными <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>
будет проведено т.н. <i style='mso-bidi-font-style:normal'>сторнирование</i> –
операция, удаляющая полученные <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>
из того источника (<span lang=EN-US style='mso-ansi-language:EN-US'>view</span>),
в котором шёл поиск. Следовательно, если делать выбор случайных <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span> с проверкой на отсутствие
их в «корзине», то она будет всё-таки заполняться разными значениями, а не
одними и теми же («большими»). И это не будет зависеть от физического
размещения данных по страницам базы.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Эффективный алгоритм выбора случайного <span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span> невозможно реализовать без сведений о
характере распределения его значений. Скорость выбора зависит от наличия двух индексов:
по возрастанию <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span> (в
тесте это обеспечивается индексами первичных ключей) и – обязательно! - по его
убыванию. Последнее продиктовано тем, что в СУБД <span lang=EN-US
style='mso-ansi-language:EN-US'>Firdbird</span><span lang=EN-US> </span>отсутствует
возможность «обратного скана» ключей в <span lang=EN-US style='mso-ansi-language:
EN-US'>ascending</span>-индексах.</p>

<p class=MsoNormal>Когда эта функция начинает свою работу, она пытается прежде
всего найти диапазон <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>
в источнике, определяемом правилом: <span lang=EN-US style='mso-ansi-language:
EN-US'>coalesce</span>(a_view_for_bounds, <span lang=EN-US style='mso-ansi-language:
EN-US'>a</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>view</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>for</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>search</span>) – и сохраняет эти значения в
переменных <span lang=EN-US style='mso-ansi-language:EN-US'>id</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>min</span><span lang=EN-US> </span>и
<span lang=EN-US style='mso-ansi-language:EN-US'>id</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>max</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Далее, если разница <span lang=EN-US style='mso-ansi-language:
EN-US'>id</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>max</span> – <span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>min</span><span lang=EN-US> </span>«не очень велика»
(см ниже замечание про контекстную переменную 'RANDOM_SEEK_VIA_ROWS_LIMIT), то
функция просто выполнит подсчет числа строк и затем – запрос: <span
style='background:silver;mso-highlight:silver'>select id from
&lt;a_view_for_search&gt; rows :x to :y</span>, где :<span lang=EN-US
style='mso-ansi-language:EN-US'>x</span> = :<span lang=EN-US style='mso-ansi-language:
EN-US'>y</span> = случайное натуральное число между <span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>min</span>-0.5 и <span lang=EN-US style='mso-ansi-language:EN-US'>id</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>max</span>+0.5. Предложение ‘<span
lang=EN-US style='mso-ansi-language:EN-US'>order</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>by</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>’ здесь НЕ нужно, что
значительно ускоряет поиск.</p>

<p class=MsoNormal>Если же разность <span lang=EN-US style='mso-ansi-language:
EN-US'>id</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>max</span> – <span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>min</span> достаточно большая, то вместо
подсчета числа строк будет выполнен<span style='mso-spacerun:yes'> 
</span>запрос вида: <span style='background:silver;mso-highlight:silver'>select
id from '||a_view_for_search||' where id &gt;= :x <b style='mso-bidi-font-weight:
normal'>order by id</b> rows 1</span>, где :<span lang=EN-US style='mso-ansi-language:
EN-US'>x</span><span lang=EN-US> </span>определяется аналогично предыдущему
варианту. Предложение “<span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>order</span><span lang=EN-US style='background:
silver;mso-highlight:silver'> </span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>by</span><span lang=EN-US
style='background:silver;mso-highlight:silver'> </span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>id</span>”,
как уже говорилось, будет включено в <span lang=EN-US style='mso-ansi-language:
EN-US'>select</span>-выражение только при условии, что входной аргумент <span
lang=EN-US style='mso-ansi-language:EN-US'>a</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>can</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>skip</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>order</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>clause</span> = 0 (а по умолчанию он
именно таков). </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Определение лимитов для поиска (<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>min</span>, <span lang=EN-US style='mso-ansi-language:EN-US'>id</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>max</span>) может оказаться весьма
ресурсоемкой операцией в связи с большим числом <span lang=EN-US
style='mso-ansi-language:EN-US'>random</span>-чтений (из-за наличия <span
lang=EN-US style='mso-ansi-language:EN-US'>ORDER</span><span lang=EN-US> </span>в
планах таких запросов).</p>

<p class=MsoNormal>В рамках одной и той же транзакции, работающей в режиме <span
lang=EN-US style='mso-ansi-language:EN-US'>SNAPSHOT</span>, значения лимитов
диапазона для поиска могут поменяться только этой же транзакцией. Прикладным <i
style='mso-bidi-font-style:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>OLTP</span>-</i>модулям после выбора случайного <span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span> документа нет необходимости проводить
массовые изменения в том же источнике, где был сейчас этот выбор. Это означает,
что определение лимитов (<span lang=EN-US style='mso-ansi-language:EN-US'>id</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>min</span>, <span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>max</span>) можно сделать только один раз на всю транзакцию, при первом
вызове этой функции с соответствующими аргументами.</p>

<p class=MsoNormal>Значения <span lang=EN-US style='mso-ansi-language:EN-US'>id</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>min</span><span lang=EN-US> </span>и
<span lang=EN-US style='mso-ansi-language:EN-US'>id</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>max</span><span lang=EN-US> </span>для того
источника, который сейчас был задействован, запоминаются в контекстных
переменных уровня транзакции. Имена этих переменных генерируются по принципу: </p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>rdb$set_context('USER_TRANSACTION',
upper(:a_view_for_bounds)||'_ID_MIN', id_min);<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>rdb$set_context('USER_TRANSACTION',
upper(:a_view_for_bounds)||'_ID_MAX', id_max);</span><span lang=EN-US
style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>При последующих вызовах этой функции в рамках текущей
транзакции лимиты уже будут определены через извлечение чисел из контекстных
переменных, а не обращением к БД.</p>

<p class=MsoNormal><i style='mso-bidi-font-style:normal'>Замечание</i>. Порог,
регулирующий способ выбора случайного <span lang=EN-US style='mso-ansi-language:
EN-US'>id</span><span lang=EN-US> </span>в диапазоне {<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>min</span>, <span lang=EN-US style='mso-ansi-language:EN-US'>id</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>max</span>}, определяется контекстной
переменной уровня сеанса, её имя: 'RANDOM_SEEK_VIA_ROWS_LIMIT'.</p>

<p class=MsoNormal>Её значение задаётся в скрипте <span lang=EN-US
style='mso-ansi-language:EN-US'>oltp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>main</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>filling</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>sql</span><span lang=EN-US> </span>и
было выбрано равным 10000.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Fn</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>get</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>random</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>quantity</span><span
lang=EN-US> </span>– <span style='mso-spacerun:yes'> </span>возвращает случайное
значение <i style='mso-bidi-font-style:normal'>количества</i> из диапазона,
определяемого настройками – контекстными переменными. Нижний лимит всегда равен
1.</p>

<p class=MsoNormal>Эта функция используется для заполнения «корзины покупателя»
(таблицы <span lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>$<span
lang=EN-US style='mso-ansi-language:EN-US'>shopping</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>cart</span>), а также при формировании заказов
поставщику на основе клиентских заказов, при формировании инвойса от поставщика
на основе складских заказов, и др.</p>

<p class=MsoNormal>При формировании документов с контрагентом-<i
style='mso-bidi-font-style:normal'>покупателем</i> верхний лимит для генерации
случайного количества определяется контекстной переменной с именем: 'C_CUSTOMER_DOC_MAX_QTY';
при формировании документа с контрагентом-<i style='mso-bidi-font-style:normal'>поставщиком</i>
верхний лимит задается контекстной переменной с именем 'C_SUPPLIER_DOC_MAX_QTY’.
</p>

<p class=MsoNormal>Чем больше отношение C_SUPPLIER_DOC_MAX_QTY / C_CUSTOMER_DOC_MAX_QTY,
тем дольше будут выполняться операции формирования заказ поставщику, инвойса от
поставщика и – особенно – операция «проведения инвойса». Кроме того, тем чаще
будут возникать лок-конфликты при выполнени операции отмены проведения инвойса.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Fn</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>get</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>random</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>supplier</span>
– возвращает <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>
случайно выбираемого контрагента-поставщика;</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Fn</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>get</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>stack</span> – возвращает стек
вызовов в виде: <span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>имя_модуля1(строка:столбец) ==&gt; имя_модуля2(строка:столбец)
. . .</p>

<p class=MsoNormal>(строка «<span lang=EN-US style='mso-ansi-language:EN-US'>fn</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>get</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>stack</span>» в возвращаемую строку не
включается).</p>

<p class=MsoNormal>Функция вызывается только из процедуры <span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>add</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>to</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>abend</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span> и предназначена для регистрации того
места в коде, где произошло исключение.</p>

<p class=MsoNormal>Внимание: эта функция обращается к <span lang=EN-US
style='mso-ansi-language:EN-US'>mon</span>$-таблицам. На момент написания
данного текста были выявлены проблемы при её вызове в конкуретной среде,
приводящие к зависанию СУБД. Контекстная переменная 'ENABLE_MON_QUERY',
установленная в скрипте <span lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>main</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>filling</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>sql</span>, регулирует поведение этой функции:
если она равна <b style='mso-bidi-font-weight:normal'>0</b>, то функция вернёт
пустую строку без обращения к <span lang=EN-US style='mso-ansi-language:EN-US'>mon</span>$-таблицам.
Ожидается, что в ближайшем будущем разработчики <span lang=EN-US
style='mso-ansi-language:EN-US'>Firebird</span> устранят эту проблему и тогда
эту переменную можно будет установить в <b style='mso-bidi-font-weight:normal'><span
style='font-family:"Courier New"'>1</span></b>.</p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Fn</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>infinity</span> – возвращает <span
lang=EN-US style='mso-ansi-language:EN-US'>bigint</span>-число power(2, 64)-1,
интерпретируемое в коде как «бесконечность». Используется в некоторых выборках
для обхода проблемы ‘<span lang=EN-US style='mso-ansi-language:EN-US'>where</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>id</span> =
:<span lang=EN-US style='mso-ansi-language:EN-US'>a</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>selected</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>or</span> :<span lang=EN-US
style='mso-ansi-language:EN-US'>a</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>selected</span><span lang=EN-US> </span><span lang=EN-US
style='mso-ansi-language:EN-US'>id</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>is</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>null</span>’, при которой оптимизатор
игнорирует индекс по полю <span lang=EN-US style='mso-ansi-language:EN-US'>ID.</span></p>

<p class=MsoNormal>В версии 3.0 эта проблема решена (см. <span lang=EN-US
style='mso-ansi-language:EN-US'>Release</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>Notes</span>), но только частично
(например, для запросов с <span lang=EN-US style='mso-ansi-language:EN-US'>group</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>by</span>
она по-прежнему существует).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Fn</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>is</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>lock</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>troube</span>
( <span lang=EN-US style='mso-ansi-language:EN-US'>a</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>gdscode</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>int</span> ) – возвращает <span
lang=EN-US style='mso-ansi-language:EN-US'>true</span>, если код исключения <span
lang=EN-US style='mso-ansi-language:EN-US'>a</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>gdscode</span> относится к любому из следующих
видов: lock_conflict, concurrent_transaction, deadlock, update_conflict.
Вызывается из <span lang=EN-US style='mso-ansi-language:EN-US'>when-</span>секций,
обрабатывающих исключения.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Fn</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>is</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>snapshot</span> – возвращает <span
lang=EN-US style='mso-ansi-language:EN-US'>boolean</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>true</span>, если текущая транзакция
работает в режиме <span lang=EN-US style='mso-ansi-language:EN-US'>SNAPSHOT</span>.
Вызывается во всех прикладных модулях для проверки того, что тест сейчас
действительно работает в этом режиме.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Fn</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>is</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>uniqueness</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>troube</span>
( <span lang=EN-US style='mso-ansi-language:EN-US'>a</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>gdscode</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>int</span> ) – возвращает <span
lang=EN-US style='mso-ansi-language:EN-US'>true</span>, если код исключения <span
lang=EN-US style='mso-ansi-language:EN-US'>a</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>gdscode</span> относится к любому из следующих
видов: unique_key_violation, no_dup. Вызывается из небольшого числа <span
lang=EN-US style='mso-ansi-language:EN-US'>when</span>-секций, обрабатывающих
исключения так, что эти их виды можно подавить.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Fn</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>is</span><span style='background:
silver;mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>validation</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>trouble</span>
( <span lang=EN-US style='mso-ansi-language:EN-US'>a</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>gdscode</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>int</span>) - возвращает <span
lang=EN-US style='mso-ansi-language:EN-US'>true</span>, если код исключения <span
lang=EN-US style='mso-ansi-language:EN-US'>a</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>gdscode</span> относится к любому из следующих
видов: check_constraint, not_valid. Вызывается во ВСЕХ прикладных модулях в
секции обработки исключения. Если возникло исключение, нарушающее декларативные
правила бизнес-логики (например, неотрицательный остаток на складе), то тест
будет остановлен и «грязные» данные некоторых таблиц будут сброшены в их «<span
lang=EN-US style='mso-ansi-language:EN-US'>Z</span>-эквиваленты». Это позволило
найти и исправить большое количество логических ошибок в коде.<span lang=EN-US
style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Вызов этой функции выглядит везде одинаково:<span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>create or alter procedure sp_nnnn ( . . . )<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>returns ( . . . )<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>as<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>&lt;declarations&gt;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Begin<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>. . . </span><span
style='font-size:11.0pt;font-family:"Courier New"'>прикладной</span><span
style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:EN-US'> </span><span
style='font-size:11.0pt;font-family:"Courier New"'>код</span><span lang=EN-US
style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:EN-US'> . .
.<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>when any do<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>begin<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>        </span>execute
procedure sp_add_to_abend_log(<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>            </span>'',<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>           
</span>gdscode,<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>            </span></span><span
lang=DE style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:
DE'>v_msg||' '||v_info,<o:p></o:p></span></p>

<p class=MsoNormal><span lang=DE style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:DE'><span style='mso-spacerun:yes'>            </span></span><span
lang=EN-US style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'>v_this,<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>            </span>iif(
fn_is_validation_trouble(gdscode), 1, 0) -- ::: nb ::: 1 ==&gt; force HALT test<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>        </span>);<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>       
</span>--#######<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>       
</span>exception;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>        </span></span><span
style='font-size:11.0pt;font-family:"Courier New"'>--#######<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:11.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>end<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:11.0pt;font-family:"Courier New"'>end</span><span
lang=EN-US style='font-size:11.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Fn</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>mcode</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>for</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>oper</span>
– возвращает мнемокод вида операции (‘<span lang=EN-US style='mso-ansi-language:
EN-US'>RES</span>’ для клиентского резерва, ‘<span lang=EN-US style='mso-ansi-language:
EN-US'>SUP</span>’ для заказа поставщику, ‘<span lang=EN-US style='mso-ansi-language:
EN-US'>SAL</span>’ для проведенного резерва и т.п.). Нужна только для
облегчения анализа данных при отладке.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Fn</span><span style='background:silver;
mso-highlight:silver'>_</span><span lang=EN-US style='background:silver;
mso-highlight:silver;mso-ansi-language:EN-US'>oper</span><span
style='background:silver;mso-highlight:silver'>_</span><span lang=EN-US
style='background:silver;mso-highlight:silver;mso-ansi-language:EN-US'>XXXX</span>
– группа <span lang=EN-US style='mso-ansi-language:EN-US'>deterministic</span>-функций,
возвращающих <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span
lang=EN-US> </span>из справочника видов операций (таблица <span lang=EN-US
style='mso-ansi-language:EN-US'>optypes).<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='background:silver;mso-highlight:
silver;mso-ansi-language:EN-US'>Fn_remote_process</span><span lang=EN-US
style='mso-ansi-language:EN-US'> – </span>возвращает<span style='mso-ansi-language:
EN-US'> </span>имя<span style='mso-ansi-language:EN-US'> </span>клиентского<span
style='mso-ansi-language:EN-US'> </span>процесса<span lang=EN-US
style='mso-ansi-language:EN-US'> (</span>то<span style='mso-ansi-language:EN-US'>
</span>есть<span style='mso-ansi-language:EN-US'> </span>значение<span
lang=EN-US style='mso-ansi-language:EN-US'> rdb$get_context('SYSTEM',
'CLIENT_PROCESS')), </span>объявлена<span style='mso-ansi-language:EN-US'> </span>как<span
style='mso-ansi-language:EN-US'> <span lang=EN-US>deterministic. </span></span>Нужна
для отладки: некоторые режимы при работе с базой из среды <span lang=EN-US
style='mso-ansi-language:EN-US'>IB</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>Expert</span> было необходимо
изменить для более полного протоколирования.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>Описание таблиц<o:p></o:p></span></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Все таблицы имеют поле <span lang=EN-US style='mso-ansi-language:
EN-US'>ID</span>, являющееся первичным ключем. Его назначение самоочевидно и
оно ниже не упоминается.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>1. </b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>FIXED</span>-таблицы.<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Agents</span></b>. Справочник контрагентов, с
дополнительными признаками: «является покупателем ?», «поставщиком ?» или «наша
фирма ?» (для ускорения выборки случайного контрагента при большом числе
записей).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Doc</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>data</span></b>. Строковые
части документов («детализация»). Содержит ссылку на родительскую запись (поле ‘<span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>’, родительское поле: <span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>list</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>id</span>), ссылку на изделия (поле ‘<span lang=EN-US style='mso-ansi-language:
EN-US'>ware</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>id</span>’,
родительское поле: <span lang=EN-US style='mso-ansi-language:EN-US'>wares</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>),<span
style='mso-spacerun:yes'>  </span>ссылку на вид операции (поле <span
lang=EN-US style='mso-ansi-language:EN-US'>optype</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>), количество затребованное (<span
lang=EN-US style='mso-ansi-language:EN-US'>qty</span>). Также содержит
стоимость в закупочных (<span lang=EN-US style='mso-ansi-language:EN-US'>cost</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>purchase</span>) и розничных (<span
lang=EN-US style='mso-ansi-language:EN-US'>cost</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>retail</span>) ценах.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Doc</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>list</span></b>. Заголовки
документов. Содержат ссылки на справочники:<span style='mso-spacerun:yes'> 
</span>видов операций (<span lang=EN-US style='mso-ansi-language:EN-US'>optype</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>); контрагентов (<span
lang=EN-US style='mso-ansi-language:EN-US'>agent</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>); состояний документов (<span
lang=EN-US style='mso-ansi-language:EN-US'>state</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>). Для документов, являющихся
резервами с изделиями из клиентских заказов, необходимо наличие поля <span
lang=EN-US style='mso-ansi-language:EN-US'>base</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>id</span>. В этом поле содержится <span lang=EN-US style='mso-ansi-language:
EN-US'>ID</span> клиентского заказа, к которому «привязан» данный резерв.<span
style='mso-spacerun:yes'>  </span>В случае удаления этого резерва алгоритм
«выйдет» на соотв-щий клиентский заказ и проведет там необходимые корректировки
в поле <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>data</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>crq</span> (описание его см в таблице <span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>data</span>).</p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l13 level1 lfo5;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>Кроме
того, таблица <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>list</span> содержит накопительные
поля-«агрегаты» <span lang=EN-US style='mso-ansi-language:EN-US'>cost</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>purchase</span> &amp; <span
lang=EN-US style='mso-ansi-language:EN-US'>cost</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>retail</span> (сумма по закупочным и розничным
стоимостям изделий в строках <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>data</span> для этого документа) </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>При удалении строки в <span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>list</span>
будут удалены (каскадом) все подчиненные ей строки из <span lang=EN-US
style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>data</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Doc</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>states</span></b>. Справочник
состояний документов. Реализовано 4 состояния: «Открыт для изменений»,
«Зафиксирован» (доступны только отражения оплат), «Закрыт» и «Заблокирован».
Отличие закрытого от заблокированного в том, что первый можно перевести назад,
в зафиксированный статус, второй – нет. </p>

<p class=MsoNormal>Статус «Заблокирован» применяется только для клиентских
заказов, когда покупатель отказывается от своего заказа, но мы не можем удалить
такой документ ввиду того, что как минимум одна его строка уже попала в наш
заказ поставщику.</p>

<p class=MsoNormal>Все остальные виды документов допускают полную отмену
операций, приводивших их в состояние вплоть до «Закрыт», а также удаление в
состоянии «Открыт».</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Ext</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>stoptest</span></b>.
Внешняя таблица, отображаемая на текстовый файл, располагаемый на сервере.
Служит для корректной остановки теста, при которой все <span lang=EN-US
style='mso-ansi-language:EN-US'>isql</span>-окна будут «самозакрываться» с
откатом транзакций. Все модули теста перед началом своей работы проверяют
наличие в этой таблице хотя бы одной строки. Если такая строка есть, вызывается
исключение <span lang=EN-US style='mso-ansi-language:EN-US'>ex</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>test</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>cancellation</span>, после чего командный файл oltp_isql_run_worker.bat
прекратит цикл вызовов <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>
и закроет своё окно.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Fb</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>errors</span></b>. Справочник
стандартных кодов исключений <span lang=EN-US style='mso-ansi-language:EN-US'>Firebird</span>.
Служит только для удобства восприятия логов с ошибками. Содержит две поправки
по сравнению данными, взятыми из <span lang=EN-US style='mso-ansi-language:
EN-US'>Internet</span>:</p>

<p class=MsoNormal>1) коду 335544382 приписано пояснение &quot;<span
lang=EN-US style='mso-ansi-language:EN-US'>cannot</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>update</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>erased</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>record</span>&quot; вместо “<span
lang=EN-US style='mso-ansi-language:EN-US'>random</span> @1”</p>

<p class=MsoNormal>2) коду 335544517 приписано пояснение “<span lang=EN-US
style='mso-ansi-language:EN-US'>user</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>exception</span>” вместо “<span
lang=EN-US style='mso-ansi-language:EN-US'>exception</span>”<span lang=EN-US
style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Invnt_saldo</span></b>. Накопительный регистр
остатков по их видам. Формируется только через вызовы процедуры <span
lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>money</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span>, его <i style='mso-bidi-font-style:
normal'>данные</i> в <span lang=EN-US style='mso-ansi-language:EN-US'>OLTP</span>-тесте
*НЕ* используются (но могут понадобиться в будущих дополнениях к этому тесту,
если они будут имитировать построение отчетов). Данные в этом регистре
обновляются на основе лога – таблицы <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span><span
style='mso-spacerun:yes'>  </span><span style='mso-spacerun:yes'> </span>– и
выполняется эта операция только тем коннектом, который смог установить
блокировку на «семафорной» строке таблицы <span lang=EN-US style='mso-ansi-language:
EN-US'>semaphores</span> (см ниже). При неудачной блокировке коннект НЕ
прерывает работу .<span lang=EN-US style='mso-ansi-language:EN-US'>sql</span>-скрипта,
а приступает к другому заданию.</p>

<p class=MsoNormal>Таким обр., формирование этого регистра идёт как бы в
«монопольном» режиме. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Таблица <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span> содержит следующие
поля.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>clo</span> – сумма количеств в <i
style='mso-bidi-font-style:normal'>не</i> отмененных клиентских заказах, по
которым мы еще НЕ создавали заказа поставщикам (т.е. которые мы ДОЛЖНЫ заказать).</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>clr</span> – сумма количеств в
отменённых клиентских заказах (находятся в состоянии «заблокирован»)</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>ord</span> – сумма количеств в наших
заказах поставщикам, по которым нам еще не были присланы инвойсы (т.е.
поставщики еще не подтвердили отправку нам этих количеств).</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>sup</span> – сумма количеств в НЕ
проведенных инвойсах (поставщик подтвердил наш заказ и выслал инвойс, мы
занесли инвойс в БД, однако еще не «провели» его, т.е. не добавили к свободным
остаткам склада).</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>avl</span> – сумма количеств в
разряде «Свободный остаток». Возникает, когда покупателем по соотв. клиентскому
заказу является «наша фирма»: нет смысла резервировать изделия для самих себя,
эти изделия будут продаваться сторонним клиентам.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>res</span> – сумма количеств в
разряде «Зарезервировано». Если в результате оприходования инвойса были найдены
клиентские заказы, в которых есть изделия из этого инвойса, и по ним мы еще не
проводили резерв, то алгоритм начнёт немедленное резервирование, чтобы такие
изделия не появились в свободном доступе.<span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>out</span> – количество
реализованное.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Cost</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>inc</span> – сумма оприходованного
количества в закупочных стоимостях. Увеличивается при проведении инвойсов.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Cost</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>out</span> – сумма реализованного
количества, также в закупочных стоимостях.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>acn</span> – вычисляемое поле,
является суммой <span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>avl</span> + <span lang=EN-US
style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>res</span>: количественный остаток по данным бухучета.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Cost</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>out</span> - вычисляемое поле,
является разностью (<span lang=EN-US style='mso-ansi-language:EN-US'>cost</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>inc</span> – <span lang=EN-US
style='mso-ansi-language:EN-US'>cost</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>out</span>): стоимостной остаток по данным бухучета.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>На таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span><span lang=EN-US> </span>установлено
ограничение: <span lang=EN-US style='mso-ansi-language:EN-US'>check</span> (<span
lang=EN-US style='mso-ansi-language:EN-US'>NOT</span> (<span lang=EN-US
style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>acn</span> = 0 <span lang=EN-US style='mso-ansi-language:EN-US'>and</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>cost</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>acn</span>&lt;&gt;0 <span
lang=EN-US style='mso-ansi-language:EN-US'>or</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>acn</span>&lt;&gt;0 <span lang=EN-US
style='mso-ansi-language:EN-US'>and</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>cost</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>acn</span>=0 )). Оно помогло выявить несколько
крайне трудных в обнаружении алгоритмических ошибок</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Invnt_turnover_log<span
style='mso-spacerun:yes'>  </span></span></b>. Журнал любых изменений количеств
по операциям. Хранит как положительные, так и отрицательные значения изменений.
Записи в эту таблицу добавляются (и <i style='mso-bidi-font-style:normal'>только</i>
добавляются) всеми процедурами, выполняющими формирование складских документов.
Записи из этой таблицы удаляются только при успешной корректировке таблицы ‘<span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span>’ в процедуре <span lang=EN-US
style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>make</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span> (и <i style='mso-bidi-font-style:
normal'>только в этой</i> процедуре происходит удаление этих строк).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Money_turnover_log</span></b>. Журнал всех
изменений стоимостных балансов контрагентов. Хранит как положительные, так и
отрицательные значения изменений. Записи в эту таблицу добавляются (и <i
style='mso-bidi-font-style:normal'>только</i> добавляются) <span lang=EN-US
style='mso-ansi-language:EN-US'>after</span>-<span lang=EN-US style='mso-ansi-language:
EN-US'>IUD</span> триггером таблицы <span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>list</span>,
причём добавление происходит только для тех операций, которые действительно
должны поменять баланс контрагента. </p>

<p class=MsoNormal>Решение о том, влияет ли операция на баланс контрагента,
принимается на основании значения множителя <span lang=EN-US style='mso-ansi-language:
EN-US'>optypes</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>m</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>cust</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>debt</span> (для операций с покупателями) и <span
lang=EN-US style='mso-ansi-language:EN-US'>optypes</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>m</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>supp</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>debt</span>
(для операций с поставщиками), где <span lang=EN-US style='mso-ansi-language:
EN-US'>optypes</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>id</span>
= значению<span style='mso-spacerun:yes'>  </span>поля <span lang=EN-US
style='mso-ansi-language:EN-US'>optype</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span> корректируемой сейчас таблицы <span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>list</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Optypes</span></b>. Справочник видов операций,
с «картой» множителей, показывающих влияние этих операций на количественные и
стоимостные остатки изделий, а также на балансы контрагентов.</p>

<p class=MsoNormal>Поля <span lang=EN-US style='mso-ansi-language:EN-US'>m</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>clo</span>, <span lang=EN-US style='mso-ansi-language:
EN-US'>m</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>clr</span>, <span lang=EN-US
style='mso-ansi-language:EN-US'>m</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>qty</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>ord</span>, <span
lang=EN-US style='mso-ansi-language:EN-US'>m</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>sup</span>, <span lang=EN-US style='mso-ansi-language:EN-US'>m</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>avl</span>, <span lang=EN-US style='mso-ansi-language:
EN-US'>m</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>res</span>, <span lang=EN-US
style='mso-ansi-language:EN-US'>m</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>cost</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>inc</span><span
lang=EN-US> </span>и <span lang=EN-US style='mso-ansi-language:EN-US'>m</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>cost</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>out</span> показывают влияние на остатки
изделий и соответствуют полям таблицы <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>,
если убрать префикс ‘<span lang=EN-US style='mso-ansi-language:EN-US'>m</span>_’
(см выше).</p>

<p class=MsoNormal>Поля<span style='mso-spacerun:yes'>  </span><span
lang=EN-US style='mso-ansi-language:EN-US'>m</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>cust</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>debt</span> и <span lang=EN-US style='mso-ansi-language:EN-US'>m</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>supp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>debt</span> содержат множители к балансам
контрагентов, если рассматривать их как покупателей (‘<span lang=EN-US
style='mso-ansi-language:EN-US'>m</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>cust</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>debt</span>’)
или же как поставщиков (‘<span lang=EN-US style='mso-ansi-language:EN-US'>m</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>supp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>debt</span>’).</p>

<p class=MsoNormal>Все множители могут иметь только одно из трёх значений: -1,
0 и 1.<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Запрос этих множителей производится в процедурах <span
lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>money</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>saldo</span><span lang=EN-US> </span>и <span
lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>money</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>money</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>, формирующих сводные
регистры остатков и балансов.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Perf</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>log</span></b>. Лог
времени выполнения модулей. Каждый модуль пишет в эту таблицу момент своего
начала и, в зависимости от ситуации, момент <i style='mso-bidi-font-style:normal'>успешного</i>
или <i style='mso-bidi-font-style:normal'>аварийного</i> завершения. Кроме
того, в эту табицу (чаще всего – при аварийном завершении) будет записана
некоторая детализирующая информация для возможной отладки. На основании данных
этой таблицы можно сделать несколько ХП или представлений, показывающих
производительность в виде «развёртки во времени», а также процент аварийных
звершений модулей. Высокий процент аварийных завершений свидтельствует о
большом числе <span lang=EN-US style='mso-ansi-language:EN-US'>lock</span>-конфликтов.</p>

<p class=MsoNormal>В таблице <span lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span><span lang=EN-US> </span>*НЕ*
должно быть строк с кодами ошибок 335544347,335544558 (<span lang=EN-US
style='mso-ansi-language:EN-US'>check</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>violations</span>). Наличие таких
строк однозначно будет говорить об алгоритмических ошибках.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Phrases</span></b>. Вспомогательная таблица,
которую можно применить для формирования корзины покупателя не через выбор <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span> изделий из таблицы <span
lang=EN-US style='mso-ansi-language:EN-US'>wares</span>, а через поиск по
шаблонам (<span lang=EN-US style='mso-ansi-language:EN-US'>similar</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>to</span>).
Заполнение этой таблицы занимает длительное время и производится только при
наличии команды:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>insert into
settings(working_mode, mcode,<span style='mso-spacerun:yes'>            
</span>stype,<span style='mso-spacerun:yes'>     </span>svalue)<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>              </span>values('COMMON',<span
style='mso-spacerun:yes'>       </span>'ENABLE_FILL_PHRASES',<span
style='mso-spacerun:yes'>  </span>'int', '1');<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>в<span style='mso-ansi-language:EN-US'> </span>скрипте<span
style='mso-ansi-language:EN-US'> <span lang=EN-US>oltp_main_filling.sql<o:p></o:p></span></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal>Если формирование корзины через поиск шаблонов разрешен, то
будет интенсивное использование <span lang=EN-US style='mso-ansi-language:EN-US'>similar</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>to</span>
(см ХП <span lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>client</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>order</span>). В настоящее время <span
lang=EN-US style='mso-ansi-language:EN-US'>similar</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>to</span><span lang=EN-US> </span>является
одним из проблемных мест в ФБ в плане производительности: существуют шаблоны,
которые ищутся необъяснимо долго. Поэтому возможность его тестирования будет не
лишней.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Rules</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>for</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>qdistr</span></b>. Вспомогательная таблица, содержащая в каждой строке:</p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l14 level1 lfo17;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>мнемоническое
обозначение алгоритма, который будет применён при вводе нового <i
style='mso-bidi-font-style:normal'>количества</i> в детализацию документа (т.е.
в <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>data</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>qty</span>) – поле ‘<span lang=EN-US style='mso-ansi-language:EN-US'>mode</span>’;
</p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l14 level1 lfo17;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>код
операции, при которой введенной в <span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>data</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>qty</span> количество будет являться
«<i style='mso-bidi-font-style:normal'>источником»</i> для последующего
сторнирования – поле ‘<span lang=EN-US style='mso-ansi-language:EN-US'>snd</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>optype</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>’; каждое количество из <span
lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>data</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>qty</span><span lang=EN-US> </span>для такой операции-«источника»
(натуральное число, <span lang=EN-US style='mso-ansi-language:EN-US'>N</span>)
будет отображено в <span lang=EN-US style='mso-ansi-language:EN-US'>N</span><span
lang=EN-US> </span>записей, добавляемых в таблицу <span lang=EN-US
style='mso-ansi-language:EN-US'>QDISTR</span>. Пример операции-«источника»:
клиентский заказ на поставку изделий. </p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l14 level1 lfo17;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>3)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>код
операции-«приемника», при которой для введенного в <span lang=EN-US
style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>data</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>qty</span>
количества будет проведён <i style='mso-bidi-font-style:normal'>поиск</i>
записей-«источников» в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span><span
lang=EN-US> </span>и они будут перемещены из этой таблицы в <span lang=EN-US
style='mso-ansi-language:EN-US'>QSTORNED</span>. Поле – ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>rcv</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>optype</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>id</span>’.
Пример операции-«приемника» для клиентского заказа – операция «Наш заказ
поставщику».</p>

<p class=MsoNormal>Если поле <span lang=EN-US style='mso-ansi-language:EN-US'>rules</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>for</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>qdistr</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>mode</span><span lang=EN-US> </span>записано ‘new_doc_only’,
то это означает, что для одного из кодов операций (тот, который <span
lang=EN-US style='mso-ansi-language:EN-US'>not</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>null</span><span lang=EN-US> </span>–
см содержимое таблицы) не требуется искать строки-«источники». Таких ситуаций в
тесте две: создание клиентского заказа и проведение резерва.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Если поле <span lang=EN-US style='mso-ansi-language:EN-US'>rules</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>for</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>qdistr</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>mode</span><span lang=EN-US> </span>записано ‘<span
lang=EN-US style='mso-ansi-language:EN-US'>distr</span>+<span lang=EN-US
style='mso-ansi-language:EN-US'>new</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>doc</span>’, то это значит, что при <i style='mso-bidi-font-style:normal'>создании</i>
(‘<span lang=EN-US style='mso-ansi-language:EN-US'>new</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>doc</span>’) документа, код операции которого
записан в поле <span lang=EN-US style='mso-ansi-language:EN-US'>rcv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>optype</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>, будет проведено сторнирование (‘<span
lang=EN-US style='mso-ansi-language:EN-US'>distr</span>’) количества со строк
документов, коды операций которых записаны в поле <span lang=EN-US
style='mso-ansi-language:EN-US'>snd</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>optype</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>id</span>.
Например, при создании инвойса от поставщика (код операции = 2000) будет
проведено сторнирование количеств с документов, у которых код операции есть
«Складской заказ поставщику» (код = 1200).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Если в поле <span lang=EN-US style='mso-ansi-language:EN-US'>rules</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>for</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>qdistr</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>mode</span><span lang=EN-US> </span>записано ‘<span
lang=EN-US style='mso-ansi-language:EN-US'>mult</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>rows</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>only</span>’, то это значит, что сторнирование будет проводиться как при
создании документа с кодом <span lang=EN-US style='mso-ansi-language:EN-US'>snd</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>optype</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>, так и при изменении его состояния,
код которого опять-таки записан в поле <span lang=EN-US style='mso-ansi-language:
EN-US'>snd</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>optype</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>.</p>

<p class=MsoNormal>Таких ситуаций в тесте реализовано две: </p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l8 level1 lfo18;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>проведение
инвойса (т.е. перевод его в такое состояние, при котором изделия считаются
доступными для резервирования) – это реализовано через изменение кода операции
в заголовке документа с 2000 на 2100. При проведении инвойса необходимо каждое <i
style='mso-bidi-font-style:normal'>количество</i> из его строк «размножить» на
соотв-щее число строк, чтобы далее они могли быть сторнированы операцией
«Проведение РЕЗЕРВА» (код 3300);</p>

<p class=MsoNormal style='margin-left:36.0pt;text-indent:-18.0pt;mso-list:l8 level1 lfo18;
tab-stops:list 36.0pt'><![if !supportLists]><span style='mso-list:Ignore'>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><![endif]>создание
клиентского заказа: при формировании этого документа каждую его строку с
количеством = <span lang=EN-US style='mso-ansi-language:EN-US'>N</span>
необходимо «размножить» (отобразить строками в таблице <span lang=EN-US
style='mso-ansi-language:EN-US'>QDISTR</span>) так, чтобы далее их можно было
сторнировать всё той же операцией «Проведение РЕЗЕРВА» (код 3300). </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Таким образом, продажа изделий сторнирует количества сразу в
<i style='mso-bidi-font-style:normal'>двух</i> видах документов: в инвойсах и в
клиентских заказах. Первое сторнирование (в инвойсах) позволяет получить
информацию, сколько количества продано по выбранному приходу, а второе (в
клиентских заказах) – по каким изделиям и в каком объёме мы выполнили свои
обязательства перед клиентами (заказчиками).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Qdistr</span>, </b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>Qstorned</span></b> –
это пара таблиц, служащих для хранения информации об <i style='mso-bidi-font-style:
normal'>ожидаемых</i> (<span lang=EN-US style='mso-ansi-language:EN-US'>qdistr</span>)
и <i style='mso-bidi-font-style:normal'>свершенных</i> (<span lang=EN-US
style='mso-ansi-language:EN-US'>qstorned</span>) сторнированиях <i
style='mso-bidi-font-style:normal'>количеств</i>. </p>

<p class=MsoNormal>Когда создается документ, код операции которого присутствует
в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>RULES</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>FOR</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>QDISTR</span> (а это все документы, за
исключением платежей), то каждое значение <i style='mso-bidi-font-style:normal'>количества</i>
в его строках (<span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>data</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>qty</span>) будет отображено на добавленные
строки в таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span>,
причем число добавленных строк будет равно этому количеству. Далее, проводится
проверка: а не нужно ли сейчас выполнить не только добавление новых записей в <span
lang=EN-US style='mso-ansi-language:EN-US'>QDISTR</span>, но и сторнирование
других записей, которые ранее были доавлены в эту таблицу и которые относятся к
документам, находящимся непосредственно перед текущим документом в
бизнес-цепочке. </p>

<p class=MsoNormal>Например, при создании нашего <span style='background:silver;
mso-highlight:silver'>заказа поставщику</span> необходимо:</p>

<p class=MsoNormal>1) добавить строки в <span lang=EN-US style='mso-ansi-language:
EN-US'>QDISTR</span> для <i style='mso-bidi-font-style:normal'>последующего</i>
их сторнирования количествами, создаваемыми <i style='mso-bidi-font-style:normal'>инвойсами</i>
от поставщика; инвойс – это документ, который находится в бизнес-цепочке
«после» <span style='background:silver;mso-highlight:silver'>заказа поставщику</span>
(т.е. «справа» от него);</p>

<p class=MsoNormal>2) найти строки из <i style='mso-bidi-font-style:normal'>клиентских</i>
заказов, которые необходимо сторнировать, т.к. сейчас мы создаём документ на
основе содержимого этих клиентских заказов. Клиентский заказ – это документ,
который находится в бизнес-цепочке «перед» <span style='background:silver;
mso-highlight:silver'>заказом поставщику</span> (т.е. «слева» от него). Каждую
такую строку следует перенести в таблицу <span lang=EN-US style='mso-ansi-language:
EN-US'>QSTORNED</span>, добавив в неё информацию о том, «кто» её сторнировал.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Замечание. Тест предполагает, что все количества представлены
только в виде натуральных чисел. Не очень сложно, впрочем, переделать его и на
общий вариант, с действительными числами (см. ниже, таблицы <span lang=EN-US
style='mso-ansi-language:EN-US'>PDISTR</span><span lang=EN-US> </span>и <span
lang=EN-US style='mso-ansi-language:EN-US'>PSTORNED</span>, хранящие информацию
о распределении <i style='mso-bidi-font-style:normal'>стоимостей</i>).</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Rules</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>for</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>pdistr</span></b>. Вспомогательная таблица, используемая при
формировании <i style='mso-bidi-font-style:normal'>платежных</i> документов, а
также при <i style='mso-bidi-font-style:normal'>изменении состояния</i>
инвойсов и резервов, и содержащая в каждой строке:</p>

<p class=MsoNormal>1) мнемоническое обозначение ситуации, при которой ввод в
платежный документ значения его суммы требует генерации новых строк –
«источников» для последующего сторнирования. Таких ситуаций реализовано четыре:
</p>

<p class=MsoNormal>1.1) ввод платежа (возможно – аванса) от покупателя, сумма
которого будет затем<span style='mso-spacerun:yes'>  </span>сторнирована
проведенными резервами (т.е. реализацией) этому покупателю; </p>

<p class=MsoNormal>1.2) проведение резерва (возможно – отпуск товара «в долг»),
сумма которого будет затем сторнирована вводимыми платежами от этого
покупателя;</p>

<p class=MsoNormal>1.3) ввода платежа (возможно – аванса) поставщику, сумма
которого будет затем сторнирована поставленными товарами;</p>

<p class=MsoNormal>1.4) проведение иинвойса от поставщика, сумма которого будет
затем сторнирована нашими оплатами.</p>

<p class=MsoNormal>2) код операции, являющейся «источником» для последующего
сторнирования;</p>

<p class=MsoNormal>3) код операции, являющейся «приемником» при проведении
сторнирования;</p>

<p class=MsoNormal>4) число строк, на которое следует разбить сумму либо
платежа, либо проводимого сейчас инвойса / резерва. Регулируется настройкой, см.
таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>settings</span>, условие:
<span lang=EN-US style='mso-ansi-language:EN-US'>working</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>mode</span> = ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>COMMO</span>’ <span lang=EN-US
style='mso-ansi-language:EN-US'>and</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>mcode</span> = '<span lang=EN-US
style='mso-ansi-language:EN-US'>C</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>ROWS</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>TO</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>MULTIPLY</span>' (скрипт – <span
lang=EN-US style='mso-ansi-language:EN-US'>oltp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>main</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>filling</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>sql</span>).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Pdistr</span>, </b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>Pstorned</span></b><span
lang=EN-US> </span>– это пара таблиц, служащих для хранения информации об <i
style='mso-bidi-font-style:normal'>ожидаемых</i> (<span lang=EN-US
style='mso-ansi-language:EN-US'>pdistr</span>) и <i style='mso-bidi-font-style:
normal'>свершенных</i> (<span lang=EN-US style='mso-ansi-language:EN-US'>pstorned</span>)
сторнированиях <i style='mso-bidi-font-style:normal'>стоимостей</i>. Новые
строки в таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span>
попадают при формировании нового платежного документа, либо при проведении
инвойса или проведении резерва. </p>

<p class=MsoNormal>Число добавляемых строк определяется правилом: если сумма
меньше 1000, то добавится одна строка, иначе сумма документа будет разделена на
10 частей, затем каждая часть будет округлена до 1000 (для проведения инвойсов
или наших платежей поставщикам) или до 100 (для проведения резервов или
платежей от клиентов). Далее в таблицу <span lang=EN-US style='mso-ansi-language:
EN-US'>PDISTR</span><span lang=EN-US> </span>будет добавлено такое число
строк,<span style='mso-spacerun:yes'>  </span>которое обеспечит вводимую сумму
(в последней строке будет проведено уменьшение стоимости для удаления
результатов превышения). Значение стоимости, которая должна быть сторнирована,
записано в поле <span lang=EN-US style='mso-ansi-language:EN-US'>SND</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>COST</span>. Операция документа,
являющегося при этом «источником» для сторнирования – поле <span lang=EN-US
style='mso-ansi-language:EN-US'>SND</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>OPTYPE</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>.
Операция документа, при создании которого будет проведено сторнирование – поле <span
lang=EN-US style='mso-ansi-language:EN-US'>RCV</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>OPTYPE</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span>. Поле <span lang=EN-US
style='mso-ansi-language:EN-US'>SND</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>ID</span> совпадает с <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span
lang=EN-US> </span>документа (его заголовка, см <span lang=EN-US
style='mso-ansi-language:EN-US'>doc</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>list</span>.<span lang=EN-US style='mso-ansi-language:EN-US'>id</span>).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Когда выполняется проведение инвойса от поставщика, в
таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span> будут
добавлены строки, сумма которых равна закупочной стоимости изделий этого
инвойса (поле <span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>list</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>cost</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>purchase</span>). Далее, когда вводится наш платёж поставщику, то
необходимо проверить наличие для этого контрагента всех <i style='mso-bidi-font-style:
normal'>проведённых</i> инвойсов, стоимости которых еще не были оплачены (или
были оплачены, но не в полном объеме). Поскольку проведение инвойса
сопровождается добавлением строк в <span lang=EN-US style='mso-ansi-language:
EN-US'>PDISTR</span>, при вводе нашей оплаты нужно проверить наличие в <span
lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span> таких строк и
попытаться заблокировать каждую из них – до тех пор, пока общая сумма по полю <span
lang=EN-US style='mso-ansi-language:EN-US'>pdistr</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>snd</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>cost</span> не станет равной или большей, чем сумма вводимого сейчас
платежа. Факт получения блокировки означает, что мы действительно можем
сторнировать соответствующую <i style='mso-bidi-font-style:normal'>часть</i>
стоимости.</p>

<p class=MsoNormal>При сторнировании стоимостей информация переносится из <span
lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span><span lang=EN-US> </span>в
таблицу <span lang=EN-US style='mso-ansi-language:EN-US'>PSTORNED</span>.</p>

<p class=MsoNormal>Сторнирование стоимости, в отличие от количества,
выполняется более сложно. Допустим, инвойс был на сумму 1234. При этом в <span
lang=EN-US style='mso-ansi-language:EN-US'>pdistr</span> будет добавлено 2
строки, причём в первой будет записано <span lang=EN-US style='mso-ansi-language:
EN-US'>snd</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>cost</span>
=1000, а во второй – 234. Если далее вводится наш платеж поставщику на сумму
800, то мы НЕ можем перенести всю стоимость с первой строки (т.е. 1000),
поскольку она превышает наш платеж.</p>

<p class=MsoNormal>Вместо этого, нам нужно добавить в <span lang=EN-US
style='mso-ansi-language:EN-US'>PSTORNED</span> строку только с той стоимостью,
что обеспечивается нашим платежом – т.е. 800. Но это означает, что часть
стоимости (1000 – 800 = 200) должна остаться в таблице <span lang=EN-US
style='mso-ansi-language:EN-US'>PDISTR.</span></p>

<p class=MsoNormal>Если затем будет введен еще один платеж, на сумму 150, то мы
должны сторнировать в <span lang=EN-US style='mso-ansi-language:EN-US'>PDISTR</span><span
lang=EN-US> </span>запись с остатком от предыдущего нашего платежа (ту, в
которой записано теперь <span lang=EN-US style='mso-ansi-language:EN-US'>snd</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>cost</span> = 200) и добавить в <span
lang=EN-US style='mso-ansi-language:EN-US'>PSTORNED</span><span lang=EN-US> </span>запись
с суммой 150.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><i style='mso-bidi-font-style:
normal'>Замечание</i></b><i style='mso-bidi-font-style:normal'> о
производительности при операциях над таблицами </i><i style='mso-bidi-font-style:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>xDistr</span>, </i><i
style='mso-bidi-font-style:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>xStorned</span>.<o:p></o:p></i></p>

<p class=MsoNormal>Таблицы ожидаемых (<span lang=EN-US style='mso-ansi-language:
EN-US'>qdistr</span>, <span lang=EN-US style='mso-ansi-language:EN-US'>pdistr</span>)
и совершённых (<span lang=EN-US style='mso-ansi-language:EN-US'>qstorned</span>,
<span lang=EN-US style='mso-ansi-language:EN-US'>pstorned</span>) сторнирований
находятся в постоянном обмене данными. Все «прямые» операции приводят к
переносу информации из <span lang=EN-US style='mso-ansi-language:EN-US'>xDistr</span>
в <span lang=EN-US style='mso-ansi-language:EN-US'>xStorned</span>, причём он
достаточно большой – рчеь идёт о сотнях строк на каждый документ среднего
размера. Все «отменяющие» операции приводят к обратным перемещениям записей.</p>

<p class=MsoNormal>Кроме того, тест сделан так, чтобы уменьшить число
исключений, вызванных лок-конфликтами. Это реализовано через попытки «тихо»
заблокировать записи вызовами вида <span lang=EN-US style='mso-ansi-language:
EN-US'>select</span><span lang=EN-US> </span>… <span lang=EN-US
style='mso-ansi-language:EN-US'>from</span><span lang=EN-US> </span>… <span
lang=EN-US style='mso-ansi-language:EN-US'>for</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>update</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>with</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>lock</span><span lang=EN-US> </span>–
с перехватом и подавлением исключения, если оно относится к <span lang=EN-US
style='mso-ansi-language:EN-US'>lock</span>-конфликтам.</p>

<p class=MsoNormal>Очевидно, что эти две таблицы могут содержать значительно
число мусорных версий строк. Любой поиск в этих таблицах (в т.ч. проверка
существования через <span lang=EN-US style='mso-ansi-language:EN-US'>exists</span>)
будет сопровождаться задержками в связи с кооперативной сборкой мусора. Индексы
по полям <span lang=EN-US style='mso-ansi-language:EN-US'>rcv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>optype</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span><span lang=EN-US> </span>и <span
lang=EN-US style='mso-ansi-language:EN-US'>snd</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>optype</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span> имеют очень низкую селективность
(0.25 и 0.2), поэтому они непригодны для поиска, где в плане имеется <span
lang=EN-US style='mso-ansi-language:EN-US'>ORDER</span>.</p>

<p class=MsoNormal>В тех <span lang=EN-US style='mso-ansi-language:EN-US'>view</span>,
где есть необходимость проверки наличия строк <span lang=EN-US
style='mso-ansi-language:EN-US'>c</span><span lang=EN-US> </span>критериями “<span
lang=EN-US style='mso-ansi-language:EN-US'>where</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>rdv</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>optype</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span> = “ (и аналогично для <span
lang=EN-US style='mso-ansi-language:EN-US'>snd</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>optype</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>), выполнено искуственное подавление
выбора индексов оптимизатором через «+0».<span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Money</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span></b>. Накопительный
регистр балансов контрагентов (положительных и отрицательных). Формируется
только через вызовы процедуры <span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>money</span><span lang=EN-US> </span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>, его <i
style='mso-bidi-font-style:normal'>данные</i> в <span lang=EN-US
style='mso-ansi-language:EN-US'>OLTP</span>-тесте *НЕ* используются (но могут
понадобиться в будущих дополнениях к этому тесту, если они будут имитировать
построение отчетов). Данные в этом регистре обновляются на основе лога –
таблицы <span lang=EN-US style='mso-ansi-language:EN-US'>money</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>turnover</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span> – и выполняется эта операция только
тем коннектом, который смог установить блокировку на «семафорной» строке таблицы
<span lang=EN-US style='mso-ansi-language:EN-US'>semaphores</span> (см ниже).
При неудачной блокировке коннект НЕ прерывает работу .<span lang=EN-US
style='mso-ansi-language:EN-US'>sql</span>-скрипта, а приступает к другому
заданию.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Semahores</span></b>.<span
style='mso-spacerun:yes'>  </span>Таблица, строки которой созданы только для
того, чтобы их блокировали, что обеспечит строго последовательный доступ к
некоторым алгоритмам. Если некоторый алгоритм должен вызываться в любой момент
времени не более, чем одним коннектом, то этот алгоритм должен сначала <i
style='mso-bidi-font-style:normal'>попытаться </i>заблокировать некоторую
специальную строку. Только если такая блокировка успешна, он может продолжать
свою работу. Блокировка, разумеется, будет снята только при завершении
транзакции. Если же блокировка не удалась, то алгоритм должен зарегистрировать
это и «тихо» выйти, т.е. не выбрасывая исключение.</p>

<p class=MsoNormal>На момент написания этого текста в таблице <span lang=EN-US
style='mso-ansi-language:EN-US'>Semaphores</span> имеется три строки со
следующими значениями в поле ‘<span lang=EN-US style='mso-ansi-language:EN-US'>task</span>’:
‘<span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>money</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>’;
‘<span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>’
и ‘<span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>recalc</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>idx</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>stat</span>’. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Settings</span></b>. Таблица настроек,
регулирующих работу теста.</p>

<p class=MsoNormal>Поле ‘<span lang=EN-US style='mso-ansi-language:EN-US'>working</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>mode</span>’ содежит значения,
которые являются общими для нескольких строк.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Значение <span lang=EN-US style='mso-ansi-language:EN-US'>settings</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>working</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>mode</span> = ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>COMMON</span>’ относится к настройкам, общим
для любых режимов работы теста.</p>

<p class=MsoNormal>Значение <span lang=EN-US style='mso-ansi-language:EN-US'>settings</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>working</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>mode</span> = ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>INIT</span>’ определяет «нагрузочный режим»: от
слабого до сильного (см ниже, «нагрузочные пакеты»).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Некоторые настройки из группы ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>COMMON</span>’ оказывают сильное влияние на
производительность:</p>

<p class=MsoNormal>1) <span lang=EN-US style='mso-ansi-language:EN-US'>settings</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>mcode</span> = ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>LOG</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>ERRORS</span>’ – регистрировать ли пользовательские исключения в таблице
<span lang=EN-US style='mso-ansi-language:EN-US'>abend</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>;<br>
2) <span lang=EN-US style='mso-ansi-language:EN-US'>settings</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'>mcode</span> ='LOG_AUX_INFO’ – добавлять
ли регистрацию некоторых информационных сообщений в лог;</p>

<p class=MsoNormal>3) 'LOG_PERF_IN_AUTONOM_TX' – выполнять ли регистрацию
моментов «входа» и «выхода» из каждого модуля для последующего анализа
производительности (это делается в автономных транзакциях, при большой нагрузке
возможно сильное уменьшение производительности);</p>

<p class=MsoNormal>4) 'ENABLE_MON_QUERY' – разрешить ли при регистрации ошибок
обращение к <span lang=EN-US style='mso-ansi-language:EN-US'>mon</span>$-таблицам
для получения стека вызовов. При разрешенном вызове <span lang=EN-US
style='mso-ansi-language:EN-US'>mon</span>$-таблиц были неоднократно замечены
зависания коннектов и невозможность подключения к базе! Если запрещено, то
вместо стека вызовов будет указано просто имя модуля (ХП, триггера или
функции).</p>

<p class=MsoNormal>5) 'ENABLE_FILL_PHRASES' -<span style='mso-spacerun:yes'> 
</span>создать ли в стартовом скрипте (<span lang=EN-US style='mso-ansi-language:
EN-US'>oltp</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>main</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>filling</span>.<span lang=EN-US
style='mso-ansi-language:EN-US'>sql</span>) набор строковых шаблонов для
использования <span lang=EN-US style='mso-ansi-language:EN-US'>similar</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>to</span> вместо
выборки через случайные <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>.<span
lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>6) '<span lang=EN-US style='mso-ansi-language:EN-US'>NUMBER</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>OF</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>AGENTS</span>' -<span
style='mso-spacerun:yes'>  </span>число контрагентов, которое необходимо
создать в стартовом скрипте заполнения справочников. При небольшом числе будут
частые <span lang=EN-US style='mso-ansi-language:EN-US'>lock</span>-конфликты в
процедурах ввода платежей и их <span lang=EN-US style='mso-ansi-language:EN-US'>FIFO</span>-распределении.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>В остальных строках поле <span lang=EN-US style='mso-ansi-language:
EN-US'>working</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>mode</span>
содержит мнемокоды, отражающие степень загрузки СУБД.</p>

<p class=MsoNormal>Например, группа ‘<span lang=EN-US style='mso-ansi-language:
EN-US'>SMALL</span>_01’ показывает настройки, которые должны использоваться при
очень небольшом количестве коннектов.</p>

<p class=MsoNormal>Эти группы строк формируют «нагрузочные пакеты».</p>

<p class=MsoNormal>Наибольшее влияние в каждом таком пакете играет соотношение
между максимальным числом строк в клиентском документе и документе поставщика
(переменные 'C_CUSTOMER_DOC_MAX_ROWS’ и 'C_SUPPLIER_DOC_MAX_ROWS'): чем оно
больше, тем чаще будут возникать <span lang=EN-US style='mso-ansi-language:
EN-US'>lock</span>-конфликты при записи результатов <span lang=EN-US
style='mso-ansi-language:EN-US'>FIFO</span>-распределений. </p>

<p class=MsoNormal>Кроме того, очень сильное влияние оказывает параметр 'C_WARES_MAX_ID'
– число строк, которое должна иметь в результате начальной загрузки данных
таблица <span lang=EN-US style='mso-ansi-language:EN-US'>wares</span>. Чем оно
больше, тем конфликты за изделия будут реже. Не рекомендуется выполнять тест с
числом строк в справочнике <span lang=EN-US style='mso-ansi-language:EN-US'>WARES</span><span
lang=EN-US> </span>менее 50, кроме целей отладки.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Wares</span></b>. Исходный справочник изделий
(«прайс-лист»), на основании которого далее формируются клиентские заказы (а по
ним – заказы поставщику, инвойсы и резервы). Справочник состоит из полей:</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Group</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span> – ссылка на группу изделий
(сейчас не используется);</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Numb</span>
– номенклатурный номер (вымышленные коды, напоминающие заводские номера
запасных частей)</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Name</span>
– название (реальные, взяты из прайс-листа одного из брендов)</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Price</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>purchase</span> – цена закупочная за
единицу</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>Price</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>reatail</span> – цена розничная за
единицу, рекомендованная поставщиком.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Поле <span lang=EN-US style='mso-ansi-language:EN-US'>Name</span>
используется для формирования шаблонов поиска по <span lang=EN-US
style='mso-ansi-language:EN-US'>similar</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>to</span>, если включена соотв-щая
настройка в таблице <span lang=EN-US style='mso-ansi-language:EN-US'>settings</span>.
Из каждого названия (например, «SPACER,CLUTCH PEDAL») будут выбраны все
возможные сочетания<span style='mso-spacerun:yes'>  </span>из двух его слов и
по ним составлен шаблон для подстановки в <span lang=EN-US style='mso-ansi-language:
EN-US'>similar</span><span lang=EN-US> </span><span lang=EN-US
style='mso-ansi-language:EN-US'>to</span>.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Z</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>used</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>views</span>. </b>Вспомогательная таблица, накапливающая в себе имена
представлений (<span lang=EN-US style='mso-ansi-language:EN-US'>view</span>),
использовавшихся при работе теста в динамическом <span lang=EN-US
style='mso-ansi-language:EN-US'>SQL</span>-коде функции <span lang=EN-US
style='mso-ansi-language:EN-US'>fn</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>get</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>random</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>id</span>. Эти представления не
имеют зависимостей и их можно случайно удалить. Поэтому прежде чем сделать
такое удаление, можно убедиться в действительной «ненужности» представления,
просмотрев данные таблицы <span lang=EN-US style='mso-ansi-language:EN-US'>z</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>used</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>views</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>2. GTT-</span>таблицы.<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Tmp</span>$</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>dep</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>docs</span><span lang=EN-US> </span></b>– служит для сохранения
результатов ХП <span lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>get</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>depended</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>docs</span>. Данная ХП вызывается в операциях
отмены проведения инвойсов и заказов поставщику, её описание см выше (получение
документов, зависимых от выбранного сейчас). </p>

<p class=MsoNormal>Таблица предназначена только для того, чтобы зафиксировать
производительность поиска зависимых документов (вызовами <span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>add</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>to</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>), т.к. эта операция может оказаться
затратной. Как только в таблицу будет помещён весь список, её содержимое
немедленно передается вызывающей ХП.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Tmp</span>$</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>idx</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>recalc</span><span lang=EN-US> </span></b>– используется в .<span
lang=EN-US style='mso-ansi-language:EN-US'>SQL</span>-скриптах (<span
lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>sales</span>.<span lang=EN-US style='mso-ansi-language:
EN-US'>tmp</span><span lang=EN-US> </span>и остальных) для сохранения в ней
данных о статистике индексов перед и после пересчета в ХП <span lang=EN-US
style='mso-ansi-language:EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>recalc</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>idx</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>stat</span>. Пересчет статистики выполняется
через <span lang=EN-US style='mso-ansi-language:EN-US'>execute</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>statement</span>
‘<span lang=EN-US style='mso-ansi-language:EN-US'>set</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>statistics</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>index</span> ‘||&lt;<span
lang=EN-US style='mso-ansi-language:EN-US'>index</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>name</span>&gt;, а команда <span lang=EN-US
style='mso-ansi-language:EN-US'>set</span><span lang=EN-US> </span><span
lang=EN-US style='mso-ansi-language:EN-US'>statistics</span><span lang=EN-US> </span>относится
к семейству <span lang=EN-US style='mso-ansi-language:EN-US'>DDL</span>, т.е.
она всегда будет выполняться в <i style='mso-bidi-font-style:normal'>отдельной</i>
транзакции. Это сделает результаты этой команды невидимыми для текущей <span
lang=EN-US style='mso-ansi-language:EN-US'>snapshot</span>-транзакции (для <span
lang=EN-US style='mso-ansi-language:EN-US'>ReadCommitted</span> они будут
видимыми, если выполнять <span lang=EN-US style='mso-ansi-language:EN-US'>execute</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>statement</span>
с добавлением ‘<span lang=EN-US style='mso-ansi-language:EN-US'>with</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>autonomous</span><span
lang=EN-US> </span><span lang=EN-US style='mso-ansi-language:EN-US'>transaction</span>’;
однако, все ХП в тесте выполняются только с <span lang=EN-US style='mso-ansi-language:
EN-US'>TIL</span> = <span lang=EN-US style='mso-ansi-language:EN-US'>SNAPSHOT</span>).
В связи с этим, было принято решение выполнять пересчет только после того, как
предыдущая информация из <span lang=EN-US style='mso-ansi-language:EN-US'>rdb</span>$<span
lang=EN-US style='mso-ansi-language:EN-US'>indices</span> будет записана в
«кеш» - т.е. в эту таблицу.<span lang=EN-US style='mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal>Пример использования этой таблицы можно найти только в
автоматически создаваемых скриптах:<span lang=EN-US style='mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>delete from tmp$idx_recalc; commit;<span
style='mso-spacerun:yes'>                               </span></span><span
style='font-size:11.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:11.0pt;font-family:"Courier New"'>--
Предварительное сохранение данных о текущей («старой») статистике:<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>insert into <b style='mso-bidi-font-weight:normal'>tmp$idx_recalc</b>(tab_name,
idx_name, idx_stat_befo)<span style='mso-spacerun:yes'>    </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>select ri.rdb$relation_name, ri.rdb$index_name,
ri.rdb$statistics <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>from rdb$indices ri<span
style='mso-spacerun:yes'>                                            </span><span
style='mso-spacerun:yes'>   </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>where<span
style='mso-spacerun:yes'>                                                            
</span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>   
</span>coalesce(ri.rdb$system_flag,0)=0<span
style='mso-spacerun:yes'>                              </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>and
ri.rdb$relation_name in ( 'DOC_DATA', 'DOC_LIST', 'QDISTR', 'QSTORNED',
'PDISTR', 'PSTORNED') <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>order by ri.rdb$relation_name, ri.rdb$index_name;<span
style='mso-spacerun:yes'>                  </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>                                                                  
</span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>commit; set transaction SNAPSHOT NO WAIT;<span
style='mso-spacerun:yes'>                          </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>                                                                  
</span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>set list on; select current_timestamp,
current_transaction, current_connection att from rdb$database; set list off; <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>set list off; set stat on; set echo on;<span
style='mso-spacerun:yes'>                            </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>select count(*) from <b style='mso-bidi-font-weight:
normal'>srv_recalc_idx_stat</b>; -- </span><span style='font-size:11.0pt;
font-family:"Courier New"'>это</span><span style='font-size:11.0pt;font-family:
"Courier New";mso-ansi-language:EN-US'> </span><span style='font-size:11.0pt;
font-family:"Courier New"'>сам</span><span style='font-size:11.0pt;font-family:
"Courier New";mso-ansi-language:EN-US'> </span><span style='font-size:11.0pt;
font-family:"Courier New"'>пересчет</span><span lang=EN-US style='font-size:
11.0pt;font-family:"Courier New";mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>set echo off; set stat off;<span
style='mso-spacerun:yes'>                                           </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>commit;<span
style='mso-spacerun:yes'>                                                              
</span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>                                                                     
</span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>merge into <b style='mso-bidi-font-weight:normal'>tmp$idx_recalc</b>
t<span style='mso-spacerun:yes'>                      </span><span
style='mso-spacerun:yes'>                     </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>using (<span
style='mso-spacerun:yes'>                                                              
</span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>       </span>select
ri.rdb$index_name idx_name, ri.rdb$statistics idx_afte<span
style='mso-spacerun:yes'>  </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>       </span>from
rdb$indices ri<span
style='mso-spacerun:yes'>                                            </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>      
</span>where<span style='mso-spacerun:yes'>         </span><span
style='mso-spacerun:yes'>                                                      </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>         
</span>coalesce(ri.rdb$system_flag,0)=0<span
style='mso-spacerun:yes'>                                </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>          </span>and
ri.rdb$relation_name in ( 'DOC_DATA', 'DOC_LIST', 'QDISTR',<span
style='mso-spacerun:yes'>  </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>                                       
</span>'QSTORNED', 'PDISTR', 'PSTORNED'<span style='mso-spacerun:yes'>  
</span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>                                     </span>)<span
style='mso-spacerun:yes'>                               </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>      </span>) s<span
style='mso-spacerun:yes'>                                                           
</span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>on t.idx_name = s.idx_name<span
style='mso-spacerun:yes'>                                            </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>when MATCHED then update set t.idx_stat_afte =
s.idx_afte;<span style='mso-spacerun:yes'>            </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>                                                                     
</span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>set width tab_name 15; set width idx_name 25;<span
style='mso-spacerun:yes'>                         </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span style='font-size:11.0pt;font-family:"Courier New"'>-- Вывод
окончательных данных с результатами: <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>select tab_name, idx_name, idx_stat_befo,
idx_stat_afte, idx_stat_diff <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>from <b style='mso-bidi-font-weight:normal'>tmp$idx_recalc</b><span
style='mso-spacerun:yes'>                                                  
</span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>where idx_stat_afte is NOT null;<span
style='mso-spacerun:yes'>                                      </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:11.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>delete from tmp$idx_recalc; commit;</span><span
lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>                     </span><span
style='mso-spacerun:yes'>              </span><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Tmp</span>$</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>log</span></b> – таблица, в которую добавляется запись при каждой
регистрации <i style='mso-bidi-font-style:normal'>начала</i> выполнения
какого-либо прикладного модуля, см. процедуру <span lang=EN-US
style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>add</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>to</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span>. Как только модуль <i
style='mso-bidi-font-style:normal'>завершает</i> свой основной код, процедура <span
lang=EN-US style='mso-ansi-language:EN-US'>sp</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>add</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>to</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>log</span> вызывается снова и при
этом она <i style='mso-bidi-font-style:normal'>найдет</i> запись в <span
lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>$<span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>log</span>. Факт этого нахождения строки используется алгоритмом так:
«раз строка найдена, значит, это <i style='mso-bidi-font-style:normal'>окончание</i>
выполнения такого-то модуля». В этом случае запись немедленно переносится из <span
lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>$<span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>log</span> в <span lang=EN-US style='mso-ansi-language:EN-US'>fixed</span>-таблицу
<span lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>log</span> (с удалением в <span lang=EN-US
style='mso-ansi-language:EN-US'>GTT</span>). </p>

<p class=MsoNormal>Если далее (в другом прикладном модуле):</p>

<p class=MsoNormal>1) всё пройдет также нормально, то в <span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>log</span> окажется еще одна строка, добавлявшаяся в <span lang=EN-US
style='mso-ansi-language:EN-US'>tmp</span>$<span lang=EN-US style='mso-ansi-language:
EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>log</span><span
lang=EN-US> </span>для этого модуля;</p>

<p class=MsoNormal>2) возникнет исключение,<span style='mso-spacerun:yes'> 
</span>то оно отменит все такие переносы строк, т.е. записи снова окажутся в <span
lang=EN-US style='mso-ansi-language:EN-US'>tmp</span>$<span lang=EN-US
style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>log</span> и будут удалены (<span lang=EN-US style='mso-ansi-language:
EN-US'>backout</span> в статистике) из <span lang=EN-US style='mso-ansi-language:
EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>log</span>.
Чтобы сохранить сведения, имеющиеся в этот момент в таблице <span lang=EN-US
style='mso-ansi-language:EN-US'>tmp</span>$<span lang=EN-US style='mso-ansi-language:
EN-US'>perf</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>log</span>,
будет выполнен перенос значений из всех её строк и полей в контекстные переменные
уровня <b style='mso-bidi-font-weight:normal'>сессии</b> и выдан старт
автономной транзакции, которая уже запишет содержимое этих переменных в <span
lang=EN-US style='mso-ansi-language:EN-US'>perf_log.<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Tmp</span>$</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>mon</span></b> – вспомогательная таблица для «кеширования» данных о
производительности, получаемых в ХП <span lang=EN-US style='mso-ansi-language:
EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>mon</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>perf</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>detailed</span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Tmp</span>$</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>result</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>set</span></b> – вспомогательная таблица для сохранения данных
документа, который сейчас удаляется, и выдачи их как результата завершения
процедуры, удалившей этот документ. Вывод таких данных удобен для отладки.
Скрипты, выполняемые <span lang=EN-US style='mso-ansi-language:EN-US'>isql</span>,
вместо данных используют только результат <span lang=EN-US style='mso-ansi-language:
EN-US'>count</span>(*) селдективных прикладных процедур.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>Tmp</span>$</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>shopping</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>cart</span></b> – «корзина покупателя». Таблица, хранящая выбранные
случайным образом изделия, по которой далее будет сформирован документ.</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>Описание хранимых запросов (</span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:14.0pt;
mso-ansi-language:EN-US'>view</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>)</span></b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='font-size:14.0pt;mso-ansi-language:EN-US'><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='font-size:14.0pt;mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>Все хранимые запросы, начинающиеся с ‘<span lang=EN-US
style='mso-ansi-language:EN-US'>V</span>_’, используются при получении
случайного <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span> – см.
вызовы функции <span lang=EN-US style='mso-ansi-language:EN-US'>fn</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>get</span>-<span lang=EN-US
style='mso-ansi-language:EN-US'>random</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>id</span>. Все хранимые запросы, начинающиеся с
‘<span lang=EN-US style='mso-ansi-language:EN-US'>Z</span>_’, были созданы для
удобства проверки получаемых результатов и оставлены в коде для возможной
будущей отладки.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>ВНИМАНИЕ</b>! Явных
зависимостей (вкладка ‘<span lang=EN-US style='mso-ansi-language:EN-US'>Dependencies</span>’
в среде <span lang=EN-US style='mso-ansi-language:EN-US'>IBExpert</span>) от
хранимых <span lang=EN-US style='mso-ansi-language:EN-US'>V</span>-запросов
нет, но это не значит, что их пожно удалять! Те имена, что «проходили» через <span
lang=EN-US style='mso-ansi-language:EN-US'>fn</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>get</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>random</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>id</span>
за время работы теста, накапливаются в таблице <span lang=EN-US
style='mso-ansi-language:EN-US'>Z</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>USED</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>VIEWS</span>.
Проверьте её содержимое, если собираетесь удалять какой-то из <span lang=EN-US
style='mso-ansi-language:EN-US'>V</span>-запросов.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Далее приводится описание <span lang=EN-US style='mso-ansi-language:
EN-US'>V</span>-запросов, в алфавитном порядке</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>V</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>add</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>invoice</span>_</b><b style='mso-bidi-font-weight:normal'><span
lang=EN-US style='mso-ansi-language:EN-US'>to</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>stock</span></b> –
возвращает перечень <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span><span
lang=EN-US> </span>документов, являющихся инвойсами от поставщиков, к которым
можно применять операцию «Провести инвойс» (ХП <span lang=EN-US
style='mso-ansi-language:EN-US'>sp_add_invoice_to_stock).<o:p></o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>V</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>all</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>customers</span></b><span lang=EN-US> </span>и <b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>V</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>all</span>_</b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>suppliers</span></b> – возвращает перечень <span
lang=EN-US style='mso-ansi-language:EN-US'>ID</span> контрагентов, являющихся
покупателями и поставщиками (соответственно). Используются при формировании
клиентского заказа, резерва по доступным остаткам (т.е. когда он не связан ни с
каким клиентским заказом) и заказа поставщику.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>V</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>all</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>wares</span></b> – проекция на справочник <span lang=EN-US
style='mso-ansi-language:EN-US'>wares</span>, без всякого дополнительного <span
lang=EN-US style='mso-ansi-language:EN-US'>where</span>-условия. Используется
только при создании нового клиентского заказа (т.е. когда создается «бизнес-цепочка»
документов).</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>V</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>cancel</span>_</b><span
lang=EN-US style='mso-ansi-language:EN-US'>xxx</span> – группа запросов,
относящихся к операциям удаления ранее созданных документов, либо к операциям,
отменяющим их состояние «проведён» и возвращающим такие документы в предыдущее
состояние.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>V</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>detailed</span></b> – развернутое представление документа, объединяющее
в себе как данные из его заголовка, так и данные его строк. Для складских
документов в этом <span lang=EN-US style='mso-ansi-language:EN-US'>view</span>
также показываются остатки – данные представления <span lang=EN-US
style='mso-ansi-language:EN-US'>v</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>saldo</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>
(см ниже). Это представление было нужно только при отладке работы процедур и
его использование сейчас ограничено только средой <span lang=EN-US
style='mso-ansi-language:EN-US'>IBE</span>: при вызове прикладной процедуры
она, перед тем как выдать результат, определяет имя приложения-клиента. Если
это имя содержит в себе строку ‘<span lang=EN-US style='mso-ansi-language:EN-US'>IBExpert</span>’,
то будут выданы данные именно из <span lang=EN-US style='mso-ansi-language:
EN-US'>v</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>doc</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>detailed</span>, в противном случае
это представление НЕ будет задействовано.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>V</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>max</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>id</span></b>_<span lang=EN-US style='mso-ansi-language:EN-US'>xxx</span>
и <b style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>v</span>_</b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>min</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>id</span></b>_<span
lang=EN-US style='mso-ansi-language:EN-US'>xxx</span> – вспомогательные <span
lang=EN-US style='mso-ansi-language:EN-US'>view</span><span lang=EN-US> </span>для
быстрого определения границ <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span>,
в рамках которых следует проводить поиск случайного значения в источнике <b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>v</span>_</b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>random</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>find</span></b>_<span
lang=EN-US style='mso-ansi-language:EN-US'>xxx</span>. При этом суффиксом ‘<span
lang=EN-US style='mso-ansi-language:EN-US'>xxx</span>’ обозначены следующие
операции:</p>

<p class=MsoNormal>‘<span lang=EN-US style='mso-ansi-language:EN-US'>avl</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>res</span>’ – создание резерва
изделий для последующей продаже клиенту, на основе имеющихся сейчас «свободных
остатков» (в том числе – только тех, что видимы незавершенной транзакции,
выполняющей сейчас проведение инвойса);</p>

<p class=MsoNormal>‘<span lang=EN-US style='mso-ansi-language:EN-US'>clo</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>ord</span>’ – создание заказа
поставщику на основе нескольких клиентских заказов, которые были созданы ранее;</p>

<p class=MsoNormal>‘<span lang=EN-US style='mso-ansi-language:EN-US'>clo</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>res</span>’ -<span
style='mso-spacerun:yes'>  </span>получение таких изделий из клиентских
заказов, по которым заказанное количество еще не полностью обеспечено соответствующими
резервами. Другими словами, поиск таких изделий из клиентских заказов, по
которым мы еще должны создать их резерв при первой же возможности (т.е. при
поступлении инвойса и его «проведении»).</p>

<p class=MsoNormal>‘<span lang=EN-US style='mso-ansi-language:EN-US'>ord</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>sup</span>’ – создание инвойса от
поставщика на основе нескольких наших заказов (ему или другим поставщикам).</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>V</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>our</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>firm</span></b> – возвращает список <span lang=EN-US style='mso-ansi-language:
EN-US'>ID</span><span lang=EN-US> </span>контрагентов, которые являются «нашей
фирмой» или её филиалами. Если создается клиентский заказ, в котором контрагент
имеет <span lang=EN-US style='mso-ansi-language:EN-US'>ID</span> из этого
перечня, то после проведения любого инвойса,<span style='mso-spacerun:yes'> 
</span>содержащего изделия из этого клиентского заказа, резервирование их
выполняться не будет. Изделия в итоге окажутся в свободном доступе и будут
сразу доступны для розничной продажи, без предварительного формирования
клиентского заказа.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>V</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>pdistr</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>non</span>_</b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>paid</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>invoices</span></b><span
lang=EN-US> </span>и <b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>v</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>pdistr</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>non</span>_</b><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>paid</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>realization</span></b><span
lang=EN-US> </span>– запросы для получения перечня <span lang=EN-US
style='mso-ansi-language:EN-US'>ID</span> инвойсов и резервов, находящихся в
состоянии «Проведён», по которым далее можно делать операцию их оплаты. Первый
из перечисленных используется для операции «Наша оплата поставщику», второй –
«Оплата нам от клиента».</p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>V</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>reserve</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>writeoff</span> – запрос для получения перечня
резервов, находящихся в состоянии «НЕ проведён», по которым далее можно
выполнять операцию «Проведение резерва» (т.е. списание товара и отражение этой
реализации на балансе покупателя).</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>V</span>_</b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>_</b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span></b> – представление, являющееся «источником» для процедуры
сборки количественных остатков (<span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>total</span>) и показывающее, какое количество по каждому виду остатка
необходимо <i style='mso-bidi-font-style:normal'>добавить</i> к
соответствующему изделию в таблице <span lang=EN-US style='mso-ansi-language:
EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>saldo</span>.
Данные этого представления НЕ являются теми остатками, которые будут в итоге!
Это всего лишь то, что надо <i style='mso-bidi-font-style:normal'>добавлять</i>
к ним.</p>

<p class=MsoNormal>После того, как ХП <span lang=EN-US style='mso-ansi-language:
EN-US'>srv</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>total</span> завершает своё очередное
выполнение, данные этого представления будут пустыми ввиду того, что эта ХП
«обнуляет» журнал количественных оборотов – таблицу <span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>turnover</span>_<span lang=EN-US style='mso-ansi-language:EN-US'>log</span>.
Если же обратиться к этому представлению в какой-то промежуточный момент (между
запусками ХП <span lang=EN-US style='mso-ansi-language:EN-US'>srv</span>_<span
lang=EN-US style='mso-ansi-language:EN-US'>make</span>_<span lang=EN-US
style='mso-ansi-language:EN-US'>invnt</span>_<span lang=EN-US style='mso-ansi-language:
EN-US'>total</span>), то в нём можно увидеть и отрицательные значения в
столбцах с количеством. Это означает, что с момента последней сборки оборотов
были операции удаления документов.</p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>Ошибки в ядре СУБД </span></b><b style='mso-bidi-font-weight:
normal'><span lang=EN-US style='font-size:14.0pt;mso-ansi-language:EN-US'>Firebird</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:14.0pt'> 3.</span></b><b
style='mso-bidi-font-weight:normal'><span lang=EN-US style='font-size:14.0pt;
mso-ansi-language:EN-US'>x</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:14.0pt'>, найденные при написаниии данного теста<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>1. http://tracker.firebirdsql.org/<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4360 <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>SELECT from derived table which contains GROUP BY on
field with literal value returns wrong result<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4366<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Wrong result of WHERE predicate when it contains NULL
IS NOT DISTINCT FROM (select min(NULL) from ...)<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4371<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Create function/sp which references to non-existent
exception: error message is &quot;Error while parsing function's BLR&quot;
instead of &quot;exception not defined&quot;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4379<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Poor performance of explicit cursors containing
correlated subqueries in the select list<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4388<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>SELECT WITH LOCK may enter an infinite loop for a
single record<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4399<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Inner join (nested loop) does not take in account
predicate in WHERE clause when driven source is VIEW based on GROUP BY<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4400<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>MERGE set ROW_COUNT to 1 when number of handled
records more than 1<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4416<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>FB bugchecks (index inconsistent) attempting to create
index with key length &gt; 3375 bytes (charset = NONE) when database page_size
= 16384<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4418<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Regression: Can not run ALTER TABLE DROP CONSTRAINT
&lt;FK_name&gt; after recent changes in svn<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4422<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>FB crashes when using row_number()over( PARTITION BY
x) in ORDER by clause<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4426<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Attachments remains in MON$ tables, owners &gt;<st1:metricconverter
ProductID="0 in" w:st="on">0 in</st1:metricconverter> fb_lock_print result
after FB bugcheck + restart<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4447<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Positioned UPDATE statement prohibits index usage for
the subsequent cursor field references<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4452<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Can`t create two collations with different names if
autoddl = OFF in FB 2.5.3<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4453<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Regression: NOT NULL constraint, declared in domain,
does not work<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4472<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Message &quot;Modifying function &lt;F&gt; which is
currently in use&quot; when running script with AUTODDL=OFF and &lt;F&gt; is
called from INTERNAL function declared in other unit<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4479<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Can`t restore from .fbk which contains two tables
linked by PK/FK and trivial function which returns int: message about corrupted
RDB$FLAGS for trigger CHECK_1 appears<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4480<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>ISQL issues warning: &quot;Bad debug info format&quot;
when connect to database with stored function after it's restoring<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4483<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Changed data not visible in WHEN-section if exception
occured inside SP that has been called from this code<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4488<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Wrong results of FOR SELECT &lt;L&gt; FROM &lt;T&gt;
AS CURSOR &lt;C&gt; and table &lt;T&gt; is modified inside cursor's begin...end
block<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4490<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><a
href="http://tracker.firebirdsql.org/browse/CORE-4490"><span lang=EN-US
style='color:windowtext;mso-ansi-language:EN-US;text-decoration:none;
text-underline:none'>AUTODDL OFF: can`t create procedure P2 which references on
proc P1 and both of them are created in same transaction (and ONLY at 2nd, 4th,
6th etc even runs of the script)</span></a></span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4492<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Adding 2nd condition in WHERE which containing
RDB$DBKEY leads to NATURAL plan</span><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4497<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Regression in 3.0.x: wrong handling in FOR-cursor when
NOT EXISTS( select from &lt;VIEW&gt; ) statement is used to check results
obtained from SP<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4498<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>FB 3.0 crashes when getting an explained plan for a
DBKEY based retrieval<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4515<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><a
href="http://tracker.firebirdsql.org/browse/CORE-4515"><span lang=EN-US
style='color:windowtext;mso-ansi-language:EN-US;text-decoration:none;
text-underline:none'>Regression in 3.0: trace reports UPDATES in statistics
when doing INSERT into &lt;some_table&gt;</span></a></span><span lang=EN-US
style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4521<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><a
href="http://tracker.firebirdsql.org/browse/CORE-4521"><span lang=EN-US
style='color:windowtext;mso-ansi-language:EN-US;text-decoration:none;
text-underline:none'>ISQL: AV message after SET WIDTH &lt;F&gt; &lt;N&gt; +
pressing Ctrl_BREAK</span></a></span><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4530<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><a
href="http://tracker.firebirdsql.org/browse/CORE-4530"><span lang=EN-US
style='color:windowtext;mso-ansi-language:EN-US;text-decoration:none;
text-underline:none'>DB_KEY based join of two tables may be ineffective</span></a></span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4537<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><a
href="http://tracker.firebirdsql.org/browse/CORE-4537"><span lang=EN-US
style='color:windowtext;mso-ansi-language:EN-US;text-decoration:none;
text-underline:none'>OR'ed optimization in 3.0 is ineffective if WHERE-clause
contains two expression and they do NOT match to order of SP input arguments</span></a></span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4540<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><a
href="http://tracker.firebirdsql.org/browse/CORE-4540"><span lang=EN-US
style='color:windowtext;mso-ansi-language:EN-US;text-decoration:none;
text-underline:none'>Regression in 3.0: compiler requires aliasing of table in
UPDATE ... </span><span style='color:windowtext;text-decoration:none;
text-underline:none'>RETURNING statement when include RDB$DB_KEY in fields list</span></a></span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4553<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Error stack can be broken after several minutes under
heavy workload<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4557<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><a
href="http://tracker.firebirdsql.org/browse/CORE-4557"><span lang=EN-US
style='color:windowtext;mso-ansi-language:EN-US;text-decoration:none;
text-underline:none'>FB 3.0 crashes on EXIT (or QUIT) command if use
UTF8-collation + create domain based on it + issue SHOW DOMAIN</span></a></span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4560<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>gfix -v -full hangs without message &quot;Resource
temporarily unavailable&quot; when .fdb is opened by some attach (only in
SuperCLASSIC)<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4561 <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><a
href="http://tracker.firebirdsql.org/browse/CORE-4561"><span lang=EN-US
style='color:windowtext;mso-ansi-language:EN-US;text-decoration:none;
text-underline:none'>Bugcheckabort with message &quot;wrong record length
(183), file: vio.cpp line: 1311&quot; when use cursor with &quot;order by
ID+0&quot; and &quot;for update with lock&quot;</span></a></span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4565 <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><a
href="http://tracker.firebirdsql.org/browse/CORE-4565"><span lang=EN-US
style='color:windowtext;mso-ansi-language:EN-US;text-decoration:none;
text-underline:none'>GDSCODE can have value = 0 in WHEN-section under some
concurrent env., only in SC or CS (not in SS)</span></a></span><span
lang=EN-US style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4568<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><a
href="http://tracker.firebirdsql.org/browse/CORE-4568"><span lang=EN-US
style='color:windowtext;mso-ansi-language:EN-US;text-decoration:none;
text-underline:none'>Server may crash while disconnecting from the database
under load</span></a></span><span lang=EN-US style='font-size:10.0pt;
font-family:"Courier New";mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4571<o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><a
href="http://tracker.firebirdsql.org/browse/CORE-4571"><span lang=EN-US
style='color:windowtext;mso-ansi-language:EN-US;text-decoration:none;
text-underline:none'>Can't select from table with ICU column when database
(.FDB) is created on LINUX with icu 4.2.1 and then copied to WINDOWS</span></a><o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4597<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>'show exception' command hangs on empty database<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>CORE-4618<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Rollback doesn`t undo changes when MERGE statement
updates the same target rows multiple times and PLAN MERGE is used<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=EN-US
style='mso-ansi-language:EN-US'>2. http://svn.code.sf.net/p/firebird/code/firebird/trunk/ChangeLog<o:p></o:p></span></b></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>2014-06-26 09:43<span style='mso-spacerun:yes'> 
</span>alexpeshkoff <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>   </span>M
src/jrd/DatabaseSnapshot.cpp<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Fixed very frequent segfault in monitoring code (CS/SC):
tdbb-&gt;attachment was not set in thread_db::getCharSet() function used to
convert monitoring strings<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>2014-05-20 08:05<span style='mso-spacerun:yes'> 
</span>alexpeshkoff <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>   </span>M
src/common/MsgMetadata.h<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>   </span>M
src/common/classes/InternalMessageBuffer.cpp<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>   </span>M
src/jrd/PreparedStatement.cpp<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>   </span>M
src/jrd/extds/InternalDS.cpp<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Fixed assertion<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>2014-05-06 12:25<span style='mso-spacerun:yes'> 
</span>alexpeshkoff <o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>   </span>M
src/jrd/jrd.cpp<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>   </span></span><span
style='font-size:10.0pt;font-family:"Courier New"'>M src/jrd/svc.cpp<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:EN-US'>Fixed a bug, privately reported<o:p></o:p></span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<pre><span lang=EN-US style='mso-ansi-language:EN-US'>2014-08-11 14:02<span style='mso-spacerun:yes'>  </span>dimitr <o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>   </span>M src/jrd/RuntimeStatistics.h<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>Regression in 3.0: trace reports UPDATES in statistics when doing INSERT into &lt;some_table&gt;.<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'> 2014-08-10 20:11<span style='mso-spacerun:yes'>  </span>dimitr <o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>   </span>M src/jrd/Attachment.cpp<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>   </span>M src/jrd/Attachment.h<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>   </span>M src/jrd/Monitoring.cpp<o:p></o:p></span></pre><pre><span
lang=EN-US style='mso-ansi-language:EN-US'>Better (methinks) synchronization for the monitoring stuff. </span>Being field tested.</pre>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>
